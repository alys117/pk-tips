window.TILE_VERSION = {
  ditu: {
    normal: { version: '088', updateDate: '20220712' },
    satellite: { version: '009', updateDate: '20220712' },
    normalTraffic: { version: '081', updateDate: '20220712' },
    satelliteTraffic: { version: '083', updateDate: '20220712' },
    mapJS: { version: '104', updateDate: '20220712' },
    satelliteStreet: { version: '083', updateDate: '20220712' },
    earthVector: { version: '001', updateDate: '20220712' },
  },
  webapp: {
    high_normal: { version: '001', updateDate: '20220712' },
    lower_normal: { version: '002', updateDate: '20220712' },
  },
  api_for_mobile: {
    vector: { version: '002', updateDate: '20220712' },
    vectorIcon: { version: '002', updateDate: '20220712' },
  },
}
window.MSV = { mapstyle: { version: '001', updateDate: '20220706' } }
window.BMAP_AUTHENTIC_KEY = 'Eul8g1mSUP8z9XHwh9Hql0EpctbrcEK9'
!(function (t) {
  'use strict'
  function e(t) {
    return t &&
      t.__esModule &&
      Object.prototype.hasOwnProperty.call(t, 'default')
      ? t.default
      : t
  }
  function n(t, e) {
    return t((e = { exports: {} }), e.exports), e.exports
  }
  Object.values ||
    (Object.values = function (t) {
      if (t !== Object(t))
        throw new TypeError('Object.values called on a non-object')
      var e,
        n = []
      for (e in t) Object.prototype.hasOwnProperty.call(t, e) && n.push(t[e])
      return n
    }),
    'function' != typeof Object.assign &&
      Object.defineProperty(Object, 'assign', {
        value: function (t) {
          if (null == t)
            throw new TypeError('Cannot convert undefined or null to object')
          for (
            var e = Object(t), n = 0;
            n < (arguments.length <= 1 ? 0 : arguments.length - 1);
            n++
          ) {
            var r =
              n + 1 < 1 || arguments.length <= n + 1 ? void 0 : arguments[n + 1]
            if (null != r)
              for (var i in r)
                Object.prototype.hasOwnProperty.call(r, i) && (e[i] = r[i])
          }
          return e
        },
        writable: !0,
        configurable: !0,
      })
  var r = n(function (t) {
      function e(n) {
        return (
          (t.exports = e =
            'function' == typeof Symbol && 'symbol' == typeof Symbol.iterator
              ? function (t) {
                  return typeof t
                }
              : function (t) {
                  return t &&
                    'function' == typeof Symbol &&
                    t.constructor === Symbol &&
                    t !== Symbol.prototype
                    ? 'symbol'
                    : typeof t
                }),
          (t.exports.__esModule = !0),
          (t.exports.default = t.exports),
          e(n)
        )
      }
      ;(t.exports = e),
        (t.exports.__esModule = !0),
        (t.exports.default = t.exports)
    }),
    i = e(r),
    o = e(
      n(function (t) {
        function e(t, e) {
          for (var n = 0; n < e.length; n++) {
            var r = e[n]
            ;(r.enumerable = r.enumerable || !1),
              (r.configurable = !0),
              'value' in r && (r.writable = !0),
              Object.defineProperty(t, r.key, r)
          }
        }
        ;(t.exports = function (t, n, r) {
          return (
            n && e(t.prototype, n),
            r && e(t, r),
            Object.defineProperty(t, 'prototype', { writable: !1 }),
            t
          )
        }),
          (t.exports.__esModule = !0),
          (t.exports.default = t.exports)
      })
    ),
    a = e(
      n(function (t) {
        ;(t.exports = function (t) {
          if (void 0 === t)
            throw new ReferenceError(
              "this hasn't been initialised - super() hasn't been called"
            )
          return t
        }),
          (t.exports.__esModule = !0),
          (t.exports.default = t.exports)
      })
    ),
    s = n(function (t) {
      function e(n, r) {
        return (
          (t.exports = e =
            Object.setPrototypeOf ||
            function (t, e) {
              return (t.__proto__ = e), t
            }),
          (t.exports.__esModule = !0),
          (t.exports.default = t.exports),
          e(n, r)
        )
      }
      ;(t.exports = e),
        (t.exports.__esModule = !0),
        (t.exports.default = t.exports)
    })
  e(s)
  var u,
    h,
    c = e(
      n(function (t) {
        ;(t.exports = function (t, e) {
          ;(t.prototype = Object.create(e.prototype)),
            (t.prototype.constructor = t),
            s(t, e)
        }),
          (t.exports.__esModule = !0),
          (t.exports.default = t.exports)
      })
    ),
    l = function (t, e) {
      var n = this
      ;(this.width = void 0),
        (this.height = void 0),
        (this.equals = function (t) {
          return t && n.width === t.width && n.height === t.height
        }),
        (this.width = t || 0),
        (this.height = e || 0)
    },
    f = (function () {
      function t(t, e) {
        ;(this.lng = void 0),
          (this.lat = void 0),
          (this.lng = +t),
          (this.lat = +e)
      }
      return (
        (t.prototype.equals = function (t) {
          return t && this.lat === t.lat && this.lng === t.lng
        }),
        t
      )
    })(),
    d = {
      REFRESH: 'refresh',
      DATA_LOADED: 'dataload',
      THUMB_LOADED: 'thumb_loaded',
      SET_POV: 'set_pov',
      POV_CHANGED: 'pov_changed',
      POV_CHANGED_END: 'pov_changed_end',
      ZOOM_CHANGED: 'zoom_changed',
      SIZE_CHANGED: 'size_changed',
      SET_ID: 'set_id',
      SET_POSITION: 'set_position',
      ID_CHANGED: 'id_changed',
      POSITION_CHANGED: 'position_changed',
      TOUCH_START: 'touchstart',
      TOUCH_END: 'touchend',
      CLICK: 'click',
      DOUBLE_CLICK: 'dblclick',
      LINK_CLICK: 'link_click',
      OVERLAY_ADD: 'overlay_add',
      OVERLAY_REMOVE: 'overlay_remove',
      OVERLAYS_CLEAR: 'overlays_clear',
      PANO_ERROR: 'pano_error',
      LINK_VISIBLE_CHANGE: 'links_visible_changed',
      DESTROY: 'destroy',
      SCENE_CHANGE_END: 'scene_change_end',
    },
    p = {
      TYPE_INNER: 'inter',
      TYPE_STREET: 'street',
      RADIUS: 3e3,
      COLS: 16,
      ROWS: 8,
      TILE_MAX_ZOOM: 4,
      TILE_MIN_ZOOM: 1,
      MIN_PITCH: -90,
      MAX_PITCH: 90,
      MAX_ZOOM: 4,
      MIN_ZOOM: 1,
      TILE_BASE_URLS: [
        '//mapsv0.bdimg.com/scape/',
        '//mapsv1.bdimg.com/scape/',
      ],
      TOPO_ARROW_TEXTURE:
        '//webmap0.bdimg.com/wolfman/static/pano/images/webgl/topo_arrow_06f0f2e.png',
      FISHEYE_DURATION: 1500,
      FISHEYE_DELAY: 2e3,
    },
    v =
      ((u = {}),
      (h = (navigator.userAgent || '').toLowerCase()),
      (u.isAndroid = h.includes('android')),
      (u.isFirefox = h.includes('firefox')),
      (u.isIos = /ip(hone|ad|od)/i.test(h)),
      (u.isWeixin = h.includes('micromessenger')),
      (u.isWeibo = h.includes('weibo')),
      (u.isWeChatOrWeiBo = u.isWeixin && u.isWeibo),
      (u.isBaiduMap = h.includes('baidumap_')),
      (u.isMobile =
        /android|webos|ip(hone|ad|od)|opera (mini|mobi|tablet)|iemobile|windows.+(phone|touch)|mobile|fennec|kindle (Fire)|Silk|maemo|blackberry|playbook; (touch|kbd)|Symbian(OS)|Ubuntu Touch/i.test(
          h
        )),
      (u.isPc = !u.isMobile),
      u),
    m = function (t) {
      for (
        var e = arguments.length <= 1 ? 0 : arguments.length - 1, n = 0;
        n < e;
        n++
      ) {
        var r =
          n + 1 < 1 || arguments.length <= n + 1 ? void 0 : arguments[n + 1]
        for (var i in r)
          Object.prototype.hasOwnProperty.call(r, i) && (t[i] = r[i])
      }
      return t
    },
    g = function (t) {
      return (t * Math.PI) / 180
    },
    y = function (t) {
      return (180 * t) / Math.PI
    },
    _ = function (t) {
      return t - 360 * Math.floor(t / 360)
    },
    x = function () {
      return Date.now()
    }
  var b = function t() {
      var e = t
      if ('boolean' == typeof e._supportWebGL) return e._supportWebGL
      if (!window.WebGLRenderingContext) return (e._supportWebGL = !1), !1
      var n = null,
        r = document.createElement('canvas')
      try {
        ;(n = r.getContext('webgl') || r.getContext('experimental-webgl')) &&
          n instanceof WebGLRenderingContext &&
          (e._supportWebGL = !0)
      } catch (t) {
        e._supportWebGL = !1
      }
      return null === n && (e._supportWebGL = !1), e._supportWebGL
    },
    M = function (t) {
      for (
        var e, n = Number.MAX_VALUE, r = -Number.MAX_VALUE, i = t.length - 1;
        i >= 0;
        i--
      )
        n > (e = t[i]) && (n = e), r < e && (r = e)
      return { min: n, max: r }
    },
    E = {
      g: function (t) {
        return 'string' == typeof t || t instanceof String
          ? document.getElementById(t)
          : t && t.nodeName && (1 === t.nodeType || 9 === t.nodeType)
          ? t
          : null
      },
      show: function (t) {
        var e = E.g(t)
        return e && (e.style.display = ''), e
      },
      hide: function (t) {
        var e = E.g(t)
        return e && (e.style.display = 'none'), t
      },
      create: function (t) {
        var e =
            arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {},
          n = document.createElement(t)
        for (var r in e)
          Object.prototype.hasOwnProperty.call(e, r) && n.setAttribute(r, e[r])
        return n
      },
      getCurrentStyle: function (t) {
        return window.getComputedStyle(t, null)
      },
    },
    w = function (t, e, n) {
      var r,
        o,
        a,
        s = '',
        u = [],
        h = 'jsonp' + Math.ceil(1e5 * Math.random()),
        c = t.indexOf('?') > 0 ? '&' : '?'
      for (var l in ((n = Object.assign(
        {},
        { jsonpCallback: 'jsonp', timeout: 5e4, jsonp: 'callback' },
        n
      )),
      e))
        ({}.hasOwnProperty.call(e, l) &&
          ((s =
            'object' === i(e[l])
              ? l + '=' + JSON.stringify(e[l])
              : l + '=' + e[l]),
          u.push(s)))
      function f() {
        o.parentNode && o.parentNode.removeChild(o),
          r && clearTimeout(r),
          (window[h] = null)
      }
      return (
        (t += c + u.join('&')),
        (a = document.getElementsByTagName('script')[0] || document.head),
        (t = t + '&' + n.jsonp + '=' + h),
        ((o = document.createElement('script')).src = t),
        (o.type = 'text/javascript'),
        a.parentNode.appendChild(o, a),
        new Promise(function (t, e) {
          ;(window[h] = function (e) {
            if (e && 'string' == typeof e)
              try {
                e = JSON.parse(e)
              } catch (t) {
                ;(e = {}), console.error('[ERROR] Parse Error.')
              }
            t(e), f()
          }),
            (o.onerror = function (t) {
              f(),
                e({
                  errno: -2,
                  errmsg: '[ERROR] Load Error: '.concat(t),
                  data: {},
                })
            }),
            n.timeout &&
              (r = setTimeout(function () {
                f(), e({ errno: -3, errmsg: '[ERROR] Time out.', data: {} })
              }, n.timeout))
        })
      )
    },
    T = (function () {
      function t() {
        var t =
            arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
          e =
            arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}
        ;(this._size = 0),
          (this._cache = void 0),
          (this.keyList = []),
          (this._options = void 0),
          (this._size = t),
          (this._cache = new window.Map())
        var n = { clearCallback: null }
        this._options = Object.assign({}, n, e)
      }
      var e = t.prototype
      return (
        (e.setData = function (t, e) {
          0 !== this._size &&
            (this._cache.size >= this._size && this._removeOld(),
            this._cache.has(t) || this.keyList.push(t),
            this._cache.set(t, e))
        }),
        (e.getData = function (t) {
          return this._cache.get(t)
        }),
        (e._removeOld = function () {
          for (var t = Math.round(0.6 * this._size), e = 0; e < t; e++) {
            var n = this.keyList[e]
            this._options.clearCallback &&
              this._options.clearCallback(this.getData(n)),
              this._cache.delete(n)
          }
          this.keyList.splice(0, t)
        }),
        (e.clear = function () {
          this._cache.clear(), (this.keyList = [])
        }),
        o(t, [
          {
            key: 'cacheCount',
            get: function () {
              return this._cache.size
            },
          },
        ]),
        t
      )
    })(),
    A = (function () {
      function t() {
        var t = this
        ;(this.rid = ''),
          (this.roadName = ''),
          (this.roadWidth = 5),
          (this.isCurrentRoad = 0),
          (this.pointList = []),
          (this.getTopoInRoad = function (e) {
            var n = [],
              r = t.pointList,
              i = r.length,
              o = t.getPointByPanoId(e)
            if (!o || i <= 1) return n
            var a = o.order
            return (
              0 === a
                ? n.push(t.generateTopoData(o.dir, r[1]))
                : a === i - 1
                ? n.push(t.generateTopoData(r[a - 1].dir + 180, r[a - 1]))
                : (n.push(
                    t.generateTopoData((r[a - 1].dir + 180) % 360, r[a - 1])
                  ),
                  n.push(t.generateTopoData(r[a].dir, r[a + 1]))),
              n
            )
          }),
          (this.getPointByPanoId = function (e) {
            for (var n, r = t.pointList, i = 0, o = r.length; i < o; i++)
              if (r[i].panoId === e) {
                n = r[i]
                break
              }
            return n
          })
      }
      return (
        (t.prototype.generateTopoData = function (t, e) {
          return (
            void 0 !== e && ((e.topoDir = t), (e.roadName = this.roadName)), e
          )
        }),
        t
      )
    })(),
    R = function () {
      var t = this
      ;(this.image = void 0),
        (this.panoId = ''),
        (this.iid = ''),
        (this.panoType = ''),
        (this.panoX = 0),
        (this.panoY = 0),
        (this.panoZ = 0),
        (this.heading = 0),
        (this.pitch = 0),
        (this.defaultHeading = void 0),
        (this.defaultPitch = void 0),
        (this.northDir = 0),
        (this.fixHeading = 0),
        (this.fixPitch = 0),
        (this.fixRoll = 0),
        (this.deviceHeight = 0),
        (this.date = '20130822'),
        (this.time = ''),
        (this.provider = 1),
        (this.admission = 'GS(2013)6021'),
        (this.photos = []),
        (this.roadName = ''),
        (this.roads = []),
        (this.vpoints = []),
        (this.topoArray = void 0),
        (this.currentRoad = void 0),
        (this.roadWidth = void 0),
        (this.getCurrentRoad = function () {
          if (t.currentRoad) return t.currentRoad
          for (var e = t.roads, n = 0, r = e.length; n < r; n++)
            if (e[n].isCurrentRoad) {
              t.currentRoad = e[n]
              break
            }
          return t.currentRoad
        }),
        (this.getTopos = function () {
          if (t.topoArray) return t.topoArray
          if (
            (t.currentRoad || (t.currentRoad = t.getCurrentRoad()),
            !t.currentRoad)
          )
            return []
          if (
            ((t.topoArray = t.currentRoad.getTopoInRoad(t.panoId)),
            t.vpoints.length < 1)
          )
            return t.topoArray
          for (var e, n = t.vpoints.length - 1; n >= 0; n--)
            ((e = t.vpoints[n]).topoDir = e.dir), t.topoArray.push(e)
          return t.topoArray
        }),
        (this.getRoadWidth = function () {
          return (
            void 0 === t.roadWidth &&
              (t.currentRoad || (t.currentRoad = t.getCurrentRoad()),
              t.currentRoad
                ? (t.roadWidth = t.currentRoad.roadWidth)
                : (t.roadWidth = 0)),
            t.roadWidth
          )
        })
    }
  function C(t) {
    var e = {}
    return (
      (e.panoId = t.PID),
      (e.panoType = t.Type),
      (e.rid = t.RID),
      (e.dir = t.DIR),
      (e.roadName = t.RoadName),
      (e.order = t.Order),
      (e.panoX = t.X / 100),
      (e.panoY = t.Y / 100),
      void 0 !== t.CPointX &&
        void 0 !== t.CPointY &&
        (e.cPoint = { x: t.CPointX / 100, y: t.CPointY / 100 }),
      e
    )
  }
  function S(t) {
    if (!t) return console.error('Get none from server'), null
    var e = t.result
    if (e && 0 !== e.error) return console.error('Get error from server'), null
    var n = t.content
    if (void 0 === n || 0 === n.length || void 0 === n[0])
      return console.error('Get empty data from server'), null
    var r = n[0],
      i = new R(),
      o = r.Roll,
      a = {}
    if (((i.panoId = r.ID), r.Inters instanceof Array)) {
      var s = r.Inters[0]
      void 0 !== s && (i.iid = s.IID)
    }
    if (
      ((i.panoType = r.Type),
      (i.panoX = (r.X || 0) / 100),
      (i.panoY = (r.Y || 0) / 100),
      (i.panoZ = (r.Z || 0) / 100),
      (i.heading = void 0 !== r.MoveDir ? r.MoveDir : 0),
      (i.northDir = r.NorthDir),
      (i.fixHeading = void 0 !== r.Heading ? r.Heading : 270 - r.NorthDir),
      (i.fixPitch = r.Pitch),
      (i.fixRoll = 90 < o || -90 > o ? 0 : o),
      (i.deviceHeight = r.DeviceHeight),
      (i.date = r.Date || i.date),
      (i.time = r.Time),
      (i.provider = void 0 !== r.Provider ? r.Provider : i.provider),
      (i.admission = r.Admission || i.admission),
      (i.timeLine = r.TimeLine || []),
      (i.roadName = r.Rname),
      r.Roads)
    ) {
      var u = r.Roads
      i.roads = u.map(function (t) {
        return (
          (a[t.ID] = t.Name),
          (function (t) {
            var e = new A()
            if (
              ((e.rid = t.ID),
              (e.roadName = t.Name),
              (e.roadWidth = void 0 !== t.Width ? t.Width / 100 : 0),
              (e.isCurrentRoad = t.IsCurrent || 0),
              t.Panos)
            )
              for (var n = t.Panos, r = 0, i = n.length; r < i; r++)
                e.pointList.push(C(n[r]))
            return e
          })(t)
        )
      })
    }
    if (r.Links)
      for (var h = r.Links, c = h.length, l = 0; l < c; l++) {
        var f = h[l]
        ;(f.RoadName = a[f.RID]), i.vpoints.push(C(f))
      }
    return (i.photos = r.Photos || []), i
  }
  var P = !!window.PANORAMA_URL,
    D = (function () {
      function t(e) {
        var n = this
        ;(this.getPanoById = function (e) {
          var r = function () {},
            i = ''
          P
            ? ((i = ''.concat(t.SERVICE_URL, '/si?qt=sdata&sid=').concat(e)),
              (r = fetch(i).then(function (t) {
                return t.json()
              })))
            : ((i = ''.concat(t.SERVICE_URL, '?qt=sdata&sid=').concat(e)),
              (r = n.getDataByUrl(i))),
            r
              .then(function (t) {
                var e = S(t)
                if (null === e) throw new Error('数据解析异常')
                return (
                  n._cache.setData(i, t),
                  n._pano.dispatchEvent(d.DATA_LOADED, { data: e }),
                  n._pano.dispatchEvent(d.ID_CHANGED, e.panoId),
                  n._pano.dispatchEvent(
                    d.POSITION_CHANGED,
                    new f(e.panoX, e.panoY)
                  ),
                  e
                )
              })
              .catch(function (t) {
                n._pano.dispatchEvent({ type: d.PANO_ERROR, data: t })
              })
        }),
          (this.getPanoByLocation = function (e, r) {
            var i = function () {},
              o = ''
            P
              ? ((o = ''
                  .concat(t.SERVICE_URL, '/qsi?qt=qsdata&x=')
                  .concat(e.lng, '&y=')
                  .concat(e.lat)
                  .concat(r ? '&r=' + r : '', '&action=1&coord_type=')
                  .concat(window.BMAPGL_84 ? 'wgs84ll' : '')),
                (i = fetch(o).then(function (t) {
                  return t.json()
                })))
              : ((o = ''
                  .concat(t.SERVICE_URL, '?qt=qsdata&x=')
                  .concat(e.lng, '&y=')
                  .concat(e.lat)
                  .concat(r ? '&r=' + r : '', '&action=1')),
                (i = n.getDataByUrl(o))),
              i
                .then(function (t) {
                  var r = S(t)
                  n._cache.setData(o, t),
                    n._pano.dispatchEvent(d.DATA_LOADED, { data: r }),
                    n._pano.dispatchEvent(d.POSITION_CHANGED, e)
                })
                .catch(function (t) {
                  n._pano.dispatchEvent({ type: d.PANO_ERROR, data: t })
                })
          }),
          (this._pano = e),
          (this._cache = new T(10))
      }
      return (
        (t.prototype.getDataByUrl = function (t) {
          var e = this._cache.getData(t)
          return e ? Promise.resolve(e) : w(t, {}, { jsonp: 'fn' })
        }),
        t
      )
    })()
  D.SERVICE_URL = P
    ? window.PANORAMA_URL + '/panorama'
    : '//mapsv0.bdimg.com/scape/'
  var I = n(function (t) {
      function e(t, e, n, r, i, o, a) {
        try {
          var s = t[o](a),
            u = s.value
        } catch (t) {
          return void n(t)
        }
        s.done ? e(u) : Promise.resolve(u).then(r, i)
      }
      ;(t.exports = function (t) {
        return function () {
          var n = this,
            r = arguments
          return new Promise(function (i, o) {
            var a = t.apply(n, r)
            function s(t) {
              e(a, i, o, s, u, 'next', t)
            }
            function u(t) {
              e(a, i, o, s, u, 'throw', t)
            }
            s(void 0)
          })
        }
      }),
        (t.exports.__esModule = !0),
        (t.exports.default = t.exports)
    }),
    L = e(I),
    O = n(function (t) {
      var e = (function (t) {
        var e,
          n = Object.prototype,
          r = n.hasOwnProperty,
          i = 'function' == typeof Symbol ? Symbol : {},
          o = i.iterator || '@@iterator',
          a = i.asyncIterator || '@@asyncIterator',
          s = i.toStringTag || '@@toStringTag'
        function u(t, e, n) {
          return (
            Object.defineProperty(t, e, {
              value: n,
              enumerable: !0,
              configurable: !0,
              writable: !0,
            }),
            t[e]
          )
        }
        try {
          u({}, '')
        } catch (t) {
          u = function (t, e, n) {
            return (t[e] = n)
          }
        }
        function h(t, e, n, r) {
          var i = e && e.prototype instanceof m ? e : m,
            o = Object.create(i.prototype),
            a = new C(r || [])
          return (
            (o._invoke = (function (t, e, n) {
              var r = l
              return function (i, o) {
                if (r === d) throw new Error('Generator is already running')
                if (r === p) {
                  if ('throw' === i) throw o
                  return P()
                }
                for (n.method = i, n.arg = o; ; ) {
                  var a = n.delegate
                  if (a) {
                    var s = T(a, n)
                    if (s) {
                      if (s === v) continue
                      return s
                    }
                  }
                  if ('next' === n.method) n.sent = n._sent = n.arg
                  else if ('throw' === n.method) {
                    if (r === l) throw ((r = p), n.arg)
                    n.dispatchException(n.arg)
                  } else 'return' === n.method && n.abrupt('return', n.arg)
                  r = d
                  var u = c(t, e, n)
                  if ('normal' === u.type) {
                    if (((r = n.done ? p : f), u.arg === v)) continue
                    return { value: u.arg, done: n.done }
                  }
                  'throw' === u.type &&
                    ((r = p), (n.method = 'throw'), (n.arg = u.arg))
                }
              }
            })(t, n, a)),
            o
          )
        }
        function c(t, e, n) {
          try {
            return { type: 'normal', arg: t.call(e, n) }
          } catch (t) {
            return { type: 'throw', arg: t }
          }
        }
        t.wrap = h
        var l = 'suspendedStart',
          f = 'suspendedYield',
          d = 'executing',
          p = 'completed',
          v = {}
        function m() {}
        function g() {}
        function y() {}
        var _ = {}
        u(_, o, function () {
          return this
        })
        var x = Object.getPrototypeOf,
          b = x && x(x(S([])))
        b && b !== n && r.call(b, o) && (_ = b)
        var M = (y.prototype = m.prototype = Object.create(_))
        function E(t) {
          ;['next', 'throw', 'return'].forEach(function (e) {
            u(t, e, function (t) {
              return this._invoke(e, t)
            })
          })
        }
        function w(t, e) {
          function n(i, o, a, s) {
            var u = c(t[i], t, o)
            if ('throw' !== u.type) {
              var h = u.arg,
                l = h.value
              return l && 'object' == typeof l && r.call(l, '__await')
                ? e.resolve(l.__await).then(
                    function (t) {
                      n('next', t, a, s)
                    },
                    function (t) {
                      n('throw', t, a, s)
                    }
                  )
                : e.resolve(l).then(
                    function (t) {
                      ;(h.value = t), a(h)
                    },
                    function (t) {
                      return n('throw', t, a, s)
                    }
                  )
            }
            s(u.arg)
          }
          var i
          this._invoke = function (t, r) {
            function o() {
              return new e(function (e, i) {
                n(t, r, e, i)
              })
            }
            return (i = i ? i.then(o, o) : o())
          }
        }
        function T(t, n) {
          var r = t.iterator[n.method]
          if (r === e) {
            if (((n.delegate = null), 'throw' === n.method)) {
              if (
                t.iterator.return &&
                ((n.method = 'return'),
                (n.arg = e),
                T(t, n),
                'throw' === n.method)
              )
                return v
              ;(n.method = 'throw'),
                (n.arg = new TypeError(
                  "The iterator does not provide a 'throw' method"
                ))
            }
            return v
          }
          var i = c(r, t.iterator, n.arg)
          if ('throw' === i.type)
            return (n.method = 'throw'), (n.arg = i.arg), (n.delegate = null), v
          var o = i.arg
          return o
            ? o.done
              ? ((n[t.resultName] = o.value),
                (n.next = t.nextLoc),
                'return' !== n.method && ((n.method = 'next'), (n.arg = e)),
                (n.delegate = null),
                v)
              : o
            : ((n.method = 'throw'),
              (n.arg = new TypeError('iterator result is not an object')),
              (n.delegate = null),
              v)
        }
        function A(t) {
          var e = { tryLoc: t[0] }
          1 in t && (e.catchLoc = t[1]),
            2 in t && ((e.finallyLoc = t[2]), (e.afterLoc = t[3])),
            this.tryEntries.push(e)
        }
        function R(t) {
          var e = t.completion || {}
          ;(e.type = 'normal'), delete e.arg, (t.completion = e)
        }
        function C(t) {
          ;(this.tryEntries = [{ tryLoc: 'root' }]),
            t.forEach(A, this),
            this.reset(!0)
        }
        function S(t) {
          if (t) {
            var n = t[o]
            if (n) return n.call(t)
            if ('function' == typeof t.next) return t
            if (!isNaN(t.length)) {
              var i = -1,
                a = function n() {
                  for (; ++i < t.length; )
                    if (r.call(t, i)) return (n.value = t[i]), (n.done = !1), n
                  return (n.value = e), (n.done = !0), n
                }
              return (a.next = a)
            }
          }
          return { next: P }
        }
        function P() {
          return { value: e, done: !0 }
        }
        return (
          (g.prototype = y),
          u(M, 'constructor', y),
          u(y, 'constructor', g),
          (g.displayName = u(y, s, 'GeneratorFunction')),
          (t.isGeneratorFunction = function (t) {
            var e = 'function' == typeof t && t.constructor
            return (
              !!e &&
              (e === g || 'GeneratorFunction' === (e.displayName || e.name))
            )
          }),
          (t.mark = function (t) {
            return (
              Object.setPrototypeOf
                ? Object.setPrototypeOf(t, y)
                : ((t.__proto__ = y), u(t, s, 'GeneratorFunction')),
              (t.prototype = Object.create(M)),
              t
            )
          }),
          (t.awrap = function (t) {
            return { __await: t }
          }),
          E(w.prototype),
          u(w.prototype, a, function () {
            return this
          }),
          (t.AsyncIterator = w),
          (t.async = function (e, n, r, i, o) {
            void 0 === o && (o = Promise)
            var a = new w(h(e, n, r, i), o)
            return t.isGeneratorFunction(n)
              ? a
              : a.next().then(function (t) {
                  return t.done ? t.value : a.next()
                })
          }),
          E(M),
          u(M, s, 'Generator'),
          u(M, o, function () {
            return this
          }),
          u(M, 'toString', function () {
            return '[object Generator]'
          }),
          (t.keys = function (t) {
            var e = []
            for (var n in t) e.push(n)
            return (
              e.reverse(),
              function n() {
                for (; e.length; ) {
                  var r = e.pop()
                  if (r in t) return (n.value = r), (n.done = !1), n
                }
                return (n.done = !0), n
              }
            )
          }),
          (t.values = S),
          (C.prototype = {
            constructor: C,
            reset: function (t) {
              if (
                ((this.prev = 0),
                (this.next = 0),
                (this.sent = this._sent = e),
                (this.done = !1),
                (this.delegate = null),
                (this.method = 'next'),
                (this.arg = e),
                this.tryEntries.forEach(R),
                !t)
              )
                for (var n in this)
                  't' === n.charAt(0) &&
                    r.call(this, n) &&
                    !isNaN(+n.slice(1)) &&
                    (this[n] = e)
            },
            stop: function () {
              this.done = !0
              var t = this.tryEntries[0].completion
              if ('throw' === t.type) throw t.arg
              return this.rval
            },
            dispatchException: function (t) {
              if (this.done) throw t
              var n = this
              function i(r, i) {
                return (
                  (s.type = 'throw'),
                  (s.arg = t),
                  (n.next = r),
                  i && ((n.method = 'next'), (n.arg = e)),
                  !!i
                )
              }
              for (var o = this.tryEntries.length - 1; o >= 0; --o) {
                var a = this.tryEntries[o],
                  s = a.completion
                if ('root' === a.tryLoc) return i('end')
                if (a.tryLoc <= this.prev) {
                  var u = r.call(a, 'catchLoc'),
                    h = r.call(a, 'finallyLoc')
                  if (u && h) {
                    if (this.prev < a.catchLoc) return i(a.catchLoc, !0)
                    if (this.prev < a.finallyLoc) return i(a.finallyLoc)
                  } else if (u) {
                    if (this.prev < a.catchLoc) return i(a.catchLoc, !0)
                  } else {
                    if (!h)
                      throw new Error('try statement without catch or finally')
                    if (this.prev < a.finallyLoc) return i(a.finallyLoc)
                  }
                }
              }
            },
            abrupt: function (t, e) {
              for (var n = this.tryEntries.length - 1; n >= 0; --n) {
                var i = this.tryEntries[n]
                if (
                  i.tryLoc <= this.prev &&
                  r.call(i, 'finallyLoc') &&
                  this.prev < i.finallyLoc
                ) {
                  var o = i
                  break
                }
              }
              o &&
                ('break' === t || 'continue' === t) &&
                o.tryLoc <= e &&
                e <= o.finallyLoc &&
                (o = null)
              var a = o ? o.completion : {}
              return (
                (a.type = t),
                (a.arg = e),
                o
                  ? ((this.method = 'next'), (this.next = o.finallyLoc), v)
                  : this.complete(a)
              )
            },
            complete: function (t, e) {
              if ('throw' === t.type) throw t.arg
              return (
                'break' === t.type || 'continue' === t.type
                  ? (this.next = t.arg)
                  : 'return' === t.type
                  ? ((this.rval = this.arg = t.arg),
                    (this.method = 'return'),
                    (this.next = 'end'))
                  : 'normal' === t.type && e && (this.next = e),
                v
              )
            },
            finish: function (t) {
              for (var e = this.tryEntries.length - 1; e >= 0; --e) {
                var n = this.tryEntries[e]
                if (n.finallyLoc === t)
                  return this.complete(n.completion, n.afterLoc), R(n), v
              }
            },
            catch: function (t) {
              for (var e = this.tryEntries.length - 1; e >= 0; --e) {
                var n = this.tryEntries[e]
                if (n.tryLoc === t) {
                  var r = n.completion
                  if ('throw' === r.type) {
                    var i = r.arg
                    R(n)
                  }
                  return i
                }
              }
              throw new Error('illegal catch attempt')
            },
            delegateYield: function (t, n, r) {
              return (
                (this.delegate = { iterator: S(t), resultName: n, nextLoc: r }),
                'next' === this.method && (this.arg = e),
                v
              )
            },
          }),
          t
        )
      })(t.exports)
      try {
        regeneratorRuntime = e
      } catch (t) {
        'object' == typeof globalThis
          ? (globalThis.regeneratorRuntime = e)
          : Function('r', 'regeneratorRuntime = r')(e)
      }
    }),
    B = O
  function k(t, e) {
    if (!t) throw new Error('math.gl assertion '.concat(e))
  }
  const U = {}
  function N(t, { precision: e = U.precision || 4 } = {}) {
    return (
      (t = (function (t) {
        return Math.round(t / U.EPSILON) * U.EPSILON
      })(t)),
      ''.concat(parseFloat(t.toPrecision(e)))
    )
  }
  function F(t) {
    return (
      Array.isArray(t) || (ArrayBuffer.isView(t) && !(t instanceof DataView))
    )
  }
  function j(t, e, n) {
    const r = U.EPSILON
    n && (U.EPSILON = n)
    try {
      if (t === e) return !0
      if (F(t) && F(e)) {
        if (t.length !== e.length) return !1
        for (let n = 0; n < t.length; ++n) if (!j(t[n], e[n])) return !1
        return !0
      }
      return t && t.equals
        ? t.equals(e)
        : e && e.equals
        ? e.equals(t)
        : !(!Number.isFinite(t) || !Number.isFinite(e)) &&
          Math.abs(t - e) <= U.EPSILON * Math.max(1, Math.abs(t), Math.abs(e))
    } finally {
      U.EPSILON = r
    }
  }
  ;(U.EPSILON = 1e-12),
    (U.debug = !1),
    (U.precision = 4),
    (U.printTypes = !1),
    (U.printDegrees = !1),
    (U.printRowMajor = !0)
  class z extends (function (t) {
    function e() {
      var e = Reflect.construct(t, Array.from(arguments))
      return Object.setPrototypeOf(e, Object.getPrototypeOf(this)), e
    }
    return (
      (e.prototype = Object.create(t.prototype, {
        constructor: {
          value: t,
          enumerable: !1,
          writable: !0,
          configurable: !0,
        },
      })),
      Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : (e.__proto__ = t),
      e
    )
  })(Array) {
    get ELEMENTS() {
      return k(!1), 0
    }
    clone() {
      return new this.constructor().copy(this)
    }
    from(t) {
      return Array.isArray(t) ? this.copy(t) : this.fromObject(t)
    }
    fromArray(t, e = 0) {
      for (let n = 0; n < this.ELEMENTS; ++n) this[n] = t[n + e]
      return this.check()
    }
    to(t) {
      return t === this ? this : F(t) ? this.toArray(t) : this.toObject(t)
    }
    toTarget(t) {
      return t ? this.to(t) : this
    }
    toArray(t = [], e = 0) {
      for (let n = 0; n < this.ELEMENTS; ++n) t[e + n] = this[n]
      return t
    }
    toFloat32Array() {
      return new Float32Array(this)
    }
    toString() {
      return this.formatString(U)
    }
    formatString(t) {
      let e = ''
      for (let n = 0; n < this.ELEMENTS; ++n)
        e += (n > 0 ? ', ' : '') + N(this[n], t)
      return ''
        .concat(t.printTypes ? this.constructor.name : '', '[')
        .concat(e, ']')
    }
    equals(t) {
      if (!t || this.length !== t.length) return !1
      for (let e = 0; e < this.ELEMENTS; ++e) if (!j(this[e], t[e])) return !1
      return !0
    }
    exactEquals(t) {
      if (!t || this.length !== t.length) return !1
      for (let e = 0; e < this.ELEMENTS; ++e) if (this[e] !== t[e]) return !1
      return !0
    }
    negate() {
      for (let t = 0; t < this.ELEMENTS; ++t) this[t] = -this[t]
      return this.check()
    }
    lerp(t, e, n) {
      void 0 === n && ((n = e), (e = t), (t = this))
      for (let r = 0; r < this.ELEMENTS; ++r) {
        const i = t[r]
        this[r] = i + n * (e[r] - i)
      }
      return this.check()
    }
    min(t) {
      for (let e = 0; e < this.ELEMENTS; ++e) this[e] = Math.min(t[e], this[e])
      return this.check()
    }
    max(t) {
      for (let e = 0; e < this.ELEMENTS; ++e) this[e] = Math.max(t[e], this[e])
      return this.check()
    }
    clamp(t, e) {
      for (let n = 0; n < this.ELEMENTS; ++n)
        this[n] = Math.min(Math.max(this[n], t[n]), e[n])
      return this.check()
    }
    add(...t) {
      for (const e of t) for (let t = 0; t < this.ELEMENTS; ++t) this[t] += e[t]
      return this.check()
    }
    subtract(...t) {
      for (const e of t) for (let t = 0; t < this.ELEMENTS; ++t) this[t] -= e[t]
      return this.check()
    }
    scale(t) {
      if (Array.isArray(t)) return this.multiply(t)
      for (let e = 0; e < this.ELEMENTS; ++e) this[e] *= t
      return this.check()
    }
    sub(t) {
      return this.subtract(t)
    }
    setScalar(t) {
      for (let e = 0; e < this.ELEMENTS; ++e) this[e] = t
      return this.check()
    }
    addScalar(t) {
      for (let e = 0; e < this.ELEMENTS; ++e) this[e] += t
      return this.check()
    }
    subScalar(t) {
      return this.addScalar(-t)
    }
    multiplyScalar(t) {
      for (let e = 0; e < this.ELEMENTS; ++e) this[e] *= t
      return this.check()
    }
    divideScalar(t) {
      return this.scale(1 / t)
    }
    clampScalar(t, e) {
      for (let n = 0; n < this.ELEMENTS; ++n)
        this[n] = Math.min(Math.max(this[n], t), e)
      return this.check()
    }
    multiplyByScalar(t) {
      return this.scale(t)
    }
    get elements() {
      return this
    }
    check() {
      if (U.debug && !this.validate())
        throw new Error(
          'math.gl: '.concat(
            this.constructor.name,
            " some fields set to invalid numbers'"
          )
        )
      return this
    }
    validate() {
      let t = this.length === this.ELEMENTS
      for (let e = 0; e < this.ELEMENTS; ++e) t = t && Number.isFinite(this[e])
      return t
    }
  }
  function V(t) {
    if (!Number.isFinite(t)) throw new Error('Invalid number '.concat(t))
    return t
  }
  function G(t, e, n = '') {
    if (
      U.debug &&
      !(function (t, e) {
        if (t.length !== e) return !1
        for (let e = 0; e < t.length; ++e) if (!Number.isFinite(t[e])) return !1
        return !0
      })(t, e)
    )
      throw new Error(
        'math.gl: '.concat(n, " some fields set to invalid numbers'")
      )
    return t
  }
  const H = {}
  function W(t, e) {
    H[t] ||
      ((H[t] = !0),
      console.warn(
        ''
          .concat(t, ' has been removed in version ')
          .concat(e, ', see upgrade guide for more information')
      ))
  }
  class Z extends z {
    get ELEMENTS() {
      return k(!1), 0
    }
    copy(t) {
      return k(!1), this
    }
    get x() {
      return this[0]
    }
    set x(t) {
      this[0] = V(t)
    }
    get y() {
      return this[1]
    }
    set y(t) {
      this[1] = V(t)
    }
    len() {
      return Math.sqrt(this.lengthSquared())
    }
    magnitude() {
      return this.len()
    }
    lengthSquared() {
      let t = 0
      for (let e = 0; e < this.ELEMENTS; ++e) t += this[e] * this[e]
      return t
    }
    magnitudeSquared() {
      return this.lengthSquared()
    }
    distance(t) {
      return Math.sqrt(this.distanceSquared(t))
    }
    distanceSquared(t) {
      let e = 0
      for (let n = 0; n < this.ELEMENTS; ++n) {
        const r = this[n] - t[n]
        e += r * r
      }
      return V(e)
    }
    dot(t) {
      let e = 0
      for (let n = 0; n < this.ELEMENTS; ++n) e += this[n] * t[n]
      return V(e)
    }
    normalize() {
      const t = this.magnitude()
      if (0 !== t) for (let e = 0; e < this.ELEMENTS; ++e) this[e] /= t
      return this.check()
    }
    multiply(...t) {
      for (const e of t) for (let t = 0; t < this.ELEMENTS; ++t) this[t] *= e[t]
      return this.check()
    }
    divide(...t) {
      for (const e of t) for (let t = 0; t < this.ELEMENTS; ++t) this[t] /= e[t]
      return this.check()
    }
    lengthSq() {
      return this.lengthSquared()
    }
    distanceTo(t) {
      return this.distance(t)
    }
    distanceToSquared(t) {
      return this.distanceSquared(t)
    }
    getComponent(t) {
      return k(t >= 0 && t < this.ELEMENTS, 'index is out of range'), V(this[t])
    }
    setComponent(t, e) {
      return (
        k(t >= 0 && t < this.ELEMENTS, 'index is out of range'),
        (this[t] = e),
        this.check()
      )
    }
    addVectors(t, e) {
      return this.copy(t).add(e)
    }
    subVectors(t, e) {
      return this.copy(t).subtract(e)
    }
    multiplyVectors(t, e) {
      return this.copy(t).multiply(e)
    }
    addScaledVector(t, e) {
      return this.add(new this.constructor(t).multiplyScalar(e))
    }
  }
  var q = 1e-6,
    Y = 'undefined' != typeof Float32Array ? Float32Array : Array,
    X = Math.random
  function K() {
    var t = new Y(2)
    return Y != Float32Array && ((t[0] = 0), (t[1] = 0)), t
  }
  function Q(t, e) {
    var n = new Y(2)
    return (n[0] = t), (n[1] = e), n
  }
  function J(t, e, n) {
    return (t[0] = e[0] - n[0]), (t[1] = e[1] - n[1]), t
  }
  function $(t, e, n) {
    return (t[0] = e[0] * n[0]), (t[1] = e[1] * n[1]), t
  }
  function tt(t, e, n) {
    return (t[0] = e[0] / n[0]), (t[1] = e[1] / n[1]), t
  }
  function et(t, e) {
    var n = e[0] - t[0],
      r = e[1] - t[1]
    return Math.hypot(n, r)
  }
  function nt(t, e) {
    var n = e[0] - t[0],
      r = e[1] - t[1]
    return n * n + r * r
  }
  function rt(t) {
    var e = t[0],
      n = t[1]
    return Math.hypot(e, n)
  }
  function it(t) {
    var e = t[0],
      n = t[1]
    return e * e + n * n
  }
  function ot(t, e, n) {
    var r = e[0],
      i = e[1]
    return (
      (t[0] = n[0] * r + n[4] * i + n[12]),
      (t[1] = n[1] * r + n[5] * i + n[13]),
      t
    )
  }
  Math.hypot ||
    (Math.hypot = function () {
      for (var t = 0, e = arguments.length; e--; )
        t += arguments[e] * arguments[e]
      return Math.sqrt(t)
    })
  var at,
    st = rt,
    ut = J,
    ht = $,
    ct = tt,
    lt = et,
    ft = nt,
    dt = it,
    pt =
      ((at = K()),
      function (t, e, n, r, i, o) {
        var a, s
        for (
          e || (e = 2),
            n || (n = 0),
            s = r ? Math.min(r * e + n, t.length) : t.length,
            a = n;
          a < s;
          a += e
        )
          (at[0] = t[a]),
            (at[1] = t[a + 1]),
            i(at, at, o),
            (t[a] = at[0]),
            (t[a + 1] = at[1])
        return t
      }),
    vt = Object.freeze({
      __proto__: null,
      create: K,
      clone: function (t) {
        var e = new Y(2)
        return (e[0] = t[0]), (e[1] = t[1]), e
      },
      fromValues: Q,
      copy: function (t, e) {
        return (t[0] = e[0]), (t[1] = e[1]), t
      },
      set: function (t, e, n) {
        return (t[0] = e), (t[1] = n), t
      },
      add: function (t, e, n) {
        return (t[0] = e[0] + n[0]), (t[1] = e[1] + n[1]), t
      },
      subtract: J,
      multiply: $,
      divide: tt,
      ceil: function (t, e) {
        return (t[0] = Math.ceil(e[0])), (t[1] = Math.ceil(e[1])), t
      },
      floor: function (t, e) {
        return (t[0] = Math.floor(e[0])), (t[1] = Math.floor(e[1])), t
      },
      min: function (t, e, n) {
        return (t[0] = Math.min(e[0], n[0])), (t[1] = Math.min(e[1], n[1])), t
      },
      max: function (t, e, n) {
        return (t[0] = Math.max(e[0], n[0])), (t[1] = Math.max(e[1], n[1])), t
      },
      round: function (t, e) {
        return (t[0] = Math.round(e[0])), (t[1] = Math.round(e[1])), t
      },
      scale: function (t, e, n) {
        return (t[0] = e[0] * n), (t[1] = e[1] * n), t
      },
      scaleAndAdd: function (t, e, n, r) {
        return (t[0] = e[0] + n[0] * r), (t[1] = e[1] + n[1] * r), t
      },
      distance: et,
      squaredDistance: nt,
      length: rt,
      squaredLength: it,
      negate: function (t, e) {
        return (t[0] = -e[0]), (t[1] = -e[1]), t
      },
      inverse: function (t, e) {
        return (t[0] = 1 / e[0]), (t[1] = 1 / e[1]), t
      },
      normalize: function (t, e) {
        var n = e[0],
          r = e[1],
          i = n * n + r * r
        return (
          i > 0 && (i = 1 / Math.sqrt(i)),
          (t[0] = e[0] * i),
          (t[1] = e[1] * i),
          t
        )
      },
      dot: function (t, e) {
        return t[0] * e[0] + t[1] * e[1]
      },
      cross: function (t, e, n) {
        var r = e[0] * n[1] - e[1] * n[0]
        return (t[0] = t[1] = 0), (t[2] = r), t
      },
      lerp: function (t, e, n, r) {
        var i = e[0],
          o = e[1]
        return (t[0] = i + r * (n[0] - i)), (t[1] = o + r * (n[1] - o)), t
      },
      random: function (t, e) {
        e = e || 1
        var n = 2 * X() * Math.PI
        return (t[0] = Math.cos(n) * e), (t[1] = Math.sin(n) * e), t
      },
      transformMat2: function (t, e, n) {
        var r = e[0],
          i = e[1]
        return (t[0] = n[0] * r + n[2] * i), (t[1] = n[1] * r + n[3] * i), t
      },
      transformMat2d: function (t, e, n) {
        var r = e[0],
          i = e[1]
        return (
          (t[0] = n[0] * r + n[2] * i + n[4]),
          (t[1] = n[1] * r + n[3] * i + n[5]),
          t
        )
      },
      transformMat3: function (t, e, n) {
        var r = e[0],
          i = e[1]
        return (
          (t[0] = n[0] * r + n[3] * i + n[6]),
          (t[1] = n[1] * r + n[4] * i + n[7]),
          t
        )
      },
      transformMat4: ot,
      rotate: function (t, e, n, r) {
        var i = e[0] - n[0],
          o = e[1] - n[1],
          a = Math.sin(r),
          s = Math.cos(r)
        return (t[0] = i * s - o * a + n[0]), (t[1] = i * a + o * s + n[1]), t
      },
      angle: function (t, e) {
        var n = t[0],
          r = t[1],
          i = e[0],
          o = e[1],
          a = Math.sqrt(n * n + r * r) * Math.sqrt(i * i + o * o),
          s = a && (n * i + r * o) / a
        return Math.acos(Math.min(Math.max(s, -1), 1))
      },
      zero: function (t) {
        return (t[0] = 0), (t[1] = 0), t
      },
      str: function (t) {
        return 'vec2(' + t[0] + ', ' + t[1] + ')'
      },
      exactEquals: function (t, e) {
        return t[0] === e[0] && t[1] === e[1]
      },
      equals: function (t, e) {
        var n = t[0],
          r = t[1],
          i = e[0],
          o = e[1]
        return (
          Math.abs(n - i) <= q * Math.max(1, Math.abs(n), Math.abs(i)) &&
          Math.abs(r - o) <= q * Math.max(1, Math.abs(r), Math.abs(o))
        )
      },
      len: st,
      sub: ut,
      mul: ht,
      div: ct,
      dist: lt,
      sqrDist: ft,
      sqrLen: dt,
      forEach: pt,
    })
  function mt(t, e, n) {
    const r = e[0],
      i = e[1],
      o = e[2],
      a = n[3] * r + n[7] * i + n[11] * o || 1
    return (
      (t[0] = (n[0] * r + n[4] * i + n[8] * o) / a),
      (t[1] = (n[1] * r + n[5] * i + n[9] * o) / a),
      (t[2] = (n[2] * r + n[6] * i + n[10] * o) / a),
      t
    )
  }
  function gt() {
    var t = new Y(3)
    return Y != Float32Array && ((t[0] = 0), (t[1] = 0), (t[2] = 0)), t
  }
  function yt(t) {
    var e = new Y(3)
    return (e[0] = t[0]), (e[1] = t[1]), (e[2] = t[2]), e
  }
  function _t(t) {
    var e = t[0],
      n = t[1],
      r = t[2]
    return Math.hypot(e, n, r)
  }
  function xt(t, e, n) {
    var r = new Y(3)
    return (r[0] = t), (r[1] = e), (r[2] = n), r
  }
  function bt(t, e) {
    return (t[0] = e[0]), (t[1] = e[1]), (t[2] = e[2]), t
  }
  function Mt(t, e, n) {
    return (t[0] = e[0] + n[0]), (t[1] = e[1] + n[1]), (t[2] = e[2] + n[2]), t
  }
  function Et(t, e, n) {
    return (t[0] = e[0] - n[0]), (t[1] = e[1] - n[1]), (t[2] = e[2] - n[2]), t
  }
  function wt(t, e, n) {
    return (t[0] = e[0] * n[0]), (t[1] = e[1] * n[1]), (t[2] = e[2] * n[2]), t
  }
  function Tt(t, e, n) {
    return (t[0] = e[0] / n[0]), (t[1] = e[1] / n[1]), (t[2] = e[2] / n[2]), t
  }
  function At(t, e, n) {
    return (t[0] = e[0] * n), (t[1] = e[1] * n), (t[2] = e[2] * n), t
  }
  function Rt(t, e) {
    var n = e[0] - t[0],
      r = e[1] - t[1],
      i = e[2] - t[2]
    return Math.hypot(n, r, i)
  }
  function Ct(t, e) {
    var n = e[0] - t[0],
      r = e[1] - t[1],
      i = e[2] - t[2]
    return n * n + r * r + i * i
  }
  function St(t) {
    var e = t[0],
      n = t[1],
      r = t[2]
    return e * e + n * n + r * r
  }
  function Pt(t, e) {
    var n = e[0],
      r = e[1],
      i = e[2],
      o = n * n + r * r + i * i
    return (
      o > 0 && (o = 1 / Math.sqrt(o)),
      (t[0] = e[0] * o),
      (t[1] = e[1] * o),
      (t[2] = e[2] * o),
      t
    )
  }
  function Dt(t, e) {
    return t[0] * e[0] + t[1] * e[1] + t[2] * e[2]
  }
  function It(t, e, n) {
    var r = e[0],
      i = e[1],
      o = e[2],
      a = n[0],
      s = n[1],
      u = n[2]
    return (
      (t[0] = i * u - o * s), (t[1] = o * a - r * u), (t[2] = r * s - i * a), t
    )
  }
  function Lt(t, e, n) {
    var r = e[0],
      i = e[1],
      o = e[2],
      a = n[3] * r + n[7] * i + n[11] * o + n[15]
    return (
      (a = a || 1),
      (t[0] = (n[0] * r + n[4] * i + n[8] * o + n[12]) / a),
      (t[1] = (n[1] * r + n[5] * i + n[9] * o + n[13]) / a),
      (t[2] = (n[2] * r + n[6] * i + n[10] * o + n[14]) / a),
      t
    )
  }
  function Ot(t, e, n) {
    var r = e[0],
      i = e[1],
      o = e[2]
    return (
      (t[0] = r * n[0] + i * n[3] + o * n[6]),
      (t[1] = r * n[1] + i * n[4] + o * n[7]),
      (t[2] = r * n[2] + i * n[5] + o * n[8]),
      t
    )
  }
  function Bt(t, e, n) {
    var r = n[0],
      i = n[1],
      o = n[2],
      a = n[3],
      s = e[0],
      u = e[1],
      h = e[2],
      c = i * h - o * u,
      l = o * s - r * h,
      f = r * u - i * s,
      d = i * f - o * l,
      p = o * c - r * f,
      v = r * l - i * c,
      m = 2 * a
    return (
      (c *= m),
      (l *= m),
      (f *= m),
      (d *= 2),
      (p *= 2),
      (v *= 2),
      (t[0] = s + c + d),
      (t[1] = u + l + p),
      (t[2] = h + f + v),
      t
    )
  }
  function kt(t, e, n, r) {
    var i = [],
      o = []
    return (
      (i[0] = e[0] - n[0]),
      (i[1] = e[1] - n[1]),
      (i[2] = e[2] - n[2]),
      (o[0] = i[0]),
      (o[1] = i[1] * Math.cos(r) - i[2] * Math.sin(r)),
      (o[2] = i[1] * Math.sin(r) + i[2] * Math.cos(r)),
      (t[0] = o[0] + n[0]),
      (t[1] = o[1] + n[1]),
      (t[2] = o[2] + n[2]),
      t
    )
  }
  function Ut(t, e, n, r) {
    var i = [],
      o = []
    return (
      (i[0] = e[0] - n[0]),
      (i[1] = e[1] - n[1]),
      (i[2] = e[2] - n[2]),
      (o[0] = i[2] * Math.sin(r) + i[0] * Math.cos(r)),
      (o[1] = i[1]),
      (o[2] = i[2] * Math.cos(r) - i[0] * Math.sin(r)),
      (t[0] = o[0] + n[0]),
      (t[1] = o[1] + n[1]),
      (t[2] = o[2] + n[2]),
      t
    )
  }
  function Nt(t, e, n, r) {
    var i = [],
      o = []
    return (
      (i[0] = e[0] - n[0]),
      (i[1] = e[1] - n[1]),
      (i[2] = e[2] - n[2]),
      (o[0] = i[0] * Math.cos(r) - i[1] * Math.sin(r)),
      (o[1] = i[0] * Math.sin(r) + i[1] * Math.cos(r)),
      (o[2] = i[2]),
      (t[0] = o[0] + n[0]),
      (t[1] = o[1] + n[1]),
      (t[2] = o[2] + n[2]),
      t
    )
  }
  function Ft(t, e) {
    var n = t[0],
      r = t[1],
      i = t[2],
      o = e[0],
      a = e[1],
      s = e[2],
      u = Math.sqrt(n * n + r * r + i * i) * Math.sqrt(o * o + a * a + s * s),
      h = u && Dt(t, e) / u
    return Math.acos(Math.min(Math.max(h, -1), 1))
  }
  function jt(t, e) {
    var n = t[0],
      r = t[1],
      i = t[2],
      o = e[0],
      a = e[1],
      s = e[2]
    return (
      Math.abs(n - o) <= q * Math.max(1, Math.abs(n), Math.abs(o)) &&
      Math.abs(r - a) <= q * Math.max(1, Math.abs(r), Math.abs(a)) &&
      Math.abs(i - s) <= q * Math.max(1, Math.abs(i), Math.abs(s))
    )
  }
  var zt = Et,
    Vt = wt,
    Gt = Tt,
    Ht = Rt,
    Wt = Ct,
    Zt = _t,
    qt = St,
    Yt = (function () {
      var t = gt()
      return function (e, n, r, i, o, a) {
        var s, u
        for (
          n || (n = 3),
            r || (r = 0),
            u = i ? Math.min(i * n + r, e.length) : e.length,
            s = r;
          s < u;
          s += n
        )
          (t[0] = e[s]),
            (t[1] = e[s + 1]),
            (t[2] = e[s + 2]),
            o(t, t, a),
            (e[s] = t[0]),
            (e[s + 1] = t[1]),
            (e[s + 2] = t[2])
        return e
      }
    })(),
    Xt = Object.freeze({
      __proto__: null,
      create: gt,
      clone: yt,
      length: _t,
      fromValues: xt,
      copy: bt,
      set: function (t, e, n, r) {
        return (t[0] = e), (t[1] = n), (t[2] = r), t
      },
      add: Mt,
      subtract: Et,
      multiply: wt,
      divide: Tt,
      ceil: function (t, e) {
        return (
          (t[0] = Math.ceil(e[0])),
          (t[1] = Math.ceil(e[1])),
          (t[2] = Math.ceil(e[2])),
          t
        )
      },
      floor: function (t, e) {
        return (
          (t[0] = Math.floor(e[0])),
          (t[1] = Math.floor(e[1])),
          (t[2] = Math.floor(e[2])),
          t
        )
      },
      min: function (t, e, n) {
        return (
          (t[0] = Math.min(e[0], n[0])),
          (t[1] = Math.min(e[1], n[1])),
          (t[2] = Math.min(e[2], n[2])),
          t
        )
      },
      max: function (t, e, n) {
        return (
          (t[0] = Math.max(e[0], n[0])),
          (t[1] = Math.max(e[1], n[1])),
          (t[2] = Math.max(e[2], n[2])),
          t
        )
      },
      round: function (t, e) {
        return (
          (t[0] = Math.round(e[0])),
          (t[1] = Math.round(e[1])),
          (t[2] = Math.round(e[2])),
          t
        )
      },
      scale: At,
      scaleAndAdd: function (t, e, n, r) {
        return (
          (t[0] = e[0] + n[0] * r),
          (t[1] = e[1] + n[1] * r),
          (t[2] = e[2] + n[2] * r),
          t
        )
      },
      distance: Rt,
      squaredDistance: Ct,
      squaredLength: St,
      negate: function (t, e) {
        return (t[0] = -e[0]), (t[1] = -e[1]), (t[2] = -e[2]), t
      },
      inverse: function (t, e) {
        return (t[0] = 1 / e[0]), (t[1] = 1 / e[1]), (t[2] = 1 / e[2]), t
      },
      normalize: Pt,
      dot: Dt,
      cross: It,
      lerp: function (t, e, n, r) {
        var i = e[0],
          o = e[1],
          a = e[2]
        return (
          (t[0] = i + r * (n[0] - i)),
          (t[1] = o + r * (n[1] - o)),
          (t[2] = a + r * (n[2] - a)),
          t
        )
      },
      hermite: function (t, e, n, r, i, o) {
        var a = o * o,
          s = a * (2 * o - 3) + 1,
          u = a * (o - 2) + o,
          h = a * (o - 1),
          c = a * (3 - 2 * o)
        return (
          (t[0] = e[0] * s + n[0] * u + r[0] * h + i[0] * c),
          (t[1] = e[1] * s + n[1] * u + r[1] * h + i[1] * c),
          (t[2] = e[2] * s + n[2] * u + r[2] * h + i[2] * c),
          t
        )
      },
      bezier: function (t, e, n, r, i, o) {
        var a = 1 - o,
          s = a * a,
          u = o * o,
          h = s * a,
          c = 3 * o * s,
          l = 3 * u * a,
          f = u * o
        return (
          (t[0] = e[0] * h + n[0] * c + r[0] * l + i[0] * f),
          (t[1] = e[1] * h + n[1] * c + r[1] * l + i[1] * f),
          (t[2] = e[2] * h + n[2] * c + r[2] * l + i[2] * f),
          t
        )
      },
      random: function (t, e) {
        e = e || 1
        var n = 2 * X() * Math.PI,
          r = 2 * X() - 1,
          i = Math.sqrt(1 - r * r) * e
        return (
          (t[0] = Math.cos(n) * i), (t[1] = Math.sin(n) * i), (t[2] = r * e), t
        )
      },
      transformMat4: Lt,
      transformMat3: Ot,
      transformQuat: Bt,
      rotateX: kt,
      rotateY: Ut,
      rotateZ: Nt,
      angle: Ft,
      zero: function (t) {
        return (t[0] = 0), (t[1] = 0), (t[2] = 0), t
      },
      str: function (t) {
        return 'vec3(' + t[0] + ', ' + t[1] + ', ' + t[2] + ')'
      },
      exactEquals: function (t, e) {
        return t[0] === e[0] && t[1] === e[1] && t[2] === e[2]
      },
      equals: jt,
      sub: zt,
      mul: Vt,
      div: Gt,
      dist: Ht,
      sqrDist: Wt,
      len: Zt,
      sqrLen: qt,
      forEach: Yt,
    })
  const Kt = [0, 0, 0],
    Qt = {}
  class Jt extends Z {
    static get ZERO() {
      return (Qt.ZERO = Qt.ZERO || Object.freeze(new Jt(0, 0, 0, 0)))
    }
    constructor(t = 0, e = 0, n = 0) {
      super(-0, -0, -0),
        1 === arguments.length && F(t)
          ? this.copy(t)
          : (U.debug && (V(t), V(e), V(n)),
            (this[0] = t),
            (this[1] = e),
            (this[2] = n))
    }
    set(t, e, n) {
      return (this[0] = t), (this[1] = e), (this[2] = n), this.check()
    }
    copy(t) {
      return (this[0] = t[0]), (this[1] = t[1]), (this[2] = t[2]), this.check()
    }
    fromObject(t) {
      return (
        U.debug && (V(t.x), V(t.y), V(t.z)),
        (this[0] = t.x),
        (this[1] = t.y),
        (this[2] = t.z),
        this.check()
      )
    }
    toObject(t) {
      return (t.x = this[0]), (t.y = this[1]), (t.z = this[2]), t
    }
    get ELEMENTS() {
      return 3
    }
    get z() {
      return this[2]
    }
    set z(t) {
      this[2] = V(t)
    }
    angle(t) {
      return Ft(this, t)
    }
    cross(t) {
      return It(this, this, t), this.check()
    }
    rotateX({ radians: t, origin: e = Kt }) {
      return kt(this, this, e, t), this.check()
    }
    rotateY({ radians: t, origin: e = Kt }) {
      return Ut(this, this, e, t), this.check()
    }
    rotateZ({ radians: t, origin: e = Kt }) {
      return Nt(this, this, e, t), this.check()
    }
    transform(t) {
      return this.transformAsPoint(t)
    }
    transformAsPoint(t) {
      return Lt(this, this, t), this.check()
    }
    transformAsVector(t) {
      return mt(this, this, t), this.check()
    }
    transformByMatrix3(t) {
      return Ot(this, this, t), this.check()
    }
    transformByMatrix2(t) {
      return (
        (function (t, e, n) {
          const r = e[0],
            i = e[1]
          ;(t[0] = n[0] * r + n[2] * i),
            (t[1] = n[1] * r + n[3] * i),
            (t[2] = e[2])
        })(this, this, t),
        this.check()
      )
    }
    transformByQuaternion(t) {
      return Bt(this, this, t), this.check()
    }
  }
  const $t = {}
  class te extends Z {
    static get ZERO() {
      return ($t.ZERO = $t.ZERO || Object.freeze(new te(0, 0, 0, 0)))
    }
    constructor(t = 0, e = 0, n = 0, r = 0) {
      super(-0, -0, -0, -0),
        F(t) && 1 === arguments.length
          ? this.copy(t)
          : (U.debug && (V(t), V(e), V(n), V(r)),
            (this[0] = t),
            (this[1] = e),
            (this[2] = n),
            (this[3] = r))
    }
    set(t, e, n, r) {
      return (
        (this[0] = t), (this[1] = e), (this[2] = n), (this[3] = r), this.check()
      )
    }
    copy(t) {
      return (
        (this[0] = t[0]),
        (this[1] = t[1]),
        (this[2] = t[2]),
        (this[3] = t[3]),
        this.check()
      )
    }
    fromObject(t) {
      return (
        U.debug && (V(t.x), V(t.y), V(t.z), V(t.w)),
        (this[0] = t.x),
        (this[1] = t.y),
        (this[2] = t.z),
        (this[3] = t.w),
        this
      )
    }
    toObject(t) {
      return (
        (t.x = this[0]), (t.y = this[1]), (t.z = this[2]), (t.w = this[3]), t
      )
    }
    get ELEMENTS() {
      return 4
    }
    get z() {
      return this[2]
    }
    set z(t) {
      this[2] = V(t)
    }
    get w() {
      return this[3]
    }
    set w(t) {
      this[3] = V(t)
    }
    transform(t) {
      return Lt(this, this, t), this.check()
    }
    transformByMatrix3(t) {
      return (
        (function (t, e, n) {
          const r = e[0],
            i = e[1],
            o = e[2]
          ;(t[0] = n[0] * r + n[3] * i + n[6] * o),
            (t[1] = n[1] * r + n[4] * i + n[7] * o),
            (t[2] = n[2] * r + n[5] * i + n[8] * o),
            (t[3] = e[3])
        })(this, this, t),
        this.check()
      )
    }
    transformByMatrix2(t) {
      return (
        (function (t, e, n) {
          const r = e[0],
            i = e[1]
          ;(t[0] = n[0] * r + n[2] * i),
            (t[1] = n[1] * r + n[3] * i),
            (t[2] = e[2]),
            (t[3] = e[3])
        })(this, this, t),
        this.check()
      )
    }
    transformByQuaternion(t) {
      return Bt(this, this, t), this.check()
    }
    applyMatrix4(t) {
      return t.transform(this, this), this
    }
  }
  class ee extends z {
    get ELEMENTS() {
      return k(!1), 0
    }
    get RANK() {
      return k(!1), 0
    }
    toString() {
      let t = '['
      if (U.printRowMajor) {
        t += 'row-major:'
        for (let e = 0; e < this.RANK; ++e)
          for (let n = 0; n < this.RANK; ++n)
            t += ' '.concat(this[n * this.RANK + e])
      } else {
        t += 'column-major:'
        for (let e = 0; e < this.ELEMENTS; ++e) t += ' '.concat(this[e])
      }
      return (t += ']'), t
    }
    getElementIndex(t, e) {
      return e * this.RANK + t
    }
    getElement(t, e) {
      return this[e * this.RANK + t]
    }
    setElement(t, e, n) {
      return (this[e * this.RANK + t] = V(n)), this
    }
    getColumn(t, e = new Array(this.RANK).fill(-0)) {
      const n = t * this.RANK
      for (let t = 0; t < this.RANK; ++t) e[t] = this[n + t]
      return e
    }
    setColumn(t, e) {
      const n = t * this.RANK
      for (let t = 0; t < this.RANK; ++t) this[n + t] = e[t]
      return this
    }
  }
  function ne() {
    var t = new Y(9)
    return (
      Y != Float32Array &&
        ((t[1] = 0),
        (t[2] = 0),
        (t[3] = 0),
        (t[5] = 0),
        (t[6] = 0),
        (t[7] = 0)),
      (t[0] = 1),
      (t[4] = 1),
      (t[8] = 1),
      t
    )
  }
  function re(t, e, n) {
    var r = e[0],
      i = e[1],
      o = e[2],
      a = e[3],
      s = e[4],
      u = e[5],
      h = e[6],
      c = e[7],
      l = e[8],
      f = n[0],
      d = n[1],
      p = n[2],
      v = n[3],
      m = n[4],
      g = n[5],
      y = n[6],
      _ = n[7],
      x = n[8]
    return (
      (t[0] = f * r + d * a + p * h),
      (t[1] = f * i + d * s + p * c),
      (t[2] = f * o + d * u + p * l),
      (t[3] = v * r + m * a + g * h),
      (t[4] = v * i + m * s + g * c),
      (t[5] = v * o + m * u + g * l),
      (t[6] = y * r + _ * a + x * h),
      (t[7] = y * i + _ * s + x * c),
      (t[8] = y * o + _ * u + x * l),
      t
    )
  }
  function ie(t, e, n) {
    return (
      (t[0] = e[0] - n[0]),
      (t[1] = e[1] - n[1]),
      (t[2] = e[2] - n[2]),
      (t[3] = e[3] - n[3]),
      (t[4] = e[4] - n[4]),
      (t[5] = e[5] - n[5]),
      (t[6] = e[6] - n[6]),
      (t[7] = e[7] - n[7]),
      (t[8] = e[8] - n[8]),
      t
    )
  }
  var oe = re,
    ae = ie,
    se = Object.freeze({
      __proto__: null,
      create: ne,
      fromMat4: function (t, e) {
        return (
          (t[0] = e[0]),
          (t[1] = e[1]),
          (t[2] = e[2]),
          (t[3] = e[4]),
          (t[4] = e[5]),
          (t[5] = e[6]),
          (t[6] = e[8]),
          (t[7] = e[9]),
          (t[8] = e[10]),
          t
        )
      },
      clone: function (t) {
        var e = new Y(9)
        return (
          (e[0] = t[0]),
          (e[1] = t[1]),
          (e[2] = t[2]),
          (e[3] = t[3]),
          (e[4] = t[4]),
          (e[5] = t[5]),
          (e[6] = t[6]),
          (e[7] = t[7]),
          (e[8] = t[8]),
          e
        )
      },
      copy: function (t, e) {
        return (
          (t[0] = e[0]),
          (t[1] = e[1]),
          (t[2] = e[2]),
          (t[3] = e[3]),
          (t[4] = e[4]),
          (t[5] = e[5]),
          (t[6] = e[6]),
          (t[7] = e[7]),
          (t[8] = e[8]),
          t
        )
      },
      fromValues: function (t, e, n, r, i, o, a, s, u) {
        var h = new Y(9)
        return (
          (h[0] = t),
          (h[1] = e),
          (h[2] = n),
          (h[3] = r),
          (h[4] = i),
          (h[5] = o),
          (h[6] = a),
          (h[7] = s),
          (h[8] = u),
          h
        )
      },
      set: function (t, e, n, r, i, o, a, s, u, h) {
        return (
          (t[0] = e),
          (t[1] = n),
          (t[2] = r),
          (t[3] = i),
          (t[4] = o),
          (t[5] = a),
          (t[6] = s),
          (t[7] = u),
          (t[8] = h),
          t
        )
      },
      identity: function (t) {
        return (
          (t[0] = 1),
          (t[1] = 0),
          (t[2] = 0),
          (t[3] = 0),
          (t[4] = 1),
          (t[5] = 0),
          (t[6] = 0),
          (t[7] = 0),
          (t[8] = 1),
          t
        )
      },
      transpose: function (t, e) {
        if (t === e) {
          var n = e[1],
            r = e[2],
            i = e[5]
          ;(t[1] = e[3]),
            (t[2] = e[6]),
            (t[3] = n),
            (t[5] = e[7]),
            (t[6] = r),
            (t[7] = i)
        } else
          (t[0] = e[0]),
            (t[1] = e[3]),
            (t[2] = e[6]),
            (t[3] = e[1]),
            (t[4] = e[4]),
            (t[5] = e[7]),
            (t[6] = e[2]),
            (t[7] = e[5]),
            (t[8] = e[8])
        return t
      },
      invert: function (t, e) {
        var n = e[0],
          r = e[1],
          i = e[2],
          o = e[3],
          a = e[4],
          s = e[5],
          u = e[6],
          h = e[7],
          c = e[8],
          l = c * a - s * h,
          f = -c * o + s * u,
          d = h * o - a * u,
          p = n * l + r * f + i * d
        return p
          ? ((p = 1 / p),
            (t[0] = l * p),
            (t[1] = (-c * r + i * h) * p),
            (t[2] = (s * r - i * a) * p),
            (t[3] = f * p),
            (t[4] = (c * n - i * u) * p),
            (t[5] = (-s * n + i * o) * p),
            (t[6] = d * p),
            (t[7] = (-h * n + r * u) * p),
            (t[8] = (a * n - r * o) * p),
            t)
          : null
      },
      adjoint: function (t, e) {
        var n = e[0],
          r = e[1],
          i = e[2],
          o = e[3],
          a = e[4],
          s = e[5],
          u = e[6],
          h = e[7],
          c = e[8]
        return (
          (t[0] = a * c - s * h),
          (t[1] = i * h - r * c),
          (t[2] = r * s - i * a),
          (t[3] = s * u - o * c),
          (t[4] = n * c - i * u),
          (t[5] = i * o - n * s),
          (t[6] = o * h - a * u),
          (t[7] = r * u - n * h),
          (t[8] = n * a - r * o),
          t
        )
      },
      determinant: function (t) {
        var e = t[0],
          n = t[1],
          r = t[2],
          i = t[3],
          o = t[4],
          a = t[5],
          s = t[6],
          u = t[7],
          h = t[8]
        return e * (h * o - a * u) + n * (-h * i + a * s) + r * (u * i - o * s)
      },
      multiply: re,
      translate: function (t, e, n) {
        var r = e[0],
          i = e[1],
          o = e[2],
          a = e[3],
          s = e[4],
          u = e[5],
          h = e[6],
          c = e[7],
          l = e[8],
          f = n[0],
          d = n[1]
        return (
          (t[0] = r),
          (t[1] = i),
          (t[2] = o),
          (t[3] = a),
          (t[4] = s),
          (t[5] = u),
          (t[6] = f * r + d * a + h),
          (t[7] = f * i + d * s + c),
          (t[8] = f * o + d * u + l),
          t
        )
      },
      rotate: function (t, e, n) {
        var r = e[0],
          i = e[1],
          o = e[2],
          a = e[3],
          s = e[4],
          u = e[5],
          h = e[6],
          c = e[7],
          l = e[8],
          f = Math.sin(n),
          d = Math.cos(n)
        return (
          (t[0] = d * r + f * a),
          (t[1] = d * i + f * s),
          (t[2] = d * o + f * u),
          (t[3] = d * a - f * r),
          (t[4] = d * s - f * i),
          (t[5] = d * u - f * o),
          (t[6] = h),
          (t[7] = c),
          (t[8] = l),
          t
        )
      },
      scale: function (t, e, n) {
        var r = n[0],
          i = n[1]
        return (
          (t[0] = r * e[0]),
          (t[1] = r * e[1]),
          (t[2] = r * e[2]),
          (t[3] = i * e[3]),
          (t[4] = i * e[4]),
          (t[5] = i * e[5]),
          (t[6] = e[6]),
          (t[7] = e[7]),
          (t[8] = e[8]),
          t
        )
      },
      fromTranslation: function (t, e) {
        return (
          (t[0] = 1),
          (t[1] = 0),
          (t[2] = 0),
          (t[3] = 0),
          (t[4] = 1),
          (t[5] = 0),
          (t[6] = e[0]),
          (t[7] = e[1]),
          (t[8] = 1),
          t
        )
      },
      fromRotation: function (t, e) {
        var n = Math.sin(e),
          r = Math.cos(e)
        return (
          (t[0] = r),
          (t[1] = n),
          (t[2] = 0),
          (t[3] = -n),
          (t[4] = r),
          (t[5] = 0),
          (t[6] = 0),
          (t[7] = 0),
          (t[8] = 1),
          t
        )
      },
      fromScaling: function (t, e) {
        return (
          (t[0] = e[0]),
          (t[1] = 0),
          (t[2] = 0),
          (t[3] = 0),
          (t[4] = e[1]),
          (t[5] = 0),
          (t[6] = 0),
          (t[7] = 0),
          (t[8] = 1),
          t
        )
      },
      fromMat2d: function (t, e) {
        return (
          (t[0] = e[0]),
          (t[1] = e[1]),
          (t[2] = 0),
          (t[3] = e[2]),
          (t[4] = e[3]),
          (t[5] = 0),
          (t[6] = e[4]),
          (t[7] = e[5]),
          (t[8] = 1),
          t
        )
      },
      fromQuat: function (t, e) {
        var n = e[0],
          r = e[1],
          i = e[2],
          o = e[3],
          a = n + n,
          s = r + r,
          u = i + i,
          h = n * a,
          c = r * a,
          l = r * s,
          f = i * a,
          d = i * s,
          p = i * u,
          v = o * a,
          m = o * s,
          g = o * u
        return (
          (t[0] = 1 - l - p),
          (t[3] = c - g),
          (t[6] = f + m),
          (t[1] = c + g),
          (t[4] = 1 - h - p),
          (t[7] = d - v),
          (t[2] = f - m),
          (t[5] = d + v),
          (t[8] = 1 - h - l),
          t
        )
      },
      normalFromMat4: function (t, e) {
        var n = e[0],
          r = e[1],
          i = e[2],
          o = e[3],
          a = e[4],
          s = e[5],
          u = e[6],
          h = e[7],
          c = e[8],
          l = e[9],
          f = e[10],
          d = e[11],
          p = e[12],
          v = e[13],
          m = e[14],
          g = e[15],
          y = n * s - r * a,
          _ = n * u - i * a,
          x = n * h - o * a,
          b = r * u - i * s,
          M = r * h - o * s,
          E = i * h - o * u,
          w = c * v - l * p,
          T = c * m - f * p,
          A = c * g - d * p,
          R = l * m - f * v,
          C = l * g - d * v,
          S = f * g - d * m,
          P = y * S - _ * C + x * R + b * A - M * T + E * w
        return P
          ? ((P = 1 / P),
            (t[0] = (s * S - u * C + h * R) * P),
            (t[1] = (u * A - a * S - h * T) * P),
            (t[2] = (a * C - s * A + h * w) * P),
            (t[3] = (i * C - r * S - o * R) * P),
            (t[4] = (n * S - i * A + o * T) * P),
            (t[5] = (r * A - n * C - o * w) * P),
            (t[6] = (v * E - m * M + g * b) * P),
            (t[7] = (m * x - p * E - g * _) * P),
            (t[8] = (p * M - v * x + g * y) * P),
            t)
          : null
      },
      projection: function (t, e, n) {
        return (
          (t[0] = 2 / e),
          (t[1] = 0),
          (t[2] = 0),
          (t[3] = 0),
          (t[4] = -2 / n),
          (t[5] = 0),
          (t[6] = -1),
          (t[7] = 1),
          (t[8] = 1),
          t
        )
      },
      str: function (t) {
        return (
          'mat3(' +
          t[0] +
          ', ' +
          t[1] +
          ', ' +
          t[2] +
          ', ' +
          t[3] +
          ', ' +
          t[4] +
          ', ' +
          t[5] +
          ', ' +
          t[6] +
          ', ' +
          t[7] +
          ', ' +
          t[8] +
          ')'
        )
      },
      frob: function (t) {
        return Math.hypot(t[0], t[1], t[2], t[3], t[4], t[5], t[6], t[7], t[8])
      },
      add: function (t, e, n) {
        return (
          (t[0] = e[0] + n[0]),
          (t[1] = e[1] + n[1]),
          (t[2] = e[2] + n[2]),
          (t[3] = e[3] + n[3]),
          (t[4] = e[4] + n[4]),
          (t[5] = e[5] + n[5]),
          (t[6] = e[6] + n[6]),
          (t[7] = e[7] + n[7]),
          (t[8] = e[8] + n[8]),
          t
        )
      },
      subtract: ie,
      multiplyScalar: function (t, e, n) {
        return (
          (t[0] = e[0] * n),
          (t[1] = e[1] * n),
          (t[2] = e[2] * n),
          (t[3] = e[3] * n),
          (t[4] = e[4] * n),
          (t[5] = e[5] * n),
          (t[6] = e[6] * n),
          (t[7] = e[7] * n),
          (t[8] = e[8] * n),
          t
        )
      },
      multiplyScalarAndAdd: function (t, e, n, r) {
        return (
          (t[0] = e[0] + n[0] * r),
          (t[1] = e[1] + n[1] * r),
          (t[2] = e[2] + n[2] * r),
          (t[3] = e[3] + n[3] * r),
          (t[4] = e[4] + n[4] * r),
          (t[5] = e[5] + n[5] * r),
          (t[6] = e[6] + n[6] * r),
          (t[7] = e[7] + n[7] * r),
          (t[8] = e[8] + n[8] * r),
          t
        )
      },
      exactEquals: function (t, e) {
        return (
          t[0] === e[0] &&
          t[1] === e[1] &&
          t[2] === e[2] &&
          t[3] === e[3] &&
          t[4] === e[4] &&
          t[5] === e[5] &&
          t[6] === e[6] &&
          t[7] === e[7] &&
          t[8] === e[8]
        )
      },
      equals: function (t, e) {
        var n = t[0],
          r = t[1],
          i = t[2],
          o = t[3],
          a = t[4],
          s = t[5],
          u = t[6],
          h = t[7],
          c = t[8],
          l = e[0],
          f = e[1],
          d = e[2],
          p = e[3],
          v = e[4],
          m = e[5],
          g = e[6],
          y = e[7],
          _ = e[8]
        return (
          Math.abs(n - l) <= q * Math.max(1, Math.abs(n), Math.abs(l)) &&
          Math.abs(r - f) <= q * Math.max(1, Math.abs(r), Math.abs(f)) &&
          Math.abs(i - d) <= q * Math.max(1, Math.abs(i), Math.abs(d)) &&
          Math.abs(o - p) <= q * Math.max(1, Math.abs(o), Math.abs(p)) &&
          Math.abs(a - v) <= q * Math.max(1, Math.abs(a), Math.abs(v)) &&
          Math.abs(s - m) <= q * Math.max(1, Math.abs(s), Math.abs(m)) &&
          Math.abs(u - g) <= q * Math.max(1, Math.abs(u), Math.abs(g)) &&
          Math.abs(h - y) <= q * Math.max(1, Math.abs(h), Math.abs(y)) &&
          Math.abs(c - _) <= q * Math.max(1, Math.abs(c), Math.abs(_))
        )
      },
      mul: oe,
      sub: ae,
    })
  function ue() {
    var t = new Y(16)
    return (
      Y != Float32Array &&
        ((t[1] = 0),
        (t[2] = 0),
        (t[3] = 0),
        (t[4] = 0),
        (t[6] = 0),
        (t[7] = 0),
        (t[8] = 0),
        (t[9] = 0),
        (t[11] = 0),
        (t[12] = 0),
        (t[13] = 0),
        (t[14] = 0)),
      (t[0] = 1),
      (t[5] = 1),
      (t[10] = 1),
      (t[15] = 1),
      t
    )
  }
  function he(t) {
    var e = new Y(16)
    return (
      (e[0] = t[0]),
      (e[1] = t[1]),
      (e[2] = t[2]),
      (e[3] = t[3]),
      (e[4] = t[4]),
      (e[5] = t[5]),
      (e[6] = t[6]),
      (e[7] = t[7]),
      (e[8] = t[8]),
      (e[9] = t[9]),
      (e[10] = t[10]),
      (e[11] = t[11]),
      (e[12] = t[12]),
      (e[13] = t[13]),
      (e[14] = t[14]),
      (e[15] = t[15]),
      e
    )
  }
  function ce(t, e) {
    return (
      (t[0] = e[0]),
      (t[1] = e[1]),
      (t[2] = e[2]),
      (t[3] = e[3]),
      (t[4] = e[4]),
      (t[5] = e[5]),
      (t[6] = e[6]),
      (t[7] = e[7]),
      (t[8] = e[8]),
      (t[9] = e[9]),
      (t[10] = e[10]),
      (t[11] = e[11]),
      (t[12] = e[12]),
      (t[13] = e[13]),
      (t[14] = e[14]),
      (t[15] = e[15]),
      t
    )
  }
  function le(t) {
    return (
      (t[0] = 1),
      (t[1] = 0),
      (t[2] = 0),
      (t[3] = 0),
      (t[4] = 0),
      (t[5] = 1),
      (t[6] = 0),
      (t[7] = 0),
      (t[8] = 0),
      (t[9] = 0),
      (t[10] = 1),
      (t[11] = 0),
      (t[12] = 0),
      (t[13] = 0),
      (t[14] = 0),
      (t[15] = 1),
      t
    )
  }
  function fe(t, e) {
    if (t === e) {
      var n = e[1],
        r = e[2],
        i = e[3],
        o = e[6],
        a = e[7],
        s = e[11]
      ;(t[1] = e[4]),
        (t[2] = e[8]),
        (t[3] = e[12]),
        (t[4] = n),
        (t[6] = e[9]),
        (t[7] = e[13]),
        (t[8] = r),
        (t[9] = o),
        (t[11] = e[14]),
        (t[12] = i),
        (t[13] = a),
        (t[14] = s)
    } else
      (t[0] = e[0]),
        (t[1] = e[4]),
        (t[2] = e[8]),
        (t[3] = e[12]),
        (t[4] = e[1]),
        (t[5] = e[5]),
        (t[6] = e[9]),
        (t[7] = e[13]),
        (t[8] = e[2]),
        (t[9] = e[6]),
        (t[10] = e[10]),
        (t[11] = e[14]),
        (t[12] = e[3]),
        (t[13] = e[7]),
        (t[14] = e[11]),
        (t[15] = e[15])
    return t
  }
  function de(t, e) {
    var n = e[0],
      r = e[1],
      i = e[2],
      o = e[3],
      a = e[4],
      s = e[5],
      u = e[6],
      h = e[7],
      c = e[8],
      l = e[9],
      f = e[10],
      d = e[11],
      p = e[12],
      v = e[13],
      m = e[14],
      g = e[15],
      y = n * s - r * a,
      _ = n * u - i * a,
      x = n * h - o * a,
      b = r * u - i * s,
      M = r * h - o * s,
      E = i * h - o * u,
      w = c * v - l * p,
      T = c * m - f * p,
      A = c * g - d * p,
      R = l * m - f * v,
      C = l * g - d * v,
      S = f * g - d * m,
      P = y * S - _ * C + x * R + b * A - M * T + E * w
    return P
      ? ((P = 1 / P),
        (t[0] = (s * S - u * C + h * R) * P),
        (t[1] = (i * C - r * S - o * R) * P),
        (t[2] = (v * E - m * M + g * b) * P),
        (t[3] = (f * M - l * E - d * b) * P),
        (t[4] = (u * A - a * S - h * T) * P),
        (t[5] = (n * S - i * A + o * T) * P),
        (t[6] = (m * x - p * E - g * _) * P),
        (t[7] = (c * E - f * x + d * _) * P),
        (t[8] = (a * C - s * A + h * w) * P),
        (t[9] = (r * A - n * C - o * w) * P),
        (t[10] = (p * M - v * x + g * y) * P),
        (t[11] = (l * x - c * M - d * y) * P),
        (t[12] = (s * T - a * R - u * w) * P),
        (t[13] = (n * R - r * T + i * w) * P),
        (t[14] = (v * _ - p * b - m * y) * P),
        (t[15] = (c * b - l * _ + f * y) * P),
        t)
      : null
  }
  function pe(t) {
    var e = t[0],
      n = t[1],
      r = t[2],
      i = t[3],
      o = t[4],
      a = t[5],
      s = t[6],
      u = t[7],
      h = t[8],
      c = t[9],
      l = t[10],
      f = t[11],
      d = t[12],
      p = t[13],
      v = t[14],
      m = t[15]
    return (
      (e * a - n * o) * (l * m - f * v) -
      (e * s - r * o) * (c * m - f * p) +
      (e * u - i * o) * (c * v - l * p) +
      (n * s - r * a) * (h * m - f * d) -
      (n * u - i * a) * (h * v - l * d) +
      (r * u - i * s) * (h * p - c * d)
    )
  }
  function ve(t, e, n) {
    var r = e[0],
      i = e[1],
      o = e[2],
      a = e[3],
      s = e[4],
      u = e[5],
      h = e[6],
      c = e[7],
      l = e[8],
      f = e[9],
      d = e[10],
      p = e[11],
      v = e[12],
      m = e[13],
      g = e[14],
      y = e[15],
      _ = n[0],
      x = n[1],
      b = n[2],
      M = n[3]
    return (
      (t[0] = _ * r + x * s + b * l + M * v),
      (t[1] = _ * i + x * u + b * f + M * m),
      (t[2] = _ * o + x * h + b * d + M * g),
      (t[3] = _ * a + x * c + b * p + M * y),
      (_ = n[4]),
      (x = n[5]),
      (b = n[6]),
      (M = n[7]),
      (t[4] = _ * r + x * s + b * l + M * v),
      (t[5] = _ * i + x * u + b * f + M * m),
      (t[6] = _ * o + x * h + b * d + M * g),
      (t[7] = _ * a + x * c + b * p + M * y),
      (_ = n[8]),
      (x = n[9]),
      (b = n[10]),
      (M = n[11]),
      (t[8] = _ * r + x * s + b * l + M * v),
      (t[9] = _ * i + x * u + b * f + M * m),
      (t[10] = _ * o + x * h + b * d + M * g),
      (t[11] = _ * a + x * c + b * p + M * y),
      (_ = n[12]),
      (x = n[13]),
      (b = n[14]),
      (M = n[15]),
      (t[12] = _ * r + x * s + b * l + M * v),
      (t[13] = _ * i + x * u + b * f + M * m),
      (t[14] = _ * o + x * h + b * d + M * g),
      (t[15] = _ * a + x * c + b * p + M * y),
      t
    )
  }
  function me(t, e, n) {
    var r,
      i,
      o,
      a,
      s,
      u,
      h,
      c,
      l,
      f,
      d,
      p,
      v = n[0],
      m = n[1],
      g = n[2]
    return (
      e === t
        ? ((t[12] = e[0] * v + e[4] * m + e[8] * g + e[12]),
          (t[13] = e[1] * v + e[5] * m + e[9] * g + e[13]),
          (t[14] = e[2] * v + e[6] * m + e[10] * g + e[14]),
          (t[15] = e[3] * v + e[7] * m + e[11] * g + e[15]))
        : ((r = e[0]),
          (i = e[1]),
          (o = e[2]),
          (a = e[3]),
          (s = e[4]),
          (u = e[5]),
          (h = e[6]),
          (c = e[7]),
          (l = e[8]),
          (f = e[9]),
          (d = e[10]),
          (p = e[11]),
          (t[0] = r),
          (t[1] = i),
          (t[2] = o),
          (t[3] = a),
          (t[4] = s),
          (t[5] = u),
          (t[6] = h),
          (t[7] = c),
          (t[8] = l),
          (t[9] = f),
          (t[10] = d),
          (t[11] = p),
          (t[12] = r * v + s * m + l * g + e[12]),
          (t[13] = i * v + u * m + f * g + e[13]),
          (t[14] = o * v + h * m + d * g + e[14]),
          (t[15] = a * v + c * m + p * g + e[15])),
      t
    )
  }
  function ge(t, e, n) {
    var r = n[0],
      i = n[1],
      o = n[2]
    return (
      (t[0] = e[0] * r),
      (t[1] = e[1] * r),
      (t[2] = e[2] * r),
      (t[3] = e[3] * r),
      (t[4] = e[4] * i),
      (t[5] = e[5] * i),
      (t[6] = e[6] * i),
      (t[7] = e[7] * i),
      (t[8] = e[8] * o),
      (t[9] = e[9] * o),
      (t[10] = e[10] * o),
      (t[11] = e[11] * o),
      (t[12] = e[12]),
      (t[13] = e[13]),
      (t[14] = e[14]),
      (t[15] = e[15]),
      t
    )
  }
  function ye(t, e, n, r) {
    var i,
      o,
      a,
      s,
      u,
      h,
      c,
      l,
      f,
      d,
      p,
      v,
      m,
      g,
      y,
      _,
      x,
      b,
      M,
      E,
      w,
      T,
      A,
      R,
      C = r[0],
      S = r[1],
      P = r[2],
      D = Math.hypot(C, S, P)
    return D < q
      ? null
      : ((C *= D = 1 / D),
        (S *= D),
        (P *= D),
        (i = Math.sin(n)),
        (a = 1 - (o = Math.cos(n))),
        (s = e[0]),
        (u = e[1]),
        (h = e[2]),
        (c = e[3]),
        (l = e[4]),
        (f = e[5]),
        (d = e[6]),
        (p = e[7]),
        (v = e[8]),
        (m = e[9]),
        (g = e[10]),
        (y = e[11]),
        (_ = C * C * a + o),
        (x = S * C * a + P * i),
        (b = P * C * a - S * i),
        (M = C * S * a - P * i),
        (E = S * S * a + o),
        (w = P * S * a + C * i),
        (T = C * P * a + S * i),
        (A = S * P * a - C * i),
        (R = P * P * a + o),
        (t[0] = s * _ + l * x + v * b),
        (t[1] = u * _ + f * x + m * b),
        (t[2] = h * _ + d * x + g * b),
        (t[3] = c * _ + p * x + y * b),
        (t[4] = s * M + l * E + v * w),
        (t[5] = u * M + f * E + m * w),
        (t[6] = h * M + d * E + g * w),
        (t[7] = c * M + p * E + y * w),
        (t[8] = s * T + l * A + v * R),
        (t[9] = u * T + f * A + m * R),
        (t[10] = h * T + d * A + g * R),
        (t[11] = c * T + p * A + y * R),
        e !== t &&
          ((t[12] = e[12]), (t[13] = e[13]), (t[14] = e[14]), (t[15] = e[15])),
        t)
  }
  function _e(t, e, n) {
    var r = Math.sin(n),
      i = Math.cos(n),
      o = e[4],
      a = e[5],
      s = e[6],
      u = e[7],
      h = e[8],
      c = e[9],
      l = e[10],
      f = e[11]
    return (
      e !== t &&
        ((t[0] = e[0]),
        (t[1] = e[1]),
        (t[2] = e[2]),
        (t[3] = e[3]),
        (t[12] = e[12]),
        (t[13] = e[13]),
        (t[14] = e[14]),
        (t[15] = e[15])),
      (t[4] = o * i + h * r),
      (t[5] = a * i + c * r),
      (t[6] = s * i + l * r),
      (t[7] = u * i + f * r),
      (t[8] = h * i - o * r),
      (t[9] = c * i - a * r),
      (t[10] = l * i - s * r),
      (t[11] = f * i - u * r),
      t
    )
  }
  function xe(t, e, n) {
    var r = Math.sin(n),
      i = Math.cos(n),
      o = e[0],
      a = e[1],
      s = e[2],
      u = e[3],
      h = e[8],
      c = e[9],
      l = e[10],
      f = e[11]
    return (
      e !== t &&
        ((t[4] = e[4]),
        (t[5] = e[5]),
        (t[6] = e[6]),
        (t[7] = e[7]),
        (t[12] = e[12]),
        (t[13] = e[13]),
        (t[14] = e[14]),
        (t[15] = e[15])),
      (t[0] = o * i - h * r),
      (t[1] = a * i - c * r),
      (t[2] = s * i - l * r),
      (t[3] = u * i - f * r),
      (t[8] = o * r + h * i),
      (t[9] = a * r + c * i),
      (t[10] = s * r + l * i),
      (t[11] = u * r + f * i),
      t
    )
  }
  function be(t, e, n) {
    var r = Math.sin(n),
      i = Math.cos(n),
      o = e[0],
      a = e[1],
      s = e[2],
      u = e[3],
      h = e[4],
      c = e[5],
      l = e[6],
      f = e[7]
    return (
      e !== t &&
        ((t[8] = e[8]),
        (t[9] = e[9]),
        (t[10] = e[10]),
        (t[11] = e[11]),
        (t[12] = e[12]),
        (t[13] = e[13]),
        (t[14] = e[14]),
        (t[15] = e[15])),
      (t[0] = o * i + h * r),
      (t[1] = a * i + c * r),
      (t[2] = s * i + l * r),
      (t[3] = u * i + f * r),
      (t[4] = h * i - o * r),
      (t[5] = c * i - a * r),
      (t[6] = l * i - s * r),
      (t[7] = f * i - u * r),
      t
    )
  }
  function Me(t, e, n) {
    var r = e[0],
      i = e[1],
      o = e[2],
      a = e[3],
      s = r + r,
      u = i + i,
      h = o + o,
      c = r * s,
      l = r * u,
      f = r * h,
      d = i * u,
      p = i * h,
      v = o * h,
      m = a * s,
      g = a * u,
      y = a * h
    return (
      (t[0] = 1 - (d + v)),
      (t[1] = l + y),
      (t[2] = f - g),
      (t[3] = 0),
      (t[4] = l - y),
      (t[5] = 1 - (c + v)),
      (t[6] = p + m),
      (t[7] = 0),
      (t[8] = f + g),
      (t[9] = p - m),
      (t[10] = 1 - (c + d)),
      (t[11] = 0),
      (t[12] = n[0]),
      (t[13] = n[1]),
      (t[14] = n[2]),
      (t[15] = 1),
      t
    )
  }
  function Ee(t, e) {
    var n = e[0],
      r = e[1],
      i = e[2],
      o = e[4],
      a = e[5],
      s = e[6],
      u = e[8],
      h = e[9],
      c = e[10]
    return (
      (t[0] = Math.hypot(n, r, i)),
      (t[1] = Math.hypot(o, a, s)),
      (t[2] = Math.hypot(u, h, c)),
      t
    )
  }
  function we(t, e) {
    var n = new Y(3)
    Ee(n, e)
    var r = 1 / n[0],
      i = 1 / n[1],
      o = 1 / n[2],
      a = e[0] * r,
      s = e[1] * i,
      u = e[2] * o,
      h = e[4] * r,
      c = e[5] * i,
      l = e[6] * o,
      f = e[8] * r,
      d = e[9] * i,
      p = e[10] * o,
      v = a + c + p,
      m = 0
    return (
      v > 0
        ? ((m = 2 * Math.sqrt(v + 1)),
          (t[3] = 0.25 * m),
          (t[0] = (l - d) / m),
          (t[1] = (f - u) / m),
          (t[2] = (s - h) / m))
        : a > c && a > p
        ? ((m = 2 * Math.sqrt(1 + a - c - p)),
          (t[3] = (l - d) / m),
          (t[0] = 0.25 * m),
          (t[1] = (s + h) / m),
          (t[2] = (f + u) / m))
        : c > p
        ? ((m = 2 * Math.sqrt(1 + c - a - p)),
          (t[3] = (f - u) / m),
          (t[0] = (s + h) / m),
          (t[1] = 0.25 * m),
          (t[2] = (l + d) / m))
        : ((m = 2 * Math.sqrt(1 + p - a - c)),
          (t[3] = (s - h) / m),
          (t[0] = (f + u) / m),
          (t[1] = (l + d) / m),
          (t[2] = 0.25 * m)),
      t
    )
  }
  function Te(t, e, n, r) {
    var i = e[0],
      o = e[1],
      a = e[2],
      s = e[3],
      u = i + i,
      h = o + o,
      c = a + a,
      l = i * u,
      f = i * h,
      d = i * c,
      p = o * h,
      v = o * c,
      m = a * c,
      g = s * u,
      y = s * h,
      _ = s * c,
      x = r[0],
      b = r[1],
      M = r[2]
    return (
      (t[0] = (1 - (p + m)) * x),
      (t[1] = (f + _) * x),
      (t[2] = (d - y) * x),
      (t[3] = 0),
      (t[4] = (f - _) * b),
      (t[5] = (1 - (l + m)) * b),
      (t[6] = (v + g) * b),
      (t[7] = 0),
      (t[8] = (d + y) * M),
      (t[9] = (v - g) * M),
      (t[10] = (1 - (l + p)) * M),
      (t[11] = 0),
      (t[12] = n[0]),
      (t[13] = n[1]),
      (t[14] = n[2]),
      (t[15] = 1),
      t
    )
  }
  function Ae(t, e) {
    var n = e[0],
      r = e[1],
      i = e[2],
      o = e[3],
      a = n + n,
      s = r + r,
      u = i + i,
      h = n * a,
      c = r * a,
      l = r * s,
      f = i * a,
      d = i * s,
      p = i * u,
      v = o * a,
      m = o * s,
      g = o * u
    return (
      (t[0] = 1 - l - p),
      (t[1] = c + g),
      (t[2] = f - m),
      (t[3] = 0),
      (t[4] = c - g),
      (t[5] = 1 - h - p),
      (t[6] = d + v),
      (t[7] = 0),
      (t[8] = f + m),
      (t[9] = d - v),
      (t[10] = 1 - h - l),
      (t[11] = 0),
      (t[12] = 0),
      (t[13] = 0),
      (t[14] = 0),
      (t[15] = 1),
      t
    )
  }
  function Re(t, e, n, r, i, o, a) {
    var s = 1 / (n - e),
      u = 1 / (i - r),
      h = 1 / (o - a)
    return (
      (t[0] = 2 * o * s),
      (t[1] = 0),
      (t[2] = 0),
      (t[3] = 0),
      (t[4] = 0),
      (t[5] = 2 * o * u),
      (t[6] = 0),
      (t[7] = 0),
      (t[8] = (n + e) * s),
      (t[9] = (i + r) * u),
      (t[10] = (a + o) * h),
      (t[11] = -1),
      (t[12] = 0),
      (t[13] = 0),
      (t[14] = a * o * 2 * h),
      (t[15] = 0),
      t
    )
  }
  function Ce(t, e, n, r, i) {
    var o,
      a = 1 / Math.tan(e / 2)
    return (
      (t[0] = a / n),
      (t[1] = 0),
      (t[2] = 0),
      (t[3] = 0),
      (t[4] = 0),
      (t[5] = a),
      (t[6] = 0),
      (t[7] = 0),
      (t[8] = 0),
      (t[9] = 0),
      (t[11] = -1),
      (t[12] = 0),
      (t[13] = 0),
      (t[15] = 0),
      null != i && i !== 1 / 0
        ? ((o = 1 / (r - i)), (t[10] = (i + r) * o), (t[14] = 2 * i * r * o))
        : ((t[10] = -1), (t[14] = -2 * r)),
      t
    )
  }
  function Se(t, e, n, r, i, o, a) {
    var s = 1 / (e - n),
      u = 1 / (r - i),
      h = 1 / (o - a)
    return (
      (t[0] = -2 * s),
      (t[1] = 0),
      (t[2] = 0),
      (t[3] = 0),
      (t[4] = 0),
      (t[5] = -2 * u),
      (t[6] = 0),
      (t[7] = 0),
      (t[8] = 0),
      (t[9] = 0),
      (t[10] = 2 * h),
      (t[11] = 0),
      (t[12] = (e + n) * s),
      (t[13] = (i + r) * u),
      (t[14] = (a + o) * h),
      (t[15] = 1),
      t
    )
  }
  function Pe(t, e, n, r) {
    var i,
      o,
      a,
      s,
      u,
      h,
      c,
      l,
      f,
      d,
      p = e[0],
      v = e[1],
      m = e[2],
      g = r[0],
      y = r[1],
      _ = r[2],
      x = n[0],
      b = n[1],
      M = n[2]
    return Math.abs(p - x) < q && Math.abs(v - b) < q && Math.abs(m - M) < q
      ? le(t)
      : ((c = p - x),
        (l = v - b),
        (f = m - M),
        (i = y * (f *= d = 1 / Math.hypot(c, l, f)) - _ * (l *= d)),
        (o = _ * (c *= d) - g * f),
        (a = g * l - y * c),
        (d = Math.hypot(i, o, a))
          ? ((i *= d = 1 / d), (o *= d), (a *= d))
          : ((i = 0), (o = 0), (a = 0)),
        (s = l * a - f * o),
        (u = f * i - c * a),
        (h = c * o - l * i),
        (d = Math.hypot(s, u, h))
          ? ((s *= d = 1 / d), (u *= d), (h *= d))
          : ((s = 0), (u = 0), (h = 0)),
        (t[0] = i),
        (t[1] = s),
        (t[2] = c),
        (t[3] = 0),
        (t[4] = o),
        (t[5] = u),
        (t[6] = l),
        (t[7] = 0),
        (t[8] = a),
        (t[9] = h),
        (t[10] = f),
        (t[11] = 0),
        (t[12] = -(i * p + o * v + a * m)),
        (t[13] = -(s * p + u * v + h * m)),
        (t[14] = -(c * p + l * v + f * m)),
        (t[15] = 1),
        t)
  }
  function De(t, e, n, r) {
    var i = e[0],
      o = e[1],
      a = e[2],
      s = r[0],
      u = r[1],
      h = r[2],
      c = i - n[0],
      l = o - n[1],
      f = a - n[2],
      d = c * c + l * l + f * f
    d > 0 && ((c *= d = 1 / Math.sqrt(d)), (l *= d), (f *= d))
    var p = u * f - h * l,
      v = h * c - s * f,
      m = s * l - u * c
    return (
      (d = p * p + v * v + m * m) > 0 &&
        ((p *= d = 1 / Math.sqrt(d)), (v *= d), (m *= d)),
      (t[0] = p),
      (t[1] = v),
      (t[2] = m),
      (t[3] = 0),
      (t[4] = l * m - f * v),
      (t[5] = f * p - c * m),
      (t[6] = c * v - l * p),
      (t[7] = 0),
      (t[8] = c),
      (t[9] = l),
      (t[10] = f),
      (t[11] = 0),
      (t[12] = i),
      (t[13] = o),
      (t[14] = a),
      (t[15] = 1),
      t
    )
  }
  function Ie(t, e, n) {
    return (
      (t[0] = e[0] - n[0]),
      (t[1] = e[1] - n[1]),
      (t[2] = e[2] - n[2]),
      (t[3] = e[3] - n[3]),
      (t[4] = e[4] - n[4]),
      (t[5] = e[5] - n[5]),
      (t[6] = e[6] - n[6]),
      (t[7] = e[7] - n[7]),
      (t[8] = e[8] - n[8]),
      (t[9] = e[9] - n[9]),
      (t[10] = e[10] - n[10]),
      (t[11] = e[11] - n[11]),
      (t[12] = e[12] - n[12]),
      (t[13] = e[13] - n[13]),
      (t[14] = e[14] - n[14]),
      (t[15] = e[15] - n[15]),
      t
    )
  }
  var Le = ve,
    Oe = Ie,
    Be = Object.freeze({
      __proto__: null,
      create: ue,
      clone: he,
      copy: ce,
      fromValues: function (t, e, n, r, i, o, a, s, u, h, c, l, f, d, p, v) {
        var m = new Y(16)
        return (
          (m[0] = t),
          (m[1] = e),
          (m[2] = n),
          (m[3] = r),
          (m[4] = i),
          (m[5] = o),
          (m[6] = a),
          (m[7] = s),
          (m[8] = u),
          (m[9] = h),
          (m[10] = c),
          (m[11] = l),
          (m[12] = f),
          (m[13] = d),
          (m[14] = p),
          (m[15] = v),
          m
        )
      },
      set: function (t, e, n, r, i, o, a, s, u, h, c, l, f, d, p, v, m) {
        return (
          (t[0] = e),
          (t[1] = n),
          (t[2] = r),
          (t[3] = i),
          (t[4] = o),
          (t[5] = a),
          (t[6] = s),
          (t[7] = u),
          (t[8] = h),
          (t[9] = c),
          (t[10] = l),
          (t[11] = f),
          (t[12] = d),
          (t[13] = p),
          (t[14] = v),
          (t[15] = m),
          t
        )
      },
      identity: le,
      transpose: fe,
      invert: de,
      adjoint: function (t, e) {
        var n = e[0],
          r = e[1],
          i = e[2],
          o = e[3],
          a = e[4],
          s = e[5],
          u = e[6],
          h = e[7],
          c = e[8],
          l = e[9],
          f = e[10],
          d = e[11],
          p = e[12],
          v = e[13],
          m = e[14],
          g = e[15]
        return (
          (t[0] =
            s * (f * g - d * m) - l * (u * g - h * m) + v * (u * d - h * f)),
          (t[1] = -(
            r * (f * g - d * m) -
            l * (i * g - o * m) +
            v * (i * d - o * f)
          )),
          (t[2] =
            r * (u * g - h * m) - s * (i * g - o * m) + v * (i * h - o * u)),
          (t[3] = -(
            r * (u * d - h * f) -
            s * (i * d - o * f) +
            l * (i * h - o * u)
          )),
          (t[4] = -(
            a * (f * g - d * m) -
            c * (u * g - h * m) +
            p * (u * d - h * f)
          )),
          (t[5] =
            n * (f * g - d * m) - c * (i * g - o * m) + p * (i * d - o * f)),
          (t[6] = -(
            n * (u * g - h * m) -
            a * (i * g - o * m) +
            p * (i * h - o * u)
          )),
          (t[7] =
            n * (u * d - h * f) - a * (i * d - o * f) + c * (i * h - o * u)),
          (t[8] =
            a * (l * g - d * v) - c * (s * g - h * v) + p * (s * d - h * l)),
          (t[9] = -(
            n * (l * g - d * v) -
            c * (r * g - o * v) +
            p * (r * d - o * l)
          )),
          (t[10] =
            n * (s * g - h * v) - a * (r * g - o * v) + p * (r * h - o * s)),
          (t[11] = -(
            n * (s * d - h * l) -
            a * (r * d - o * l) +
            c * (r * h - o * s)
          )),
          (t[12] = -(
            a * (l * m - f * v) -
            c * (s * m - u * v) +
            p * (s * f - u * l)
          )),
          (t[13] =
            n * (l * m - f * v) - c * (r * m - i * v) + p * (r * f - i * l)),
          (t[14] = -(
            n * (s * m - u * v) -
            a * (r * m - i * v) +
            p * (r * u - i * s)
          )),
          (t[15] =
            n * (s * f - u * l) - a * (r * f - i * l) + c * (r * u - i * s)),
          t
        )
      },
      determinant: pe,
      multiply: ve,
      translate: me,
      scale: ge,
      rotate: ye,
      rotateX: _e,
      rotateY: xe,
      rotateZ: be,
      fromTranslation: function (t, e) {
        return (
          (t[0] = 1),
          (t[1] = 0),
          (t[2] = 0),
          (t[3] = 0),
          (t[4] = 0),
          (t[5] = 1),
          (t[6] = 0),
          (t[7] = 0),
          (t[8] = 0),
          (t[9] = 0),
          (t[10] = 1),
          (t[11] = 0),
          (t[12] = e[0]),
          (t[13] = e[1]),
          (t[14] = e[2]),
          (t[15] = 1),
          t
        )
      },
      fromScaling: function (t, e) {
        return (
          (t[0] = e[0]),
          (t[1] = 0),
          (t[2] = 0),
          (t[3] = 0),
          (t[4] = 0),
          (t[5] = e[1]),
          (t[6] = 0),
          (t[7] = 0),
          (t[8] = 0),
          (t[9] = 0),
          (t[10] = e[2]),
          (t[11] = 0),
          (t[12] = 0),
          (t[13] = 0),
          (t[14] = 0),
          (t[15] = 1),
          t
        )
      },
      fromRotation: function (t, e, n) {
        var r,
          i,
          o,
          a = n[0],
          s = n[1],
          u = n[2],
          h = Math.hypot(a, s, u)
        return h < q
          ? null
          : ((a *= h = 1 / h),
            (s *= h),
            (u *= h),
            (r = Math.sin(e)),
            (o = 1 - (i = Math.cos(e))),
            (t[0] = a * a * o + i),
            (t[1] = s * a * o + u * r),
            (t[2] = u * a * o - s * r),
            (t[3] = 0),
            (t[4] = a * s * o - u * r),
            (t[5] = s * s * o + i),
            (t[6] = u * s * o + a * r),
            (t[7] = 0),
            (t[8] = a * u * o + s * r),
            (t[9] = s * u * o - a * r),
            (t[10] = u * u * o + i),
            (t[11] = 0),
            (t[12] = 0),
            (t[13] = 0),
            (t[14] = 0),
            (t[15] = 1),
            t)
      },
      fromXRotation: function (t, e) {
        var n = Math.sin(e),
          r = Math.cos(e)
        return (
          (t[0] = 1),
          (t[1] = 0),
          (t[2] = 0),
          (t[3] = 0),
          (t[4] = 0),
          (t[5] = r),
          (t[6] = n),
          (t[7] = 0),
          (t[8] = 0),
          (t[9] = -n),
          (t[10] = r),
          (t[11] = 0),
          (t[12] = 0),
          (t[13] = 0),
          (t[14] = 0),
          (t[15] = 1),
          t
        )
      },
      fromYRotation: function (t, e) {
        var n = Math.sin(e),
          r = Math.cos(e)
        return (
          (t[0] = r),
          (t[1] = 0),
          (t[2] = -n),
          (t[3] = 0),
          (t[4] = 0),
          (t[5] = 1),
          (t[6] = 0),
          (t[7] = 0),
          (t[8] = n),
          (t[9] = 0),
          (t[10] = r),
          (t[11] = 0),
          (t[12] = 0),
          (t[13] = 0),
          (t[14] = 0),
          (t[15] = 1),
          t
        )
      },
      fromZRotation: function (t, e) {
        var n = Math.sin(e),
          r = Math.cos(e)
        return (
          (t[0] = r),
          (t[1] = n),
          (t[2] = 0),
          (t[3] = 0),
          (t[4] = -n),
          (t[5] = r),
          (t[6] = 0),
          (t[7] = 0),
          (t[8] = 0),
          (t[9] = 0),
          (t[10] = 1),
          (t[11] = 0),
          (t[12] = 0),
          (t[13] = 0),
          (t[14] = 0),
          (t[15] = 1),
          t
        )
      },
      fromRotationTranslation: Me,
      fromQuat2: function (t, e) {
        var n = new Y(3),
          r = -e[0],
          i = -e[1],
          o = -e[2],
          a = e[3],
          s = e[4],
          u = e[5],
          h = e[6],
          c = e[7],
          l = r * r + i * i + o * o + a * a
        return (
          l > 0
            ? ((n[0] = (2 * (s * a + c * r + u * o - h * i)) / l),
              (n[1] = (2 * (u * a + c * i + h * r - s * o)) / l),
              (n[2] = (2 * (h * a + c * o + s * i - u * r)) / l))
            : ((n[0] = 2 * (s * a + c * r + u * o - h * i)),
              (n[1] = 2 * (u * a + c * i + h * r - s * o)),
              (n[2] = 2 * (h * a + c * o + s * i - u * r))),
          Me(t, e, n),
          t
        )
      },
      getTranslation: function (t, e) {
        return (t[0] = e[12]), (t[1] = e[13]), (t[2] = e[14]), t
      },
      getScaling: Ee,
      getRotation: we,
      fromRotationTranslationScale: Te,
      fromRotationTranslationScaleOrigin: function (t, e, n, r, i) {
        var o = e[0],
          a = e[1],
          s = e[2],
          u = e[3],
          h = o + o,
          c = a + a,
          l = s + s,
          f = o * h,
          d = o * c,
          p = o * l,
          v = a * c,
          m = a * l,
          g = s * l,
          y = u * h,
          _ = u * c,
          x = u * l,
          b = r[0],
          M = r[1],
          E = r[2],
          w = i[0],
          T = i[1],
          A = i[2],
          R = (1 - (v + g)) * b,
          C = (d + x) * b,
          S = (p - _) * b,
          P = (d - x) * M,
          D = (1 - (f + g)) * M,
          I = (m + y) * M,
          L = (p + _) * E,
          O = (m - y) * E,
          B = (1 - (f + v)) * E
        return (
          (t[0] = R),
          (t[1] = C),
          (t[2] = S),
          (t[3] = 0),
          (t[4] = P),
          (t[5] = D),
          (t[6] = I),
          (t[7] = 0),
          (t[8] = L),
          (t[9] = O),
          (t[10] = B),
          (t[11] = 0),
          (t[12] = n[0] + w - (R * w + P * T + L * A)),
          (t[13] = n[1] + T - (C * w + D * T + O * A)),
          (t[14] = n[2] + A - (S * w + I * T + B * A)),
          (t[15] = 1),
          t
        )
      },
      fromQuat: Ae,
      frustum: Re,
      perspective: Ce,
      perspectiveFromFieldOfView: function (t, e, n, r) {
        var i = Math.tan((e.upDegrees * Math.PI) / 180),
          o = Math.tan((e.downDegrees * Math.PI) / 180),
          a = Math.tan((e.leftDegrees * Math.PI) / 180),
          s = Math.tan((e.rightDegrees * Math.PI) / 180),
          u = 2 / (a + s),
          h = 2 / (i + o)
        return (
          (t[0] = u),
          (t[1] = 0),
          (t[2] = 0),
          (t[3] = 0),
          (t[4] = 0),
          (t[5] = h),
          (t[6] = 0),
          (t[7] = 0),
          (t[8] = -(a - s) * u * 0.5),
          (t[9] = (i - o) * h * 0.5),
          (t[10] = r / (n - r)),
          (t[11] = -1),
          (t[12] = 0),
          (t[13] = 0),
          (t[14] = (r * n) / (n - r)),
          (t[15] = 0),
          t
        )
      },
      ortho: Se,
      lookAt: Pe,
      targetTo: De,
      str: function (t) {
        return (
          'mat4(' +
          t[0] +
          ', ' +
          t[1] +
          ', ' +
          t[2] +
          ', ' +
          t[3] +
          ', ' +
          t[4] +
          ', ' +
          t[5] +
          ', ' +
          t[6] +
          ', ' +
          t[7] +
          ', ' +
          t[8] +
          ', ' +
          t[9] +
          ', ' +
          t[10] +
          ', ' +
          t[11] +
          ', ' +
          t[12] +
          ', ' +
          t[13] +
          ', ' +
          t[14] +
          ', ' +
          t[15] +
          ')'
        )
      },
      frob: function (t) {
        return Math.hypot(
          t[0],
          t[1],
          t[2],
          t[3],
          t[4],
          t[5],
          t[6],
          t[7],
          t[8],
          t[9],
          t[10],
          t[11],
          t[12],
          t[13],
          t[14],
          t[15]
        )
      },
      add: function (t, e, n) {
        return (
          (t[0] = e[0] + n[0]),
          (t[1] = e[1] + n[1]),
          (t[2] = e[2] + n[2]),
          (t[3] = e[3] + n[3]),
          (t[4] = e[4] + n[4]),
          (t[5] = e[5] + n[5]),
          (t[6] = e[6] + n[6]),
          (t[7] = e[7] + n[7]),
          (t[8] = e[8] + n[8]),
          (t[9] = e[9] + n[9]),
          (t[10] = e[10] + n[10]),
          (t[11] = e[11] + n[11]),
          (t[12] = e[12] + n[12]),
          (t[13] = e[13] + n[13]),
          (t[14] = e[14] + n[14]),
          (t[15] = e[15] + n[15]),
          t
        )
      },
      subtract: Ie,
      multiplyScalar: function (t, e, n) {
        return (
          (t[0] = e[0] * n),
          (t[1] = e[1] * n),
          (t[2] = e[2] * n),
          (t[3] = e[3] * n),
          (t[4] = e[4] * n),
          (t[5] = e[5] * n),
          (t[6] = e[6] * n),
          (t[7] = e[7] * n),
          (t[8] = e[8] * n),
          (t[9] = e[9] * n),
          (t[10] = e[10] * n),
          (t[11] = e[11] * n),
          (t[12] = e[12] * n),
          (t[13] = e[13] * n),
          (t[14] = e[14] * n),
          (t[15] = e[15] * n),
          t
        )
      },
      multiplyScalarAndAdd: function (t, e, n, r) {
        return (
          (t[0] = e[0] + n[0] * r),
          (t[1] = e[1] + n[1] * r),
          (t[2] = e[2] + n[2] * r),
          (t[3] = e[3] + n[3] * r),
          (t[4] = e[4] + n[4] * r),
          (t[5] = e[5] + n[5] * r),
          (t[6] = e[6] + n[6] * r),
          (t[7] = e[7] + n[7] * r),
          (t[8] = e[8] + n[8] * r),
          (t[9] = e[9] + n[9] * r),
          (t[10] = e[10] + n[10] * r),
          (t[11] = e[11] + n[11] * r),
          (t[12] = e[12] + n[12] * r),
          (t[13] = e[13] + n[13] * r),
          (t[14] = e[14] + n[14] * r),
          (t[15] = e[15] + n[15] * r),
          t
        )
      },
      exactEquals: function (t, e) {
        return (
          t[0] === e[0] &&
          t[1] === e[1] &&
          t[2] === e[2] &&
          t[3] === e[3] &&
          t[4] === e[4] &&
          t[5] === e[5] &&
          t[6] === e[6] &&
          t[7] === e[7] &&
          t[8] === e[8] &&
          t[9] === e[9] &&
          t[10] === e[10] &&
          t[11] === e[11] &&
          t[12] === e[12] &&
          t[13] === e[13] &&
          t[14] === e[14] &&
          t[15] === e[15]
        )
      },
      equals: function (t, e) {
        var n = t[0],
          r = t[1],
          i = t[2],
          o = t[3],
          a = t[4],
          s = t[5],
          u = t[6],
          h = t[7],
          c = t[8],
          l = t[9],
          f = t[10],
          d = t[11],
          p = t[12],
          v = t[13],
          m = t[14],
          g = t[15],
          y = e[0],
          _ = e[1],
          x = e[2],
          b = e[3],
          M = e[4],
          E = e[5],
          w = e[6],
          T = e[7],
          A = e[8],
          R = e[9],
          C = e[10],
          S = e[11],
          P = e[12],
          D = e[13],
          I = e[14],
          L = e[15]
        return (
          Math.abs(n - y) <= q * Math.max(1, Math.abs(n), Math.abs(y)) &&
          Math.abs(r - _) <= q * Math.max(1, Math.abs(r), Math.abs(_)) &&
          Math.abs(i - x) <= q * Math.max(1, Math.abs(i), Math.abs(x)) &&
          Math.abs(o - b) <= q * Math.max(1, Math.abs(o), Math.abs(b)) &&
          Math.abs(a - M) <= q * Math.max(1, Math.abs(a), Math.abs(M)) &&
          Math.abs(s - E) <= q * Math.max(1, Math.abs(s), Math.abs(E)) &&
          Math.abs(u - w) <= q * Math.max(1, Math.abs(u), Math.abs(w)) &&
          Math.abs(h - T) <= q * Math.max(1, Math.abs(h), Math.abs(T)) &&
          Math.abs(c - A) <= q * Math.max(1, Math.abs(c), Math.abs(A)) &&
          Math.abs(l - R) <= q * Math.max(1, Math.abs(l), Math.abs(R)) &&
          Math.abs(f - C) <= q * Math.max(1, Math.abs(f), Math.abs(C)) &&
          Math.abs(d - S) <= q * Math.max(1, Math.abs(d), Math.abs(S)) &&
          Math.abs(p - P) <= q * Math.max(1, Math.abs(p), Math.abs(P)) &&
          Math.abs(v - D) <= q * Math.max(1, Math.abs(v), Math.abs(D)) &&
          Math.abs(m - I) <= q * Math.max(1, Math.abs(m), Math.abs(I)) &&
          Math.abs(g - L) <= q * Math.max(1, Math.abs(g), Math.abs(L))
        )
      },
      mul: Le,
      sub: Oe,
    })
  function ke() {
    var t = new Y(4)
    return (
      Y != Float32Array && ((t[0] = 0), (t[1] = 0), (t[2] = 0), (t[3] = 0)), t
    )
  }
  function Ue(t) {
    var e = new Y(4)
    return (e[0] = t[0]), (e[1] = t[1]), (e[2] = t[2]), (e[3] = t[3]), e
  }
  function Ne(t, e, n, r) {
    var i = new Y(4)
    return (i[0] = t), (i[1] = e), (i[2] = n), (i[3] = r), i
  }
  function Fe(t, e) {
    return (t[0] = e[0]), (t[1] = e[1]), (t[2] = e[2]), (t[3] = e[3]), t
  }
  function je(t, e, n, r, i) {
    return (t[0] = e), (t[1] = n), (t[2] = r), (t[3] = i), t
  }
  function ze(t, e, n) {
    return (
      (t[0] = e[0] + n[0]),
      (t[1] = e[1] + n[1]),
      (t[2] = e[2] + n[2]),
      (t[3] = e[3] + n[3]),
      t
    )
  }
  function Ve(t, e, n) {
    return (
      (t[0] = e[0] - n[0]),
      (t[1] = e[1] - n[1]),
      (t[2] = e[2] - n[2]),
      (t[3] = e[3] - n[3]),
      t
    )
  }
  function Ge(t, e, n) {
    return (
      (t[0] = e[0] * n[0]),
      (t[1] = e[1] * n[1]),
      (t[2] = e[2] * n[2]),
      (t[3] = e[3] * n[3]),
      t
    )
  }
  function He(t, e, n) {
    return (
      (t[0] = e[0] / n[0]),
      (t[1] = e[1] / n[1]),
      (t[2] = e[2] / n[2]),
      (t[3] = e[3] / n[3]),
      t
    )
  }
  function We(t, e, n) {
    return (
      (t[0] = e[0] * n),
      (t[1] = e[1] * n),
      (t[2] = e[2] * n),
      (t[3] = e[3] * n),
      t
    )
  }
  function Ze(t, e) {
    var n = e[0] - t[0],
      r = e[1] - t[1],
      i = e[2] - t[2],
      o = e[3] - t[3]
    return Math.hypot(n, r, i, o)
  }
  function qe(t, e) {
    var n = e[0] - t[0],
      r = e[1] - t[1],
      i = e[2] - t[2],
      o = e[3] - t[3]
    return n * n + r * r + i * i + o * o
  }
  function Ye(t) {
    var e = t[0],
      n = t[1],
      r = t[2],
      i = t[3]
    return Math.hypot(e, n, r, i)
  }
  function Xe(t) {
    var e = t[0],
      n = t[1],
      r = t[2],
      i = t[3]
    return e * e + n * n + r * r + i * i
  }
  function Ke(t, e) {
    var n = e[0],
      r = e[1],
      i = e[2],
      o = e[3],
      a = n * n + r * r + i * i + o * o
    return (
      a > 0 && (a = 1 / Math.sqrt(a)),
      (t[0] = n * a),
      (t[1] = r * a),
      (t[2] = i * a),
      (t[3] = o * a),
      t
    )
  }
  function Qe(t, e) {
    return t[0] * e[0] + t[1] * e[1] + t[2] * e[2] + t[3] * e[3]
  }
  function Je(t, e, n, r) {
    var i = e[0],
      o = e[1],
      a = e[2],
      s = e[3]
    return (
      (t[0] = i + r * (n[0] - i)),
      (t[1] = o + r * (n[1] - o)),
      (t[2] = a + r * (n[2] - a)),
      (t[3] = s + r * (n[3] - s)),
      t
    )
  }
  function $e(t, e, n) {
    var r = e[0],
      i = e[1],
      o = e[2],
      a = e[3]
    return (
      (t[0] = n[0] * r + n[4] * i + n[8] * o + n[12] * a),
      (t[1] = n[1] * r + n[5] * i + n[9] * o + n[13] * a),
      (t[2] = n[2] * r + n[6] * i + n[10] * o + n[14] * a),
      (t[3] = n[3] * r + n[7] * i + n[11] * o + n[15] * a),
      t
    )
  }
  function tn(t, e) {
    return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] && t[3] === e[3]
  }
  function en(t, e) {
    var n = t[0],
      r = t[1],
      i = t[2],
      o = t[3],
      a = e[0],
      s = e[1],
      u = e[2],
      h = e[3]
    return (
      Math.abs(n - a) <= q * Math.max(1, Math.abs(n), Math.abs(a)) &&
      Math.abs(r - s) <= q * Math.max(1, Math.abs(r), Math.abs(s)) &&
      Math.abs(i - u) <= q * Math.max(1, Math.abs(i), Math.abs(u)) &&
      Math.abs(o - h) <= q * Math.max(1, Math.abs(o), Math.abs(h))
    )
  }
  var nn = Ve,
    rn = Ge,
    on = He,
    an = Ze,
    sn = qe,
    un = Ye,
    hn = Xe,
    cn = (function () {
      var t = ke()
      return function (e, n, r, i, o, a) {
        var s, u
        for (
          n || (n = 4),
            r || (r = 0),
            u = i ? Math.min(i * n + r, e.length) : e.length,
            s = r;
          s < u;
          s += n
        )
          (t[0] = e[s]),
            (t[1] = e[s + 1]),
            (t[2] = e[s + 2]),
            (t[3] = e[s + 3]),
            o(t, t, a),
            (e[s] = t[0]),
            (e[s + 1] = t[1]),
            (e[s + 2] = t[2]),
            (e[s + 3] = t[3])
        return e
      }
    })(),
    ln = Object.freeze({
      __proto__: null,
      create: ke,
      clone: Ue,
      fromValues: Ne,
      copy: Fe,
      set: je,
      add: ze,
      subtract: Ve,
      multiply: Ge,
      divide: He,
      ceil: function (t, e) {
        return (
          (t[0] = Math.ceil(e[0])),
          (t[1] = Math.ceil(e[1])),
          (t[2] = Math.ceil(e[2])),
          (t[3] = Math.ceil(e[3])),
          t
        )
      },
      floor: function (t, e) {
        return (
          (t[0] = Math.floor(e[0])),
          (t[1] = Math.floor(e[1])),
          (t[2] = Math.floor(e[2])),
          (t[3] = Math.floor(e[3])),
          t
        )
      },
      min: function (t, e, n) {
        return (
          (t[0] = Math.min(e[0], n[0])),
          (t[1] = Math.min(e[1], n[1])),
          (t[2] = Math.min(e[2], n[2])),
          (t[3] = Math.min(e[3], n[3])),
          t
        )
      },
      max: function (t, e, n) {
        return (
          (t[0] = Math.max(e[0], n[0])),
          (t[1] = Math.max(e[1], n[1])),
          (t[2] = Math.max(e[2], n[2])),
          (t[3] = Math.max(e[3], n[3])),
          t
        )
      },
      round: function (t, e) {
        return (
          (t[0] = Math.round(e[0])),
          (t[1] = Math.round(e[1])),
          (t[2] = Math.round(e[2])),
          (t[3] = Math.round(e[3])),
          t
        )
      },
      scale: We,
      scaleAndAdd: function (t, e, n, r) {
        return (
          (t[0] = e[0] + n[0] * r),
          (t[1] = e[1] + n[1] * r),
          (t[2] = e[2] + n[2] * r),
          (t[3] = e[3] + n[3] * r),
          t
        )
      },
      distance: Ze,
      squaredDistance: qe,
      length: Ye,
      squaredLength: Xe,
      negate: function (t, e) {
        return (t[0] = -e[0]), (t[1] = -e[1]), (t[2] = -e[2]), (t[3] = -e[3]), t
      },
      inverse: function (t, e) {
        return (
          (t[0] = 1 / e[0]),
          (t[1] = 1 / e[1]),
          (t[2] = 1 / e[2]),
          (t[3] = 1 / e[3]),
          t
        )
      },
      normalize: Ke,
      dot: Qe,
      cross: function (t, e, n, r) {
        var i = n[0] * r[1] - n[1] * r[0],
          o = n[0] * r[2] - n[2] * r[0],
          a = n[0] * r[3] - n[3] * r[0],
          s = n[1] * r[2] - n[2] * r[1],
          u = n[1] * r[3] - n[3] * r[1],
          h = n[2] * r[3] - n[3] * r[2],
          c = e[0],
          l = e[1],
          f = e[2],
          d = e[3]
        return (
          (t[0] = l * h - f * u + d * s),
          (t[1] = -c * h + f * a - d * o),
          (t[2] = c * u - l * a + d * i),
          (t[3] = -c * s + l * o - f * i),
          t
        )
      },
      lerp: Je,
      random: function (t, e) {
        var n, r, i, o, a, s
        e = e || 1
        do {
          a = (n = 2 * X() - 1) * n + (r = 2 * X() - 1) * r
        } while (a >= 1)
        do {
          s = (i = 2 * X() - 1) * i + (o = 2 * X() - 1) * o
        } while (s >= 1)
        var u = Math.sqrt((1 - a) / s)
        return (
          (t[0] = e * n),
          (t[1] = e * r),
          (t[2] = e * i * u),
          (t[3] = e * o * u),
          t
        )
      },
      transformMat4: $e,
      transformQuat: function (t, e, n) {
        var r = e[0],
          i = e[1],
          o = e[2],
          a = n[0],
          s = n[1],
          u = n[2],
          h = n[3],
          c = h * r + s * o - u * i,
          l = h * i + u * r - a * o,
          f = h * o + a * i - s * r,
          d = -a * r - s * i - u * o
        return (
          (t[0] = c * h + d * -a + l * -u - f * -s),
          (t[1] = l * h + d * -s + f * -a - c * -u),
          (t[2] = f * h + d * -u + c * -s - l * -a),
          (t[3] = e[3]),
          t
        )
      },
      zero: function (t) {
        return (t[0] = 0), (t[1] = 0), (t[2] = 0), (t[3] = 0), t
      },
      str: function (t) {
        return 'vec4(' + t[0] + ', ' + t[1] + ', ' + t[2] + ', ' + t[3] + ')'
      },
      exactEquals: tn,
      equals: en,
      sub: nn,
      mul: rn,
      div: on,
      dist: an,
      sqrDist: sn,
      len: un,
      sqrLen: hn,
      forEach: cn,
    })
  const fn = Object.freeze([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]),
    dn = Object.freeze([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]),
    pn = Object.freeze({
      COL0ROW0: 0,
      COL0ROW1: 1,
      COL0ROW2: 2,
      COL0ROW3: 3,
      COL1ROW0: 4,
      COL1ROW1: 5,
      COL1ROW2: 6,
      COL1ROW3: 7,
      COL2ROW0: 8,
      COL2ROW1: 9,
      COL2ROW2: 10,
      COL2ROW3: 11,
      COL3ROW0: 12,
      COL3ROW1: 13,
      COL3ROW2: 14,
      COL3ROW3: 15,
    }),
    vn = {}
  class mn extends ee {
    static get IDENTITY() {
      return (
        (vn.IDENTITY = vn.IDENTITY || Object.freeze(new mn(fn))), vn.IDENTITY
      )
    }
    static get ZERO() {
      return (vn.ZERO = vn.ZERO || Object.freeze(new mn(dn))), vn.ZERO
    }
    get INDICES() {
      return pn
    }
    get ELEMENTS() {
      return 16
    }
    get RANK() {
      return 4
    }
    constructor(t) {
      super(-0, -0, -0, -0, -0, -0, -0, -0, -0, -0, -0, -0, -0, -0, -0, -0),
        1 === arguments.length && Array.isArray(t)
          ? this.copy(t)
          : this.identity()
    }
    copy(t) {
      return (
        (this[0] = t[0]),
        (this[1] = t[1]),
        (this[2] = t[2]),
        (this[3] = t[3]),
        (this[4] = t[4]),
        (this[5] = t[5]),
        (this[6] = t[6]),
        (this[7] = t[7]),
        (this[8] = t[8]),
        (this[9] = t[9]),
        (this[10] = t[10]),
        (this[11] = t[11]),
        (this[12] = t[12]),
        (this[13] = t[13]),
        (this[14] = t[14]),
        (this[15] = t[15]),
        this.check()
      )
    }
    set(t, e, n, r, i, o, a, s, u, h, c, l, f, d, p, v) {
      return (
        (this[0] = t),
        (this[1] = e),
        (this[2] = n),
        (this[3] = r),
        (this[4] = i),
        (this[5] = o),
        (this[6] = a),
        (this[7] = s),
        (this[8] = u),
        (this[9] = h),
        (this[10] = c),
        (this[11] = l),
        (this[12] = f),
        (this[13] = d),
        (this[14] = p),
        (this[15] = v),
        this.check()
      )
    }
    setRowMajor(t, e, n, r, i, o, a, s, u, h, c, l, f, d, p, v) {
      return (
        (this[0] = t),
        (this[1] = i),
        (this[2] = u),
        (this[3] = f),
        (this[4] = e),
        (this[5] = o),
        (this[6] = h),
        (this[7] = d),
        (this[8] = n),
        (this[9] = a),
        (this[10] = c),
        (this[11] = p),
        (this[12] = r),
        (this[13] = s),
        (this[14] = l),
        (this[15] = v),
        this.check()
      )
    }
    toRowMajor(t) {
      return (
        (t[0] = this[0]),
        (t[1] = this[4]),
        (t[2] = this[8]),
        (t[3] = this[12]),
        (t[4] = this[1]),
        (t[5] = this[5]),
        (t[6] = this[9]),
        (t[7] = this[13]),
        (t[8] = this[2]),
        (t[9] = this[6]),
        (t[10] = this[10]),
        (t[11] = this[14]),
        (t[12] = this[3]),
        (t[13] = this[7]),
        (t[14] = this[11]),
        (t[15] = this[15]),
        t
      )
    }
    identity() {
      return this.copy(fn)
    }
    fromQuaternion(t) {
      return Ae(this, t), this.check()
    }
    frustum({ left: t, right: e, bottom: n, top: r, near: i, far: o }) {
      return (
        o === 1 / 0
          ? mn._computeInfinitePerspectiveOffCenter(this, t, e, n, r, i)
          : Re(this, t, e, n, r, i, o),
        this.check()
      )
    }
    static _computeInfinitePerspectiveOffCenter(t, e, n, r, i, o) {
      const a = (2 * o) / (n - e),
        s = (2 * o) / (i - r),
        u = (n + e) / (n - e),
        h = (i + r) / (i - r),
        c = -2 * o
      return (
        (t[0] = a),
        (t[1] = 0),
        (t[2] = 0),
        (t[3] = 0),
        (t[4] = 0),
        (t[5] = s),
        (t[6] = 0),
        (t[7] = 0),
        (t[8] = u),
        (t[9] = h),
        (t[10] = -1),
        (t[11] = -1),
        (t[12] = 0),
        (t[13] = 0),
        (t[14] = c),
        (t[15] = 0),
        t
      )
    }
    lookAt(t, e, n) {
      return (
        1 === arguments.length && ({ eye: t, center: e, up: n } = t),
        Pe(this, t, (e = e || [0, 0, 0]), (n = n || [0, 1, 0])),
        this.check()
      )
    }
    ortho({
      left: t,
      right: e,
      bottom: n,
      top: r,
      near: i = 0.1,
      far: o = 500,
    }) {
      return Se(this, t, e, n, r, i, o), this.check()
    }
    orthographic({
      fovy: t = (45 * Math.PI) / 180,
      aspect: e = 1,
      focalDistance: n = 1,
      near: r = 0.1,
      far: i = 500,
    }) {
      if (t > 2 * Math.PI) throw Error('radians')
      const o = t / 2,
        a = n * Math.tan(o),
        s = a * e
      return new mn().ortho({
        left: -s,
        right: s,
        bottom: -a,
        top: a,
        near: r,
        far: i,
      })
    }
    perspective({
      fovy: t,
      fov: e = (45 * Math.PI) / 180,
      aspect: n = 1,
      near: r = 0.1,
      far: i = 500,
    } = {}) {
      if ((t = t || e) > 2 * Math.PI) throw Error('radians')
      return Ce(this, t, n, r, i), this.check()
    }
    determinant() {
      return pe(this)
    }
    getScale(t = [-0, -0, -0]) {
      return (
        (t[0] = Math.sqrt(
          this[0] * this[0] + this[1] * this[1] + this[2] * this[2]
        )),
        (t[1] = Math.sqrt(
          this[4] * this[4] + this[5] * this[5] + this[6] * this[6]
        )),
        (t[2] = Math.sqrt(
          this[8] * this[8] + this[9] * this[9] + this[10] * this[10]
        )),
        t
      )
    }
    getTranslation(t = [-0, -0, -0]) {
      return (t[0] = this[12]), (t[1] = this[13]), (t[2] = this[14]), t
    }
    getRotation(
      t = [-0, -0, -0, -0, -0, -0, -0, -0, -0, -0, -0, -0, -0, -0, -0, -0],
      e = null
    ) {
      const n = this.getScale(e || [-0, -0, -0]),
        r = 1 / n[0],
        i = 1 / n[1],
        o = 1 / n[2]
      return (
        (t[0] = this[0] * r),
        (t[1] = this[1] * i),
        (t[2] = this[2] * o),
        (t[3] = 0),
        (t[4] = this[4] * r),
        (t[5] = this[5] * i),
        (t[6] = this[6] * o),
        (t[7] = 0),
        (t[8] = this[8] * r),
        (t[9] = this[9] * i),
        (t[10] = this[10] * o),
        (t[11] = 0),
        (t[12] = 0),
        (t[13] = 0),
        (t[14] = 0),
        (t[15] = 1),
        t
      )
    }
    getRotationMatrix3(t = [-0, -0, -0, -0, -0, -0, -0, -0, -0], e = null) {
      const n = this.getScale(e || [-0, -0, -0]),
        r = 1 / n[0],
        i = 1 / n[1],
        o = 1 / n[2]
      return (
        (t[0] = this[0] * r),
        (t[1] = this[1] * i),
        (t[2] = this[2] * o),
        (t[3] = this[4] * r),
        (t[4] = this[5] * i),
        (t[5] = this[6] * o),
        (t[6] = this[8] * r),
        (t[7] = this[9] * i),
        (t[8] = this[10] * o),
        t
      )
    }
    transpose() {
      return fe(this, this), this.check()
    }
    invert() {
      return de(this, this), this.check()
    }
    multiplyLeft(t) {
      return ve(this, t, this), this.check()
    }
    multiplyRight(t) {
      return ve(this, this, t), this.check()
    }
    rotateX(t) {
      return _e(this, this, t), this.check()
    }
    rotateY(t) {
      return xe(this, this, t), this.check()
    }
    rotateZ(t) {
      return be(this, this, t), this.check()
    }
    rotateXYZ([t, e, n]) {
      return this.rotateX(t).rotateY(e).rotateZ(n)
    }
    rotateAxis(t, e) {
      return ye(this, this, t, e), this.check()
    }
    scale(t) {
      return (
        Array.isArray(t) ? ge(this, this, t) : ge(this, this, [t, t, t]),
        this.check()
      )
    }
    translate(t) {
      return me(this, this, t), this.check()
    }
    transform(t, e) {
      return 4 === t.length
        ? (G((e = $e(e || [-0, -0, -0, -0], t, this)), 4), e)
        : this.transformAsPoint(t, e)
    }
    transformAsPoint(t, e) {
      const { length: n } = t
      switch (n) {
        case 2:
          e = ot(e || [-0, -0], t, this)
          break
        case 3:
          e = Lt(e || [-0, -0, -0], t, this)
          break
        default:
          throw new Error('Illegal vector')
      }
      return G(e, t.length), e
    }
    transformAsVector(t, e) {
      switch (t.length) {
        case 2:
          e = (function (t, e, n) {
            const r = e[0],
              i = e[1],
              o = n[3] * r + n[7] * i || 1
            return (
              (t[0] = (n[0] * r + n[4] * i) / o),
              (t[1] = (n[1] * r + n[5] * i) / o),
              t
            )
          })(e || [-0, -0], t, this)
          break
        case 3:
          e = mt(e || [-0, -0, -0], t, this)
          break
        default:
          throw new Error('Illegal vector')
      }
      return G(e, t.length), e
    }
    makeRotationX(t) {
      return this.identity().rotateX(t)
    }
    makeTranslation(t, e, n) {
      return this.identity().translate([t, e, n])
    }
    transformPoint(t, e) {
      return W('Matrix4.transformPoint', '3.0'), this.transformAsPoint(t, e)
    }
    transformVector(t, e) {
      return W('Matrix4.transformVector', '3.0'), this.transformAsPoint(t, e)
    }
    transformDirection(t, e) {
      return (
        W('Matrix4.transformDirection', '3.0'), this.transformAsVector(t, e)
      )
    }
  }
  function gn() {
    var t = new Y(4)
    return (
      Y != Float32Array && ((t[0] = 0), (t[1] = 0), (t[2] = 0)), (t[3] = 1), t
    )
  }
  function yn(t) {
    return (t[0] = 0), (t[1] = 0), (t[2] = 0), (t[3] = 1), t
  }
  function _n(t, e, n) {
    n *= 0.5
    var r = Math.sin(n)
    return (
      (t[0] = r * e[0]),
      (t[1] = r * e[1]),
      (t[2] = r * e[2]),
      (t[3] = Math.cos(n)),
      t
    )
  }
  function xn(t, e, n) {
    var r = e[0],
      i = e[1],
      o = e[2],
      a = e[3],
      s = n[0],
      u = n[1],
      h = n[2],
      c = n[3]
    return (
      (t[0] = r * c + a * s + i * h - o * u),
      (t[1] = i * c + a * u + o * s - r * h),
      (t[2] = o * c + a * h + r * u - i * s),
      (t[3] = a * c - r * s - i * u - o * h),
      t
    )
  }
  function bn(t, e) {
    var n = e[0],
      r = e[1],
      i = e[2],
      o = e[3],
      a = Math.sqrt(n * n + r * r + i * i),
      s = Math.exp(o),
      u = a > 0 ? (s * Math.sin(a)) / a : 0
    return (
      (t[0] = n * u),
      (t[1] = r * u),
      (t[2] = i * u),
      (t[3] = s * Math.cos(a)),
      t
    )
  }
  function Mn(t, e) {
    var n = e[0],
      r = e[1],
      i = e[2],
      o = e[3],
      a = Math.sqrt(n * n + r * r + i * i),
      s = a > 0 ? Math.atan2(a, o) / a : 0
    return (
      (t[0] = n * s),
      (t[1] = r * s),
      (t[2] = i * s),
      (t[3] = 0.5 * Math.log(n * n + r * r + i * i + o * o)),
      t
    )
  }
  function En(t, e, n, r) {
    var i,
      o,
      a,
      s,
      u,
      h = e[0],
      c = e[1],
      l = e[2],
      f = e[3],
      d = n[0],
      p = n[1],
      v = n[2],
      m = n[3]
    return (
      (o = h * d + c * p + l * v + f * m) < 0 &&
        ((o = -o), (d = -d), (p = -p), (v = -v), (m = -m)),
      1 - o > q
        ? ((i = Math.acos(o)),
          (a = Math.sin(i)),
          (s = Math.sin((1 - r) * i) / a),
          (u = Math.sin(r * i) / a))
        : ((s = 1 - r), (u = r)),
      (t[0] = s * h + u * d),
      (t[1] = s * c + u * p),
      (t[2] = s * l + u * v),
      (t[3] = s * f + u * m),
      t
    )
  }
  function wn(t, e) {
    var n,
      r = e[0] + e[4] + e[8]
    if (r > 0)
      (n = Math.sqrt(r + 1)),
        (t[3] = 0.5 * n),
        (n = 0.5 / n),
        (t[0] = (e[5] - e[7]) * n),
        (t[1] = (e[6] - e[2]) * n),
        (t[2] = (e[1] - e[3]) * n)
    else {
      var i = 0
      e[4] > e[0] && (i = 1), e[8] > e[3 * i + i] && (i = 2)
      var o = (i + 1) % 3,
        a = (i + 2) % 3
      ;(n = Math.sqrt(e[3 * i + i] - e[3 * o + o] - e[3 * a + a] + 1)),
        (t[i] = 0.5 * n),
        (n = 0.5 / n),
        (t[3] = (e[3 * o + a] - e[3 * a + o]) * n),
        (t[o] = (e[3 * o + i] + e[3 * i + o]) * n),
        (t[a] = (e[3 * a + i] + e[3 * i + a]) * n)
    }
    return t
  }
  function Tn(t, e, n, r) {
    var i = (0.5 * Math.PI) / 180
    ;(e *= i), (n *= i), (r *= i)
    var o = Math.sin(e),
      a = Math.cos(e),
      s = Math.sin(n),
      u = Math.cos(n),
      h = Math.sin(r),
      c = Math.cos(r)
    return (
      (t[0] = o * u * c - a * s * h),
      (t[1] = a * s * c + o * u * h),
      (t[2] = a * u * h - o * s * c),
      (t[3] = a * u * c + o * s * h),
      t
    )
  }
  var An,
    Rn,
    Cn,
    Sn,
    Pn,
    Dn,
    In = Ue,
    Ln = Ne,
    On = Fe,
    Bn = je,
    kn = ze,
    Un = xn,
    Nn = We,
    Fn = Qe,
    jn = Je,
    zn = Ye,
    Vn = zn,
    Gn = Xe,
    Hn = Gn,
    Wn = Ke,
    Zn = tn,
    qn = en,
    Yn =
      ((An = gt()),
      (Rn = xt(1, 0, 0)),
      (Cn = xt(0, 1, 0)),
      function (t, e, n) {
        var r = Dt(e, n)
        return r < -0.999999
          ? (It(An, Rn, e),
            Zt(An) < 1e-6 && It(An, Cn, e),
            Pt(An, An),
            _n(t, An, Math.PI),
            t)
          : r > 0.999999
          ? ((t[0] = 0), (t[1] = 0), (t[2] = 0), (t[3] = 1), t)
          : (It(An, e, n),
            (t[0] = An[0]),
            (t[1] = An[1]),
            (t[2] = An[2]),
            (t[3] = 1 + r),
            Wn(t, t))
      }),
    Xn =
      ((Sn = gn()),
      (Pn = gn()),
      function (t, e, n, r, i, o) {
        return (
          En(Sn, e, i, o), En(Pn, n, r, o), En(t, Sn, Pn, 2 * o * (1 - o)), t
        )
      }),
    Kn =
      ((Dn = ne()),
      function (t, e, n, r) {
        return (
          (Dn[0] = n[0]),
          (Dn[3] = n[1]),
          (Dn[6] = n[2]),
          (Dn[1] = r[0]),
          (Dn[4] = r[1]),
          (Dn[7] = r[2]),
          (Dn[2] = -e[0]),
          (Dn[5] = -e[1]),
          (Dn[8] = -e[2]),
          Wn(t, wn(t, Dn))
        )
      }),
    Qn = Object.freeze({
      __proto__: null,
      create: gn,
      identity: yn,
      setAxisAngle: _n,
      getAxisAngle: function (t, e) {
        var n = 2 * Math.acos(e[3]),
          r = Math.sin(n / 2)
        return (
          r > q
            ? ((t[0] = e[0] / r), (t[1] = e[1] / r), (t[2] = e[2] / r))
            : ((t[0] = 1), (t[1] = 0), (t[2] = 0)),
          n
        )
      },
      getAngle: function (t, e) {
        var n = Fn(t, e)
        return Math.acos(2 * n * n - 1)
      },
      multiply: xn,
      rotateX: function (t, e, n) {
        n *= 0.5
        var r = e[0],
          i = e[1],
          o = e[2],
          a = e[3],
          s = Math.sin(n),
          u = Math.cos(n)
        return (
          (t[0] = r * u + a * s),
          (t[1] = i * u + o * s),
          (t[2] = o * u - i * s),
          (t[3] = a * u - r * s),
          t
        )
      },
      rotateY: function (t, e, n) {
        n *= 0.5
        var r = e[0],
          i = e[1],
          o = e[2],
          a = e[3],
          s = Math.sin(n),
          u = Math.cos(n)
        return (
          (t[0] = r * u - o * s),
          (t[1] = i * u + a * s),
          (t[2] = o * u + r * s),
          (t[3] = a * u - i * s),
          t
        )
      },
      rotateZ: function (t, e, n) {
        n *= 0.5
        var r = e[0],
          i = e[1],
          o = e[2],
          a = e[3],
          s = Math.sin(n),
          u = Math.cos(n)
        return (
          (t[0] = r * u + i * s),
          (t[1] = i * u - r * s),
          (t[2] = o * u + a * s),
          (t[3] = a * u - o * s),
          t
        )
      },
      calculateW: function (t, e) {
        var n = e[0],
          r = e[1],
          i = e[2]
        return (
          (t[0] = n),
          (t[1] = r),
          (t[2] = i),
          (t[3] = Math.sqrt(Math.abs(1 - n * n - r * r - i * i))),
          t
        )
      },
      exp: bn,
      ln: Mn,
      pow: function (t, e, n) {
        return Mn(t, e), Nn(t, t, n), bn(t, t), t
      },
      slerp: En,
      random: function (t) {
        var e = X(),
          n = X(),
          r = X(),
          i = Math.sqrt(1 - e),
          o = Math.sqrt(e)
        return (
          (t[0] = i * Math.sin(2 * Math.PI * n)),
          (t[1] = i * Math.cos(2 * Math.PI * n)),
          (t[2] = o * Math.sin(2 * Math.PI * r)),
          (t[3] = o * Math.cos(2 * Math.PI * r)),
          t
        )
      },
      invert: function (t, e) {
        var n = e[0],
          r = e[1],
          i = e[2],
          o = e[3],
          a = n * n + r * r + i * i + o * o,
          s = a ? 1 / a : 0
        return (
          (t[0] = -n * s), (t[1] = -r * s), (t[2] = -i * s), (t[3] = o * s), t
        )
      },
      conjugate: function (t, e) {
        return (t[0] = -e[0]), (t[1] = -e[1]), (t[2] = -e[2]), (t[3] = e[3]), t
      },
      fromMat3: wn,
      fromEuler: Tn,
      str: function (t) {
        return 'quat(' + t[0] + ', ' + t[1] + ', ' + t[2] + ', ' + t[3] + ')'
      },
      clone: In,
      fromValues: Ln,
      copy: On,
      set: Bn,
      add: kn,
      mul: Un,
      scale: Nn,
      dot: Fn,
      lerp: jn,
      length: zn,
      len: Vn,
      squaredLength: Gn,
      sqrLen: Hn,
      normalize: Wn,
      exactEquals: Zn,
      equals: qn,
      rotationTo: Yn,
      sqlerp: Xn,
      setAxes: Kn,
    })
  function Jn(t) {
    return (
      (Jn =
        'function' == typeof Symbol && 'symbol' == typeof Symbol.iterator
          ? function (t) {
              return typeof t
            }
          : function (t) {
              return t &&
                'function' == typeof Symbol &&
                t.constructor === Symbol &&
                t !== Symbol.prototype
                ? 'symbol'
                : typeof t
            }),
      Jn(t)
    )
  }
  var $n = function (t) {
      return '[object String]' === Object.prototype.toString.call(t)
    },
    tr = function (t) {
      var e = '[object Function]' === Object.prototype.toString.call(t),
        n = '[object AsyncFunction]' === Object.prototype.toString.call(t)
      return e || n
    },
    er = 365611
  function nr(t, e) {
    ;(this.type = t),
      (this.returnValue = !0),
      (this.target = e || null),
      (this.currentTarget = null)
  }
  var rr = (function () {
    function t() {
      this.__listeners = void 0
    }
    var e = t.prototype
    return (
      (e.on = function () {
        for (var t = arguments.length, e = new Array(t), n = 0; n < t; n++)
          e[n] = arguments[n]
        this.alias('addEventListener')(e)
      }),
      (e.off = function () {
        for (var t = arguments.length, e = new Array(t), n = 0; n < t; n++)
          e[n] = arguments[n]
        this.alias('removeEventListener')(e)
      }),
      (e.emit = function () {
        for (var t = arguments.length, e = new Array(t), n = 0; n < t; n++)
          e[n] = arguments[n]
        this.alias('dispatchEvent')(e)
      }),
      (e.addEventListener = function (t, e, n) {
        if (tr(e)) {
          var r
          !this.__listeners && (this.__listeners = {})
          var i = this.__listeners
          if ('string' == typeof n && n) {
            if (/[^\w-]/.test(n)) throw 'nonstandard key:' + n
            ;(e.hashCode = n), (r = n)
          }
          !t.startsWith('on') && (t = 'on' + t),
            'object' !== Jn(i[t]) && (i[t] = {}),
            (r = r || (++er).toString()),
            (e.hashCode = r),
            (i[t][r] = e)
        }
      }),
      (e.removeEventListener = function (t, e) {
        if (tr(e)) e = e.hashCode
        else if (!$n(e)) return
        !this.__listeners && (this.__listeners = {}),
          !t.startsWith('on') && (t = 'on' + t)
        var n = this.__listeners
        n[t] && n[t][e] && delete n[t][e]
      }),
      (e.dispatchEvent = function (t, e) {
        $n(t) && (t = new nr(t)), !this.__listeners && (this.__listeners = {})
        var n = this.__listeners,
          r = t.type,
          i = e || t
        if (
          ((t.target = t.target || this),
          (t.currentTarget = this),
          0 !== r.indexOf('on') && (r = 'on'.concat(r)),
          tr(n[r]) && n[r].call(this, i),
          'object' === Jn(n[r]))
        )
          for (var o in n[r])
            Object.prototype.hasOwnProperty.call(n[r], o) &&
              n[r][o].call(this, i)
        return t.returnValue
      }),
      (e.alias = function (t) {
        var e = this
        return function (n) {
          return e[t].apply(e, n)
        }
      }),
      t
    )
  })()
  function ir(t, e) {
    var n = e[2],
      r = e[0],
      i = e[1],
      o = e[3],
      a = o * o,
      s = n * n,
      u = r * r,
      h = i * i,
      c = i * n - r * o,
      l = 0.4999999
    return (
      c < -l
        ? ((t[0] = Math.PI / 2), (t[1] = 2 * Math.atan2(i, o)), (t[2] = 0))
        : c > l
        ? ((t[0] = -Math.PI / 2), (t[1] = 2 * Math.atan2(i, o)), (t[2] = 0))
        : ((t[0] = Math.asin(-2 * (n * i - r * o))),
          (t[1] = Math.atan2(2 * (n * r + i * o), s - u - h + a)),
          (t[2] = Math.atan2(2 * (r * i + n * o), -s - u + h + a))),
      t
    )
  }
  var or = (function () {
    function t() {
      var e =
          arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
        n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0,
        r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0,
        i =
          arguments.length > 3 && void 0 !== arguments[3]
            ? arguments[3]
            : t.DefaultOrder
      ;(this.isEuler = !0),
        (this._x = void 0),
        (this._y = void 0),
        (this._z = void 0),
        (this._order = void 0),
        (this._onChangeCallback = void 0),
        (this._x = e),
        (this._y = n),
        (this._z = r),
        (this._order = i),
        (this._onChangeCallback = function () {})
    }
    var e = t.prototype
    return (
      (e.set = function (t, e, n) {
        var r =
          !(arguments.length > 3 && void 0 !== arguments[3]) || arguments[3]
        return (
          (this._x = t),
          (this._y = e),
          (this._z = n),
          r && this._onChangeCallback(),
          this
        )
      }),
      (e.clone = function () {
        return new t(this._x, this._y, this._z, this._order)
      }),
      (e.copy = function (t) {
        return t.isEuler
          ? ((this._x = t._x),
            (this._y = t._y),
            (this._z = t._z),
            (this._order = t._order),
            this._onChangeCallback(),
            this)
          : this
      }),
      (e.equals = function (t) {
        return (
          t._x === this._x &&
          t._y === this._y &&
          t._z === this._z &&
          t._order === this._order
        )
      }),
      (e.toVector3 = function () {
        return xt(this._x, this._y, this._z)
      }),
      (e.onChange = function (t) {
        'function' == typeof t && (this._onChangeCallback = t)
      }),
      o(t, [
        {
          key: 'x',
          get: function () {
            return this._x
          },
          set: function (t) {
            ;(this._x = t), this._onChangeCallback()
          },
        },
        {
          key: 'y',
          get: function () {
            return this._y
          },
          set: function (t) {
            ;(this._y = t), this._onChangeCallback()
          },
        },
        {
          key: 'z',
          get: function () {
            return this._z
          },
          set: function (t) {
            ;(this._z = t), this._onChangeCallback()
          },
        },
        {
          key: 'order',
          get: function () {
            return this._order
          },
          set: function (t) {
            ;(this._order = t), this._onChangeCallback()
          },
        },
      ]),
      t
    )
  })()
  function ar() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(
      /[xy]/g,
      function (t) {
        var e = (16 * Math.random()) | 0
        return ('x' === t ? e : (3 & e) | 8).toString(16)
      }
    )
  }
  or.DefaultOrder = 'XYZ'
  var sr = function (t) {
      return (180 * t) / Math.PI
    },
    ur = (function (t) {
      function e() {
        var n
        return (
          ((n = t.call(this) || this).isObject3D = !0),
          (n.uuid = ar()),
          (n.name = ''),
          (n.parent = null),
          (n.children = []),
          (n.visible = !0),
          (n.position = gt()),
          (n.rotation = new or()),
          (n.scale = xt(1, 1, 1)),
          (n.quaternion = gn()),
          (n.up = yt(e.DefaultUp)),
          (n.modelMatrix = ue()),
          (n.worldMatrix = ue()),
          (n.modelMatrixNeedUpdate = !1),
          (n.worldMatrixNeedsUpdate = !1),
          n.rotation.onChange(function () {
            n.modelMatrixNeedUpdate = !0
          }),
          n
        )
      }
      c(e, t)
      var n = e.prototype
      return (
        (n.rotateX = function (t) {
          this.rotation.x = t
        }),
        (n.rotateY = function (t) {
          this.rotation.y = t
        }),
        (n.rotateZ = function (t) {
          this.rotation.z = t
        }),
        (n.translate = function (t, e, n) {
          var r = xt(t, e, n)
          return (
            (this.position = Mt(this.position, this.position, r)),
            (this.modelMatrixNeedUpdate = !0),
            this
          )
        }),
        (n.setPosition = function (t, e, n) {
          var r = xt(t, e, n)
          return (
            jt(this.position, r) ||
              ((this.position = r), (this.modelMatrixNeedUpdate = !0)),
            this
          )
        }),
        (n.lookAt = function (t, e, n) {
          var r = this.up,
            i = this.position,
            o = xt(t, e, n),
            a = De(ue(), i, o, r),
            s = we(gn(), a),
            u = ir(gt(), s)
          this.rotation.set(sr(u[0]), sr(u[1]), sr(u[2]))
        }),
        (n.setVisible = function (t) {
          var e =
            arguments.length > 1 && void 0 !== arguments[1] && arguments[1]
          if (this.visible !== t && ((this.visible = t), e))
            for (var n = 0, r = this.children.length; n < r; n++)
              this.children[n].setVisible(t, e)
        }),
        (n.setScale = function (t, e, n) {
          var r = xt(t, e, n)
          return (
            jt(this.scale, r) ||
              ((this.scale = r), (this.modelMatrixNeedUpdate = !0)),
            this
          )
        }),
        (n.updateMatrix = function () {
          le(this.modelMatrix),
            yn(this.quaternion),
            Tn(
              this.quaternion,
              this.rotation.x,
              this.rotation.y,
              this.rotation.z
            ),
            Te(this.modelMatrix, this.quaternion, this.position, this.scale),
            (this.modelMatrixNeedUpdate = !1),
            (this.worldMatrixNeedsUpdate = !0)
        }),
        (n.updateWorldMatrix = function () {
          var t =
            arguments.length > 0 && void 0 !== arguments[0] && arguments[0]
          ;(!0 !== this.modelMatrixNeedUpdate && !0 !== t) ||
            this.updateMatrix(),
            !0 === this.worldMatrixNeedsUpdate &&
              (this.parent
                ? ve(
                    this.worldMatrix,
                    this.parent.worldMatrix,
                    this.modelMatrix
                  )
                : ce(this.worldMatrix, this.modelMatrix),
              (this.worldMatrixNeedsUpdate = !1),
              (t = !0))
          for (var e = 0, n = this.children.length; e < n; e++)
            this.children[e].updateWorldMatrix(t)
        }),
        (n.add = function (t) {
          if (t === this)
            return (
              console.error(
                "object3D.add: object can't be added as a child of itself. ==> ".concat(
                  t
                )
              ),
              this
            )
          if (t instanceof Array) {
            for (var e = 0, n = t.length; e < n; e++) this.add(t[e])
            return this
          }
          return (
            t && t.isObject3D
              ? (null !== t.parent && t.parent.remove(t),
                (t.parent = this),
                this.children.push(t))
              : console.error(
                  'Object3D.add: object not an instance of Object3D.',
                  t
                ),
            this
          )
        }),
        (n.remove = function (t) {
          if (t instanceof Array) {
            for (var e = 0, n = t.length; e < n; e++) this.remove(t[e])
            return this
          }
          var r = this.children.indexOf(t)
          return (
            -1 !== r && ((t.parent = null), this.children.splice(r, 1)), this
          )
        }),
        (n.traverse = function (t) {
          t(this),
            this.children &&
              this.children.length > 0 &&
              this.children.forEach(function (e) {
                e.traverse(t)
              })
        }),
        (n.clone = function () {
          var t =
              arguments.length > 0 && void 0 !== arguments[0] && arguments[0],
            n = new e()
          if (
            ((n.up = yt(this.up)),
            (n.scale = yt(this.scale)),
            (n.position = yt(this.position)),
            (n.rotation = this.rotation.clone()),
            (n.quaternion = In(this.quaternion)),
            (n.modelMatrix = he(this.modelMatrix)),
            (n.worldMatrix = he(this.worldMatrix)),
            (n.visible = this.visible),
            this.children.length && t)
          )
            for (var r = 0, i = this.children.length; r < i; r++)
              n.add(this.children[r].clone())
          return n
        }),
        (n.raycast = function (t) {
          return null
        }),
        e
      )
    })(rr)
  ur.DefaultUp = xt(0, 1, 0)
  var hr = (function () {
      function t(t, e) {
        ;(this.isBox = !0),
          (this.min = void 0),
          (this.max = void 0),
          (this.min = void 0 !== t ? t : xt(1 / 0, 1 / 0, 1 / 0)),
          (this.max = void 0 !== e ? e : xt(-1 / 0, -1 / 0, -1 / 0))
      }
      var e = t.prototype
      return (
        (e.set = function (t, e) {
          return bt(this.min, t), bt(this.max, e), this
        }),
        (e.setFromBufferAttribute = function (t) {
          for (
            var e = 1 / 0,
              n = 1 / 0,
              r = 1 / 0,
              i = -1 / 0,
              o = -1 / 0,
              a = -1 / 0,
              s = t.array,
              u = t.count,
              h = t.itemSize,
              c = 0;
            c < u;
            c++
          ) {
            var l = s[c * h],
              f = s[c * h + 1],
              d = s[c * h + 2]
            l < e && (e = l),
              f < n && (n = f),
              d < r && (r = d),
              l > i && (i = l),
              f > o && (o = f),
              d > a && (a = d)
          }
          var p = xt(e, n, r),
            v = xt(i, o, a)
          return this.set(p, v), this
        }),
        (e.getCenter = function () {
          return this.isInvalid()
            ? gt()
            : xt(
                (this.max[0] + this.min[0]) / 2,
                (this.max[1] + this.min[1]) / 2,
                (this.max[2] + this.min[2]) / 2
              )
        }),
        (e.isInvalid = function () {
          return (
            this.max[0] < this.min[0] ||
            this.max[1] < this.min[1] ||
            this.max[2] < this.min[2]
          )
        }),
        t
      )
    })(),
    cr = (function () {
      function t(e, n, r) {
        var i = arguments.length > 3 && void 0 !== arguments[3] && arguments[3]
        if (
          ((this.isBufferAttribute = !0),
          (this.name = ''),
          (this.type = void 0),
          (this.array = void 0),
          (this.itemSize = void 0),
          (this.count = void 0),
          (this.normalized = void 0),
          (this.usage = void 0),
          (this.needUpdate = void 0),
          Array.isArray(e))
        )
          throw new TypeError('BufferAttribute: array should be a Typed Array.')
        if (
          ((this.name = 'BufferAttribute'),
          (this.array = e),
          (this.itemSize = n),
          (this.count = void 0 !== e ? e.length / n : 0),
          (this.normalized = !0 === i),
          (this.usage = 35044),
          (this.needUpdate = !0),
          void 0 === r)
        ) {
          var o = this.array
          ;(this.type = t.FLOAT),
            o instanceof Int8Array
              ? (this.type = t.BYTE)
              : o instanceof Uint8Array
              ? (this.type = t.UNSIGNED_BYTE)
              : o instanceof Int16Array
              ? (this.type = t.SHORT)
              : o instanceof Uint16Array
              ? (this.type = t.UNSIGNED_SHORT)
              : o instanceof Int32Array
              ? (this.type = t.INT)
              : o instanceof Uint32Array && (this.type = t.UNSIGNED_INT)
        } else this.type = r
      }
      t.isBufferAttribute = function (e) {
        var n = !1
        return e && e instanceof t && (n = !0), n
      }
      var e = t.prototype
      return (
        (e.setUsage = function (t) {
          return (this.usage = t), this
        }),
        (e.setArray = function (t) {
          return this.array.set(t), this
        }),
        t
      )
    })()
  ;(cr.BYTE = 5120),
    (cr.UNSIGNED_BYTE = 5121),
    (cr.SHORT = 5122),
    (cr.UNSIGNED_SHORT = 5123),
    (cr.INT = 5124),
    (cr.UNSIGNED_INT = 5125),
    (cr.FLOAT = 5126)
  var lr = (function (t) {
      function e(e, n, r, i) {
        var o
        return (
          ((o = t.call(this, new Uint8Array(e), n, r, i) || this).name =
            'Uint8BufferAttribute'),
          o
        )
      }
      return c(e, t), e
    })(cr),
    fr = (function (t) {
      function e(e, n, r, i) {
        var o
        return (
          ((o = t.call(this, new Uint16Array(e), n, r, i) || this).name =
            'Uint16BufferAttribute'),
          o
        )
      }
      return c(e, t), e
    })(cr),
    dr = (function (t) {
      function e(e, n, r, i) {
        var o
        return (
          ((o = t.call(this, new Uint32Array(e), n, r, i) || this).name =
            'Uint32BufferAttribute'),
          o
        )
      }
      return c(e, t), e
    })(cr),
    pr = (function (t) {
      function e(e, n, r, i) {
        var o
        return (
          ((o = t.call(this, new Float32Array(e), n, r, i) || this).name =
            'Float32ArrayAttribute'),
          o
        )
      }
      return c(e, t), e
    })(cr),
    vr = (function (t) {
      function e(e, n, r, i) {
        var o
        if (Array.isArray(e)) {
          var a = (function (t) {
            for (
              var e,
                n = Number.MAX_VALUE,
                r = -Number.MAX_VALUE,
                i = t.length - 1;
              i >= 0;
              i--
            )
              n > (e = t[i]) && (n = e), r < e && (r = e)
            return { min: n, max: r }
          })(e)
          o = new (a.max > 65535 ? Uint32Array : Uint16Array)(e)
        } else o = e
        return t.call(this, o, n, r, i) || this
      }
      return c(e, t), e
    })(cr),
    mr = 0,
    gr = (function (t) {
      function e() {
        for (var e, n = arguments.length, r = new Array(n), i = 0; i < n; i++)
          r[i] = arguments[i]
        return (
          ((e = t.call.apply(t, [this].concat(r)) || this).id = mr++),
          (e.uuid = ar()),
          (e.name = ''),
          (e.type = 'BufferGeometry'),
          (e.indexes = null),
          (e.attributes = {}),
          (e.__webglInit = !1),
          (e.groupsNeedUpdate = !1),
          (e.boundingBox = null),
          e
        )
      }
      c(e, t)
      var n = e.prototype
      return (
        (n.getIndexes = function () {
          return this.indexes
        }),
        (n.getCenter = function () {
          return (
            this.computeBoundingBox(),
            this.boundingBox ? this.boundingBox.getCenter() : void 0
          )
        }),
        (n.setIndexes = function (t) {
          return (
            Array.isArray(t) || ArrayBuffer.isView(t)
              ? (this.indexes = new vr(t, 1))
              : vr.isBufferAttribute(t) && (this.indexes = t),
            this
          )
        }),
        (n.getAttribute = function (t) {
          return t ? this.attributes[t] : this.attributes
        }),
        (n.setAttribute = function (t, e) {
          return t && cr.isBufferAttribute(e) && (this.attributes[t] = e), this
        }),
        (n.deleteAttribute = function (t) {
          return this.attributes[t] && delete this.attributes[t], this
        }),
        (n.computeBoundingBox = function () {
          null === this.boundingBox && (this.boundingBox = new hr())
          var t = this.attributes.position
          t && t.isBufferAttribute && this.boundingBox.setFromBufferAttribute(t)
        }),
        e
      )
    })(rr),
    yr = new Jt(),
    _r = new Jt(),
    xr = new Jt(),
    br = (function (t) {
      function e(e, n) {
        var r
        return (
          ((r = t.call(this) || this).type = 'Mesh'),
          (r.geometry = void 0),
          (r.material = void 0),
          (r.materialChanged = void 0),
          (r.__webglInit = !1),
          (r.geometry = void 0 !== e ? e : new gr()),
          (r.material = void 0 !== n ? n : null),
          (r.materialChanged = !1),
          r
        )
      }
      c(e, t)
      var n = e.prototype
      return (
        (n.updateMaterial = function (t) {
          this.material &&
            t.isMaterial &&
            t.uuid !== this.material.uuid &&
            ((this.material = t), (this.materialChanged = !0))
        }),
        (n.raycast = function (t) {
          var e = this.geometry,
            n = e.indexes && e.indexes.array,
            r = e.attributes.position.array
          if (!n) return null
          for (var i = 0; i < n.length; i += 3) {
            var o = 3 * n[i],
              a = 3 * n[i + 1],
              s = 3 * n[i + 2],
              u = yr.set(r[o], r[o + 1], r[o + 2]).transform(this.worldMatrix),
              h = _r.set(r[a], r[a + 1], r[a + 2]).transform(this.worldMatrix),
              c = xr.set(r[s], r[s + 1], r[s + 2]).transform(this.worldMatrix),
              l = t.intersectTriangle(u, h, c)
            if (l) return { distance: l.distance, point: l.point, object: this }
          }
          return null
        }),
        e
      )
    })(ur),
    Mr = (function (t) {
      function e() {
        for (var e, n = arguments.length, r = new Array(n), i = 0; i < n; i++)
          r[i] = arguments[i]
        return (
          ((e = t.call.apply(t, [this].concat(r)) || this).type = 'Scene'),
          (e.isScene = !0),
          (e.autoUpdate = !0),
          e
        )
      }
      c(e, t)
      var n = e.prototype
      return (
        (n.updateWorldMatrix = function () {
          var e =
            arguments.length > 0 && void 0 !== arguments[0] && arguments[0]
          !0 === this.autoUpdate && t.prototype.updateWorldMatrix.call(this, e)
        }),
        (n.clone = function (n) {
          return (
            void 0 === n && (n = new e()),
            t.prototype.clone.call(this, n),
            (n.autoUpdate = this.autoUpdate),
            n
          )
        }),
        e
      )
    })(ur),
    Er = (function (t) {
      function e() {
        var e
        return (
          ((e = t.call(this) || this).type = 'Geometry'),
          (e.vertices = []),
          (e.verticesBufferData = new Float32Array()),
          (e.indicesBufferData = new Uint16Array()),
          (e.uvtsBufferData = new Float32Array()),
          (e.groupsNeedUpdate = !1),
          e
        )
      }
      return c(e, t), e
    })(rr),
    wr = new Jt(),
    Tr = new Jt(),
    Ar = new Jt(),
    Rr = new Jt(),
    Cr = new Jt(),
    Sr = (function () {
      function t(t, e) {
        ;(this.origin = void 0),
          (this.direction = void 0),
          (this.origin = t || new Jt()),
          (this.direction = e || new Jt(0, 0, -1))
      }
      var e = t.prototype
      return (
        (e.set = function (t, e) {
          return this.origin.copy(t), this.direction.copy(e), this
        }),
        (e.setFromCamera = function (t, e) {
          var n = new Jt(e.position[0], e.position[1], e.position[2]),
            r = new mn().fromArray(e.projectionMatrix),
            i = e.worldMatrix,
            o = new te(t[0], t[1], 0.5, 1).transform(r).transform(i),
            a = o.x,
            s = o.y,
            u = o.z,
            h = new Jt(a, s, u).sub(n).normalize()
          this.set(n, h)
        }),
        (e.getPointByLen = function (t, e) {
          var n = void 0 !== e ? e : new Jt()
          return n.copy(this.direction), n.scale(t), n.add(this.origin), n
        }),
        (e.intersectTriangle_Old = function (t, e, n) {
          var r,
            i = arguments.length > 3 && void 0 !== arguments[3] && arguments[3],
            o = arguments.length > 4 ? arguments[4] : void 0,
            a = wr.copy(e).subtract(t),
            s = Tr.copy(n).subtract(t),
            u = Ar.copy(a).cross(s),
            h = Rr.copy(this.origin).subtract(t),
            c = this.direction.dot(u)
          if (0 < c) {
            if (i) return null
            r = 1
          } else {
            if (!(0 > c)) return null
            ;(r = -1), (c = -c)
          }
          s.copy(new Jt().copy(h).cross(s))
          var l = r * this.direction.dot(s)
          if (0 > l) return null
          var f = r * this.direction.dot(new Jt().copy(h).cross(a))
          if (0 > f) return null
          if (l + f > c) return null
          var d = -r * h.dot(u)
          return 0 > d ? null : this.getPointByLen(d / c, o)
        }),
        (e.intersectTriangle = function (t, e, n) {
          var r = arguments.length > 4 ? arguments[4] : void 0,
            i = 1e-6,
            o = wr.subVectors(e, t),
            a = Tr.subVectors(n, t),
            s = Ar.copy(this.direction).cross(a),
            u = o.dot(s)
          if (u > -i && u < i) return null
          var h = 1 / u,
            c = Rr.subVectors(this.origin, t),
            l = h * c.dot(s)
          if (l < 0 || l > 1) return null
          var f = Cr.copy(c).cross(o),
            d = h * this.direction.dot(f)
          if (d < 0 || l + d > 1) return null
          var p = a.dot(f) * h
          return p > i ? { distance: p, point: this.getPointByLen(p, r) } : null
        }),
        (e.intersectSphere = function (t, e, n) {
          var r = new Jt().subtract(t, this.origin),
            i = r.dot(this.direction),
            o = r.dot(r) - i * i,
            a = e * e
          if (o > a) return null
          var s = Math.sqrt(a - o),
            u = i - s,
            h = i + s
          return 0 > u && 0 > h
            ? null
            : 0 > u
            ? this.getPointByLen(h, n)
            : this.getPointByLen(u, n)
        }),
        t
      )
    })()
  function Pr(t, e) {
    var n =
      ('undefined' != typeof Symbol && t[Symbol.iterator]) || t['@@iterator']
    if (!n) {
      if (
        Array.isArray(t) ||
        (n = (function (t, e) {
          if (!t) return
          if ('string' == typeof t) return Dr(t, e)
          var n = Object.prototype.toString.call(t).slice(8, -1)
          'Object' === n && t.constructor && (n = t.constructor.name)
          if ('Map' === n || 'Set' === n) return Array.from(t)
          if (
            'Arguments' === n ||
            /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)
          )
            return Dr(t, e)
        })(t)) ||
        (e && t && 'number' == typeof t.length)
      ) {
        n && (t = n)
        var r = 0,
          i = function () {}
        return {
          s: i,
          n: function () {
            return r >= t.length ? { done: !0 } : { done: !1, value: t[r++] }
          },
          e: function (t) {
            throw t
          },
          f: i,
        }
      }
      throw new TypeError(
        'Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.'
      )
    }
    var o,
      a = !0,
      s = !1
    return {
      s: function () {
        n = n.call(t)
      },
      n: function () {
        var t = n.next()
        return (a = t.done), t
      },
      e: function (t) {
        ;(s = !0), (o = t)
      },
      f: function () {
        try {
          a || null == n.return || n.return()
        } finally {
          if (s) throw o
        }
      },
    }
  }
  function Dr(t, e) {
    ;(null == e || e > t.length) && (e = t.length)
    for (var n = 0, r = new Array(e); n < e; n++) r[n] = t[n]
    return r
  }
  var Ir = (function () {
      function t(t, e, n, r) {
        ;(this.ray = void 0),
          (this.near = void 0),
          (this.far = void 0),
          (this.ray = new Sr(t, e)),
          (this.near = n || 0),
          (this.far = r || 1 / 0)
      }
      var e = t.prototype
      return (
        (e.set = function (t, e) {
          this.ray.set(t, e)
        }),
        (e.setFromCamera = function (t, e) {
          var n = new Jt(e.position[0], e.position[1], e.position[2]),
            r = new mn().fromArray(e.projectionMatrix).invert(),
            i = e.worldMatrix,
            o = new te(t[0], t[1], 0.5, 1).transform(r).transform(i),
            a = o.x,
            s = o.y,
            u = o.z,
            h = new Jt(a, s, u).sub(n).normalize()
          this.set(n, h)
        }),
        (e.pick = function (t) {
          var e,
            n = this.ray,
            r = [],
            i = Pr([].concat(t))
          try {
            for (i.s(); !(e = i.n()).done; ) {
              var o = e.value.raycast(n)
              o && r.push(o)
            }
          } catch (t) {
            i.e(t)
          } finally {
            i.f()
          }
          return (
            r.sort(function (t, e) {
              return t.distance - e.distance
            }),
            r
          )
        }),
        t
      )
    })(),
    Lr = (function (t) {
      function e(n) {
        var r
        return (
          ((r = t.call(this) || this).image = void 0),
          (r.flipY = !0),
          (r.premultiplyAlpha = !1),
          (r.needsUpdate = !0),
          (r.glTexture = null),
          (r.isTexture = !0),
          (r.gl = null),
          (r.__textureInit = !1),
          (r.clone = function (t) {
            return (
              void 0 === t && (t = new e()),
              (t.image = r.image),
              (t.flipY = r.flipY),
              t
            )
          }),
          (r.destory = function () {
            r.emit('destory', r.glTexture)
          }),
          (r.destoryTexture = function () {
            r.glTexture &&
              r.gl &&
              (r.off('destory', r.destoryTexture),
              r.gl.deleteTexture(r.glTexture))
          }),
          void 0 !== n && (r.image = n),
          r
        )
      }
      return (
        c(e, t),
        (e.prototype.init = function (t) {
          !0 !== this.__textureInit &&
            ((this.gl = t),
            (this.glTexture = t.createTexture()),
            this.on('destory', this.destoryTexture),
            (this.__textureInit = !0))
        }),
        e
      )
    })(rr),
    Or = (function (t) {
      function e(e) {
        var n
        return (
          ((n = t.call(this) || this).isCube = !0),
          (n.image = e || []),
          (n.flipY = !1),
          n
        )
      }
      return c(e, t), e
    })(Lr),
    Br = (function () {
      function t(t, e, n) {
        var r = this
        ;(this.gl = void 0),
          (this.maxTextureSize = void 0),
          (this.maxTextures = void 0),
          (this.usedTextureUnits = 0),
          (this.getTextureUnit = function () {
            var t = r.usedTextureUnits
            return (
              r.usedTextureUnits >= r.maxTextures
                ? (r.usedTextureUnits = 0)
                : (r.usedTextureUnits += 1),
              t
            )
          }),
          (this.resetUsedTextureUnits = function () {
            r.usedTextureUnits = 0
          }),
          (this.setTexture = function (t) {
            var e =
              arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0
            if (t instanceof Or) r.setCubeTexture(t, e)
            else {
              var n = r.gl
              n.activeTexture(n.TEXTURE0 + e),
                t.needsUpdate
                  ? (t.init(n), r.uploadTexture(n, t))
                  : n.bindTexture(n.TEXTURE_2D, t.glTexture)
            }
          }),
          (this.setTextureForRenderTarget = function (t) {
            var e = r.gl
            ;(t.glTexture = e.createTexture()),
              e.bindTexture(e.TEXTURE_2D, t.glTexture),
              e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL, t.flipY),
              e.pixelStorei(
                e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
                t.premultiplyAlpha
              ),
              r.setTextureParameter(e)
            var n = e.RGBA,
              i = e.RGBA,
              o = e.UNSIGNED_BYTE
            e.texImage2D(e.TEXTURE_2D, 0, n, t.width, t.height, 0, i, o, null)
          }),
          (this.uploadTexture = function (t, e) {
            e.init(t),
              t.bindTexture(t.TEXTURE_2D, e.glTexture),
              t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL, e.flipY),
              t.pixelStorei(
                t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
                e.premultiplyAlpha
              ),
              r.setTextureParameter(t),
              t.texImage2D(
                t.TEXTURE_2D,
                0,
                t.RGBA,
                t.RGBA,
                t.UNSIGNED_BYTE,
                e.image
              ),
              (e.needsUpdate = !1)
          }),
          (this.setTextureParameter = function (t) {
            t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_S, t.CLAMP_TO_EDGE),
              t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_T, t.CLAMP_TO_EDGE),
              t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MAG_FILTER, t.LINEAR),
              t.texParameteri(t.TEXTURE_2D, t.TEXTURE_MIN_FILTER, t.LINEAR)
          }),
          (this.gl = t),
          (this.maxTextureSize = n),
          (this.maxTextures = e)
      }
      return (
        (t.prototype.setCubeTexture = function (t) {
          var e =
              arguments.length > 1 && void 0 !== arguments[1]
                ? arguments[1]
                : 0,
            n = t.image
          if (6 !== n.length)
            throw new Error(
              '[setCubeTexture] CubeTexture need six images, but get\n                '.concat(
                n.length,
                '\n            '
              )
            )
          var r = this.gl
          if (t.needsUpdate) {
            t.init(r),
              r.activeTexture(r.TEXTURE0 + e),
              r.bindTexture(r.TEXTURE_CUBE_MAP, t.glTexture),
              r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL, t.flipY),
              r.texParameteri(
                r.TEXTURE_CUBE_MAP,
                r.TEXTURE_MAG_FILTER,
                r.LINEAR
              ),
              r.texParameteri(
                r.TEXTURE_CUBE_MAP,
                r.TEXTURE_MIN_FILTER,
                r.LINEAR
              ),
              r.texParameteri(
                r.TEXTURE_CUBE_MAP,
                r.TEXTURE_WRAP_S,
                r.CLAMP_TO_EDGE
              ),
              r.texParameteri(
                r.TEXTURE_CUBE_MAP,
                r.TEXTURE_WRAP_T,
                r.CLAMP_TO_EDGE
              )
            for (var i = 0; i < 6; i++) {
              var o = n[i]
              r.texImage2D(
                r.TEXTURE_CUBE_MAP_POSITIVE_X + i,
                0,
                r.RGBA,
                r.RGBA,
                r.UNSIGNED_BYTE,
                o
              )
            }
            t.needsUpdate = !1
          } else r.bindTexture(r.TEXTURE_CUBE_MAP, t.glTexture)
        }),
        t
      )
    })(),
    kr = n(function (t) {
      ;(t.exports = function (t, e) {
        ;(null == e || e > t.length) && (e = t.length)
        for (var n = 0, r = new Array(e); n < e; n++) r[n] = t[n]
        return r
      }),
        (t.exports.__esModule = !0),
        (t.exports.default = t.exports)
    })
  e(kr)
  var Ur = n(function (t) {
    ;(t.exports = function (t) {
      if (Array.isArray(t)) return kr(t)
    }),
      (t.exports.__esModule = !0),
      (t.exports.default = t.exports)
  })
  e(Ur)
  var Nr = n(function (t) {
    ;(t.exports = function (t) {
      if (
        ('undefined' != typeof Symbol && null != t[Symbol.iterator]) ||
        null != t['@@iterator']
      )
        return Array.from(t)
    }),
      (t.exports.__esModule = !0),
      (t.exports.default = t.exports)
  })
  e(Nr)
  var Fr = n(function (t) {
    ;(t.exports = function (t, e) {
      if (t) {
        if ('string' == typeof t) return kr(t, e)
        var n = Object.prototype.toString.call(t).slice(8, -1)
        return (
          'Object' === n && t.constructor && (n = t.constructor.name),
          'Map' === n || 'Set' === n
            ? Array.from(t)
            : 'Arguments' === n ||
              /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)
            ? kr(t, e)
            : void 0
        )
      }
    }),
      (t.exports.__esModule = !0),
      (t.exports.default = t.exports)
  })
  e(Fr)
  var jr = n(function (t) {
    ;(t.exports = function () {
      throw new TypeError(
        'Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.'
      )
    }),
      (t.exports.__esModule = !0),
      (t.exports.default = t.exports)
  })
  e(jr)
  var zr = e(
      n(function (t) {
        ;(t.exports = function (t) {
          return Ur(t) || Nr(t) || Fr(t) || jr()
        }),
          (t.exports.__esModule = !0),
          (t.exports.default = t.exports)
      })
    ),
    Vr = n(function (t) {
      ;(t.exports = function (t) {
        if (Array.isArray(t)) return t
      }),
        (t.exports.__esModule = !0),
        (t.exports.default = t.exports)
    })
  e(Vr)
  var Gr = n(function (t) {
    ;(t.exports = function (t, e) {
      var n =
        null == t
          ? null
          : ('undefined' != typeof Symbol && t[Symbol.iterator]) ||
            t['@@iterator']
      if (null != n) {
        var r,
          i,
          o = [],
          a = !0,
          s = !1
        try {
          for (
            n = n.call(t);
            !(a = (r = n.next()).done) &&
            (o.push(r.value), !e || o.length !== e);
            a = !0
          );
        } catch (t) {
          ;(s = !0), (i = t)
        } finally {
          try {
            a || null == n.return || n.return()
          } finally {
            if (s) throw i
          }
        }
        return o
      }
    }),
      (t.exports.__esModule = !0),
      (t.exports.default = t.exports)
  })
  e(Gr)
  var Hr = n(function (t) {
    ;(t.exports = function () {
      throw new TypeError(
        'Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.'
      )
    }),
      (t.exports.__esModule = !0),
      (t.exports.default = t.exports)
  })
  e(Hr)
  var Wr = e(
      n(function (t) {
        ;(t.exports = function (t, e) {
          return Vr(t) || Gr(t, e) || Fr(t, e) || Hr()
        }),
          (t.exports.__esModule = !0),
          (t.exports.default = t.exports)
      })
    ),
    Zr = function (t, e, n) {
      if (t && e && e.length)
        for (var r = e.length, i = 0; i < r; i++) {
          var o = void 0,
            a = void 0,
            s = void 0,
            u = e[i],
            h = Wr(u, 2),
            c = h[0],
            l = h[1],
            f = c.type,
            d = c.value
          switch (c.type) {
            case '1i':
            case '1f':
              t['uniform'.concat(f)](l, c.value)
              break
            case '2f':
            case '3f':
            case '4f':
              t['uniform'.concat(f)].apply(t, [l].concat(zr(d)))
              break
            case 't':
              if (!(o = c.value) || (!o.image && !o.glTexture)) break
              ;(a = n.getTextureUnit()), t.uniform1i(l, a), n.setTexture(o, a)
              break
            case 'tv':
              s = []
              for (var p = c.value, v = 0, m = p.length; v < m; v++)
                s[v] = n.getTextureUnit()
              t.uniform1iv(l, s)
              for (var g = 0, y = p.length; g < y; g++)
                (o = p[g]) &&
                  (o.image || o.glTexture) &&
                  ((a = s[g]), n.setTexture(o, a))
              break
            case 'mat4fv':
              t.uniformMatrix4fv(l, !1, c.value)
              break
            default:
              console.warn(
                '[UniformOperation] Unknown uniform type: '.concat(f)
              )
          }
        }
    }
  var qr =
      '\nvoid main() {\n    gl_Position = mvpMatrix * vec4(position, 1.0);\n}\n',
    Yr = '\nvoid main() {\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n',
    Xr = 0,
    Kr = (function (t) {
      function e() {
        for (var e, n = arguments.length, r = new Array(n), i = 0; i < n; i++)
          r[i] = arguments[i]
        return (
          ((e = t.call.apply(t, [this].concat(r)) || this).isMaterial = !0),
          (e.id = Xr++),
          (e.type = 'Material'),
          (e.name = ''),
          (e.uuid = ar()),
          (e.uniforms = {}),
          (e.vertexShader = qr),
          (e.fragmentShader = Yr),
          (e.program = null),
          (e.depthTest = !0),
          (e.visible = !0),
          (e.opacity = 1),
          (e.needsUpdate = !0),
          (e.uniformsList = []),
          e
        )
      }
      c(e, t)
      var n = e.prototype
      return (
        (n.setValues = function (t) {
          if (void 0 !== t)
            for (var e in t)
              if (Object.prototype.hasOwnProperty.call(t, e)) {
                var n = t[e]
                if (void 0 === n) {
                  console.warn("Material: '" + e + "' parameter is undefined.")
                  continue
                }
                if (void 0 === this[e]) {
                  console.warn(
                    ''
                      .concat(this.type, ': ')
                      .concat(e, ' is not a property of this material.')
                  )
                  continue
                }
                var r = 'set' + e.charAt(0).toUpperCase() + e.slice(1)
                'function' == typeof this[r] ? this[r](n) : (this[e] = n)
              }
        }),
        (n.clone = function () {
          return new e().copy(this)
        }),
        (n.copy = function (t) {
          return (
            (this.uniforms = (function (t) {
              var e,
                n = {}
              for (var r in t)
                if (Object.prototype.hasOwnProperty.call(t, r))
                  for (var i in ((n[r] = {}), t[r]))
                    Object.prototype.hasOwnProperty.call(t[r], i) &&
                      ((e = t[r][i]) && e.isTexture
                        ? (n[r][i] = e.clone())
                        : (n[r][i] = e instanceof Array ? e.slice(0) : e))
              return n
            })(t.uniforms)),
            (this.depthTest = t.depthTest),
            (this.visible = t.visible),
            (this.fragmentShader = t.fragmentShader),
            (this.vertexShader = t.vertexShader),
            this
          )
        }),
        o(e, [
          {
            key: 'defines',
            get: function () {
              return ''
            },
          },
        ]),
        e
      )
    })(rr),
    Qr = { useColor: 'USE_COLOR', useUV: 'NEED_UV' },
    Jr = (function () {
      function t() {
        ;(this.useColor = !1), (this.useUV = !1)
      }
      return (
        (t.prototype.getDefines = function () {
          for (var t = [], e = 0, n = Object.keys(this); e < n.length; e++) {
            var r = n[e]
            Qr[r] && !0 === this[r] && t.push('#define '.concat(Qr[r]))
          }
          return t.push(''), t.join('\n')
        }),
        t
      )
    })(),
    $r =
      '\n#ifdef NEED_UV\n    varying vec2 vUV;\n#endif\nvoid main(void) {\n    gl_Position = mvpMatrix * vec4(position, 1.0);\n    #ifdef NEED_UV\n        vUV = uv;\n    #endif\n}\n',
    ti =
      '\nprecision mediump float;\n#ifdef NEED_UV\n    varying vec2 vUV;\n    uniform sampler2D uSampler;\n#endif\n#ifdef USE_COLOR\n    uniform vec4 uColor;\n#endif\nuniform float uOpacity;\nvoid main(void) {\n    vec4 finalColor;\n    vec4 defaultColor = vec4(1.0, 0.0, 0.0, 1.0);\n    finalColor = defaultColor;\n    #ifdef USE_COLOR\n        finalColor = uColor;\n    #endif\n    #ifdef NEED_UV\n        finalColor = texture2D(uSampler, vUV);\n    #endif\n    gl_FragColor = vec4(finalColor.rgb, finalColor.a * uOpacity);\n}\n',
    ei = (function (t) {
      function e() {
        var e,
          n =
            arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}
        return (
          ((e = t.call(this) || this).map = null),
          (e.color = [1, 0, 0, 1]),
          (e.type = 'BasicMaterial'),
          (e.opacity = 1),
          (e.depthTest = !0),
          (e.vertexShader = $r),
          (e.fragmentShader = ti),
          (e.uniforms = {
            uSampler: { type: 't', value: null },
            uColor: { type: '4f', value: [1, 0, 0, 1] },
            uOpacity: { type: '1f', value: e.opacity },
          }),
          e.setValues(n),
          e
        )
      }
      c(e, t)
      var n = e.prototype
      return (
        (n.setOpacity = function (t) {
          ;(this.uniforms.uOpacity.value = t), (this.opacity = t)
        }),
        (n.setColor = function (t) {
          !Array.isArray(t) ||
            t.length < 4 ||
            ((this.uniforms.uColor.value = t), (this.color = t))
        }),
        (n.setMap = function (t) {
          var e = this
          t &&
            (t instanceof Promise
              ? t
                  .then(function (t) {
                    e.uniforms.uSampler.value =
                      t instanceof Lr == !0 ? t : new Lr(t)
                  })
                  .catch(function (t) {
                    return console.error(t)
                  })
              : !0 === t.isTexture && (this.uniforms.uSampler.value = t),
            (this.map = t))
        }),
        o(e, [
          {
            key: 'defines',
            get: function () {
              var t = new Jr()
              return (
                (t.useColor = !!this.color),
                (t.useUV = !!this.map),
                t.getDefines()
              )
            },
          },
        ]),
        e
      )
    })(Kr),
    ni = function (t) {
      var e = this
      ;(this.gl = void 0),
        (this.newAttributes = new Uint8Array(16)),
        (this.enabledAttributes = new Uint8Array(16)),
        (this.currentDepthTest = !1),
        (this.currentDepthWrite = !0),
        (this.currentColorWrite = !0),
        (this.currentDoubleSided = !1),
        (this.currentFlipSided = !1),
        (this.initAttributes = function () {
          for (var t = 0, n = e.newAttributes.length; t < n; t++)
            e.newAttributes[t] = 0
        }),
        (this.enableAttribute = function (t) {
          var n = e.gl,
            r = e.newAttributes,
            i = e.enabledAttributes
          ;(r[t] = 1), 0 === i[t] && (n.enableVertexAttribArray(t), (i[t] = 1))
        }),
        (this.disableAttribute = function (t) {
          var n = e.gl,
            r = e.newAttributes,
            i = e.enabledAttributes
          ;(r[t] = 0), 1 === i[t] && (n.disableVertexAttribArray(t), (i[t] = 0))
        }),
        (this.disableUnusedAttributes = function () {
          for (
            var t = e.gl,
              n = e.newAttributes,
              r = e.enabledAttributes,
              i = 0,
              o = r.length;
            i < o;
            i++
          )
            r[i] !== n[i] && (t.disableVertexAttribArray(i), (r[i] = 0))
        }),
        (this.setDepthTest = function (t) {
          var n = e.gl
          e.currentDepthTest !== t &&
            (t ? n.enable(n.DEPTH_TEST) : n.disable(n.DEPTH_TEST),
            (e.currentDepthTest = t))
        }),
        (this.setDepthWrite = function (t) {
          var n = e.gl
          e.currentDepthWrite !== t &&
            (n.depthMask(t), (e.currentDepthWrite = t))
        }),
        (this.setColorWrite = function (t) {
          var n = e.gl
          e.currentColorWrite !== t &&
            (n.colorMask(t, t, t, t), (e.currentColorWrite = t))
        }),
        (this.setDefaultGLState = function (t, n, r, i) {
          var o = e.gl
          o.clearColor(229 / 255, 227 / 255, 223 / 255, 1),
            o.clear(o.COLOR_BUFFER_BIT | o.DEPTH_BUFFER_BIT),
            o.clearDepth(1),
            o.clearStencil(0),
            o.disable(o.DEPTH_TEST),
            o.depthFunc(o.LEQUAL),
            o.frontFace(o.CCW),
            o.disable(o.CULL_FACE),
            o.depthMask(!0),
            o.enable(o.BLEND),
            o.blendFunc(o.SRC_ALPHA, o.ONE_MINUS_SRC_ALPHA),
            o.viewport(t, n, r, i)
        }),
        (this.setDoubleSided = function (t) {
          var n = e.gl
          e.currentDoubleSided !== t &&
            (t ? n.disable(n.CULL_FACE) : n.enable(n.CULL_FACE),
            (e.currentDoubleSided = t))
        }),
        (this.setFlipSided = function (t) {
          var n = e.gl
          e.currentFlipSided !== t &&
            (t ? n.frontFace(n.CW) : n.frontFace(n.CCW),
            (e.currentFlipSided = t))
        }),
        (this.reset = function () {
          for (var t = e.enabledAttributes, n = 0; n < t.length; n++) t[n] = 0
          ;(e.currentDepthTest = !1),
            (e.currentDepthWrite = !0),
            (e.currentColorWrite = !0),
            (e.currentDoubleSided = !1),
            (e.currentFlipSided = !1)
        }),
        (this.gl = t)
    },
    ri = function (t) {
      var e = this
      ;(this.maxTextures = void 0),
        (this.maxTextureSize = void 0),
        (this.maxVerticesOneDraw = void 0),
        (this.maxVertexShaderTextureUnits = void 0),
        (this.maxFragmentShaderTextureUnits = void 0),
        (this.gl = void 0),
        (this.getMaxTextures = function () {
          var t = e.gl
          return t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS)
        }),
        (this.getLineWidthRange = function () {
          var t = e.gl
          return t.getParameter(t.ALIASED_LINE_WIDTH_RANGE)
        }),
        (this.getMaxVertexShaderTextureUnits = function () {
          var t = e.gl
          return t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)
        }),
        (this.getMaxFragmentShaderTextureUnits = function () {
          var t = e.gl
          return t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)
        }),
        (this.getMaxTextureSize = function () {
          var t = e.gl
          return t.getParameter(t.MAX_TEXTURE_SIZE)
        }),
        (this.getMaxVerticesOneDraw = function () {
          return e.gl.getExtension('OES_element_index_uint')
            ? 4294967296
            : 65535
        }),
        (this.getLegalPrecision = function (t) {
          var n = e.gl,
            r = n.getShaderPrecisionFormat(n.VERTEX_SHADER, n.HIGH_FLOAT),
            i = n.getShaderPrecisionFormat(n.VERTEX_SHADER, n.MEDIUM_FLOAT),
            o = n.getShaderPrecisionFormat(n.FRAGMENT_SHADER, n.HIGH_FLOAT),
            a = n.getShaderPrecisionFormat(n.FRAGMENT_SHADER, n.MEDIUM_FLOAT),
            s = r && o && r.precision > 0 && o.precision > 0,
            u = i && a && i.precision > 0 && a.precision > 0
          return (
            'highp' !== t || s
              ? 'mediump' !== t ||
                u ||
                ((t = 'lowp'),
                console.warn(
                  '[WebGLCapability] mediump is not supported, using lowp by default.'
                ))
              : u
              ? ((t = 'mediump'),
                console.warn(
                  '[WebGLCapability] highp is not supported, using mediump by default.'
                ))
              : ((t = 'lowp'),
                console.warn(
                  '[WebGLCapability] highp and mediump is not supported, using lowp by default.'
                )),
            t
          )
        }),
        (this.gl = t),
        (this.maxTextures = this.getMaxTextures()),
        (this.maxVertexShaderTextureUnits =
          this.getMaxVertexShaderTextureUnits()),
        (this.maxFragmentShaderTextureUnits =
          this.getMaxFragmentShaderTextureUnits()),
        (this.maxTextureSize = this.getMaxTextureSize()),
        (this.maxVerticesOneDraw = this.getMaxVerticesOneDraw())
    },
    ii = 0,
    oi = function (t, e, n) {
      var r = t.createShader(n)
      if (!r) throw new Error('Something went wrong while compile the shader.')
      return (
        t.shaderSource(r, e),
        t.compileShader(r),
        t.getShaderParameter(r, t.COMPILE_STATUS) ||
          console.error(
            'Error compiling shader: '.concat(t.getShaderInfoLog(r))
          ),
        r
      )
    },
    ai = (function () {
      function t(t, e, n) {
        ;(this.usedTimes = void 0),
          (this.id = void 0),
          (this.code = void 0),
          (this.program = void 0),
          (this.attributes = void 0),
          (this.uniforms = void 0),
          (this.gl = void 0),
          (this.parameters = void 0),
          (this.precision = void 0),
          (this.gl = t),
          (this.parameters = e),
          (this.precision = n.precision || 'highp'),
          (this.usedTimes = 1),
          (this.id = ii++)
        var r = e.defines,
          i = void 0 === r ? '' : r,
          o = e.vertexShader,
          a = e.fragmentShader
        ;(this.code = i + o + a),
          (this.program = this.createProgram(t, e, this.precision)),
          (this.attributes = this.fetchAttributes(t, this.program)),
          (this.uniforms = (function (t, e) {
            var n,
              r =
                arguments.length > 2 && void 0 !== arguments[2]
                  ? arguments[2]
                  : [],
              i = {},
              o = r.length
            if (!o) return i
            for (var a = 0; a < o; a++)
              i[(n = r[a])] = t.getUniformLocation(e, n)
            return i
          })(t, this.program, this.getFullUniforms(e.uniforms)))
      }
      var e = t.prototype
      return (
        (e.getAttributes = function () {
          return this.attributes
        }),
        (e.getUniforms = function () {
          return this.uniforms
        }),
        (e.createProgram = function (t, e) {
          var n =
              arguments.length > 2 && void 0 !== arguments[2]
                ? arguments[2]
                : 'highp',
            r = e.vertexShader,
            i = e.fragmentShader,
            o = e.defines,
            a = void 0 === o ? '' : o,
            s = [
              'precision '.concat(n, ' float;'),
              'uniform mat4 modelMatrix;',
              'uniform mat4 projectionMatrix;',
              'uniform mat4 viewMatrix;',
              'uniform mat4 mvpMatrix;',
              'attribute vec3 position;',
              'attribute vec2 uv;',
              '',
            ].join('\n'),
            u = t.createProgram(),
            h = ['precision '.concat(n, ' float;'), ''].join('\n'),
            c = oi(t, s + a + r, t.VERTEX_SHADER),
            l = oi(t, h + a + i, t.FRAGMENT_SHADER)
          if (!u) throw new Error('Something went wrong while createProgram.')
          return t.attachShader(u, c), t.attachShader(u, l), t.linkProgram(u), u
        }),
        (e.fetchAttributes = function (t, e) {
          for (
            var n = {},
              r = t.getProgramParameter(e, t.ACTIVE_ATTRIBUTES),
              i = 0;
            i < r;
            i++
          ) {
            var o = t.getActiveAttrib(e, i)
            if (!o)
              throw new Error('Something went wrong while getActiveAttrib.')
            var a = o.name
            n[a] = t.getAttribLocation(e, a)
          }
          return n
        }),
        (e.getFullUniforms = function (t) {
          var e = ['mvpMatrix', 'modelMatrix', 'projectionMatrix', 'viewMatrix']
          for (var n in t)
            Object.prototype.hasOwnProperty.call(t, n) && e.push(n)
          return e
        }),
        t
      )
    })(),
    si = {
      canvas: document.createElement('canvas'),
      context: void 0,
      width: 0,
      height: 0,
      pixelRatio: 1,
      precision: 'highp',
      alpha: !1,
      premultipliedAlpha: !0,
      antialias: !0,
      stencil: !0,
      depth: !0,
      preserveDrawingBuffer: !1,
    },
    ui = (function () {
      function t() {
        var t = this,
          e =
            arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}
        ;(this.state = void 0),
          (this.domElement = void 0),
          (this.capability = void 0),
          (this.textureOperation = void 0),
          (this._gl = void 0),
          (this.parameters = void 0),
          (this.programs = void 0),
          (this.viewportInfo = void 0),
          (this.autoDisposeProgram = !0),
          (this.currentCacheState = void 0),
          (this.setSize = function (e, n) {
            var r = t.parameters,
              i = r.canvas,
              o = r.pixelRatio
            ;(i.style.width = ''.concat(e, 'px')),
              (i.style.height = ''.concat(n, 'px')),
              (i.width = e * o),
              (i.height = n * o),
              t.setViewport(0, 0, e, n)
          }),
          (this.setViewport = function (e, n, r, i) {
            var o = t.parameters.pixelRatio,
              a = t.viewportInfo
            ;(a.x = e * o),
              (a.y = n * o),
              (a.width = r * o),
              (a.height = i * o),
              t._gl.viewport.apply(t._gl, Object.values(a))
          }),
          (this.setClearColor = function (e, n, r) {
            var i =
              arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 1
            !0 === t.parameters.premultipliedAlpha &&
              ((e *= i), (n *= i), (r *= i)),
              t._gl.clearColor(e, n, r, i)
          }),
          (this.getContext = function () {
            return t._gl
          }),
          (this.forceContextLoss = function () {
            try {
              var e = t._gl.getExtension('WEBGL_lose_context')
              e && e.loseContext()
            } catch (t) {
              console.error('[WebGLRenderer] WEBGL_lose_context error: ', t)
            }
          }),
          (this.initScene = function (e) {
            !0 === e.visible &&
              e.traverse(function (e) {
                !0 === e.visible && e instanceof br && t.initMesh(e)
              })
          }),
          (this.initMesh = function (e) {
            !0 === e.visible &&
              (!0 !== e.__webglInit &&
                ((e.__webglInit = !0),
                e.addEventListener('removed', t.onObjectRemoved)),
              e.geometry && t.checkAndUpdateGeometry(e.geometry),
              e.children &&
                e.children.length > 0 &&
                e.children.forEach(function (e) {
                  t.initMesh(e)
                }))
          }),
          (this.checkAndUpdateGeometry = function (e) {
            !0 !== e.__webglInit &&
              ((e.__webglInit = !0),
              e.addEventListener('removed', t.onGeometryRemove),
              (e.groupsNeedUpdate = !0)),
              !0 === e.groupsNeedUpdate &&
                ('BufferGeometry' === e.type
                  ? t.updateBufferGeometry(e)
                  : t.updateGeometryBuffer(e, t._gl.STATIC_DRAW),
                (e.groupsNeedUpdate = !1))
          }),
          (this.updateGeometryBuffer = function (e, n) {
            var r = e.verticesBufferData,
              i = e.uvtsBufferData,
              o = e.indicesBufferData,
              a = e.borderVerticesBufferData,
              s = t._gl
            0 < r.length &&
              ((e.glVerticesBuffer = s.createBuffer()),
              s.bindBuffer(s.ARRAY_BUFFER, e.glVerticesBuffer),
              s.bufferData(s.ARRAY_BUFFER, r, n)),
              0 < i.length &&
                ((e.glUvtsBuffer = s.createBuffer()),
                s.bindBuffer(s.ARRAY_BUFFER, e.glUvtsBuffer),
                s.bufferData(s.ARRAY_BUFFER, i, n)),
              0 < o.length &&
                ((e.glIndicesBuffer = s.createBuffer()),
                s.bindBuffer(s.ELEMENT_ARRAY_BUFFER, e.glIndicesBuffer),
                s.bufferData(s.ELEMENT_ARRAY_BUFFER, o, n)),
              !0 === e.showBorder &&
                void 0 !== a &&
                0 < a.length &&
                ((e.glBorderVerticesBuffer = s.createBuffer()),
                s.bindBuffer(s.ARRAY_BUFFER, e.glBorderVerticesBuffer),
                s.bufferData(s.ARRAY_BUFFER, e.borderVerticesBufferData, n))
          }),
          (this.renderScene = function (e, n) {
            !0 === e.visible &&
              e.traverse(function (e) {
                e instanceof br &&
                  (t.renderObject(e, n),
                  e.children.length &&
                    e.children.forEach(function (e) {
                      t.renderObject(e, n)
                    }))
              })
          }),
          (this.renderObject = function (e, n) {
            var r = e.material,
              i = e.geometry
            if (!0 === e.visible && r && i && !0 === r.visible) {
              t.state.setDepthTest(r.depthTest)
              var o = !1,
                a = t.setProgram(n, r, e)
              ;(o =
                'BufferGeometry' === i.type
                  ? t.updateVerticesAttribute2(a, i, !1)
                  : t.updateVerticesAttribute(a, i, !1)),
                t.renderGeometryWithProgram(a, i, r, o)
            }
          }),
          (this.setProgram = function (e, n, r) {
            var i =
                !(arguments.length > 3 && void 0 !== arguments[3]) ||
                arguments[3],
              o = t._gl
            t.textureOperation.resetUsedTextureUnits(),
              t.checkAndUpdateMaterial(r.material)
            var a = n.program,
              s = a.getUniforms()
            return (
              a.id !== t.currentCacheState.programId &&
                (o.useProgram(a.program),
                (t.currentCacheState.programId = a.id)),
              !1 !== i && Zr(o, n.uniformsList, t.textureOperation),
              t.updateMVPMatrix(s, e, r),
              a
            )
          }),
          (this.checkAndUpdateMaterial = function (e) {
            void 0 !== e &&
              (!0 !== e.__webglInit &&
                ((e.__webglInit = !0),
                e.addEventListener('removed', t.onMaterialRomove),
                (e.needsUpdate = !0)),
              !0 === e.needsUpdate &&
                (t.updateMaterial(e), (e.needsUpdate = !1)))
          }),
          (this.updateMaterial = function (e) {
            e.program && t.removeMaterial(e)
            for (
              var n = null,
                r = t.programs.length,
                i = e.defines,
                o = (void 0 === i ? '' : i) + e.vertexShader + e.fragmentShader,
                a = r - 1;
              a >= 0;
              a--
            ) {
              var s = t.programs[a]
              if (s.code === o) {
                ;(n = s).usedTimes++
                break
              }
            }
            if (null === n) {
              var u = {
                uniforms: e.uniforms,
                defines: e.defines || '',
                vertexShader: e.vertexShader,
                fragmentShader: e.fragmentShader,
              }
              ;(n = new ai(t._gl, u, { precision: t.parameters.precision })),
                t.programs.push(n)
            }
            ;(e.program = n), (e.uniformsList = [])
            var h = 0,
              c = n.uniforms,
              l = e.uniforms
            for (var f in l)
              if (Object.prototype.hasOwnProperty.call(l, f)) {
                var d = c[f]
                d && ((e.uniformsList[h] = [l[f], d]), h++)
              }
          }),
          (this.updateMVPMatrix = function (e, n, r) {
            if (void 0 !== e.mvpMatrix) {
              var i = he(n.projectionMatrix)
              ve(i, i, n.viewMatrix),
                ve(i, i, r.worldMatrix),
                t._gl.uniformMatrix4fv(e.mvpMatrix, !1, i),
                t._gl.uniformMatrix4fv(e.modelMatrix, !1, r.worldMatrix),
                t._gl.uniformMatrix4fv(e.viewMatrix, !1, n.viewMatrix),
                t._gl.uniformMatrix4fv(
                  e.projectionMatrix,
                  !1,
                  n.projectionMatrix
                )
            }
            t.currentCacheState.camera = n
          }),
          (this.renderGeometryWithProgram = function (e, n, r) {
            var i = t._gl,
              o = t.currentCacheState.curRenderTarget
            if (
              (e.uniforms.showDebugLine &&
                i.uniform1i(e.uniforms.showDebugLine, 0),
              'BufferGeometry' === n.type
                ? i.bindBuffer(i.ELEMENT_ARRAY_BUFFER, n.indexesBuffer)
                : i.bindBuffer(i.ELEMENT_ARRAY_BUFFER, n.glIndicesBuffer),
              null !== o && void 0 !== o.glFrameBuffer)
            ) {
              var a = i.checkFramebufferStatus(i.FRAMEBUFFER)
              if (i.FRAMEBUFFER_COMPLETE !== a)
                return (
                  t.removeRenderTarget(o),
                  void (t.currentCacheState.curRenderTarget = null)
                )
            }
            n.indexes && n.indexes.count > 0
              ? i.drawElements(
                  i.TRIANGLES,
                  n.indexes.count,
                  i.UNSIGNED_SHORT,
                  0
                )
              : i.drawArrays(i.TRIANGLES, 0, n.attributes.position.count)
          }),
          (this.onObjectRemoved = function (e) {
            e.target.traverse(function (e) {
              e.removeEventListener('removed', t.onObjectRemoved),
                t.removeObject(e)
            })
          }),
          (this.onGeometryRemove = function (e) {
            var n = e.target
            n.removeEventListener('removed', t.onGeometryRemove),
              t.removeGeometry(n)
          }),
          (this.onMaterialRomove = function (e) {
            var n = e.target
            n.removeEventListener('removed', t.onMaterialRomove),
              t.removeMaterial(n)
          }),
          (this.onRenderTargetRemove = function (e) {
            var n = e.target
            n.removeEventListener('removed', t.onRenderTargetRemove),
              t.removeRenderTarget(n)
          }),
          (this.removeObject = function (t) {
            t.geometry && delete t.geometry.__webglInit, delete t.__webglInit
          }),
          (this.removeGeometry = function (e) {
            delete e.__webglInit,
              t.deleteBuffers(e),
              (t.currentCacheState.geometryProgramId = null)
          }),
          (this.deleteBuffers = function (e) {
            ;[
              'glVerticesBuffer',
              'glUvtsBuffer',
              'glIndicesBuffer',
              'glBorderVerticesBuffer',
            ].forEach(function (n) {
              t._gl.deleteBuffer(e[n]),
                void 0 !== e[n] && 0 < e[n] && delete e[n]
            })
          }),
          (this.removeMaterial = function (e) {
            var n = e.program.program
            if (n) {
              e.program = null
              for (var r = t.programs, i = r.length - 1; i >= 0; i--) {
                var o = r[i]
                if (o.program === n) {
                  o.usedTimes--,
                    0 === o.usedTimes &&
                      !1 !== t.autoDisposeProgram &&
                      (r.splice(i, 1), t._gl.deleteProgram(n))
                  break
                }
              }
            }
          }),
          (this.removeRenderTarget = function (e) {
            t._gl.deleteRenderbuffer(e.glDepthBuffer),
              (e.glDepthBuffer = null),
              t._gl.deleteTexture(e.glTexture),
              (e.glTexture = null),
              t._gl.deleteFramebuffer(e.glFrameBuffer),
              (e.glFrameBuffer = null)
          }),
          (this.parameters = Object.assign({}, si, e)),
          e &&
            !e.canvas &&
            (this.parameters.canvas = document.createElement('canvas')),
          this.initGL(),
          (this.programs = []),
          (this.viewportInfo = {
            x: 0,
            y: 0,
            width: this.parameters.canvas.width,
            height: this.parameters.canvas.height,
          }),
          this.parameters.width &&
            this.parameters.height &&
            this.setSize(this.parameters.width, this.parameters.height),
          (this.domElement = this.parameters.canvas),
          (this.state = new ni(this._gl)),
          this.state.setDefaultGLState.apply(
            this.state,
            Object.values(this.viewportInfo)
          ),
          (this.currentCacheState = {
            programId: null,
            geometryProgramId: null,
            materialId: null,
            camera: null,
            curRenderTarget: null,
          }),
          (this.capability = new ri(this._gl))
        var n = this.capability.maxTextures,
          r = this.capability.maxTextureSize
        this.textureOperation = new Br(this._gl, n, r)
      }
      var e = t.prototype
      return (
        (e.clearBuffer = function () {
          var t = this._gl
          t.clear(t.COLOR_BUFFER_BIT | t.DEPTH_BUFFER_BIT)
        }),
        (e.initGL = function () {
          var t = this,
            e = this.parameters,
            n = e.canvas,
            r = e.context,
            i = e.alpha,
            o = e.depth,
            a = e.stencil,
            s = e.antialias,
            u = e.premultipliedAlpha,
            h = e.preserveDrawingBuffer
          try {
            var c = {
                alpha: i,
                depth: o,
                stencil: a,
                antialias: s,
                premultipliedAlpha: u,
                preserveDrawingBuffer: h,
              },
              l =
                r ||
                n.getContext('webgl', c) ||
                n.getContext('experimental-webgl', c) ||
                n.getContext('moz-webgl', c) ||
                n.getContext('webkit-3d', c)
            if (!l)
              throw null !== n.getContext
                ? 'Error creating WebGL context with your provided attributes.'
                : 'Error creating WebGL context.'
            ;(this._gl = l),
              n.addEventListener(
                'webglcontextlost',
                function (e) {
                  e.preventDefault(),
                    void 0 !== t.state &&
                      (t.resetGLState(),
                      t.state.setDefaultGLState.apply(
                        t.state,
                        Object.values(t.viewportInfo)
                      ))
                },
                !1
              )
          } catch (t) {
            console.error('[WebGLRenderer] Create webgl error: ', t)
          }
        }),
        (e.resetGLState = function () {
          ;(this.currentCacheState = {
            programId: null,
            geometryProgramId: null,
            materialId: null,
            camera: null,
            curRenderTarget: null,
          }),
            this.state.reset()
        }),
        (e.setRenderTarget = function (t) {
          var e = this._gl
          void 0 !== t &&
            null === t.glFrameBuffer &&
            (t.addEventListener('removed', this.onRenderTargetRemove),
            (t.glFrameBuffer = e.createFramebuffer()),
            e.bindFramebuffer(e.FRAMEBUFFER, t.glFrameBuffer),
            this.textureOperation.setTextureForRenderTarget(t),
            (t.glDepthBuffer = e.createRenderbuffer()),
            e.bindRenderbuffer(e.RENDERBUFFER, t.glDepthBuffer),
            e.renderbufferStorage(
              e.RENDERBUFFER,
              e.DEPTH_COMPONENT16,
              t.width,
              t.height
            ),
            e.framebufferTexture2D(
              e.FRAMEBUFFER,
              e.COLOR_ATTACHMENT0,
              e.TEXTURE_2D,
              t.glTexture,
              0
            ),
            e.framebufferRenderbuffer(
              e.FRAMEBUFFER,
              e.DEPTH_ATTACHMENT,
              e.RENDERBUFFER,
              t.glDepthBuffer
            ),
            e.bindTexture(e.TEXTURE_2D, null),
            e.bindRenderbuffer(e.RENDERBUFFER, null),
            e.bindFramebuffer(e.FRAMEBUFFER, null))
        }),
        (e.render = function (t, e, n) {
          if (e.isCamera) {
            var r = this._gl
            if (
              (t.updateWorldMatrix(),
              e.updateWorldMatrix(),
              e.updateProjectionMatrix(),
              (this.currentCacheState.camera = null),
              void 0 !== n)
            )
              this.setRenderTarget(n),
                (this.currentCacheState.curRenderTarget = n),
                r.bindFramebuffer(r.FRAMEBUFFER, n.glFrameBuffer),
                r.viewport(0, 0, n.width, n.height)
            else {
              var i = this.viewportInfo,
                o = i.width,
                a = i.height
              ;(this.currentCacheState.curRenderTarget = null),
                r.bindFramebuffer(r.FRAMEBUFFER, null),
                r.viewport(0, 0, o, a)
            }
            this.initScene(t), this.renderScene(t, e)
          } else console.error('[WebGLRenderer]  Camera is not leagal.')
        }),
        (e.updateBufferGeometry = function (t) {
          var e = this._gl,
            n = t.getIndexes(),
            r = t.getAttribute()
          for (var i in r)
            if (Object.prototype.hasOwnProperty.call(r, i)) {
              var o = i + 'Buffer',
                a = r[i],
                s = a.array,
                u = a.usage
              ;(t[o] = e.createBuffer()),
                e.bindBuffer(e.ARRAY_BUFFER, t[o]),
                e.bufferData(e.ARRAY_BUFFER, s, u)
            }
          n &&
            ((t.indexesBuffer = e.createBuffer()),
            e.bindBuffer(e.ELEMENT_ARRAY_BUFFER, t.indexesBuffer),
            e.bufferData(e.ELEMENT_ARRAY_BUFFER, n.array, n.usage))
        }),
        (e.updateVerticesAttribute2 = function (t, e) {
          var n =
              !(arguments.length > 2 && void 0 !== arguments[2]) ||
              arguments[2],
            r = this._gl,
            i = !1,
            o = ''.concat(e.id, '_').concat(t.id)
          if (o !== this.currentCacheState.geometryProgramId) {
            ;(this.currentCacheState.geometryProgramId = o),
              this.state.initAttributes(),
              (i = !0)
            var a = e.getAttribute()
            for (var s in a)
              if (Object.prototype.hasOwnProperty.call(a, s)) {
                var u = s + 'Buffer',
                  h = a[s],
                  c = h.itemSize,
                  l = h.type,
                  f = h.normalized
                0 <= t.attributes[s] &&
                  (!0 !== n &&
                    (r.bindBuffer(r.ARRAY_BUFFER, e[u]),
                    r.vertexAttribPointer(t.attributes[s], c, l, f, 0, 0)),
                  this.state.enableAttribute(t.attributes[s]))
              }
          }
          return this.state.disableUnusedAttributes(), i
        }),
        (e.updateVerticesAttribute = function (t, e) {
          var n =
              !(arguments.length > 2 && void 0 !== arguments[2]) ||
              arguments[2],
            r = this._gl,
            i = !1,
            o = ''.concat(e.id, '_').concat(t.id)
          if (o !== this.currentCacheState.geometryProgramId) {
            ;(this.currentCacheState.geometryProgramId = o),
              this.state.initAttributes(),
              (i = !0)
            var a = t.getAttributes()
            0 <= a.position &&
              (!0 !== n &&
                (r.bindBuffer(r.ARRAY_BUFFER, e.glVerticesBuffer),
                r.vertexAttribPointer(a.position, 3, r.FLOAT, !1, 0, 0)),
              this.state.enableAttribute(a.position)),
              0 <= a.uv &&
                void 0 !== e.glUvtsBuffer &&
                (r.bindBuffer(r.ARRAY_BUFFER, e.glUvtsBuffer),
                r.vertexAttribPointer(a.uv, 2, r.FLOAT, !1, 0, 0),
                this.state.enableAttribute(a.uv))
          }
          return this.state.disableUnusedAttributes(), i
        }),
        t
      )
    })(),
    hi = (function (t) {
      function e(e, n, r, i, o, a) {
        var s
        switch (
          (((s = t.call(this) || this).addIntoBuffer = function (t, e, n) {
            ;(t[n] = e[0]), (t[n + 1] = e[1]), (t[n + 2] = e[2])
          }),
          (s.get3DVertex = function (t, e) {
            var n
            switch (e) {
              case 'x':
                n = xt(0, t[0], t[1])
                break
              case 'y':
                n = xt(t[0], 0, t[1])
                break
              default:
                n = xt(t[0], t[1], 0)
            }
            return n
          }),
          (s.zeroAxis = void 0 !== o ? o : 'z'),
          s.zeroAxis)
        ) {
          case 'x':
            s.normal = xt(-1, 0, 0)
            break
          case 'y':
          default:
            s.normal = xt(0, -1, 0)
            break
          case 'z':
            s.normal = xt(0, 0, -1)
        }
        ;(a = void 0 !== a ? a : {}),
          (s.showBorder = !(!1 === a.showBorder)),
          (s.borderWidth = void 0 !== a.borderWidth ? a.borderWidth : 1),
          (s.borderColor =
            void 0 !== a.borderColor ? a.borderColor : [0, 0, 0, 1])
        var u,
          h,
          c,
          l = 0.5 * e,
          f = 0.5 * n,
          d = r || 1,
          p = i || 1,
          v = e / d,
          m = n / p,
          g = (d + 1) * (p + 1)
        ;(s.verticesBufferData = new Float32Array(3 * g)),
          (s.uvtsBufferData = new Float32Array(2 * g)),
          (s.indicesBufferData = new (g > 65535 ? Uint32Array : Uint16Array)(
            d * p * 6
          ))
        for (var y = 0, _ = 0, x = 0; x <= p; x++) {
          u = x * m - f
          for (var b = 0; b <= d; b++)
            (c = Q(b * v - l, u)),
              (h = s.get3DVertex(c, s.zeroAxis)),
              s.vertices.push(h),
              s.addIntoBuffer(s.verticesBufferData, h, y),
              (s.uvtsBufferData[_] = b / d),
              (s.uvtsBufferData[_ + 1] = 1 - x / p),
              (y += 3),
              (_ += 2)
        }
        for (var M, E, w, T, A = 0, R = 0; R < p; R++)
          for (var C = 0; C < d; C++)
            (M = C + (d + 1) * R),
              (E = C + (d + 1) * (R + 1)),
              (w = C + 1 + (d + 1) * (R + 1)),
              (T = C + 1 + (d + 1) * R),
              s.addIntoBuffer(s.indicesBufferData, [M, E, w], A),
              s.addIntoBuffer(s.indicesBufferData, [M, w, T], A + 3),
              (A += 6)
        ;(s.borderIndicesBufferData = new Uint16Array(4)),
          (s.borderIndicesBufferData[0] = 0),
          (s.borderIndicesBufferData[1] = d),
          (s.borderIndicesBufferData[2] = (d + 1) * p),
          (s.borderIndicesBufferData[3] = (d + 1) * (p + 1) - 1)
        var S = 0
        s.borderVerticesBufferData = new Float32Array(6 * (d + p))
        for (var P = 0; P < g; P += d + 1)
          s.addIntoBuffer(s.borderVerticesBufferData, s.vertices[P], S),
            (S += 3)
        for (var D = (d + 1) * p + 1; D < g; D++)
          s.addIntoBuffer(s.borderVerticesBufferData, s.vertices[D], S),
            (S += 3)
        for (var I = (d + 1) * p - 1; I > 0; I -= d + 1)
          s.addIntoBuffer(s.borderVerticesBufferData, s.vertices[I], S),
            (S += 3)
        for (var L = d - 1; L > 0; L--)
          s.addIntoBuffer(s.borderVerticesBufferData, s.vertices[L], S),
            (S += 3)
        return s
      }
      return c(e, t), e
    })(Er),
    ci = 'z',
    li = (function (t) {
      function e(n, r, i, o) {
        var a,
          s =
            arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : {}
        a = t.call(this) || this
        var u = e.buildPlane(n, r, i, o, s),
          h = u.uvs,
          c = u.indices,
          l = u.normals,
          f = u.vertices
        return (
          (a.name = 'PlaneBufferGeometry'),
          a.setAttribute('position', new pr(f, 3)),
          a.setAttribute('normals', new pr(l, 3)),
          a.setAttribute('uv', new pr(h, 2)),
          a.setIndexes(c),
          a
        )
      }
      return (
        c(e, t),
        (e.buildPlane = function (t, n, r, i) {
          for (
            var o =
                arguments.length > 4 && void 0 !== arguments[4]
                  ? arguments[4]
                  : {},
              a = o.normalAxis,
              s = void 0 === a ? ci : a,
              u = o.useBack,
              h = void 0 !== u && u,
              c = o.normalDest,
              l = void 0 === c ? 0 : c,
              f = 0.5 * t,
              d = 0.5 * n,
              p = r || 1,
              v = i || 1,
              m = t / p,
              g = n / v,
              y = e.getNormal(s, h),
              _ = [],
              x = [],
              b = [],
              M = [],
              E = 0;
            E <= v;
            E++
          )
            for (var w = E * g - d, T = 0; T <= p; T++) {
              var A = T * m - f,
                R = e.get3DVertex([A, w], s, l)
              b.push.apply(b, zr(R)),
                _.push(T / p, 1 - E / v),
                M.push.apply(M, zr(y))
            }
          for (var C = 0; C < v; C++)
            for (var S = 0; S < p; S++) {
              var P = S + (p + 1) * C,
                D = S + (p + 1) * (C + 1),
                I = S + 1 + (p + 1) * (C + 1),
                L = S + 1 + (p + 1) * C
              x.push(P, D, I), x.push(P, I, L)
            }
          return { uvs: _, indices: x, vertices: b, normals: M }
        }),
        (e.getNormal = function (t) {
          var e,
            n = arguments.length > 1 && void 0 !== arguments[1] && arguments[1],
            r = n ? -1 : 1
          switch (t) {
            case 'x':
              e = [r, 0, 0]
              break
            case ci:
              e = [0, 0, r]
              break
            default:
              e = [0, r, 0]
          }
          return e
        }),
        e
      )
    })(gr)
  li.get3DVertex = function (t, e) {
    var n,
      r = Wr(t, 2),
      i = r[0],
      o = r[1],
      a = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0
    switch (e) {
      case 'x':
        n = [a, i, o]
        break
      case 'y':
        n = [i, a, o]
        break
      default:
        n = [i, o, a]
    }
    return n
  }
  var fi = (function (t) {
      function e(e, n, r, i, o, a) {
        var s
        ;(s = t.call(this) || this).name = 'BoxGeometry'
        var u = s.initBox(e, n, r, i, o, a),
          h = u.uvs,
          c = u.normals,
          l = u.vertices,
          f = u.indices
        return (
          s.setAttribute('position', new pr(l, 3)),
          s.setAttribute('normals', new pr(c, 3)),
          s.setAttribute('uv', new pr(h, 2)),
          s.setIndexes(f),
          s
        )
      }
      return (
        c(e, t),
        (e.prototype.initBox = function (t, e, n, r, i, o) {
          var a = [],
            s = li.buildPlane,
            u = s(n, e, o, i, { normalAxis: 'x', normalDest: t / 2 }),
            h = s(n, e, o, i, {
              normalAxis: 'x',
              useBack: !0,
              normalDest: -t / 2,
            }),
            c = s(t, n, r, o, { normalAxis: 'y', normalDest: e / 2 }),
            l = s(t, n, r, o, {
              normalAxis: 'y',
              useBack: !0,
              normalDest: -e / 2,
            }),
            f = s(t, e, r, i, { normalAxis: 'z', normalDest: n / 2 }),
            d = s(t, e, r, i, {
              normalAxis: 'z',
              useBack: !0,
              normalDest: -n / 2,
            })
          a.push(u, h, c, l, f, d)
          for (
            var p = 0,
              v = [],
              m = [],
              g = [],
              y = [],
              _ = function (t) {
                var e = a[t],
                  n = e.uvs,
                  r = e.vertices,
                  i = e.normals,
                  o = e.indices,
                  s = p
                ;(v = v.concat(n)),
                  (m = m.concat(r)),
                  (g = g.concat(i)),
                  (y = y.concat(
                    o.map(function (t) {
                      return s + t
                    })
                  )),
                  (p += r.length / 3)
              },
              x = 0;
            x < 6;
            x++
          )
            _(x)
          return { uvs: v, vertices: m, normals: g, indices: y }
        }),
        e
      )
    })(gr),
    di = (function (t) {
      function e(e, n) {
        var r
        return (
          ((r = t.call(this) || this).width = void 0),
          (r.height = void 0),
          (r.glFrameBuffer = null),
          (r.glDepthBuffer = null),
          (r.flipY = !1),
          (r.premultiplyAlpha = !1),
          (r.glTexture = null),
          (r.width = e),
          (r.height = n),
          r
        )
      }
      return c(e, t), e
    })(rr)
  function pi(t, e) {
    var n =
      ('undefined' != typeof Symbol && t[Symbol.iterator]) || t['@@iterator']
    if (!n) {
      if (
        Array.isArray(t) ||
        (n = (function (t, e) {
          if (!t) return
          if ('string' == typeof t) return vi(t, e)
          var n = Object.prototype.toString.call(t).slice(8, -1)
          'Object' === n && t.constructor && (n = t.constructor.name)
          if ('Map' === n || 'Set' === n) return Array.from(t)
          if (
            'Arguments' === n ||
            /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)
          )
            return vi(t, e)
        })(t)) ||
        (e && t && 'number' == typeof t.length)
      ) {
        n && (t = n)
        var r = 0,
          i = function () {}
        return {
          s: i,
          n: function () {
            return r >= t.length ? { done: !0 } : { done: !1, value: t[r++] }
          },
          e: function (t) {
            throw t
          },
          f: i,
        }
      }
      throw new TypeError(
        'Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.'
      )
    }
    var o,
      a = !0,
      s = !1
    return {
      s: function () {
        n = n.call(t)
      },
      n: function () {
        var t = n.next()
        return (a = t.done), t
      },
      e: function (t) {
        ;(s = !0), (o = t)
      },
      f: function () {
        try {
          a || null == n.return || n.return()
        } finally {
          if (s) throw o
        }
      },
    }
  }
  function vi(t, e) {
    ;(null == e || e > t.length) && (e = t.length)
    for (var n = 0, r = new Array(e); n < e; n++) r[n] = t[n]
    return r
  }
  var mi = (function () {
    function t() {
      ;(this.faceCount = 0),
        (this.verticesCoords = []),
        (this.textureCoords = []),
        (this.uvs = []),
        (this.vertices = []),
        (this.normals = []),
        (this.indexes = [])
    }
    var e = t.prototype
    return (
      (e.load = function (t) {
        var e = this
        return new Promise(function (n) {
          ;(function (t) {
            var e = new XMLHttpRequest()
            return (
              e.open('GET', t, !0),
              e.send(null),
              new Promise(
                function (t) {
                  e.addEventListener(
                    'load',
                    function () {
                      t(e.responseText)
                    },
                    !1
                  )
                },
                function (t) {
                  e.addEventListener(
                    'error',
                    function (e) {
                      console.error('request error'), t(e)
                    },
                    !1
                  )
                }
              )
            )
          })(t).then(function (t) {
            e.parse(t)
            var r = e.genObject3D()
            n(r)
          })
        })
      }),
      (e.genObject3D = function () {
        var t = new gr()
        t.setAttribute('position', new pr(this.vertices, 3)),
          this.uvs.length && t.setAttribute('uv', new pr(this.uvs, 2)),
          t.setIndexes(this.indexes)
        var e = new ei()
        return new br(t, e)
      }),
      (e.parse = function (t) {
        var e,
          n = pi(t.split('\n'))
        try {
          for (n.s(); !(e = n.n()).done; ) {
            var r = e.value,
              i = r.indexOf('#')
            ;-1 !== i && (r = r.substring(0, i))
            var o = (r = r.trim()).split(/\s+/)
            switch (o[0]) {
              case 'v':
                this.verticesCoords.push(
                  parseFloat(o[1]),
                  parseFloat(o[2]),
                  parseFloat(o[3])
                )
                break
              case 'vn':
                this.normals.push(
                  parseFloat(o[1]),
                  parseFloat(o[2]),
                  parseFloat(o[3])
                )
                break
              case 'vt':
                this.textureCoords.push(parseFloat(o[1]), parseFloat(o[2]))
                break
              case 'p':
              case 'l':
              case 'usemtl':
                break
              case 'f':
                o.shift(), this.parseFaceLine(o)
            }
          }
        } catch (t) {
          n.e(t)
        } finally {
          n.f()
        }
      }),
      (e.parseFaceLine = function (t) {
        for (var e = [], n = t.length, r = 0; r < n; r++) {
          var i = t[r]
          if (i.length > 0) {
            var o = i.split('/')
            e.push(o)
          }
        }
        for (var a = e[0], s = 1, u = e.length - 1; s < u; s++) {
          var h = e[s],
            c = e[s + 1]
          this.addFace(a, h, c)
        }
      }),
      (e.addFace = function (t, e, n) {
        var r = this.verticesCoords,
          i = r.length / 3,
          o = this.parseVertexIndex(t[0], i),
          a = this.parseVertexIndex(e[0], i),
          s = this.parseVertexIndex(n[0], i)
        this.vertices.push(
          r[o],
          r[o + 1],
          r[o + 2],
          r[a],
          r[a + 1],
          r[a + 2],
          r[s],
          r[s + 1],
          r[s + 2]
        )
        var u = 3 * this.faceCount
        if (
          (this.indexes.push(u, u + 1, u + 2), this.faceCount++, '' !== t[1])
        ) {
          var h = this.textureCoords,
            c = h.length,
            l = this.parseUVIndex(t[1], c),
            f = this.parseUVIndex(e[1], c),
            d = this.parseUVIndex(n[1], c)
          this.uvs.push(h[l], h[l + 1], h[f], h[f + 1], h[d], h[d + 1])
        }
        t[2]
      }),
      (e.parseVertexIndex = function (t, e) {
        var n = parseInt(t, 10)
        return 3 * (n >= 0 ? n - 1 : n + e / 3)
      }),
      (e.parseUVIndex = function (t, e) {
        var n = parseInt(t, 10)
        return 2 * (n >= 0 ? n - 1 : n + e / 2)
      }),
      t
    )
  })()
  function gi(t) {
    return new Promise(function (e, n) {
      var r = new Image()
      ;(r.src = t),
        (r.crossOrigin = 'Anonymous'),
        (r.onload = function () {
          e(r)
        }),
        (r.onerror = function (t) {
          n(t)
        })
    })
  }
  function yi(t) {
    if (6 !== t.length)
      throw new Error(
        '[loadCubeTexture] param urls need len six. [px, nx, py, ny, pz, nz]'
      )
    return new Promise(function (e, n) {
      for (
        var r = 0,
          i = new Or(),
          o = i.image,
          a = function (a) {
            gi(t[a])
              .then(function (t) {
                r++, (o[a] = t), 6 === r && ((i.needsUpdate = !0), e(i))
              })
              .catch(function (t) {
                console.error(t), n(t)
              })
          },
          s = 0;
        s < 6;
        s++
      )
        a(s)
    })
  }
  var _i = (function (t) {
      function e() {
        var e,
          n =
            arguments.length > 0 && void 0 !== arguments[0]
              ? arguments[0]
              : 0.1,
          r =
            arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 3e3
        return (
          ((e = t.call(this) || this).isCamera = !0),
          (e.viewMatrix = ue()),
          (e.projectionMatrix = ue()),
          (e.projectionMatrixNeedUpdate = !1),
          (e._far = void 0),
          (e._near = void 0),
          (e._far = r),
          (e._near = n),
          e
        )
      }
      return (
        c(e, t),
        (e.prototype.updateWorldMatrix = function () {
          var e =
            arguments.length > 0 && void 0 !== arguments[0] && arguments[0]
          t.prototype.updateWorldMatrix.call(this, e),
            de(this.viewMatrix, this.worldMatrix)
        }),
        o(e, [
          {
            key: 'near',
            get: function () {
              return this._near
            },
            set: function (t) {
              ;(this._near = t), (this.projectionMatrixNeedUpdate = !0)
            },
          },
          {
            key: 'far',
            get: function () {
              return this._far
            },
            set: function (t) {
              ;(this._far = t), (this.projectionMatrixNeedUpdate = !0)
            },
          },
        ]),
        e
      )
    })(ur),
    xi = (function (t) {
      function e(e, n, r, i, o, a) {
        var s
        return (
          ((s = t.call(this, o, a) || this)._left = void 0),
          (s._right = void 0),
          (s._top = void 0),
          (s._bottom = void 0),
          (s._top = r),
          (s._left = e),
          (s._right = n),
          (s._bottom = i),
          s.updateProjectionMatrix(!0),
          s
        )
      }
      c(e, t)
      var n = e.prototype
      return (
        (n.updateProjectionMatrix = function () {
          var t =
            arguments.length > 0 && void 0 !== arguments[0] && arguments[0]
          if (!0 === t || !0 === this.projectionMatrixNeedUpdate) {
            var e = (this.right - this.left) / 2,
              n = (this.top - this.bottom) / 2,
              r = (this.right + this.left) / 2,
              i = (this.top + this.bottom) / 2,
              o = r - e,
              a = r + e,
              s = i + n,
              u = i - n
            le(this.projectionMatrix),
              Se(this.projectionMatrix, o, a, s, u, this.near, this.far),
              (this.projectionMatrixNeedUpdate = !1)
          }
        }),
        (n.clone = function (n) {
          return (
            void 0 === n && (n = new e(0, 0, 0, 0, 0, 0)),
            t.prototype.clone.call(this, n),
            (n.left = this.left),
            (n.right = this.right),
            (n.top = this.top),
            (n.bottom = this.bottom),
            (n.near = this.near),
            (n.far = this.far),
            n.updateProjectionMatrix(),
            n.updateWorldMatrix(),
            n
          )
        }),
        o(e, [
          {
            key: 'top',
            get: function () {
              return this._top
            },
            set: function (t) {
              t !== this._top &&
                ((this._top = t), (this.projectionMatrixNeedUpdate = !0))
            },
          },
          {
            key: 'left',
            get: function () {
              return this._left
            },
            set: function (t) {
              t !== this._left &&
                ((this._left = t), (this.projectionMatrixNeedUpdate = !0))
            },
          },
          {
            key: 'right',
            get: function () {
              return this._right
            },
            set: function (t) {
              t !== this._right &&
                ((this._right = t), (this.projectionMatrixNeedUpdate = !0))
            },
          },
          {
            key: 'bottom',
            get: function () {
              return this._bottom
            },
            set: function (t) {
              t !== this._bottom &&
                ((this._bottom = t), (this.projectionMatrixNeedUpdate = !0))
            },
          },
        ]),
        e
      )
    })(_i),
    bi = (function (t) {
      function e(e, n, r, i) {
        var o
        return (
          ((o = t.call(this, r, i) || this).type = 'PerspectiveCamera'),
          (o._fov = void 0),
          (o._aspect = void 0),
          (o._fov = e),
          (o._aspect = n),
          o.updateProjectionMatrix(!0),
          o
        )
      }
      c(e, t)
      var n = e.prototype
      return (
        (n.updateProjectionMatrix = function () {
          var t =
            arguments.length > 0 && void 0 !== arguments[0] && arguments[0]
          ;(!0 !== t && !0 !== this.projectionMatrixNeedUpdate) ||
            (le(this.projectionMatrix),
            Ce(
              this.projectionMatrix,
              (this.fov * Math.PI) / 180,
              this.aspect,
              this.near,
              this.far
            ),
            (this.projectionMatrixNeedUpdate = !1))
        }),
        (n.clone = function (n) {
          return (
            void 0 === n && (n = new e(0, 0, 0, 0)),
            t.prototype.clone.call(this, n),
            (n.fov = this.fov),
            (n.aspect = this.aspect),
            (n.near = this.near),
            (n.far = this.far),
            n.updateProjectionMatrix(),
            n.updateWorldMatrix(),
            n
          )
        }),
        o(e, [
          {
            key: 'fov',
            get: function () {
              return this._fov
            },
            set: function (t) {
              t !== this._fov &&
                ((this._fov = t), (this.projectionMatrixNeedUpdate = !0))
            },
          },
          {
            key: 'aspect',
            get: function () {
              return this._aspect
            },
            set: function (t) {
              t !== this._aspect &&
                ((this._aspect = t), (this.projectionMatrixNeedUpdate = !0))
            },
          },
        ]),
        e
      )
    })(_i),
    Mi = Object.freeze({
      __proto__: null,
      Mesh: br,
      Scene: Mr,
      Geometry: Er,
      Object3D: ur,
      Raycaster: Ir,
      Texture: Lr,
      CubeTexture: Or,
      TextureOperation: Br,
      Material: Kr,
      BasicMaterial: ei,
      BufferGeometry: gr,
      WebGLRenderer: ui,
      PlaneGeometry: hi,
      BoxGeometry: fi,
      WebGLRenderTarget: di,
      PlaneBufferGeometry: li,
      Box3: hr,
      OBJLoader: mi,
      loadImage: gi,
      loadTexture: function (t, e, n) {
        return gi(t)
          .then(function (t) {
            var n = new Lr(t)
            return e && e(n), n
          })
          .catch(function (t) {
            n && n(t)
          })
      },
      loadCubeTexture: yi,
      Vec2: vt,
      Vec3: Xt,
      Vec4: ln,
      Mat3: se,
      Mat4: Be,
      Quat: Qn,
      quatToEuler: ir,
      BufferAttribute: cr,
      Uint8BufferAttribute: lr,
      Uint16BufferAttribute: fr,
      Uint32BufferAttribute: dr,
      Float32ArrayAttribute: pr,
      UintBufferAttribute: vr,
      OrthographicCamera: xi,
      PerspectiveCamera: bi,
    }),
    Ei = (function () {
      function t(t) {
        ;(this.pano = void 0),
          (this.panoData = void 0),
          (this._meshs = new br()),
          (this.pano = t)
      }
      return (
        o(t, [
          {
            key: 'camera',
            get: function () {
              return this.pano.camera
            },
          },
          {
            key: 'meshs',
            get: function () {
              return this._meshs
            },
            set: function (t) {
              this._meshs = t
            },
          },
        ]),
        t
      )
    })(),
    wi = [
      'varying vec3 v_normal;',
      'void main(void){',
      '   gl_Position = mvpMatrix * vec4(position, 1.0);',
      '   v_normal = normalize(position.xyz);',
      '}',
    ].join('\n'),
    Ti = [
      'uniform samplerCube uSampler;',
      'uniform float uOpacity;',
      'varying vec3 v_normal;',
      'void main(void){',
      '    vec4 textureColor = textureCube(uSampler, normalize(v_normal));',
      '    gl_FragColor = vec4(textureColor.rgb, textureColor.a * uOpacity);',
      '}',
    ].join('\n'),
    Ai = (function (t) {
      function e(e) {
        var n
        return (n = t.call(this, e) || this).initMesh(), n
      }
      c(e, t)
      var n = e.prototype
      return (
        (n.initMesh = function () {
          var t = new fi(8, 8, 8, 1, 1, 1),
            e = new Kr()
          ;(e.vertexShader = wi),
            (e.fragmentShader = Ti),
            (e.uniforms = {
              vColor: { type: '4f', value: [1, 0, 0, 1] },
              uSampler: { type: 't', value: null },
              uOpacity: { type: '1f', value: 1 },
            })
          var n = new br(t, e)
          ;(n.visible = !1), n.setScale(-1, 1, 1), (this.meshs = n)
        }),
        (n.setData = function (t) {
          var e = this
          if (!t.image || 6 !== t.image.length)
            throw new Error(
              '天空盒模型需要6张纹理，但只获取到 '.concat(
                t.image ? t.image.length : 0,
                '张'
              )
            )
          this.panoData = t
          var n = this.meshs
          yi(t.image)
            .then(function (t) {
              ;(n.material.uniforms.uSampler.value = t),
                (n.visible = !0),
                e.pano.emit({
                  type: d.REFRESH,
                  log: '[Refresh Log] 立方贴图加载完成， 渲染一帧',
                })
            })
            .catch(function (t) {
              return console.error(t)
            })
        }),
        (n.update = function () {}),
        (n.draw = function () {}),
        e
      )
    })(Ei),
    Ri = function (t) {
      return t
    },
    Ci = function (t) {
      return t * t
    },
    Si = function (t) {
      return -t * (t - 2)
    },
    Pi = Ci,
    Di = Si,
    Ii = Object.freeze({
      __proto__: null,
      linear: Ri,
      reverse: function (t) {
        return 1 - t
      },
      easeInQuad: Ci,
      easeInCubic: function (t) {
        return Math.pow(t, 3)
      },
      easeOutQuad: Si,
      easeOutCubic: function (t) {
        return Math.pow(t - 1, 3) + 1
      },
      easeInOutQuad: function (t) {
        return t < 0.5 ? t * t * 2 : -2 * (t - 2) * t - 1
      },
      easeInOutCubic: function (t) {
        return t < 0.5 ? 4 * Math.pow(t, 3) : 4 * Math.pow(t - 1, 3) + 1
      },
      easeInOutSine: function (t) {
        return (1 - Math.cos(Math.PI * t)) / 2
      },
      easeIn: Pi,
      easeOut: Di,
    }),
    Li = function () {},
    Oi = (function () {
      function t(t, e, n) {
        var r = this,
          i =
            arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : Ri
        ;(this.from = void 0),
          (this.to = void 0),
          (this.duration = void 0),
          (this.easingFn = void 0),
          (this._isPlaying = !1),
          (this._autoTimer = null),
          (this._startTime = null),
          (this._onUpdateCallback = Li),
          (this._onEndCallback = Li),
          (this.start = function () {
            return (
              r._isPlaying ||
                ((r._isPlaying = !0), (r._startTime = r.getNow())),
              r
            )
          }),
          (this.stop = function () {
            return (r._isPlaying = !1), r
          }),
          (this.startAndAutoUpdate = function () {
            if (r._isPlaying) return r
            r.start(), (r._autoTimer = null)
            return (
              (function t() {
                r.update(), (r._autoTimer = requestAnimationFrame(t))
              })(),
              r
            )
          }),
          (this.onEnd = function (t) {
            return (
              'function' == typeof t
                ? (r._onEndCallback = t)
                : console.warn('[Warning] onUpdate required a funtion'),
              r
            )
          }),
          (this.onUpdate = function (t) {
            return (
              'function' == typeof t
                ? (r._onUpdateCallback = t)
                : console.warn('[Warning] onUpdate required a funtion'),
              r
            )
          }),
          (this.update = function () {
            if (!r._isPlaying) return !1
            var t = r.from,
              e = r.to,
              n = r.getNow(),
              i = r.easingFn,
              o = r._startTime
            if (o > n) return !1
            var a = (n - o) / r.duration,
              s = t + (e - t) * i((a = 0 === r.duration || a > 1 ? 1 : a))
            return r._onUpdateCallback(s), 1 === a && r.handleEnd(), !0
          }),
          (this.from = t),
          (this.to = e),
          (this.duration = n),
          (this.easingFn = i)
      }
      var e = t.prototype
      return (
        (e.getNow = function () {
          return Date.now()
        }),
        (e.handleEnd = function () {
          ;(this._isPlaying = !1),
            (this._autoTimer = null),
            this._onEndCallback()
        }),
        t
      )
    })(),
    Bi = function (t, e, n) {
      var r = 0.5 * e,
        i = 0.5 * n
      return Q((t[0] - r) / r, (i - t[1]) / i)
    },
    ki = function (t, e, n) {
      var r = 0.5 * e,
        i = 0.5 * n
      return Q((t[0] + 1) * r, (1 - t[1]) * i)
    },
    Ui = function (t, e, n, r) {
      var i =
          arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : 100,
        o = ke(),
        a = Bi(t, n, r),
        s = Ne(a[0], a[1], i, 1),
        u = ue(),
        h = e.worldMatrix
      return de(u, e.projectionMatrix), $e(o, s, u), $e(o, o, h), o
    },
    Ni = function (t, e, n, r) {
      var i = arguments.length > 4 && void 0 !== arguments[4] && arguments[4],
        o = Ne(e[0], e[1], e[2], 1)
      if (($e(o, o, t.viewMatrix), 0 < o[2] && !0 !== i)) return null
      $e(o, o, t.projectionMatrix),
        (o[0] = o[0] / o[3]),
        (o[1] = o[1] / o[3]),
        (o[2] = o[2] / o[3]),
        (o[3] = 1)
      var a = Q(o[0], o[1])
      return ki(a, n, r)
    },
    Fi = function (t, e, n, r) {
      var i = Ni(e, t, n, r) || [-1, -1],
        o = Wr(i, 2),
        a = o[0],
        s = o[1],
        u = !1
      return a >= 0 && a <= n && s >= 0 && s <= r && (u = !0), u
    },
    ji = Object.freeze({
      __proto__: null,
      viewportToNormalizeProjection: Bi,
      normalizeProjectionToViewport: ki,
      viewportToWorld: Ui,
      worldToViewport: Ni,
      isCoordsInView: Fi,
    }),
    zi = (function () {
      function t() {
        var e = this,
          n =
            arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 500
        ;(this.getVertexs = function () {
          return e.vertexs
        }),
          (this.getFacesVertex = function () {
            return e.facesVertex
          }),
          (this.generateTextureCoord = function (n, r, i) {
            var o = e.facesVertex[Math.round(e.facesVertex.length / 2)]
            if (o) {
              for (
                var a = [],
                  s = Math.pow(2, 5 - i),
                  u = r % s,
                  h = n % s,
                  c = t.H_SEGS / e.cols,
                  l = 1 / c,
                  f = 1 / ((t.V_SEGS - 1) / e.rows),
                  d = 0;
                d < o.length / 3;
                d++
              ) {
                var p = (d % (c + 1)) * l,
                  v = Math.floor(d / (c + 1)) * f
                ;(p = p / s + (1 * u) / s),
                  (v = v / s + (1 * h) / s),
                  1 === i && (v *= 2),
                  a.push(p, v)
              }
              return a
            }
          }),
          (this.getFaceIndex = function (n) {
            var r = 0,
              i = Wr(n, 3),
              o = i[0],
              a = i[1],
              s = i[2],
              u = Math.round(
                (180 * Math.atan(Math.abs(s) / Math.abs(o))) / Math.PI
              )
            o > 0 ? s < 0 && (u = 360 - u) : (u = s > 0 ? 180 - u : 180 + u),
              (u %= 360),
              (r =
                a > e._x3
                  ? 7
                  : a > e._x2
                  ? 6
                  : a > e._x1
                  ? 5
                  : a > 0
                  ? 4
                  : a > -e._x1
                  ? 3
                  : a > -e._x2
                  ? 2
                  : a > -e._x3
                  ? 1
                  : 0)
            var h = Math.floor(u / 22.5),
              c = t.H_SEGS
            return [h, r, h + r * (c / (c / e.cols))]
          }),
          (this.viewportToSphereCoord = function (t, n, r, i) {
            var o = e.radius,
              a = Ui(t, i, n, r),
              s = Wr(a, 3),
              u = s[0],
              h = s[1],
              c = s[2],
              l = o / Math.sqrt(u * u + h * h + c * c)
            return [u * l, h * l, c * l]
          }),
          (this.getFaceVertex = function (n, r) {
            var i = t.H_SEGS / e.cols,
              o = r + n * (t.H_SEGS / i)
            return e.facesVertex[o]
          }),
          (this.radius = n),
          (this.rows = t.DEFAULT_COLS / 2),
          (this.cols = t.DEFAULT_COLS),
          (this.vertexs = null),
          (this.facesVertex = []),
          (this.facesVertexIndice = []),
          this.init()
      }
      var e = t.prototype
      return (
        (e.init = function () {
          var t = this.getSphereVertexInfo()
          ;(this.facesVertexIndice = this.getSphereFacesIndices()),
            (this.vertexs = t.vertexs),
            (this.facesVertex = t.facesVertex),
            this.calcConst()
        }),
        (e.calcConst = function () {
          var t = 360 / this.cols
          ;(this._x1 = Math.cos(g(3 * t)) * this.radius),
            (this._x2 = Math.cos(g(2 * t)) * this.radius),
            (this._x3 = Math.cos(g(1 * t)) * this.radius)
        }),
        (e.getSphereVertexInfo = function () {
          for (
            var e,
              n = [],
              r = [],
              i = this.radius,
              o = t.H_SEGS,
              a = t.V_SEGS,
              s = 360 / o,
              u = 180 / (a - 1),
              h = o / this.cols,
              c = o / h,
              l = 0,
              f = 0,
              d = [],
              p = 0;
            p < a;
            p++
          ) {
            var v = Math.sin(g(p * u - 90)) * i,
              m = Math.cos(g(p * u - 90)) * i
            ;(v = Math.round(100 * v) / 100),
              (m = Math.round(100 * m) / 100),
              (l = Math.floor(p / h))
            for (var y = 0; y < o; y++) {
              var _ = Math.cos(g(y * s)) * m,
                x = Math.sin(g(y * s)) * m
              if (
                ((_ = Math.round(100 * _) / 100),
                (x = Math.round(100 * x) / 100),
                n.push(_, v, x),
                (e = (f = Math.floor(y / h)) + l * c),
                l < this.rows && (r[e] || (r[e] = []), r[e].push(_, v, x)),
                l > 0 && p % h == 0)
              ) {
                var b = f + (l - 1) * c
                r[b].push(_, v, x),
                  y > 0 && y % h == 0 && r[b - 1] && r[b - 1].push(_, v, x),
                  y === o - 1 && r[b].push(d[0], d[1], d[2])
              }
              0 === f && 0 === y && (d = [_, v, x]),
                y > 0 && y % h == 0 && r[e - 1] && r[e - 1].push(_, v, x),
                l < this.rows && y === o - 1 && r[e].push(d[0], d[1], d[2])
            }
          }
          return { vertexs: n, facesVertex: r }
        }),
        (e.getSphereFacesIndices = function () {
          for (
            var e = [], n = t.H_SEGS / this.cols, r = n + 1, i = 0;
            i < n;
            i++
          )
            for (var o = 0; o < n; o++) {
              var a = i * r,
                s = a + o + 1,
                u = a + o + 1 + r
              e.push(a + o, s, u),
                (s = a + o + 1 + r),
                e.push(a + o, s, a + r + o)
            }
          return e
        }),
        (e.getSphereFacesIndicesByimageZoom = function (e) {
          for (
            var n = this,
              r = [],
              i = t.H_SEGS,
              o = Math.pow(2, 5 - e),
              a = i / this.cols + 1,
              s = a * a,
              u = function (t) {
                for (
                  var e = function (e) {
                      n.facesVertexIndice.forEach(function (n) {
                        r.push(n + s * e + s * t * 2)
                      })
                    },
                    i = 0;
                  i < o;
                  i++
                )
                  e(i)
              },
              h = 0;
            h < o;
            h++
          )
            u(h)
          return r
        }),
        t
      )
    })()
  ;(zi.DEFAULT_COLS = Math.pow(2, 4)), (zi.H_SEGS = 64), (zi.V_SEGS = 33)
  var Vi = (function () {
      function t() {
        ;(this._counter = 0), (this._imageCollection = {})
      }
      var e = t.prototype
      return (
        (e.getImageInstance = function () {
          var t
          for (var e in this._imageCollection)
            if (
              this._imageCollection[e] &&
              !0 === this._imageCollection[e]._free
            )
              return (
                (this._imageCollection[e]._free = !1), this._imageCollection[e]
              )
          t = new Image()
          var n = this.getGUID()
          return (this._imageCollection[n] = t), t
        }),
        (e.freeImage = function (t) {
          t && ((t._free = !0), (t.src = ''), (t.onload = t.onerror = null))
        }),
        (e.getGUID = function () {
          return this._counter++, 'img_'.concat(this._counter)
        }),
        t
      )
    })(),
    Gi = (function () {
      function t(e, n) {
        var r = this,
          i =
            arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : ''
        ;(this.imageInstancePool = void 0),
          (this.tileImagesCache = void 0),
          (this.textureInfo = void 0),
          (this.pano = void 0),
          (this.udtVersion = void 0),
          (this.cdnList = void 0),
          (this.calcTileKey = function (t, e, n, r) {
            return ''.concat(t, '_').concat(e, '_').concat(n, '_').concat(r)
          }),
          (this.loadImage = function (t, e, n, i) {
            var o = r.calcTileKey(t, e, n, i),
              a = r.getTilesUrl(t, { x: e, y: n }, i),
              s = r.tileImagesCache.getData(o)
            return new Promise(function (t, e) {
              s
                ? t(s._loaded ? s : null)
                : (((s = r.imageInstancePool.getImageInstance()).crossOrigin =
                    'anonymous'),
                  (s._loaded = !1),
                  (s.onload = function () {
                    ;(s._loaded = !0), t(s)
                  }),
                  (s.onerror = function (t) {
                    console.error('Tile '.concat(o, ' load error => '), t), e(t)
                  }),
                  (s.src = a),
                  r.tileImagesCache.setData(o, s))
            })
          }),
          (this.loadTexture = function (t, e, n, i) {
            var o = r.calcTileKey(t, e, n, i),
              a = r.textureInfo.getData(o)
            return new Promise(function (s, u) {
              a && a.loaded
                ? s(a)
                : r
                    .loadImage(t, e, n, i)
                    .then(function (t) {
                      if (!t) return null
                      var e = new Lr(t)
                      1 !== i && r.textureInfo.setData(o, e), s(e)
                    })
                    .catch(function (t) {
                      console.error(
                        '[TextureManager] loadTexture fail => '.concat(t)
                      ),
                        u(null)
                    })
            })
          }),
          (this.loadTopoTexture = function (t) {
            var e = 0,
              n = new Image()
            return new Promise(function (r) {
              ;(n.onload = function () {
                var t = new Lr(n)
                ;(t.flipY = !1), r(t)
              }),
                (n.onerror = function () {
                  2 > e
                    ? (e++,
                      (n.src = ''
                        .concat(t, '&random=')
                        .concat(new Date().getTime())))
                    : r(null)
                }),
                (n.crossOrigin = 'anonymous'),
                (n.src = t)
            })
          }),
          (this.clear = function () {
            r.textureInfo.clear()
          }),
          (this.pano = e),
          (this.udtVersion = i),
          (this.cdnList = n || e.opts.tileBaseUrls),
          (this.imageInstancePool = new Vi()),
          (this.tileImagesCache = new T(t.MAX_TILE_CACHED, {
            clearCallback: function (t) {
              r.imageInstancePool.freeImage(t)
            },
          })),
          (this.textureInfo = new T(t.MAX_TILE_CACHED, {
            clearCallback: function (t) {
              t.destory()
            },
          }))
      }
      var e = t.prototype
      return (
        (e.getRandomCDN = function () {
          var t =
              arguments.length > 0 && void 0 !== arguments[0]
                ? arguments[0]
                : [],
            e = t.length
          return t[Math.floor(Math.random() * e)]
        }),
        (e.getTilesUrl = function (e, n, r) {
          return (
            this.getRandomCDN(this.cdnList) +
            t.TILE_URL_TEMPLATE.replace('{udt}', this.udtVersion)
              .replace('{sid}', e)
              .replace('{x}', ''.concat(n.x))
              .replace('{y}', ''.concat(n.y))
              .replace('{zoom}', ''.concat(r))
          )
        }),
        t
      )
    })()
  ;(Gi.MAX_TILE_CACHED = 160),
    (Gi.TILE_URL_TEMPLATE =
      '?qt=pdata&sid={sid}&pos={y}_{x}&z={zoom}&udt={udt}&from=H5')
  var Hi = [
      'attribute vec2 uvBack;',
      'varying mediump vec2 vTextureCoordBack;',
      'varying mediump vec2 vTextureCoord;',
      'void main(void) {',
      '    gl_Position = mvpMatrix * vec4(position, 1.0);',
      '    vTextureCoordBack = uvBack;',
      '    vTextureCoord = uv;',
      '}',
    ].join('\n'),
    Wi = [
      'precision mediump float;',
      'varying vec2 vTextureCoordBack;',
      'varying vec2 vTextureCoord;',
      'uniform sampler2D uSamplerBack;',
      'uniform sampler2D uSampler;',
      'uniform bool uDrawThumb;',
      'uniform bool uDrawBack;',
      'uniform float uAlpha;',
      'void main(void) {',
      '    if (uDrawThumb) {',
      '        gl_FragColor = texture2D(uSamplerBack, vTextureCoordBack);',
      '        return;',
      '    }',
      '    if (uAlpha == 1.0) {',
      '        gl_FragColor = texture2D(uSampler, vTextureCoord);',
      '        return;',
      '    }',
      '    if (uDrawBack) {',
      '        gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha + texture2D(uSamplerBack, vTextureCoordBack) * (1.0 - uAlpha);',
      '    } else {',
      '        vec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));',
      '        gl_FragColor =  vec4(textureColor.rgb, textureColor.a * uAlpha);',
      '    }',
      '}',
    ].join('\n'),
    Zi = [
      'varying highp vec2 vTextureCoord;',
      'void main(void) {',
      '    gl_Position = mvpMatrix * vec4(position, 1.0);',
      '    vTextureCoord = uv;',
      '}',
    ].join('\n'),
    qi = [
      'precision mediump float;',
      'uniform sampler2D uSampler;',
      'varying highp vec2 vTextureCoord;',
      'void main(void) {',
      '    gl_FragColor = texture2D(uSampler, vTextureCoord);',
      '}',
    ].join('\n'),
    Yi = [
      'varying highp vec2 vTextureCoord;',
      'void main(void) {',
      '    gl_Position = mvpMatrix * vec4(position, 1.0);',
      '    vTextureCoord = uv;',
      '}',
    ].join('\n'),
    Xi = [
      'uniform sampler2D uSampler;',
      'uniform float uOpacity;',
      'varying vec2 vTextureCoord;',
      'void main(void){',
      '    vec4 textureColor = texture2D(uSampler, vTextureCoord);',
      '    gl_FragColor = vec4(textureColor.rgb, textureColor.a * uOpacity);',
      '}',
    ].join('\n'),
    Ki = [
      'varying highp vec3 vTextureCoord;',
      'void main(void){',
      '   gl_Position = mvpMatrix  * vec4(position, 1.0);',
      '   vTextureCoord = vec3(uv, 1.0) * length(position);',
      '}',
    ].join('\n'),
    Qi = [
      'uniform sampler2D uSampler;',
      'uniform float uOpacity;',
      'varying vec3 vTextureCoord;',
      'uniform bool showDebugLine;',
      'uniform vec4 vColor;',
      'void main(void){',
      '   if (!showDebugLine) {',
      '       vec4 textureColor = texture2DProj(uSampler, vTextureCoord);',
      '       gl_FragColor = vec4(textureColor.rgb, textureColor.a * uOpacity);',
      '   } else {',
      '       gl_FragColor = vec4(vColor.rgb, vColor.a);',
      '   }',
      '}',
    ].join('\n'),
    Ji = (function () {
      function t(e, n, r, i) {
        ;(this.nodes = void 0),
          (this.level = void 0),
          (this.key = void 0),
          (this.nodes = []),
          (this.level = e),
          (this.key = ''.concat(r, '_').concat(i)),
          e < n &&
            ((this.nodes[0] = new t(e + 1, n, 2 * r, 2 * i)),
            (this.nodes[1] = new t(e + 1, n, 2 * r, 2 * i + 1)),
            (this.nodes[2] = new t(e + 1, n, 2 * r + 1, 2 * i)),
            (this.nodes[3] = new t(e + 1, n, 2 * r + 1, 2 * i + 1)))
      }
      var e = t.prototype
      return (
        (e.hasNodes = function () {
          return this.nodes.length > 0
        }),
        (e.getNodeKeysByLevel = function (t) {
          if (t < this.level)
            return (
              console.warn(
                '指定节点'
                  .concat(t, ' 不在当前节点')
                  .concat(this.level, '范围内！')
              ),
              []
            )
          if (this.level === t) return [this.key]
          for (var e = [], n = 0; n < this.nodes.length; n++)
            if (Object.prototype.hasOwnProperty.call(this.nodes, n)) {
              var r = this.nodes[n]
              if (this.level === t - 1) e.push(r.key)
              else if (r.hasNodes()) {
                var i = r.getNodeKeysByLevel(t)
                e.push.apply(e, zr(i))
              }
            }
          return e
        }),
        t
      )
    })()
  var $i = (function (t) {
      function e(e) {
        var n
        return (
          ((n = t.call(this, e) || this).name = 'SphereRender'),
          (n.sphere = void 0),
          (n.textureManager = void 0),
          (n.imgColsRows = void 0),
          (n.curThumbTexture = void 0),
          (n.meshCache = {}),
          (n.tileInfoCache = {}),
          (n.imgRange = void 0),
          (n.faceRange = void 0),
          (n.hitTile = void 0),
          (n.setData = function (t) {
            ;(n.panoData = t),
              (n.curThumbTexture = null),
              n.loadThumbTextures(t.panoId)
          }),
          (n.update = function () {
            n.updateRangeInfo(), n.checkAndLoadTiles()
          }),
          (n.checkAndLoadTiles = function () {
            if (n.curThumbTexture && n.panoData) {
              var t = n.panoData.panoId,
                e = n.camera,
                r = n.imgColsRows[n._imgZoom],
                i = r.cols,
                o = i - 1,
                a = r.rows - 1,
                s = n.pano.getContainerSize(),
                u = s.width,
                h = s.height,
                c = !1,
                l = [],
                f = Wr(n.imgRange, 4),
                d = f[0],
                p = f[1],
                v = f[2],
                m = f[3]
              if (Fi(xt(0, 100, 0), e, u, h)) {
                for (var g = 0; g <= v; g++)
                  for (var y = 0; y <= o; y++)
                    n.checkAndLoadTile(t, y, g, n._imgZoom), l.push([g, y])
                v < m && ((v += 1), (c = !0))
              } else if (Fi(xt(0, -100, 0), e, u, h)) {
                for (var _ = m; _ <= a; _++)
                  for (var x = 0; x <= o; x++)
                    n.checkAndLoadTile(t, x, _, n._imgZoom), l.push([_, x])
                v < m && ((m -= 1), (c = !0))
              } else c = !0
              if (!0 === c) {
                p > o && (p = o)
                for (var b = d; b <= p; b++)
                  for (var M = v; M <= m; M++) {
                    var E = b < 0 ? b + i : b
                    n.checkAndLoadTile(t, E, M, n._imgZoom), l.push([M, E])
                  }
              }
              ;(n.hitTile = l),
                l.forEach(function (t) {
                  var e = Wr(t, 2),
                    r = e[0],
                    i = e[1],
                    o = ''.concat(r, '_').concat(i, '_').concat(n._imgZoom)
                  if (void 0 === n.tileInfoCache[o]) {
                    var a = new Ji(n._imgZoom, 5, r, i).getNodeKeysByLevel(5)
                    n.tileInfoCache[o] = a
                  }
                })
            }
          }),
          (n.draw = function () {
            var t = n.meshs
            if (!n.faceRange || !n.curThumbTexture) return !1
            t.children = []
            for (
              var e = function (e, r) {
                  var i = n.curThumbTexture,
                    o = n.textureManager.calcTileKey(
                      n.panoData.panoId,
                      e,
                      r,
                      n._imgZoom
                    ),
                    a = n.textureManager.textureInfo.getData(o),
                    s = !1,
                    u = null
                  if (
                    (a
                      ? !(u = a).finished &&
                        u.aniInfo &&
                        u.aniInfo &&
                        u.aniInfo.update()
                      : i && ((s = !0), (u = i)),
                    u)
                  ) {
                    var h = ''.concat(r, '_').concat(e, '_').concat(n._imgZoom),
                      c = n.meshCache[h]
                    if (!c) {
                      if (!(c = n.createTileMesh(r, e))) return
                      n.meshCache[h] = c
                    }
                    if (!c.material) return
                    var l = c.material.uniforms
                    ;(l.uSamplerBack.value = i),
                      s
                        ? (l.uDrawThumb.value = !0)
                        : ((l.uDrawThumb.value = !1),
                          (l.uSampler.value = u),
                          (l.uAlpha.value = u.alpha)),
                      t.add(c)
                  }
                },
                r = 0;
              r < n.hitTile.length;
              r++
            ) {
              var i = Wr(n.hitTile[r], 2),
                o = i[0]
              e(i[1], o)
            }
            return !0
          }),
          (n.pano = e),
          (n.sphere = new zi(e.opts.radius)),
          (n.textureManager = new Gi(e)),
          (n.imgColsRows = (function () {
            for (var t = [], e = 0; e <= 5; e++)
              t[e] =
                e < 2
                  ? { cols: 1, rows: 1 }
                  : { cols: Math.pow(2, e - 1), rows: Math.pow(2, e - 1) / 2 }
            return t
          })()),
          (n.curThumbTexture = null),
          (n.meshs = new br()),
          n
        )
      }
      c(e, t)
      var n = e.prototype
      return (
        (n.checkAndLoadTile = function (t, e, n, r) {
          var i = this,
            o = this.textureManager,
            a = o.calcTileKey(t, e, n, r)
          !0 !== (void 0 !== o.textureInfo.getData(a)) &&
            this.textureManager.loadTexture(t, e, n, r).then(function (t) {
              t &&
                !t.done &&
                ((t.aniInfo = i.createTextureAnimation(t)),
                (t.done = !0),
                i.pano.dispatchEvent({
                  type: d.REFRESH,
                  log: '[Refresh Log] 瓦片加载完成， 渲染一帧',
                }))
            })
        }),
        (n.loadThumbTextures = function (t) {
          var e = this
          this.textureManager.loadTexture(t, 0, 0, 1).then(function (t) {
            ;(e.curThumbTexture = t),
              e.pano.dispatchEvent({ type: d.THUMB_LOADED }),
              e.pano.dispatchEvent({
                debug: !0,
                type: d.REFRESH,
                log: '[Refresh Log] 缩略图加载完毕，渲染一帧',
              })
          })
        }),
        (n.createTextureAnimation = function (t) {
          var e = this
          return (
            (t.alpha = 0),
            new Oi(0, 1, 300)
              .onUpdate(function (n) {
                ;(t.alpha = n),
                  e.pano.dispatchEvent({
                    debug: !0,
                    type: d.REFRESH,
                    log: '[Refresh Log] 纹理清晰度渐变动画，渲染一帧',
                  })
              })
              .onEnd(function () {
                t.finished = !0
              })
              .start()
          )
        }),
        (n.createTileMesh = function (t, e) {
          var n = new Kr(),
            r = new gr()
          if (
            ((n.depthTest = !1),
            (n.vertexShader = Hi),
            (n.fragmentShader = Wi),
            (n.uniforms = {
              uSampler: { type: 't', value: null },
              uSamplerBack: { type: 't', value: null },
              uDrawThumb: { type: '1i', value: 1 },
              uDrawBack: { type: '1i', value: 1 },
              uAlpha: { type: '1f', value: 1 },
            }),
            !this.setGeometryAttrib(r, t, e))
          )
            return null
          var i = new br(r, n)
          return (i.name = 'tile-mesh'), i
        }),
        (n.setGeometryAttrib = function (t, e, n) {
          var r = ''.concat(e, '_').concat(n, '_').concat(this._imgZoom),
            i = this.tileInfoCache[r]
          if (!i) return !1
          for (var o = [], a = [], s = [], u = 0; u < i.length; u++) {
            var h = i[u].split('_'),
              c = this.sphere.rows,
              l = Number(h[1]),
              f = c - 1 - Number(h[0])
            o.push.apply(o, zr(this.sphere.getFaceVertex(f, l))),
              a.push.apply(
                a,
                zr(this.sphere.generateTextureCoord(f, l, this._imgZoom))
              ),
              s.push.apply(s, zr(this.sphere.generateTextureCoord(f, l, 1)))
          }
          var d = this.sphere.getSphereFacesIndicesByimageZoom(this._imgZoom)
          return (
            t.setAttribute('uv', new pr(a, 2)),
            t.setAttribute('uvBack', new pr(s, 2)),
            t.setAttribute('position', new pr(o, 3)),
            t.setIndexes(d),
            !0
          )
        }),
        (n.getTileBoundary = function () {
          var t = this.pano.getContainerSize(),
            e = t.width,
            n = t.height,
            r = Q(0, 0),
            i = Q(e, 0),
            o = Q(0, n),
            a = Q(e, n),
            s = Q(0.5 * e, 0),
            u = Q(0.5 * e, n),
            h = Q(0, 0.5 * n),
            c = Q(e, 0.5 * n),
            l = this.getSpherePosition(r),
            f = this.getSpherePosition(i),
            d = this.getSpherePosition(o),
            p = this.getSpherePosition(a),
            v = this.getSpherePosition(s),
            m = this.getSpherePosition(u),
            g = this.getSpherePosition(h),
            y = this.getSpherePosition(c),
            _ = Math.max(l[1], v[1], f[1]),
            x = Math.min(d[1], m[1], p[1]),
            b = [l[0], g[0], d[0], v[0]],
            E = [f[0], y[0], p[0], m[0]],
            w = Math.min.apply(Math, b),
            T = Math.max.apply(Math, E),
            A = M(b),
            R = M(E),
            C = this.sphere.cols,
            S = C / 2
          A.max - A.min > S &&
            (w = Math.min.apply(
              Math,
              zr(
                b.filter(function (t) {
                  return t > S
                })
              )
            )),
            R.max - R.min > S &&
              (T = Math.max.apply(
                Math,
                zr(
                  E.filter(function (t) {
                    return t < S
                  })
                )
              )),
            w > T && (w -= C)
          var P = this.getImgIndexByFaceColRow(w, _),
            D = Wr(P, 2),
            I = D[0],
            L = D[1],
            O = this.getImgIndexByFaceColRow(T, x),
            B = Wr(O, 2)
          return [
            [w, T, _, x],
            [I, B[0], L, B[1]],
          ]
        }),
        (n.updateRangeInfo = function () {
          var t = this.getTileBoundary(),
            e = Wr(t, 2),
            n = e[0],
            r = e[1]
          ;(this.imgRange = r), (this.faceRange = n)
        }),
        (n.getImgIndexByFaceColRow = function (t, e, n) {
          n = n || this._imgZoom
          var r = Math.pow(2, 5 - n),
            i = Math.floor(t / r),
            o = Math.floor(e / r)
          return [
            i,
            (o = this.imgColsRows[n].rows - o - 1),
            i + (o * zi.DEFAULT_COLS) / r,
          ]
        }),
        (n.normalizeNum = function (t, e) {
          for (
            var n =
                arguments.length > 2 && void 0 !== arguments[2]
                  ? arguments[2]
                  : 0,
              r = t;
            r < n;

          )
            r += e
          return (r %= e)
        }),
        (n.getSpherePosition = function (t) {
          var e = this.camera,
            n = this.pano.getContainerSize(),
            r = n.width,
            i = n.height,
            o = this.sphere.viewportToSphereCoord(t, r, i, e),
            a = this.sphere.getFaceIndex(o),
            s = Wr(a, 2)
          return Q(s[0], s[1])
        }),
        (n.generateBackThumb = function (t) {
          if (t) {
            var e = this.pano,
              n = e.getContainerSize(),
              r = n.width,
              i = n.height,
              o =
                '//mapsv0.bdimg.com/scape/?udt=20140616&qt=pdata&pos=0_0&z=2&sid=' +
                t +
                '&from=H5',
              a = e.getPanes().tileLayer
            ;(a.style.backgroundImage = 'url("' + o + '")'),
              (a.style.backgroundPosition = '50% 50%'),
              (a.style.backgroundSize = '150% 150%'),
              (a.style.width = ''.concat(r, 'px')),
              (a.style.height = ''.concat(i, 'px'))
          }
        }),
        o(e, [
          {
            key: '_imgZoom',
            get: function () {
              return this.pano.imageZoom
            },
          },
        ]),
        e
      )
    })(Ei),
    to = [10, -20, 30, 10, -20, 10, -10, -20, 10, -10, -20, 30].map(function (
      t
    ) {
      return -20 === t ? -20 : 1.8 * t
    }),
    eo = [10, -22, 30, 10, -22, 10, -10, -22, 10, -10, -22, 30].map(function (
      t
    ) {
      return -22 === t ? -22 : 1.8 * t
    }),
    no = [
      1.8, -20, 24.9, 1.8, -20, 16.3, -1.8, -20, 16.3, -1.8, -20, 24.9,
    ].map(function (t) {
      return -20 === t ? -20 : 1.8 * t
    }),
    ro = [0, 0, 0, 0.5, 0.25, 0.5, 0.25, 0],
    io = (function () {
      function t(t, e, n) {
        var r = this
        ;(this.mesh = void 0),
          (this.material = void 0),
          (this.linkData = void 0),
          (this._pano = void 0),
          (this.northDir = void 0),
          (this.yAxisDis = void 0),
          (this.isPosInArrow = function (t, e, n, i, o) {
            var a = Q(t, e),
              s = Ui(a, n, i, o, -1),
              u = 200 * s[0],
              h = 200 * s[1],
              c = 200 * s[2],
              l = r.yAxisDis / h
            if (l < 0) return !1
            var f = [u * l, h * l, c * l]
            return r.isHitLink(f)
          }),
          (this._pano = t),
          (this.linkData = e),
          (this.northDir = n),
          (this.yAxisDis = 0),
          (this.linkData.refinedDir = _((e.topoDir || 0) + this.northDir)),
          (this.material = this.createArrowMaterial()),
          (this.mesh = this.initMesh()),
          this.changePose()
      }
      var e = t.prototype
      return (
        (e.initMesh = function () {
          var t = this.createGeometry(),
            e = new br(t, this.material)
          return (e.visible = !1), (e.name = 'link-mesh'), e
        }),
        (e.createArrowMaterial = function () {
          var t = new Kr()
          return (
            (t.depthTest = !1),
            (t.vertexShader = Zi),
            (t.fragmentShader = qi),
            (t.uniforms = { uSampler: { type: 't', value: null } }),
            t
          )
        }),
        (e.setTopoTexture = function (t) {
          t.isTexture && (this.material.uniforms.uSampler.value = t)
        }),
        (e.setVisible = function (t) {
          this.mesh.setVisible(t, !0)
        }),
        (e.createGeometry = function () {
          var t = new gr(),
            e = this.getTextCoord(this.linkData.topoDir),
            n = [].concat(eo, to, no),
            r = [].concat(
              [0.5, 0, 0.5, 0.5, 1, 0.5, 1, 0],
              [0, 0, 0, 0.5, 0.5, 0.5, 0.5, 0],
              e
            ),
            i = [].concat(
              [0, 1, 2, 0, 2, 3],
              [4, 5, 6, 4, 6, 7],
              [8, 9, 11, 10, 11, 9]
            )
          return (
            t.setAttribute('position', new pr(n, 3)),
            t.setAttribute('uv', new pr(r, 2)),
            t.setIndexes(i),
            t
          )
        }),
        (e.changePose = function (t) {
          t = t || this.mesh
          var e = 50,
            n = -30,
            r = this._pano.getPov().pitch,
            i = this.linkData.refinedDir
          ;((e += 20 * this._pano.getZoom()), r < 0) &&
            ((e *= (90 - (r = Math.abs(r))) / 90), (n -= (20 * r) / 90))
          var o = Math.cos(g(i)) * e,
            a = Math.sin(g(i)) * e
          ;(this.yAxisDis = n + -20),
            t.setPosition(o, n, a),
            t.rotateY(-_(i - 90)),
            t.rotateX(-5),
            t.updateWorldMatrix(!0)
        }),
        (e.getTextCoord = function (t) {
          t = (t + 360) % 360
          var e = Math.ceil(Math.floor(t / 22.5) / 2)
          8 === e && (e = 0)
          for (
            var n = ro.slice(0), r = Math.floor(e / 2), i = e % 2, o = 0;
            o < n.length;
            o++
          )
            o % 2 == 0
              ? ((n[o] += 0.25 * r), (n[o] = 0.5 * n[o]))
              : ((n[o] += 0.5 * i), (n[o] = 0.5 * n[o] + 0.5))
          return n
        }),
        (e.isHitLink = function (t) {
          var e = t[0],
            n = t[2],
            r = this.mesh.worldMatrix,
            i = xt(to[0], to[1], to[2]),
            o = xt(to[6], to[7], to[8]),
            a = xt((i[0] + o[0]) / 2, (i[1] + o[1]) / 2, (i[2] + o[2]) / 2)
          return Lt(a, a, r), Math.abs(e - a[0]) < 18 && Math.abs(n - a[2]) < 18
        }),
        t
      )
    })(),
    oo = (function (t) {
      function e(e) {
        var n
        return (
          ((n = t.call(this, e) || this).name = 'PanoLinkRender'),
          (n.linkVisible = !0),
          (n.textureManager = void 0),
          (n.linkInfos = []),
          (n.setData = function (t) {
            if (
              t &&
              ((o = t.getTopos),
              (a = '[object Function]' === Object.prototype.toString.call(o)),
              (s =
                '[object AsyncFunction]' === Object.prototype.toString.call(o)),
              a || s)
            ) {
              n.reset()
              var e = t.getTopos(),
                r = t.northDir,
                i = t.panoType === p.TYPE_STREET
              e.length &&
                i &&
                ((n.linkInfos = e.map(function (t) {
                  return new io(n.pano, t, r)
                })),
                (n.meshs = n.linkInfos.map(function (t) {
                  return t.mesh
                })),
                n.loadTextures(),
                n.setVisible(!0))
            }
            var o, a, s
          }),
          (n.clickChecker = function (t, e) {
            if (n.linkVisible) {
              var r = n.getIdByTouchPos(t, e)
              return (
                r &&
                  (n.setVisible(!1),
                  n.pano.dispatchEvent({ type: d.LINK_CLICK, id: r }),
                  n.pano.setId(r, { animation: !0 })),
                !r
              )
            }
          }),
          (n.pano = e),
          (n.meshs = []),
          (n.textureManager = new Gi(e)),
          n
        )
      }
      c(e, t)
      var n = e.prototype
      return (
        (n.reset = function () {
          ;(this.meshs = []), (this.linkInfos = [])
        }),
        (n.update = function () {
          this.linkInfos.forEach(function (t) {
            t.changePose()
          })
        }),
        (n.setVisible = function (t) {
          var e = this.linkInfos
          if (!(e.length < 1)) {
            var n = this.pano.opts.linksControl,
              r = !1
            !0 === n && (r = t),
              (this.linkVisible = r),
              e.forEach(function (t) {
                return t.setVisible(r)
              })
          }
        }),
        (n.draw = function () {}),
        (n.loadTextures = function () {
          var t = this,
            e = this.pano.opts.imgPath
              ? ''.concat(this.pano.opts.imgPath, 'topo_arrow.png')
              : p.TOPO_ARROW_TEXTURE
          this.textureManager.loadTopoTexture(e).then(function (e) {
            e &&
              t.linkInfos.forEach(function (t) {
                t.setTopoTexture(e)
              })
          })
        }),
        (n.getIdByTouchPos = function (t, e) {
          var n = this,
            r = null
          if (!this.linkInfos.length) return r
          var i = this.pano.getContainerSize(),
            o = i.width,
            a = i.height,
            s = this.linkInfos.filter(function (r) {
              return r.isPosInArrow(t, e, n.camera, o, a)
            })
          return s.length && (r = s[0].linkData.panoId), r
        }),
        e
      )
    })(Ei),
    ao = (function () {
      function t(t, e, n) {
        var r = this
        ;(this.start = function () {
          r.fadeAni.start(),
            r._pano.dispatchEvent({
              debug: !0,
              log: '淡出动画，渲染一帧',
              type: d.REFRESH,
            })
        }),
          (this.update = function () {
            r.fadeAni.update()
          }),
          (this._pano = t),
          (this.gl = this._pano.gl),
          (this.snapshot = e),
          (this.scene = this.initScene()),
          (this.camera = this.initCamera())
        this.fadeAni = new Oi(1, 0, 600)
          .onUpdate(function (t) {
            ;(r.material.uniforms.uOpacity.value = t),
              r._pano.dispatchEvent({ type: d.REFRESH })
          })
          .onEnd(function () {
            n && n(),
              r._pano.dispatchEvent({
                type: d.REFRESH,
                debug: !0,
                log: '淡出动画结束，渲染一帧',
              })
          })
      }
      var e = t.prototype
      return (
        (e.initScene = function () {
          var t = new Mr(),
            e = this._pano.getContainerSize(),
            n = e.width,
            r = e.height,
            i = new li(n, r),
            o = this.initMaterial(),
            a = new br(i, o)
          return t.add(a), t
        }),
        (e.initMaterial = function () {
          var t = new Kr()
          return (
            (t.depthTest = !1),
            (t.vertexShader = Yi),
            (t.fragmentShader = Xi),
            (t.uniforms = {
              uSampler: { type: 't', value: this.snapshot },
              uOpacity: { type: '1f', value: 1 },
            }),
            (this.material = t),
            t
          )
        }),
        (e.initCamera = function () {
          var t = this._pano.getContainerSize(),
            e = t.width / 2,
            n = t.height / 2
          return new xi(-e, e, n, -n, 0, 11e3)
        }),
        t
      )
    })(),
    so = (function () {
      function t(t, e, n) {
        var r = this
        ;(this.start = function () {
          r.waveAni.start(),
            r._pano.dispatchEvent({
              debug: !0,
              log: '淡出动画，渲染一帧',
              type: d.REFRESH,
            })
        }),
          (this.update = function () {
            r.waveAni.update()
          }),
          (this._pano = t),
          (this.gl = this._pano.gl),
          (this.snapshot = e),
          (this.scene = this.initScene()),
          (this.camera = this.initCamera())
        this.waveAni = new Oi(0, 1, 800)
          .onUpdate(function (t) {
            ;(r.material.uniforms.progress.value = t),
              (r.material.uniforms.uOpacity.value = 1 - t),
              r._pano.dispatchEvent({ type: d.REFRESH })
          })
          .onEnd(function () {
            n && n(),
              r._pano.dispatchEvent({
                type: d.REFRESH,
                debug: !0,
                log: '淡出动画结束，渲染一帧',
              })
          })
      }
      var e = t.prototype
      return (
        (e.initCamera = function () {
          var t = this._pano.getContainerSize(),
            e = t.width / 2,
            n = t.height / 2
          return new xi(-e, e, n, -n, 0, 11e3)
        }),
        (e.initScene = function () {
          var t = new Mr(),
            e = this._pano.getContainerSize(),
            n = e.width,
            r = e.height,
            i = new li(n, r),
            o = this.initMaterial(),
            a = new br(i, o)
          return t.add(a), t
        }),
        (e.initMaterial = function () {
          var t = new Kr(),
            e = this._pano.getContainerSize(),
            n = e.width,
            r = e.height
          return (
            (t.depthTest = !1),
            (t.vertexShader = Yi),
            (t.fragmentShader =
              '\n    uniform float aspect;\n    uniform float radius;\n    uniform float amp;\n    uniform float band;\n    uniform float waves;\n    uniform float speed;\n    uniform float progress;\n    uniform vec2 uCenter;\n    uniform sampler2D uSampler;\n    uniform float uOpacity;\n\n    varying vec2 vTextureCoord;\n\n    void main() {\n        vec2 tc = vTextureCoord;\n        vec2 uv = vec2(0.0, 0.0);\n        vec2 p;\n        float len;\n        vec2 uv_offset;\n        float wave_width = band * radius;\n\n        p = (tc - uCenter);\n        p.x = p.x * aspect;\n        len = length(p);\n\n        float current_radius = radius * progress;\n        float damp_factor = 1.0;\n        if (progress > .5) {\n            damp_factor = (1.0 - progress) * 2.0;\n        }\n\n        float cut_factor = clamp(wave_width * damp_factor - abs(current_radius - len), 0.0, 1.0);\n        float waves_factor = waves * len / radius;\n        uv_offset = (p / len) * cos((waves_factor - progress * speed) * 3.14) * amp * cut_factor;\n\n        uv += uv_offset;\n\n        vec4 t_image = texture2D(uSampler, fract(tc + uv));\n\n        // gl_FragColor = t_image;\n        gl_FragColor = vec4(t_image.rgb, t_image.a * uOpacity);\n    }\n'),
            (t.uniforms = {
              uSampler: { type: 't', value: this.snapshot },
              uCenter: { type: '2f', value: [0.5, 0.5] },
              uOpacity: { type: '1f', value: 1 },
              progress: { type: '1f', value: 0 },
              speed: { type: '1f', value: 4 },
              waves: { type: '1f', value: 14 },
              band: { type: '1f', value: 0.3 },
              amp: { type: '1f', value: 0.3 },
              aspect: { type: '1f', value: n / r },
              radius: { type: '1f', value: 1 },
            }),
            (this.material = t),
            t
          )
        }),
        t
      )
    })(),
    uo = (function () {
      function t(t, e, n, r) {
        var i = this
        ;(this.startAni = function () {
          i.animation.start()
        }),
          (this.update = function () {
            i.animation.update()
          }),
          (this.pano = t),
          (this.distance = n),
          (this.refinedDir = e),
          (this.camera = this.pano.camera),
          (this.cameraBase = this.pano.camera.clone()),
          (this.handleEnd = r),
          this.initAni()
      }
      return (
        (t.prototype.initAni = function () {
          var t = this,
            e = this.distance,
            n = this.refinedDir,
            r = Math.cos(g(n)),
            i = Math.sin(g(n))
          this.animation = new Oi(0, 1, 400, Ii.easeOutQuad)
            .onUpdate(function (n) {
              var o = e * n,
                a = r * o,
                s = i * o
              t.camera.setPosition(a, 0, s),
                t.pano.dispatchEvent({
                  debug: !0,
                  type: d.REFRESH,
                  log: '[Refresh Log] 前进动画， 渲染一帧',
                })
            })
            .onEnd(function () {
              t.handleEnd && t.handleEnd()
            })
        }),
        t
      )
    })(),
    ho = function (t, e, n, r) {
      ;(this.x = t || 0),
        (this.y = e || 0),
        (this.width = n || 0),
        (this.height = r || 0)
    },
    co = function (t, e) {
      var n = this
      ;(this.angleDegreeDelta = function (t, e) {
        var n = Math.abs(t - e)
        return n > 180 ? 360 - n : n
      }),
        (this.getRoad = function (t, e, n, r, i) {
          for (
            var o,
              a = [],
              s = [
                [-t / 2, -e, -10],
                [-t / 2, -e, -20],
                [t / 2, -e, -10],
                [t / 2, -e, -20],
              ],
              u = s.length,
              h = 0;
            h < u;
            h++
          )
            Lt((o = s[h]), o, n),
              (a[h] = { x: o[0] * r * 0.5, y: -o[1] * i * 0.5 })
          return a
        }),
        (this.getIntersection = function (t, e, n, r) {
          if (t.x === e.x || n.x === r.x) return null
          var i = (e.y - t.y) / (e.x - t.x),
            o = (r.y - n.y) / (r.x - n.x)
          if (i === o) return null
          var a = (o * n.x - i * t.x + t.y - n.y) / (o - i)
          return { x: a, y: i * (a - t.x) + t.y }
        }),
        (this.calculateVanishPoint = function (t, e, r, i) {
          var o = n.getIntersection(t[0], t[1], t[2], t[3])
          return null === o
            ? null
            : ((o.x += r * e * 0.5), (o.y += i * e * 0.5), o)
        }),
        (this.getOuterRect = function (t, e, n) {
          return new ho(t * (n - 1) * 0.5, e * (n - 1) * 0.5, t, e)
        }),
        (this.transformPoint = function (t, e, n) {
          return t && void 0 !== t.x && void 0 !== t.y
            ? { x: t.x + e, y: t.y + n }
            : t
        }),
        (this.getInnerRect = function (t, e, r, i, o) {
          var a = n.transformPoint(t, 0.5 * -r * o, 0.5 * -i * o),
            s = n.transformPoint(a, 0, 20),
            u = n.transformPoint(a, 10, 20),
            h = n.getIntersection(e[0], e[1], s, u),
            c = n.getIntersection(e[2], e[3], s, u),
            l = n.transformPoint(h, 0, -70),
            f = new ho(l.x + r * o * 0.5, l.y + i * o * 0.5, c.x - h.x, 70)
          return (
            (f = n.fixInnerRectPosition(f, t)),
            (f = n.fixInnerRectSize(f, t, r))
          )
        }),
        (this.fixInnerRectPosition = function (t, e) {
          var n = t,
            r = (e.x - t.x) / t.width,
            i = 0
          return (
            r > 0.7 && (i = r - 0.7),
            r < 0.3 && (i = 0.3 - r),
            (n.x = n.x + n.width * i),
            n
          )
        }),
        (this.fixInnerRectSize = function (t, e, n) {
          var r,
            i,
            o,
            a,
            s = t
          s.width / n > 0.12 &&
            ((a = (o = 0.12 * n) * (s.width / s.height)),
            (r = s.x + ((s.width - o) * (e.x - s.x)) / s.width),
            (i = s.y + ((s.height - a) * (e.y - s.y)) / s.height),
            (s = new ho(r, i, o, a)))
          var u = s.width / s.height
          return (
            (a = s.height),
            u > 1.2 && (a = (s.height * u) / 1.2),
            u < 0.9 && (a = (s.height * u) / 0.9),
            (i = s.y + s.height - a),
            (s.height = a),
            (s.y = i),
            s
          )
        }),
        (this.panoData = t.panoData),
        (this.camera = t.camera),
        (this.projectionMatrix = this.camera.projectionMatrix),
        (this.fov = g(this.camera.fov)),
        (this.traverseDir = e),
        (this.cameraHeading = t.getPov().heading || 0),
        (this.isMovingForward =
          this.angleDegreeDelta(this.cameraHeading, this.traverseDir) <= 90),
        (this.roadWith = Math.min(1.5 * this.panoData.getRoadWidth(), 10)),
        (this.deviceHeight = this.panoData.deviceHeight || 2.2),
        (this.panoWidth = t._container.clientWidth),
        (this.panoHeight = t._container.clientHeight)
      var r = this.angleDegreeDelta(this.cameraHeading, this.traverseDir) > 45
      ;(this.snapshotRatio = r ? 1 : 1.8),
        (this.projectionRoadInfos = this.getRoad(
          this.roadWith,
          this.deviceHeight,
          this.projectionMatrix,
          this.panoWidth,
          this.panoHeight
        )),
        (this.vanishPoint = this.calculateVanishPoint(
          this.projectionRoadInfos,
          this.snapshotRatio,
          this.panoWidth,
          this.panoHeight
        )),
        (this.innerRect = this.getInnerRect(
          this.vanishPoint,
          this.projectionRoadInfos,
          this.panoWidth,
          this.panoHeight,
          this.snapshotRatio
        )),
        (this.outerRect = this.getOuterRect(
          this.panoWidth,
          this.panoHeight,
          this.snapshotRatio
        )),
        (this.focusLength =
          (0.5 * this.panoHeight) / Math.tan(0.75 * this.fov)),
        (this.vanishPointDeltaX =
          this.vanishPoint.x - this.outerRect.x - 0.5 * this.outerRect.width),
        (this.vanishPointDeltaY =
          this.vanishPoint.y - this.outerRect.y - 0.5 * this.outerRect.height)
    },
    lo = {
      FAR: [10, 10, 0],
      LEFT: [0, 10, 30],
      RIGHT: [0, 10, 30],
      TOP: [10, 0, 30],
      BOTTOM: [10, 0, 30],
    },
    fo = {
      FAR: ['innerTopLeftVertex', 'innerBottomRightVertex'],
      LEFT: ['outerTopLeftVertex', 'innerBottomLeftVertex'],
      RIGHT: ['innerTopRightVertex', 'outerBottomRightVertex'],
      TOP: ['outerTopLeftVertex', 'innerTopRightVertex'],
      BOTTOM: ['innerBottomLeftVertex', 'outerBottomRightVertex'],
    },
    po = Object.keys(lo),
    vo = (function (t) {
      function e(e, n) {
        var r
        if (
          (((r = t.call(this) || this).createSkeleton = function (t) {
            var e = t.vanishPoint,
              n = t.innerRect,
              r = t.outerRect,
              i = t.focusLength,
              o = r.y + r.height - n.y - n.height,
              a = e.y - n.y,
              s = e.x - n.x,
              u = n.x + n.width - e.x,
              h = r.y + r.height - e.y,
              c = (o * i) / (h - o),
              l = (u * (i + c)) / i,
              f = -((s * (i + c)) / i),
              d = h + (a * (i + c)) / i - h,
              p = -h,
              v = c / 5
            return {
              innerTopLeftVertex: { x: f, y: d, z: -c },
              innerBottomLeftVertex: { x: f, y: p, z: -c },
              innerTopRightVertex: { x: l, y: d, z: -c },
              innerBottomRightVertex: { x: l, y: p, z: -c },
              outerTopLeftVertex: { x: f, y: d, z: v },
              outerTopRightVertex: { x: l, y: d, z: v },
              outerBottomLeftVertex: { x: f, y: p, z: v },
              outerBottomRightVertex: { x: l, y: p, z: v },
            }
          }),
          (r.modelSkeleton = function (t, e) {
            var n = [],
              i = []
            return (
              po.forEach(function (o) {
                var a = Wr(fo[o], 2),
                  s = a[0],
                  u = a[1],
                  h = n.length / 3
                ;(n = n.concat(r.calculatePlaneVertex(t[s], t[u], o, e))),
                  (i = i.concat(r.calculateIndices(o, h)))
              }),
              [n, i]
            )
          }),
          (r.calculatePlaneVertex = function (t, e, n, i) {
            for (
              var o,
                a = [],
                s = Wr(lo[n], 3),
                u = s[0],
                h = s[1],
                c = s[2],
                l = r.linerInterpolate(t.x, e.x, u),
                f = r.linerInterpolate(t.y, e.y, h),
                d = r.linerInterpolate(t.z, e.z, c),
                p = 0;
              p <= u;
              p++
            )
              for (var v = 0; v <= h; v++)
                for (var m = 0; m <= c; m++)
                  $e((o = Ne(l[p], f[v], d[m], 1)), o, i),
                    (o[0] = o[0] / o[3]),
                    (o[1] = o[1] / o[3]),
                    (o[2] = o[2] / o[3]),
                    a.push(o[0], o[1], o[2])
            return a
          }),
          (r.calculateIndices = function (t, e) {
            var n = [],
              r = lo[t]
            r = r.filter(function (t) {
              return t > 0
            })
            for (
              var i = Wr(r, 2),
                o = i[0],
                a = i[1],
                s = 0,
                u = 0,
                h = 0,
                c = 0,
                l = 0;
              l < o;
              l++
            )
              for (var f = 0; f < a; f++)
                (u = (s = e + (a + 1) * l + f) + 1),
                  (c = (h = s + a + 1) + 1),
                  n.push(s, h, c),
                  n.push(s, c, u)
            return n
          }),
          (r.linerInterpolate = function (t, e, n) {
            var r = []
            if (n <= 0) r.push(t)
            else for (var i = (e - t) / n, o = 0; o <= n; o++) r[o] = t + i * o
            return r
          }),
          (r.calculateUVCoordinate = function (t, e, n) {
            for (
              var i,
                o = t.camera,
                a = t.panoWidth,
                s = t.panoHeight,
                u = t.vanishPointDeltaX,
                h = t.vanishPointDeltaY,
                c = [],
                l = e.width,
                f = e.height,
                d = 0,
                p = 0,
                v = n.length / 3,
                m = 0;
              m < v;
              m++
            )
              $e(
                (i = Ne(n[3 * m], n[3 * m + 1], n[3 * m + 2], 1)),
                i,
                o.viewMatrix
              ),
                $e(i, i, o.projectionMatrix),
                (i[0] = i[0] / i[3]),
                (i[1] = i[1] / i[3]),
                (i[2] = i[2] / i[3]),
                (i[3] = 1),
                (d = (i[0] * a * 0.5 + u + 0.5 * l) / l),
                (p = (i[1] * s * 0.5 + h + 0.5 * f) / f),
                c.push(r.getValidateUV(d), r.getValidateUV(p))
            return new Float32Array(c)
          }),
          (r.getValidateUV = function (t) {
            return Math.max(-0.1, Math.min(1.1, t))
          }),
          (r.rotationMatrix = ue()),
          (r.camera = e.camera),
          e.isMovingForward)
        )
          xe(
            r.rotationMatrix,
            r.rotationMatrix,
            g(_(-e.traverseDir + e.panoData.heading))
          )
        else {
          var i = _(180 - e.traverseDir + e.panoData.heading)
          xe(r.rotationMatrix, r.rotationMatrix, g(i))
        }
        r.cuboidVertexes = r.createSkeleton(e)
        var o = r.modelSkeleton(r.cuboidVertexes, r.rotationMatrix),
          a = Wr(o, 2),
          s = a[0],
          u = a[1]
        return (
          (r.verticesBufferData = new Float32Array(s)),
          (r.indicesBufferData = new Uint16Array(u)),
          (r.uvtsBufferData = r.calculateUVCoordinate(
            e,
            n,
            s,
            r.rotationMatrix
          )),
          r.setAttribute('position', new pr(r.verticesBufferData, 3)),
          r.setAttribute('uv', new pr(r.uvtsBufferData, 2)),
          r.setIndexes(r.indicesBufferData),
          r
        )
      }
      return c(e, t), e
    })(gr),
    mo = [0, 1, 0, 0.5],
    go = (function () {
      function t(t, e, n, r, i) {
        var o = this
        ;(this.start = function () {
          o.animation.start(),
            o._pano.dispatchEvent({
              debug: !0,
              log: '淡出动画，渲染一帧',
              type: d.REFRESH,
            })
        }),
          (this.update = function () {
            o.animation.update()
          }),
          (this._pano = t),
          (this.distance = e),
          (this.handleEnd = i),
          (this.traverseDir = r),
          (this.snapshot = n),
          (this.camera = t.camera),
          (this.scene = this.initScene()),
          (this.rotationMatrix = this.traverseGeometry.rotationMatrix),
          this.initAni()
      }
      var e = t.prototype
      return (
        (e.initAni = function () {
          var t = this,
            e = xt(0, 0, this.distance)
          Lt(e, e, this.rotationMatrix),
            (this.animation = new Oi(0, 1, 700, Ii.linear)
              .onUpdate(function (n) {
                var r = gt()
                At(r, e, n),
                  t.scene.traverse(function (t) {
                    ;(t.position = r), t.updateWorldMatrix(!0)
                  }),
                  t._pano.dispatchEvent({
                    debug: !0,
                    type: d.REFRESH,
                    log: '[Refresh Log] 前进动画， 渲染一帧',
                  })
              })
              .onEnd(function () {
                t.handleEnd && t.handleEnd(),
                  t._pano.dispatchEvent({
                    debug: !0,
                    type: d.REFRESH,
                    log: '[Refresh Log] 前进动画， 渲染一帧',
                  })
              }))
        }),
        (e.initScene = function () {
          var t = new Mr(),
            e = this._pano.getContainerSize(),
            n = e.width,
            r = e.height,
            i = new co(this._pano, this.traverseDir),
            o = new ho(0, 0, n, r),
            a = new vo(i, o),
            s = this.initMaterial(),
            u = new br(a, s)
          return (this.traverseGeometry = a), t.add(u), t
        }),
        (e.initMaterial = function () {
          var t = new Kr()
          return (
            (t.depthTest = !1),
            (t.vertexShader = Ki),
            (t.fragmentShader = Qi),
            (t.uniforms = {
              uSampler: { type: 't', value: this.snapshot },
              uOpacity: { type: '1f', value: 1 },
              vColor: { type: '4f', value: mo },
              showDebugLine: { type: '1i', value: true },
            }),
            (this.material = t),
            t
          )
        }),
        t
      )
    })(),
    yo = (function () {
      function t() {
        var t =
            arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
          e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0
        ;(this.x = t), (this.y = e)
      }
      return (
        (t.prototype.equals = function (t) {
          return t && t.x === this.x && t.y === this.y
        }),
        t
      )
    })(),
    _o = (function () {
      function t(t, e) {
        var n = this
        ;(this.setData = function (t, e) {
          ;(n.panoData = t), (n.nextPanoData = e)
        }),
          (this.sceneChangeHandler = function () {
            if (n.panoData && n.nextPanoData)
              return new Promise(function (t) {
                var e = n.isStreet(n.panoData.panoType),
                  r = n.isStreet(n.nextPanoData.panoType),
                  i = n.snapshotFn(),
                  o = n.pano.animationType
                if (o && ['waterwave', 'fade'].indexOf(o) > -1)
                  switch (o) {
                    case 'waterwave':
                      n.prepareWaterWave(i), t()
                      break
                    case 'fade':
                      n.prepareFade(i), t()
                  }
                else
                  r && e
                    ? (n.setDir(),
                      n.prepareTraverse(i).then(function (e) {
                        n.prepareFade(e), t()
                      }))
                    : (n.prepareFade(i), t())
              })
          }),
          (this.setSnapshot = function (t) {
            n.snapshot = t
          }),
          (this.pano = t),
          (this.snapshotFn = e),
          (this.panoData = null),
          (this.nextPanoData = null),
          (this.changeAni = null),
          (this.animateDir = 0)
      }
      var e = t.prototype
      return (
        (e.draw = function () {
          if (this.changeAni) {
            var t = this.changeAni,
              e = t.scene,
              n = t.camera
            this.changeAni.update(), this.pano.renderer.render(e, n)
          }
        }),
        (e.setDir = function () {
          if (this.panoData && this.nextPanoData) {
            var t = this.nextPanoData.panoId,
              e = this.panoData.getTopos().filter(function (e) {
                return e && e.panoId === t
              })
            if (e.length) {
              var n = e[0].topoDir
              this.animateDir = n
            } else this.animateDir = this.pano.getPov().heading || 0
          }
        }),
        (e.prepareJump = function () {
          var t = this,
            e = this.calcJumpDistance()
          return new Promise(function (n) {
            ;(t.changeAni = new uo(t.pano, t.animateDir, e, function () {
              ;(t.changeAni = null), n()
            })),
              t.changeAni.startAni(),
              t.pano.dispatchEvent({
                debug: !0,
                log: '穿梭动画，渲染一帧',
                type: d.REFRESH,
              })
          })
        }),
        (e.prepareTraverse = function (t) {
          var e = this,
            n = this.calcJumpDistance()
          return new Promise(function (r) {
            ;(e.changeAni = new go(e.pano, n, t, e.animateDir, function () {
              var t = e.snapshotFn(e.changeAni.scene, e.changeAni.camera)
              r(t), (e.changeAni = null)
            })),
              e.changeAni.start(),
              e.pano.dispatchEvent({
                debug: !0,
                log: '穿梭动画，渲染一帧',
                type: d.REFRESH,
              })
          })
        }),
        (e.prepareFade = function (t) {
          var e = this
          this.changeAni = new ao(this.pano, t, function () {
            ;(e.changeAni = null), e.pano.emit(d.SCENE_CHANGE_END)
          })
        }),
        (e.prepareWaterWave = function (t) {
          var e = this
          this.changeAni = new so(this.pano, t, function () {
            ;(e.changeAni = null), e.pano.emit(d.SCENE_CHANGE_END)
          })
        }),
        (e.calcJumpDistance = function () {
          var t,
            e,
            n = 300,
            r =
              ((t = new yo(this.panoData.panoX, this.panoData.panoY)),
              (e = new yo(this.nextPanoData.panoX, this.nextPanoData.panoY)),
              t && e
                ? Math.round(
                    Math.sqrt(Math.pow(t.x - e.x, 2) + Math.pow(t.y - e.y, 2))
                  )
                : 0)
          'number' == typeof r && (n *= Math.pow(r, 1 / 4))
          return n
        }),
        (e.isStreet = function (t) {
          return t === p.TYPE_STREET
        }),
        t
      )
    })(),
    xo = (function () {
      function t(t, e) {
        var n = e.fov,
          r = void 0 === n ? 145 : n,
          i = e.cameraY,
          o = void 0 === i ? 3e3 : i,
          a = e.handleEnd
        ;(this._pano = void 0),
          (this.originFov = void 0),
          (this.originRotateX = void 0),
          (this.originRotateY = void 0),
          (this.targetFov = void 0),
          (this.targetCameraY = void 0),
          (this.handleEnd = void 0),
          (this.animate = void 0),
          (this._pano = t),
          (this.originFov = this.camera.fov),
          (this.originRotateX = this.camera.rotation.x),
          (this.originRotateY = this.camera.rotation.y),
          (this.targetFov = r),
          (this.targetCameraY = o),
          (this.handleEnd = a),
          this.init()
      }
      var e = t.prototype
      return (
        (e.start = function () {
          this._pano.dispatchEvent({
            type: d.REFRESH,
            debug: !0,
            log: '开场动画动画起始，渲染一帧',
          }),
            this.animate.start()
        }),
        (e.update = function () {
          this.animate.update()
        }),
        (e.init = function () {
          var t = this,
            e = this.camera
          this.handleCameraChange(0),
            (this.animate = new Oi(0, 1, p.FISHEYE_DURATION, Ii.easeInOutQuad)
              .onUpdate(function (e) {
                t.handleCameraChange(e),
                  t._pano.dispatchEvent({
                    type: d.REFRESH,
                    debug: !0,
                    log: '开场动画动画，渲染一帧',
                  })
              })
              .onEnd(function () {
                ;(e.fov = t.originFov),
                  e.rotateX(t.originRotateX),
                  e.rotateY(t.originRotateY),
                  e.setPosition(0, 0, 0),
                  e.updateWorldMatrix(),
                  e.updateProjectionMatrix(),
                  t._pano.dispatchEvent({
                    type: d.REFRESH,
                    debug: !0,
                    log: '开场动画动画结束，渲染一帧',
                  }),
                  t.handleEnd()
              }))
        }),
        (e.handleCameraChange = function (t) {
          var e = this.camera,
            n = this.targetCameraY,
            r = this.targetFov - (this.targetFov - this.originFov) * t,
            i = (this.originRotateX - -90) * t - 90,
            o = this.originRotateY * t
          ;(e.fov = r),
            e.rotateX(i),
            e.rotateY(o),
            e.setPosition(0, n - n * t, 0),
            e.updateWorldMatrix(),
            e.updateProjectionMatrix()
        }),
        o(t, [
          {
            key: 'camera',
            get: function () {
              return this._pano.camera
            },
          },
        ]),
        t
      )
    })()
  function bo(t, e) {
    var n =
      ('undefined' != typeof Symbol && t[Symbol.iterator]) || t['@@iterator']
    if (!n) {
      if (
        Array.isArray(t) ||
        (n = (function (t, e) {
          if (!t) return
          if ('string' == typeof t) return Mo(t, e)
          var n = Object.prototype.toString.call(t).slice(8, -1)
          'Object' === n && t.constructor && (n = t.constructor.name)
          if ('Map' === n || 'Set' === n) return Array.from(t)
          if (
            'Arguments' === n ||
            /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)
          )
            return Mo(t, e)
        })(t)) ||
        (e && t && 'number' == typeof t.length)
      ) {
        n && (t = n)
        var r = 0,
          i = function () {}
        return {
          s: i,
          n: function () {
            return r >= t.length ? { done: !0 } : { done: !1, value: t[r++] }
          },
          e: function (t) {
            throw t
          },
          f: i,
        }
      }
      throw new TypeError(
        'Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.'
      )
    }
    var o,
      a = !0,
      s = !1
    return {
      s: function () {
        n = n.call(t)
      },
      n: function () {
        var t = n.next()
        return (a = t.done), t
      },
      e: function (t) {
        ;(s = !0), (o = t)
      },
      f: function () {
        try {
          a || null == n.return || n.return()
        } finally {
          if (s) throw o
        }
      },
    }
  }
  function Mo(t, e) {
    ;(null == e || e > t.length) && (e = t.length)
    for (var n = 0, r = new Array(e); n < e; n++) r[n] = t[n]
    return r
  }
  var Eo = (function () {
    function t(t) {
      var e = this
      ;(this.name = 'PanoOverlayManager'),
        (this.overlays = []),
        (this.pano = void 0),
        (this.isReady = !1),
        (this.clickChecker = function (t, n) {
          var r,
            i = !0,
            o = bo(e.overlays)
          try {
            for (o.s(); !(r = o.n()).done; ) {
              var a = r.value,
                s = a.dom.getBoundingClientRect(),
                u = s.left,
                h = s.right,
                c = s.top,
                l = s.bottom
              if (t >= u && t <= h && n >= c && n <= l) {
                ;(i = !1), a.handleClick()
                break
              }
            }
          } catch (t) {
            o.e(t)
          } finally {
            o.f()
          }
          return i
        }),
        (this.pano = t)
    }
    var e = t.prototype
    return (
      (e.handleAdd = function (t) {
        t &&
          t.id &&
          (this.overlays.some(function (e) {
            return e.id === t.id
          }) ||
            (this.overlays.push(t), this.isReady && t.init(this.pano)))
      }),
      (e.handleRemove = function (t) {
        for (var e = 0; e < this.overlays.length; e++)
          if (this.overlays[e].id === t.id)
            return this.overlays[e].remove(), void this.overlays.splice(e, 1)
      }),
      (e.init = function () {
        this.isReady = !0
        var t,
          e = bo(this.overlays)
        try {
          for (e.s(); !(t = e.n()).done; ) {
            t.value.init(this.pano)
          }
        } catch (t) {
          e.e(t)
        } finally {
          e.f()
        }
      }),
      (e.draw = function () {
        if (this.isReady) {
          var t,
            e = bo(this.overlays)
          try {
            for (e.s(); !(t = e.n()).done; ) {
              t.value.draw()
            }
          } catch (t) {
            e.e(t)
          } finally {
            e.f()
          }
        }
      }),
      (e.destroy = function () {
        var t,
          e = bo(this.overlays)
        try {
          for (e.s(); !(t = e.n()).done; ) {
            t.value.remove()
          }
        } catch (t) {
          e.e(t)
        } finally {
          e.f()
        }
        this.overlays = []
      }),
      t
    )
  })()
  function wo(t, e) {
    var n =
      ('undefined' != typeof Symbol && t[Symbol.iterator]) || t['@@iterator']
    if (!n) {
      if (
        Array.isArray(t) ||
        (n = (function (t, e) {
          if (!t) return
          if ('string' == typeof t) return To(t, e)
          var n = Object.prototype.toString.call(t).slice(8, -1)
          'Object' === n && t.constructor && (n = t.constructor.name)
          if ('Map' === n || 'Set' === n) return Array.from(t)
          if (
            'Arguments' === n ||
            /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)
          )
            return To(t, e)
        })(t)) ||
        (e && t && 'number' == typeof t.length)
      ) {
        n && (t = n)
        var r = 0,
          i = function () {}
        return {
          s: i,
          n: function () {
            return r >= t.length ? { done: !0 } : { done: !1, value: t[r++] }
          },
          e: function (t) {
            throw t
          },
          f: i,
        }
      }
      throw new TypeError(
        'Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.'
      )
    }
    var o,
      a = !0,
      s = !1
    return {
      s: function () {
        n = n.call(t)
      },
      n: function () {
        var t = n.next()
        return (a = t.done), t
      },
      e: function (t) {
        ;(s = !0), (o = t)
      },
      f: function () {
        try {
          a || null == n.return || n.return()
        } finally {
          if (s) throw o
        }
      },
    }
  }
  function To(t, e) {
    ;(null == e || e > t.length) && (e = t.length)
    for (var n = 0, r = new Array(e); n < e; n++) r[n] = t[n]
    return r
  }
  var Ao = (function () {
      function t(t) {
        var e = this
        ;(this.renderer = void 0),
          (this.gl = void 0),
          (this.camera = void 0),
          (this.cameraNoFix = null),
          (this.panoData = null),
          (this.scene = void 0),
          (this.sceneChange = void 0),
          (this.openingAni = void 0),
          (this.sphereRender = void 0),
          (this.linkGLRender = void 0),
          (this.overlayManager = void 0),
          (this.skyboxRender = void 0),
          (this.pano = void 0),
          (this.renderThreadId = null),
          (this.requestId = null),
          (this.isRAFRuning = !1),
          (this.setData = (function () {
            var t = L(
              B.mark(function t(n) {
                var r, o
                return B.wrap(function (t) {
                  for (;;)
                    switch ((t.prev = t.next)) {
                      case 0:
                        if (n) {
                          t.next = 2
                          break
                        }
                        return t.abrupt('return')
                      case 2:
                        if (!e.panoData || !e.pano.useAnimation) {
                          t.next = 8
                          break
                        }
                        return (
                          e.sceneChange.setData(e.panoData, n),
                          (t.next = 6),
                          e.sceneChange.sceneChangeHandler()
                        )
                      case 6:
                        void 0 !== e.pano.backupUseAnimation &&
                          (e.pano.useAnimation = e.pano.backupUseAnimation),
                          (e.pano.animationType = '')
                      case 8:
                        e.reset(),
                          (e.panoData = n),
                          (e.pano.panoData = n),
                          (void 0 === i(n.defaultHeading) &&
                            void 0 === i(n.defaultPitch)) ||
                            e.pano.handlePovChange({
                              heading: n.defaultHeading,
                              pitch: n.defaultPitch,
                            }),
                          (r = n.image && 6 === n.image.length),
                          (o = r ? e.skyboxRender : e.sphereRender).setData(n),
                          e.linkGLRender.setData(n),
                          e.overlayManager.init(),
                          e.scene.add(o.meshs),
                          e.updateProjectionMatrix(e.camera),
                          e.updateCameraHeadingAndPitch(e.camera)
                      case 20:
                      case 'end':
                        return t.stop()
                    }
                }, t)
              })
            )
            return function (e) {
              return t.apply(this, arguments)
            }
          })()),
          (this.getSnapshot = function (t, n) {
            ;(t = t || e.scene), (n = n || e.camera)
            var r = e.pano.getContainerSize(),
              i = r.width,
              o = r.height,
              a = new di(i, o)
            return (a.premultiplyAlpha = !0), e.renderer.render(t, n, a), a
          }),
          (this.update = function () {
            e.panoData &&
              (e.sphereRender.update(),
              e.linkGLRender.update(),
              e.startRenderThread())
          }),
          (this.onThumbLoaded = function () {
            e.sceneChange.changeAni && e.sceneChange.changeAni.start()
            var t = e.linkGLRender.meshs
            t && e.scene.add(t), e.startFishEyeAni()
          }),
          (this.startRenderThread = function () {
            var t =
              arguments.length > 0 && void 0 !== arguments[0]
                ? arguments[0]
                : 100
            e.renderThreadId &&
              (clearTimeout(e.renderThreadId), (e.renderThreadId = null)),
              (e.renderThreadId = window.setTimeout(function () {
                ;(e.isRAFRuning = !1), (e.renderThreadId = null)
              }, t)),
              e.isRAFRuning || ((e.isRAFRuning = !0), e.renderFrame())
          }),
          (this.resize = function () {
            var t = e.pano.getContainer()
            e.renderer.setSize(t.clientWidth, t.clientHeight)
          })
        var n = window.devicePixelRatio || 1,
          r = t.getContainer()
        ;(this.pano = t),
          (this.renderer = new ui({
            premultipliedAlpha: !1,
            preserveDrawingBuffer: t.opts.enableCapture || !1,
            antialias: !(n > 1),
            pixelRatio: n,
            width: r.clientWidth,
            height: r.clientHeight,
          })),
          this.renderer.setSize(r.clientWidth, r.clientHeight),
          t.getPanes().tileLayer.appendChild(this.renderer.domElement),
          (this.gl = this.renderer.getContext()),
          (this.camera = new bi(
            75,
            r.clientWidth / r.clientHeight,
            0.01,
            67e3
          )),
          (this.scene = new Mr()),
          (t.gl = this.gl),
          (t.canvas = this.renderer.domElement),
          (t.scene = this.scene),
          (t.camera = this.camera),
          (t.cameraNoFix = this.cameraNoFix),
          (t.renderer = this.renderer),
          (t.renders = []),
          (this.sceneChange = new _o(t, this.getSnapshot)),
          this.initModule()
      }
      var e = t.prototype
      return (
        (e.initModule = function () {
          var t = this.pano
          ;(this.sphereRender = new $i(t)),
            (this.linkGLRender = new oo(t)),
            (this.overlayManager = new Eo(t)),
            (this.skyboxRender = new Ai(t)),
            this.pano.renders.push(
              this.sphereRender,
              this.linkGLRender,
              this.overlayManager,
              this.skyboxRender
            )
        }),
        (e.reset = function () {
          this.scene.remove(this.sphereRender.meshs),
            this.scene.remove(this.linkGLRender.meshs)
        }),
        (e.getModule = function (t) {
          var e,
            n = null,
            r = wo(this.pano.renders)
          try {
            for (r.s(); !(e = r.n()).done; ) {
              var i = e.value
              if (i.name === t) {
                n = i
                break
              }
            }
          } catch (t) {
            r.e(t)
          } finally {
            r.f()
          }
          return n
        }),
        (e.renderFrame = function () {
          !1 !== this.isRAFRuning
            ? (this.openingAni && this.openingAni.update(),
              this.sphereRender.draw(),
              this.renderer.render(this.scene, this.camera),
              this.overlayManager.draw(),
              this.sceneChange.draw(),
              (this.requestId = requestAnimationFrame(
                this.renderFrame.bind(this)
              )))
            : this.requestId &&
              (cancelAnimationFrame(this.requestId), (this.requestId = null))
        }),
        (e.startFishEyeAni = function () {
          var t = this
          this.pano.fisheye &&
            ((this.openingAni = new xo(this.pano, {
              handleEnd: function () {
                ;(t.openingAni = null), (t.pano.fisheye = !1)
              },
            })),
            setTimeout(function () {
              t.openingAni.start(), t.startRenderThread()
            }, p.FISHEYE_DELAY))
        }),
        (e.updateProjectionMatrix = function (t, e) {
          var n = this.pano.getFov(e),
            r = this.pano.getContainerSize(),
            i = r.width / r.height
          ;(t.fov = n), (t.aspect = i), t.updateProjectionMatrix()
        }),
        (e.updateCameraHeadingAndPitch = function (t) {
          var e = this.pano.getPov(),
            n = e.heading,
            r = e.pitch,
            i = this.panoData,
            o = i.fixHeading,
            a = void 0 === o ? 0 : o,
            s = i.fixPitch,
            u = void 0 === s ? 0 : s,
            h = i.fixRoll,
            c = void 0 === h ? 0 : h
          t.rotateX(r - u),
            t.rotateY(-n + a),
            t.rotateZ(c),
            t.updateWorldMatrix()
        }),
        (e.safeCall = function (t, e, n) {
          var r = this.getModule(t)
          if (r && r[e]) return r[e].apply(r, n || [])
          throw new Error('[safeCall] get module error => '.concat(t))
        }),
        o(t, [
          {
            key: 'isCanUpdate',
            get: function () {
              var t = this.sceneChange.changeAni,
                e = this.openingAni
              return this.panoData && !(t || e)
            },
          },
        ]),
        t
      )
    })(),
    Ro = (function () {
      function t(t) {
        var e = this
        ;(this.updateAnglePerPixel = function () {
          e._anglePerPixel = e._pano.calcAnglePerPixel()
        }),
          (this.destroy = function () {
            e.bindEvent(!1)
          }),
          (this._pano = t),
          (this._displayZoom = t.getZoom()),
          (this._anglePerPixel = t.calcAnglePerPixel()),
          (this.lock = !1),
          (this.clickTimer = null),
          (this.dragAni = null),
          (this.state = {
            initPos: null,
            initHeading: 0,
            initPitch: 0,
            lastDiffPos: null,
            moveDiffPos: null,
            isTouchDown: !1,
            isTouchMove: !1,
            startTime: 0,
            lastMoveTime: 0,
          })
      }
      var e = t.prototype
      return (
        (e.init = function () {
          this._initialized ||
            ((this._initialized = !0),
            (this.isMobile = navigator.userAgent
              .toLowerCase()
              .match(/ipod|ipad|iphone|android/)),
            this.isMobile
              ? ((this.EVENTS = {
                  START: 'touchstart',
                  MOVING: 'touchmove',
                  END: 'touchend',
                  OUT: 'touchcancel',
                  WHEEL: 'gesturechange',
                  DOMMouseScroll: 'DOMMouseScroll',
                }),
                (this.getPagePosition = function (t) {
                  var e =
                    t.touches.length > 0 ? t.touches[0] : t.changedTouches[0]
                  return { x: e.pageX, y: e.pageY }
                }))
              : ((this.EVENTS = {
                  START: 'mousedown',
                  MOVING: 'mousemove',
                  END: 'mouseup',
                  OUT: 'mouseout',
                  WHEEL: 'mousewheel',
                }),
                (this.getPagePosition = function (t) {
                  return { x: t.pageX, y: t.pageY }
                })),
            this.bindEvent())
        }),
        (e.bindEvent = function () {
          var t =
              !(arguments.length > 0 && void 0 !== arguments[0]) ||
              arguments[0],
            e = document.body,
            n = this.EVENTS,
            r = n.START,
            i = n.MOVING,
            o = n.END,
            a = this._pano._svContainer,
            s = t ? 'addEventListener' : 'removeEventListener'
          a[s](r, this.handleDown.bind(this)),
            a[s](i, this.handleMove.bind(this)),
            e[s](o, this.handleUp.bind(this))
        }),
        (e.handleDown = function (t) {
          this.dragAni && this.dragAni.stop()
          var e = this.state,
            n = this.getPagePosition(t),
            r = this._pano.getPov()
          ;(e.initPos = n),
            (e.isTouchDown = !0),
            (e.initHeading = r.heading),
            (e.initPitch = r.pitch),
            (e.startTime = x()),
            this._pano.dispatchEvent(d.TOUCH_START, t)
        }),
        (e.handleMove = function (t) {
          if (this.state.isTouchDown) {
            this.state.isTouchMove = !0
            var e = this.calcDiffPos(
              this.state.initPos,
              this.getPagePosition(t)
            )
            this.setPov(e),
              (this.state.moveDiffPos = e),
              (this.state.lastDiffPos = e),
              (this.state.lastMoveTime = x()),
              t.preventDefault(),
              t.stopPropagation()
          }
        }),
        (e.handleUp = function (t) {
          var e = this
          if (this.state.isTouchDown) {
            var n = !0,
              r = this.getPagePosition(t)
            if (
              ((t.pos = r),
              (this.state.isTouchDown = !1),
              this._pano.dispatchEvent(d.TOUCH_END, t),
              this._pano.renders.length)
            )
              for (var i = 0; i < this._pano.renders.length; i++) {
                var o = this._pano.renders[i]
                if (o.clickChecker && !(n = o.clickChecker(r.x, r.y))) {
                  t.stopPropagation()
                  break
                }
              }
            if (!1 !== n)
              if (this.state.isTouchMove)
                (this.state.isTouchMove = !1), this.processMotion(t)
              else if ((t.stopPropagation(), this.clickTimer))
                clearTimeout(this.clickTimer),
                  (this.clickTimer = null),
                  this._pano.dispatchEvent(d.DOUBLE_CLICK, t)
              else {
                this.clickTimer = setTimeout(function () {
                  ;(e.clickTimer = null), e._pano.dispatchEvent(d.CLICK, t)
                }, 300)
              }
          }
        }),
        (e.setPov = function (t) {
          var e = t.x,
            n = t.y,
            r = -e * this._anglePerPixel,
            i = n * this._anglePerPixel,
            o = this.state.initHeading + r,
            a = this.state.initPitch + i
          this._pano.setPov({ heading: o, pitch: a })
        }),
        (e.processMotion = function (t) {
          var e = this,
            n = this.state,
            r = x(),
            i = r - n.lastMoveTime,
            o = n.moveDiffPos,
            a = o.x,
            s = o.y
          if (i < 300 && (Math.abs(a) > 10 || Math.abs(s) > 10)) {
            var u = this.calcDiffPos(
                this.state.initPos,
                this.getPagePosition(t)
              ),
              h =
                (2 * Math.sqrt(Math.pow(u.x, 2) + Math.pow(u.y, 2))) /
                (0.008 * (r - n.startTime)),
              c = [u.x > 0 ? 1 : -1, u.y > 0 ? 1 : -1],
              l = Math.abs(u.x),
              f = Math.abs(u.y),
              p = Math.atan2(f, l),
              v = Math.cos(p) * h,
              m = Math.sin(p) * h
            ;-1 === c[0] && (v = -v),
              -1 === c[1] && (m = -m),
              this.dragAni && this.dragAni.stop()
            var g = this._pano.getPov(),
              y = g.heading,
              _ = g.pitch
            ;(n.initHeading = y), (n.initPitch = _)
            this.dragAni = new Oi(0, 1, 400, function (t) {
              return 0.3125 * t - 0.15625 * t * t
            })
              .onUpdate(function (t) {
                var n = (t *= 6.4) * v,
                  r = t * m
                e.setPov({ x: n, y: r })
              })
              .onEnd(function () {
                ;(e.dragAni = null),
                  e._pano.dispatchEvent({ type: d.POV_CHANGED_END })
              })
              .startAndAutoUpdate()
          } else this._pano.dispatchEvent({ type: d.POV_CHANGED_END })
        }),
        (e.calcDiffPos = function (t, e) {
          return t && e ? { x: e.x - t.x, y: e.y - t.y } : { x: 0, y: 0 }
        }),
        t
      )
    })()
  function Co(t, e) {
    var n =
      ('undefined' != typeof Symbol && t[Symbol.iterator]) || t['@@iterator']
    if (!n) {
      if (
        Array.isArray(t) ||
        (n = (function (t, e) {
          if (!t) return
          if ('string' == typeof t) return So(t, e)
          var n = Object.prototype.toString.call(t).slice(8, -1)
          'Object' === n && t.constructor && (n = t.constructor.name)
          if ('Map' === n || 'Set' === n) return Array.from(t)
          if (
            'Arguments' === n ||
            /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)
          )
            return So(t, e)
        })(t)) ||
        (e && t && 'number' == typeof t.length)
      ) {
        n && (t = n)
        var r = 0,
          i = function () {}
        return {
          s: i,
          n: function () {
            return r >= t.length ? { done: !0 } : { done: !1, value: t[r++] }
          },
          e: function (t) {
            throw t
          },
          f: i,
        }
      }
      throw new TypeError(
        'Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.'
      )
    }
    var o,
      a = !0,
      s = !1
    return {
      s: function () {
        n = n.call(t)
      },
      n: function () {
        var t = n.next()
        return (a = t.done), t
      },
      e: function (t) {
        ;(s = !0), (o = t)
      },
      f: function () {
        try {
          a || null == n.return || n.return()
        } finally {
          if (s) throw o
        }
      },
    }
  }
  function So(t, e) {
    ;(null == e || e > t.length) && (e = t.length)
    for (var n = 0, r = new Array(e); n < e; n++) r[n] = t[n]
    return r
  }
  var Po = (function () {
    function t(t) {
      ;(this.pano = t),
        (this.preZoom = t.getZoom()),
        (this.zoomChangeAni = null),
        (this.debug = !1),
        (this.panoServiceLock = !1),
        this.bindEvent(),
        this.initModule(),
        this.initResize(),
        this.handleContextStatus()
    }
    var e = t.prototype
    return (
      (e.initModule = function () {
        var t = this.pano
        ;(this.panoService = new D(t)),
          (this.panoGLRender = new Ao(t)),
          (this.op = new Ro(t))
      }),
      (e.initResize = function () {
        var t = this,
          e = this.pano.getContainerSize(),
          n = this.pano.getContainer(),
          r = function (n, r) {
            if (n && r) {
              var i = new l(n, r)
              i.equals(e) ||
                (t.pano.dispatchEvent({ type: d.SIZE_CHANGED }), (e = i))
            }
          }
        if (void 0 !== window.ResizeObserver) {
          var i = new window.ResizeObserver(function (t) {
            var e,
              n = Co(t)
            try {
              for (n.s(); !(e = n.n()).done; ) {
                var i = e.value.target
                r(i.clientWidth, i.clientHeight)
              }
            } catch (t) {
              n.e(t)
            } finally {
              n.f()
            }
          })
          i.observe(n), (this.resizeOb = i)
        } else
          this.checkSizeTimer = setInterval(function () {
            r(n.clientWidth, n.clientHeight)
          }, 80)
      }),
      (e.bindEvent = function () {
        var t = this,
          e = this.pano
        e.on(d.PANO_ERROR, function () {
          t.panoServiceLock = !1
        }),
          e.on(d.DATA_LOADED, function (n) {
            t.pano.opts.visible ? t.pano.show() : t.pano.hide(),
              (t.panoServiceLock = !1),
              n.options &&
                n.options.animation &&
                ((e.backupUseAnimation = e.useAnimation),
                (e.useAnimation = n.options.animation),
                '' !== n.options.animationType &&
                  (e.animationType = n.options.animationType)),
              t.panoGLRender.setData(n.data),
              t.op.init()
          }),
          e.on(d.SET_POV, function (n) {
            var r = n.pov,
              i = n.options,
              o = (void 0 === i ? { animation: !0 } : i).animation
            if (t.panoGLRender.isCanUpdate) {
              var a = function (n) {
                e.handlePovChange(n) &&
                  (t.panoGLRender.updateCameraHeadingAndPitch(e.camera),
                  t.panoGLRender.update(),
                  e.dispatchEvent(d.POV_CHANGED, n))
              }
              if (o) {
                var s = e.getPov(),
                  u = s.heading,
                  h = s.pitch,
                  c = r.heading - u,
                  l = r.pitch - h
                c > 180
                  ? ((u += 360), (c = r.heading - u))
                  : c < -180 && ((u -= 360), (c = r.heading - u)),
                  new Oi(0, 1, 400, Ii['ease-out'])
                    .onUpdate(function (t) {
                      a({ heading: u + t * c, pitch: h + t * l })
                    })
                    .onEnd(function () {})
                    .startAndAutoUpdate()
              } else a(r)
            } else e.handlePovChange(r)
          }),
          e.on(d.ZOOM_CHANGED, function () {
            var n =
              arguments.length > 0 && void 0 !== arguments[0]
                ? arguments[0]
                : {}
            if (t.panoGLRender.isCanUpdate) {
              var r = t.preZoom,
                i = e.getZoom()
              if (r !== i) {
                var o = n.noAnimation || !1
                if (
                  (t.zoomChangeAni &&
                    (t.zoomChangeAni.stop(), (t.zoomChangeAni = null)),
                  o)
                )
                  return (
                    t.op.updateAnglePerPixel(),
                    t.panoGLRender.updateProjectionMatrix(e.camera),
                    t.panoGLRender.update(),
                    void (t.preZoom = i)
                  )
                var a = 400
                t.zoomChangeAni = new Oi(r, i, a, Ii.easeOutCubic)
                  .onUpdate(function (n) {
                    t.panoGLRender.updateProjectionMatrix(e.camera, n),
                      t.panoGLRender.update(n)
                  })
                  .onEnd(function () {
                    ;(t.zoomChangeAni = null), (t.preZoom = i)
                  })
                  .startAndAutoUpdate()
              }
            }
          }),
          e.on(d.DOUBLE_CLICK, function () {
            t.panoGLRender.isCanUpdate &&
              v.isMobile &&
              (3 === e.getZoom() ? e.setZoom(2) : e.setZoom(3))
          }),
          e.on(d.REFRESH, function (e) {
            var n = e.duration || 200
            t.panoGLRender.startRenderThread(n),
              t.debug && e.log && e.debug && console.warn(e.log)
          }),
          e.on(d.SET_ID, function (e) {
            !t.panoServiceLock &&
              e.id &&
              ((t.panoServiceLock = !0), t.panoService.getPanoById(e.id))
          }),
          e.on(d.SET_POSITION, function (e) {
            !t.panoServiceLock &&
              e.point &&
              ((t.panoServiceLock = !0),
              t.panoService.getPanoByLocation(e.point))
          }),
          e.on(d.SIZE_CHANGED, function () {
            t.op.updateAnglePerPixel(),
              t.panoGLRender.resize(),
              t.panoGLRender.updateProjectionMatrix(e.camera),
              t.panoGLRender.update()
          }),
          e.on(d.THUMB_LOADED, function () {
            t.panoGLRender.onThumbLoaded(), t.panoGLRender.update()
          }),
          e.on(d.OVERLAY_ADD, function (e) {
            t.panoGLRender.overlayManager.handleAdd(e)
          }),
          e.on(d.OVERLAY_REMOVE, function (e) {
            t.panoGLRender.overlayManager.handleRemove(e)
          }),
          e.on(d.OVERLAYS_CLEAR, function () {
            t.panoGLRender.overlayManager.destroy()
          }),
          e.on(d.LINK_VISIBLE_CHANGE, function (e) {
            'boolean' == typeof e.value &&
              (t.panoGLRender.safeCall('PanoLinkRender', 'setVisible', [
                e.value,
              ]),
              t.pano.dispatchEvent(d.REFRESH))
          }),
          e.on(d.DESTROY, function () {
            t.op.destroy(),
              t.resizeOb && t.resizeOb.disconnect(),
              t.checkSizeTimer && clearInterval(t.checkSizeTimer),
              t.panoGLRender.renderer.forceContextLoss(),
              e.canvas.removeEventListener(
                'webglcontextlost',
                t.onWebGLContextLost,
                !1
              )
          })
        var n = v.isFirefox ? 'DOMMouseScroll' : 'mousewheel',
          r = new Date()
        e._svContainer.addEventListener(n, function (t) {
          if (e.opts.enableScrollWheelZoom && e.opts.visible) {
            var n = new Date()
            if (n - r < 400) return
            r = n
            var i = -t.detail / 3 || t.wheelDelta / 120,
              o = e.getZoom() + i
            e.setZoom(o), t.preventDefault()
          }
        })
      }),
      (e.getImgZoom = function () {
        return this.pano.calcDisplayZoom().imgZoom
      }),
      (e.handleContextStatus = function () {
        this.pano.canvas.addEventListener(
          'webglcontextlost',
          this.onWebGLContextLost,
          !1
        )
      }),
      (e.onWebGLContextLost = function (t) {
        t.preventDefault(),
          setTimeout(function () {
            window.location.reload()
          }, 200)
      }),
      t
    )
  })()
  function Do(t, e, n) {
    t.addEventListener(e, n, !1)
  }
  var Io = (function (t) {
      function e(e, n) {
        var r
        ;((r = t.call(this) || this).panoData = null),
          (r.opts = void 0),
          (r.useAnimation = !1),
          (r.backupUseAnimation = r.useAnimation),
          (r.animationType = ''),
          (r.fisheye = !1),
          (r.canvas = void 0),
          (r.camera = void 0),
          (r.renderer = void 0),
          (r.gl = void 0),
          (r.scene = void 0),
          (r.cameraNoFix = void 0),
          (r.renders = void 0),
          (r.closeBtn = null),
          (r.navigator = null),
          (r._container = void 0),
          (r._pov = { heading: 0, pitch: 0 }),
          (r._id = null),
          (r._position = null),
          (r._zoom = 2),
          (r._displayZoomResultsCache = {}),
          (r._svContainer = void 0),
          (r._eventManager = void 0),
          (r._panes = void 0),
          (r.addCloseButton = function (t) {
            var e = (r.closeBtn = document.createElement('div'))
            ;(e.className = 'pano_close'),
              (e.style.cssText = [
                'position:absolute',
                'right:10px',
                'top:10px',
                'padding: 5px 8px;',
                'cursor:pointer',
                'border-radius: 4px',
                'font-size: 14px',
                'background-color: rgba(0,0,0,.55)',
                'z-index: 99',
                'color: #fff',
              ].join(';')),
              (e.innerText = '关闭'),
              (e.title = '退出全景'),
              (e.onclick = function () {
                r.hide(), t && t()
              }),
              r._svContainer.appendChild(e)
          }),
          (r.getContainer = function () {
            return r._container
          }),
          (r.getContainerSize = function () {
            var t = r._container
            return new l(t.clientWidth, t.clientHeight)
          }),
          (r.getPanes = function () {
            return r._panes
          }),
          (r.show = function () {
            ;(r.opts.visible = !0), E.show(r._svContainer)
          }),
          (r.hide = function () {
            ;(r.opts.visible = !1), E.hide(r._svContainer)
          }),
          (r.getZoom = function () {
            return r._zoom
          }),
          (r.setZoom = function (t) {
            var e =
              arguments.length > 1 && void 0 !== arguments[1]
                ? arguments[1]
                : {}
            t !== r._zoom &&
              (t > p.MAX_ZOOM && (t = p.MAX_ZOOM),
              t < p.MIN_ZOOM && (t = p.MIN_ZOOM),
              t !== r._zoom &&
                ((r._zoom = t),
                r.dispatchEvent(d.ZOOM_CHANGED, {
                  noAnimation: e.noAnimation || !1,
                })))
          }),
          (r.getPov = function () {
            return r._pov
          }),
          (r.setPov = function (t, e) {
            r.dispatchEvent(d.SET_POV, {
              pov: t,
              options: e || { animation: !1 },
            })
          }),
          (r.handlePovChange = function (t) {
            if ('object' === i(t)) {
              var e = !1,
                n = t.heading,
                o = t.pitch
              if (
                ('number' != typeof n ||
                  isNaN(n) ||
                  ((e = !0), (n = _(n)), (r._pov.heading = n)),
                'number' == typeof o && !isNaN(n))
              ) {
                e = !0
                var a = r.opts.minPitch,
                  s = r.opts.maxPitch
                o > s && (o = s), o < a && (o = a), (r._pov.pitch = o)
              }
              return e
            }
          }),
          (r.calcDisplayZoom = function (t, e) {
            ;(t = t || r.getContainerSize()), (e = e || r.getZoom())
            var n = t,
              i = n.width,
              o = n.height,
              a = r.opts.maxImageZoom,
              s = r.opts.minImageZoom,
              u = ''.concat(i, '_').concat(o, '_').concat(e)
            if (r._displayZoomResultsCache[u])
              return r._displayZoomResultsCache[u]
            for (
              var h = r.calcAnglePerPixel(),
                c = Math.floor(e) + 2,
                l = 360 / (2 * Math.pow(2, c - 2) * h);
              l > 512;

            )
              c++, (l = 360 / (2 * Math.pow(2, c - 2) * h))
            if (c > a) {
              var f = c - a
              ;(l *= Math.pow(2, f)), (c = a)
            }
            c < s && (c = s)
            var d = { imgZoom: c, displayTileSize: (l = Math.round(l)) }
            return (r._displayZoomResultsCache[u] = d), d
          }),
          (r.calcAnglePerPixel = function () {
            return r.getFov() / r.getContainerSize().height
          }),
          (r.getFov = function (t) {
            return (
              (t = t || r.getZoom()),
              (v.isMobile ? r.calcMobileFovy : r.calcPCFovy).call(a(r), t)
            )
          }),
          (r.getVisible = function () {
            return r.opts.visible
          }),
          (r.setId = function (t) {
            var e =
              arguments.length > 1 && void 0 !== arguments[1]
                ? arguments[1]
                : {}
            ;(r.useAnimation = e.animation || !1),
              (r.fisheye = e.fisheye || !1),
              (r.animationType = e.animationType || ''),
              r.dispatchEvent(d.SET_ID, { id: t })
          }),
          (r.setPosition = function (t) {
            var e =
              arguments.length > 1 && void 0 !== arguments[1]
                ? arguments[1]
                : {}
            ;(r.useAnimation = e.animation || !1),
              (r.fisheye = e.fisheye || !1),
              (r.animationType = e.animationType || ''),
              r.dispatchEvent(d.SET_POSITION, { point: t })
          })
        var o = {
          minImageZoom: p.TILE_MIN_ZOOM,
          maxImageZoom: p.TILE_MAX_ZOOM,
          minPitch: p.MIN_PITCH,
          maxPitch: p.MAX_PITCH,
          radius: p.RADIUS,
          tileBaseUrls: p.TILE_BASE_URLS,
          linksControl: !0,
          navigationControl: !0,
          enableScrollWheelZoom: !0,
          enableCapture: !1,
          visible: !0,
        }
        r.opts = Object.assign({}, o, n)
        var s = 'string' == typeof e ? document.querySelector(e) : e
        if (!s) throw new Error('全景引擎宿主容器不存在')
        return (r._container = s), r._init(), r
      }
      c(e, t)
      var n = e.prototype
      return (
        (n.getPosition = function () {
          return this.position
        }),
        (n.setOptions = function (t) {
          var e
          for (e in t)
            if (Object.prototype.hasOwnProperty.call(t, e)) {
              var n = !0
              if (
                ('object' !== i(t[e]) && (n = t[e] !== this.opts[e]),
                (this.opts[e] = t[e]),
                !n)
              )
                continue
              switch (e) {
                case 'linksControl':
                  this.dispatchEvent(d.LINK_VISIBLE_CHANGE, { value: t[e] })
                  break
                case 'navigationControl':
                  var r = !!t[e],
                    o = this.navigator
                  r ? o.show() : o.hide()
              }
            }
        }),
        (n.capture = function () {
          var t =
            arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {}
          if (this.canvas) {
            var e = this.canvas,
              n = t.quality || 0.8,
              r = t.type || 'image/jpeg',
              i = e.toDataURL(r, n)
            return i
          }
        }),
        (n.addOverlay = function (t) {
          this.dispatchEvent(d.OVERLAY_ADD, t)
        }),
        (n.removeOverlay = function (t) {
          this.dispatchEvent(d.OVERLAY_REMOVE, t)
        }),
        (n.clearOverlays = function () {
          this.dispatchEvent(d.OVERLAYS_CLEAR)
        }),
        (n.destroy = function () {
          this.dispatchEvent(d.DESTROY)
        }),
        (n._init = function () {
          this._createDoms(),
            (this.navigator = (function (t) {
              function e(t) {
                this._initialize(t)
              }
              return (
                m(e.prototype, {
                  _initialize: function (t) {
                    ;(this._pano = t),
                      (this.imgPath =
                        t.opts.imgPath || '//api0.map.bdimg.com/images/'),
                      (this._zoomInEnabled = !0),
                      (this._zoomOutEnabled = !0),
                      this._render(),
                      this._bind()
                  },
                  _render: function () {
                    this._container = E.create('div')
                    var t = this._container.style
                    ;(t.position = 'absolute'),
                      (t.left = '10px'),
                      (t.top = '10px'),
                      (t.zIndex = 99)
                    var e = this._container
                    ;(e.innerHTML = this._generateHtml()),
                      v.isPc
                        ? ((this._panBtnContainer = e.children[2]),
                          (this._panBtns = [
                            this._panBtnContainer.children[0],
                            this._panBtnContainer.children[1],
                            this._panBtnContainer.children[2],
                            this._panBtnContainer.children[3],
                          ]),
                          (this._svgDirGroup = e.children[1].childNodes[0]),
                          (this._zoomContainer = e.children[3]))
                        : v.isMobile && (this._zoomContainer = e.children[0]),
                      (this._btnZoomIn = this._zoomContainer.children[0]),
                      (this._btnZoomOut = this._zoomContainer.children[1]),
                      v.isMobile &&
                        ((this._zoomContainer.style.left =
                          this._zoomContainer.style.top =
                            '0'),
                        (this._zoomContainer.style.width = '36px'),
                        (this._zoomContainer.style.height = '78px'),
                        (this._btnZoomIn.style.width =
                          this._btnZoomOut.style.width =
                            '33px'),
                        (this._btnZoomIn.style.height =
                          this._btnZoomOut.style.height =
                            '36px'),
                        (this._btnZoomOut.style.top = '37.5px')),
                      this._pano.getZoom() >= p.MAX_ZOOM &&
                        this._setZoomBtnEnabled('zoomIn', !1),
                      this._pano.getZoom() <= p.MIN_ZOOM &&
                        this._setZoomBtnEnabled('zoomOut', !1),
                      this._pano._svContainer.appendChild(e)
                  },
                  _generateHtml: function () {
                    var t = []
                    return (
                      v.isPc &&
                        (t.push(this._generatePanHtml()),
                        t.push(this._generateDirHtml()),
                        t.push(this._generatePanBtnHtml())),
                      t.push(this._generateZoomContainerHtml()),
                      t.join('')
                    )
                  },
                  _generateDirHtml: function () {
                    return '<svg version="1.1" overflow="hidden" width="82px" height="82px" viewBox="0 0 82 82"style="position: absolute; top: 0px; left: 0px;"><g transform="rotate(0, 41, 41)"><rect x="33"y="1" width="14" height="12" rx="4" ry="4" stroke="#868685" stroke-width="1" fill="#f8f8f8"></rect><polyline points="37.5,9.5 37.5,3.5 42.5,9.5 42.5,3.5" stroke-linejoin="bevel" stroke-width="1.5" fill="#f2f4f6" stroke="#868685"></polyline></g></svg>'
                  },
                  _generatePanHtml: function () {
                    return (
                      '<div style="position:absolute;top:4px;left:4px;width:74px;height:74px;background:url(' +
                      this.imgPath +
                      'st-navictrl.png) no-repeat;-webkit-user-select:none;overflow:hidden"><div></div></div>'
                    )
                  },
                  _generatePanBtnHtml: function () {
                    return '<div style="position:absolute;top:0px;left:0;width:82px;height:82px;user-select:none;"><div style="position:absolute;left:32px;top:13px;cursor:pointer;width:17px;height:17px;" title="向上平移"></div><div style="position:absolute;left:14px;top:32px;cursor:pointer;width:17px;height:17px;" title="向左平移"></div><div style="position:absolute;left:51px;top:32px;cursor:pointer;width:17px;height:17px;" title="向右平移"></div><div style="position:absolute;left:33px;top:51px;cursor:pointer;width:17px;height:17px;" title="向下平移"></div></div>'
                  },
                  _generateZoomContainerHtml: function () {
                    var t =
                      "background-image:url('" +
                      this.imgPath +
                      "st-navictrl.png');background-repeat:no-repeat;background-position:-74px 0;"
                    return (
                      v.isMobile &&
                        (t =
                          "background-image:url('" +
                          this.imgPath +
                          "st-navictrl-hd.png');background-repeat:no-repeat;background-position:0 0;background-size:180px 78px;"),
                      '<div style="position:absolute;top:84px;left:30px;width:24px;height:52px;' +
                        t +
                        '-webkit-user-select:none;overflow:hidden"><div style="position:absolute;cursor:pointer;width:22px;height:24px;top:0;left:0;-webkit-user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)" title="放大一级"></div><div style="position:absolute;cursor:pointer;width:22px;height:24px;top:25px;left:0;-webkit-user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)" title="缩小一级"></div><div></div></div>'
                    )
                  },
                  _bind: function () {
                    var t = this._pano,
                      e = this
                    if (v.isPc) {
                      Do(this._panBtns[0], 'click', function () {
                        var e = t.getPov()
                        t.setPov(
                          { heading: e.heading, pitch: e.pitch + 30 },
                          { animation: !0 }
                        )
                      }),
                        Do(this._panBtns[1], 'click', function () {
                          var e = t.getPov()
                          t.setPov(
                            { heading: e.heading - 45, pitch: e.pitch },
                            { animation: !0 }
                          )
                        }),
                        Do(this._panBtns[2], 'click', function () {
                          var e = t.getPov()
                          t.setPov(
                            { heading: e.heading + 45, pitch: e.pitch },
                            { animation: !0 }
                          )
                        }),
                        Do(this._panBtns[3], 'click', function () {
                          var e = t.getPov()
                          t.setPov(
                            { heading: e.heading, pitch: e.pitch - 30 },
                            { animation: !0 }
                          )
                        })
                      for (var n = 0; n < this._panBtns.length; n++)
                        Do(this._panBtns[n], 'mousedown', function (t) {
                          t.stopPropagation()
                        })
                      ;(e._mousedown = !1),
                        Do(this._panBtnContainer, 'mousedown', function (n) {
                          ;(e._mousedown = !0),
                            (e._panBtnContainer.style.cursor = 'grabbing'),
                            (e._startHeading = e._calcAngle(n)),
                            (e._curHeading = t.getPov().heading),
                            n.preventDefault()
                        }),
                        Do(document, 'mousemove', function (n) {
                          e._mousedown &&
                            t.setPov({
                              heading:
                                e._curHeading +
                                360 -
                                (e._calcAngle(n) - e._startHeading),
                              pitch: t.getPov().pitch,
                            })
                        }),
                        Do(document, 'mouseup', function () {
                          e._mousedown &&
                            ((e._mousedown = !1),
                            (e._panBtnContainer.style.cursor = 'grab'),
                            (e._startHeading = null))
                        }),
                        t.addEventListener('position_changed', function () {
                          var t = 360 - this.getPov().heading
                          e._svgDirGroup.setAttribute(
                            'transform',
                            'rotate(' + t + ', 41, 41)'
                          )
                        }),
                        t.addEventListener('pov_changed', function () {
                          var t = 360 - this.getPov().heading
                          e._svgDirGroup.setAttribute(
                            'transform',
                            'rotate(' + t + ', 41, 41)'
                          )
                        })
                    }
                    Do(this._btnZoomIn, 'click', function () {
                      t.setZoom(t.getZoom() + 1)
                    }),
                      Do(this._btnZoomOut, 'click', function () {
                        t.setZoom(t.getZoom() - 1)
                      }),
                      v.isPc
                        ? (Do(this._btnZoomIn, 'mousedown', function () {
                            e._redrawZoomBtn(e._zoomInEnabled, -98)
                          }),
                          Do(this._btnZoomOut, 'mousedown', function () {
                            e._redrawZoomBtn(e._zoomOutEnabled, -122)
                          }),
                          Do(this._btnZoomIn, 'mouseup', function () {
                            e._redrawZoomBtn(e._zoomInEnabled, -74)
                          }),
                          Do(this._btnZoomOut, 'mouseup', function () {
                            e._redrawZoomBtn(e._zoomOutEnabled, -74)
                          }))
                        : v.isMobile &&
                          (Do(this._btnZoomIn, 'touchstart', function () {
                            e._redrawZoomBtn(e._zoomInEnabled, -98)
                          }),
                          Do(this._btnZoomOut, 'touchstart', function () {
                            e._redrawZoomBtn(e._zoomOutEnabled, -122)
                          }),
                          Do(this._btnZoomIn, 'touchend', function () {
                            e._redrawZoomBtn(e._zoomInEnabled, -74)
                          }),
                          Do(this._btnZoomOut, 'touchend', function () {
                            e._redrawZoomBtn(e._zoomOutEnabled, -74)
                          })),
                      t.addEventListener('zoom_changed', function (n) {
                        t.getZoom() >= p.MAX_ZOOM
                          ? e._setZoomBtnEnabled('zoomIn', !1)
                          : t.getZoom() <= p.MIN_ZOOM
                          ? e._setZoomBtnEnabled('zoomOut', !1)
                          : (e._setZoomBtnEnabled('zoomIn', !0),
                            e._setZoomBtnEnabled('zoomOut', !0))
                      })
                  },
                  _redrawZoomBtn: function (t, e) {
                    t &&
                      (v.isMobile && (e = ((e + 74) / 24) * 36),
                      (this._zoomContainer.style.backgroundPosition =
                        e + 'px 0'))
                  },
                  show: function () {
                    this._container.style.display = ''
                  },
                  hide: function () {
                    this._container.style.display = 'none'
                  },
                  _calcAngle: function (t) {
                    var e = (t = window.event || t).pageX || t.clientX,
                      n = t.pageY || t.clientY,
                      r = this._pano.getContainer().getBoundingClientRect()
                    ;(e = e - r.left - 50), (n = -(n - r.top - 50))
                    var i = (Math.atan2(n, e) / Math.PI) * 180
                    return i < 90 ? 90 - i : 450 - i
                  },
                  _setZoomBtnEnabled: function (t, e) {
                    if ('zoomIn' === t)
                      if (e) {
                        ;(this._zoomInEnabled = !0),
                          (this._btnZoomIn.style.cursor = 'pointer')
                        var n = -74
                        v.isMobile && (n = 0),
                          (this._zoomContainer.style.backgroundPosition =
                            n + 'px 0')
                      } else {
                        ;(this._zoomInEnabled = !1),
                          (this._btnZoomIn.style.cursor = '')
                        var r = -170
                        v.isMobile && (r = -144),
                          (this._zoomContainer.style.backgroundPosition =
                            r + 'px 0')
                      }
                    if ('zoomOut' === t)
                      if (e) {
                        ;(this._zoomOutEnabled = !0),
                          (this._btnZoomOut.style.cursor = 'pointer')
                        var i = -74
                        v.isMobile && (i = 0),
                          (this._zoomContainer.style.backgroundPosition =
                            i + 'px 0')
                      } else {
                        ;(this._zoomOutEnabled = !1),
                          (this._btnZoomOut.style.cursor = '')
                        var o = -146
                        v.isMobile && (o = -108),
                          (this._zoomContainer.style.backgroundPosition =
                            o + 'px 0')
                      }
                  },
                }),
                new e(t)
              )
            })(this)),
            (this._eventManager = new Po(this))
        }),
        (n._createDoms = function () {
          var t = this._container,
            e = E.create('div'),
            n = e.style
          ;(n.overflow = 'hidden'),
            (n.position = 'absolute'),
            (n.zIndex = '20'),
            (n.top = n.left = '0px'),
            (n.height = n.width = '100%'),
            (n.backgroundColor = '#e5e3df'),
            (n.display = 'none'),
            (n.cursor = 'grab'),
            e.addEventListener('mousedown', function () {
              return (n.cursor = 'grabbing')
            }),
            e.addEventListener('mouseup', function () {
              return (n.cursor = 'grab')
            }),
            (this._svContainer = e),
            (this._panes = {
              tileLayer: this._createContainer('1'),
              maskLayer: this._createContainer('2'),
              linksLayer: this._createContainer('3'),
              overlayLayer: this._createContainer('4'),
              effectLayer: this._createContainer('5'),
            }),
            e.appendChild(this._panes.tileLayer),
            e.appendChild(this._panes.linksLayer),
            e.appendChild(this._panes.overlayLayer),
            e.appendChild(this._panes.effectLayer),
            b() ||
              (e.appendChild(this._panes.maskLayer),
              (this._panes.maskLayer.style.width = ''.concat(
                t.clientWidth,
                'px'
              )),
              (this._panes.maskLayer.style.height = ''.concat(
                t.clientHeight,
                'px'
              )),
              (this._panes.maskLayer.style.overflow = 'hidden')),
            t.appendChild(e),
            'absolute' !== E.getCurrentStyle(t).position &&
              (t.style.position = 'relative')
        }),
        (n._createContainer = function (t) {
          var e = E.create('div'),
            n = e.style
          return (
            (n.position = 'absolute'),
            (n.top = n.left = '0'),
            (n.zIndex = t || '0'),
            e
          )
        }),
        (n.calcMobileFovy = function (t) {
          var e = this.getContainerSize(),
            n = e.width,
            r = e.height,
            i = 240 / Math.pow(2, t),
            o = n / 2 / Math.tan(g(i / 2)),
            a = Math.atan2(r / 2, o)
          return 2 * y(a)
        }),
        (n.calcPCFovy = function (t) {
          return 90 - 15 * (t - 1)
        }),
        o(e, [
          {
            key: 'imageZoom',
            get: function () {
              return this.calcDisplayZoom().imgZoom
            },
          },
          {
            key: 'panoId',
            get: function () {
              return this.panoData ? this.panoData.panoId : ''
            },
          },
          {
            key: 'panoNorthDir',
            get: function () {
              return this.panoData ? this.panoData.northDir : 0
            },
          },
          {
            key: 'position',
            get: function () {
              return this.panoData &&
                'number' == typeof this.panoData.panoX &&
                'number' == typeof this.panoData.panoY
                ? new f(this.panoData.panoX, this.panoData.panoY)
                : null
            },
          },
        ]),
        e
      )
    })(rr),
    Lo = {
      dom: null,
      anchor: null,
      width: null,
      height: null,
      altitude: 2,
      sphereZ: null,
      useUV: !1,
    },
    Oo = (function (t) {
      function e(e) {
        var n,
          r =
            arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}
        return (
          ((n = t.call(this) || this).visible = !0),
          (n.worldCoord = void 0),
          (n.pov = void 0),
          (n.id = n.genId()),
          (n._pano = void 0),
          (n.lastPanoPosition = null),
          (n.initialized = !1),
          (n.position = void 0),
          (n.options = void 0),
          (n.position = e),
          (n.options = Object.assign({}, Lo, r)),
          (n.pov = null),
          n
        )
      }
      c(e, t)
      var n = e.prototype
      return (
        (n.getPov = function () {
          return this.pov
        }),
        (n.genId = function () {
          var t =
            arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 4
          return Number(
            ''.concat(Math.random().toString().substr(3, t)).concat(Date.now())
          ).toString(36)
        }),
        (n.init = function (t) {
          t &&
            !this.initialized &&
            ((this._pano = t),
            (this.lastPanoPosition = this._pano.position),
            (this.worldCoord = this.options.useUV
              ? this.calcCoordsByUV()
              : this.calcCoordsByMC()),
            this.worldCoord &&
              ((this.initialized = !0), this.add(), this.draw()))
        }),
        (n.calcCoordsByMC = function () {
          var t = this._pano.position
          if (t && this.position) {
            var e,
              n = this.position,
              r = n.lng - t.lng,
              i = n.lat - t.lat,
              o = Math.atan2(r, i)
            o < 0 && (o += 2 * Math.PI), (o = Math.round(y(o)))
            var a = 500,
              s = this.options,
              u = s.sphereZ,
              h = s.altitude
            null === u
              ? (e = 25 * h)
              : ((e = u || 0),
                (a = Math.sqrt(
                  Math.pow(r, 2) + Math.pow(i, 2) + Math.pow(e, 2)
                )))
            var c = y(Math.asin(e / a))
            c = c > 90 ? 90 : c < -90 ? -90 : c
            var l = _(o + this._pano.panoNorthDir),
              f = this.radius,
              d = Math.cos(g(c)) * f
            d = Math.round(100 * d) / 100
            var p = Math.cos(g(l)) * d,
              v = Math.sin(g(c)) * f,
              m = Math.sin(g(l)) * d
            return (this.pov = { heading: o, pitch: c }), xt(p, v, m)
          }
        }),
        (n.calcCoordsByUV = function () {
          if (this.position) {
            var t = this.radius,
              e = this.position,
              n = Wr(e, 2),
              r = n[0],
              i = n[1],
              o = 2 * r * Math.PI,
              a = (i - 0.5) * Math.PI,
              s = Math.cos(a) * Math.cos(o) * t,
              u = Math.sin(a) * t,
              h = Math.cos(a) * Math.sin(o) * t
            return (
              (this.pov = {
                heading: _(y(o) - this._pano.panoNorthDir),
                pitch: y(a),
              }),
              xt(s, u, h)
            )
          }
        }),
        (n.add = function () {
          var t = this.options,
            e = t.width,
            n = t.height
          if (this.dom) {
            var r = this._pano,
              i = this.dom
            ;(i.style.position = 'absolute'),
              r.getPanes().overlayLayer.appendChild(i),
              'number' != typeof e && (this.options.width = i.clientWidth),
              'number' != typeof n && (this.options.height = i.clientHeight),
              r.dispatchEvent({ type: 'onoverlaydomadded', overlay: this })
          }
        }),
        (n.remove = function () {
          var t = this.dom
          t && t.parentNode && t.parentNode.removeChild(t)
        }),
        (n.povToPointGL = function () {
          if (!this.worldCoord) return null
          var t = this._pano,
            e = t.camera,
            n = t.getContainerSize(),
            r = n.width,
            i = n.height
          return Ni(e, this.worldCoord, r, i)
        }),
        (n.draw = function () {
          if (
            this.initialized &&
            this.visible &&
            this._pano &&
            this._pano.panoData &&
            this.dom
          ) {
            var t = this.lastPanoPosition,
              e = this._pano.position
            ;(t.lng === e.lng && t.lat === e.lat) ||
              ((this.lastPanoPosition = e),
              (this.worldCoord = this.options.useUV
                ? this.calcCoordsByUV()
                : this.calcCoordsByMC()))
            var n = this.dom,
              r = this.povToPointGL()
            if (((n.style.visibility = 'hidden'), r)) {
              var i = this.calcAnchor(),
                o = ''.concat(r[0] - i.width, 'px'),
                a = ''.concat(r[1] - i.height, 'px')
              if (isNaN(r[0]) || isNaN(r[1])) return
              ;(n.style.visibility = 'visible'),
                (n.style.webkitTransform = 'translate('
                  .concat(o, ', ')
                  .concat(a, ')')),
                (n.style.transform = 'translate('
                  .concat(o, ', ')
                  .concat(a, ')'))
            }
          }
        }),
        (n.handleClick = function () {
          this.dispatchEvent('click')
        }),
        (n.calcAnchor = function () {
          var t = this.options,
            e = t.anchor,
            n = t.width,
            r = void 0 === n ? 0 : n,
            i = t.height
          return e || new l(r / 2, (void 0 === i ? 0 : i) / 2)
        }),
        (n.show = function () {
          ;(this.visible = !0), this.dom && (this.dom.style.display = '')
        }),
        (n.hide = function () {
          ;(this.visible = !1), this.dom && (this.dom.style.display = 'none')
        }),
        o(e, [
          {
            key: 'radius',
            get: function () {
              return this._pano ? this._pano.opts.radius : 0
            },
          },
          {
            key: 'dom',
            get: function () {
              return this.options.dom
            },
          },
        ]),
        e
      )
    })(rr),
    Bo = (function (t) {
      function e(e, n) {
        var r = n.position,
          i = n.altitude,
          o = void 0 === i ? 2 : i,
          a = n.costomStyle,
          s = (function (t) {
            var e =
                arguments.length > 1 && void 0 !== arguments[1]
                  ? arguments[1]
                  : {},
              n = document.createElement('div'),
              r = {
                backgroundColor: 'rgba(29, 29, 29, 0.8)',
                fontSize: '14px',
                padding: '7px 14px',
                height: '19px',
                color: '#fff',
                whiteSpace: 'nowrap',
                borderRadius: '4px',
              }
            return m(n.style, r, e), (n.innerText = t), n
          })(e, void 0 === a ? {} : a)
        return t.call(this, r, { dom: s, altitude: o }) || this
      }
      return c(e, t), e
    })(Oo)
  ;(t.Converters = ji),
    (t.Engines = Mi),
    (t.EventType = d),
    (t.PanoLabel = Bo),
    (t.PanoOverlay = Oo),
    (t.PanoramaService = function () {
      var t = this
      ;(this.getPanoById = function (e, n) {
        var r = function () {},
          i = ''
        P
          ? ((i = ''.concat(D.SERVICE_URL, '/si?qt=sdata&sid=').concat(e)),
            (r = fetch(i).then(function (t) {
              return t.json()
            })))
          : ((i = ''.concat(D.SERVICE_URL, '?qt=sdata&sid=').concat(e)),
            (r = t.request(i))),
          r
            .then(function (t) {
              n && n(t)
            })
            .catch(function (t) {
              n && n(null)
            })
      }),
        (this.getPanoByLocation = function (e, n, r) {
          var i = function () {},
            o = ''
          P
            ? ((o = ''
                .concat(D.SERVICE_URL, '/qsi?qt=qsdata&x=')
                .concat(e.lng, '&y=')
                .concat(e.lat)
                .concat(n ? '&r=' + n : '', '&action=1&coord_type=')
                .concat(window.BMAPGL_84 ? 'wgs84ll' : '')),
              (i = fetch(o).then(function (t) {
                return t.json()
              })))
            : ((o = ''
                .concat(D.SERVICE_URL, '?qt=qsdata&x=')
                .concat(e.lng, '&y=')
                .concat(e.lat)
                .concat(n ? '&r=' + n : '', '&action=1')),
              (i = t.request(o))),
            i
              .then(function (t) {
                r && r(t)
              })
              .catch(function (t) {
                r && r(null)
              })
        }),
        (this.request = function (t) {
          return w(t, {}, { jsonp: 'fn' })
        })
    }),
    (t.Point = f),
    (t.getPanoControl = function (t, e) {
      var n,
        r,
        i,
        o = (e = e || {}).imgPath || '//api.map.baidu.com/images/'
      function a(e) {
        e.call(this),
          (this.defaultAnchor = t.ControlAnchor.TOP_RIGHT),
          (this.defaultOffset = new t.Size(10, 10)),
          (this._isOn = !1)
      }
      return (
        (n = a),
        (r = t.Control),
        ((i = Object.create(r.prototype)).constructor = n),
        (n.prototype = i),
        m(a.prototype, {
          initialize: function (t) {
            return (
              (this._map = t), this._render(), this._bind(), this._container
            )
          },
          _render: function () {
            var t = this,
              n = E.create('div')
            ;(n.innerHTML =
              '<span style="position:relative;top:33px;">全景</span>'),
              (n.title = '进入全景'),
              m(n.style, {
                width: '49px',
                height: '51px',
                color: '#565656',
                background: 'url("'.concat(o, 'st-control.png")'),
                position: 'absolute',
                cursor: 'pointer',
                fontFamily: 'arial,sans-serif',
                fontSize: '13px',
                textAlign: 'center',
                boxShadow: '0px 0px 3px rgba(0, 0, 0, 0.3)',
                MozBoxShadow: '0px 0px 3px rgba(0, 0, 0, 0.3)',
                WebkitBoxShadow: '0px 0px 3px rgba(0, 0, 0, 0.3)',
              }),
              (this._container = n)
            var r = this._map.getContainer()
            r.appendChild(n)
            var i = { visible: !1 }
            e.imgPath && (i.imgPath = [e.imgPath]),
              e.tileBaseUrl && (i.tileBaseUrls = [e.tileBaseUrl]),
              (this._pano = new Io(r, i)),
              this._pano.addCloseButton(function () {
                t.isMapEnableWheelZoom && t._map.enableScrollWheelZoom()
              })
            var a = (this._scout = E.create('div'))
            m(a.style, {
              position: 'absolute',
              width: '24px',
              height: '41px',
              cursor: 'pointer',
              backgroundImage: 'url("'.concat(o, 'st-scout.png")'),
              backgroundRepeat: 'no-repeat',
              backgroundPosition: '-24px 0',
              overflow: 'hidden',
              display: 'none',
              zIndex: 11,
            }),
              r.appendChild(a)
            var s = (this._infoWindow = E.create('div'))
            m(s.style, {
              position: 'absolute',
              width: '112px',
              height: '119px',
              backgroundImage: 'url("'.concat(o, 'st-infowindow.gif")'),
              backgroundRepeat: 'no-repeat',
              backgroundPosition: '0 0',
              display: 'none',
              cursor: 'pointer',
              zIndex: 12,
            })
            var u = (this._thumb = E.create('img'))
            s.appendChild(u),
              (u.src = o + 'st-noresult.png'),
              m(u.style, {
                width: '100px',
                height: '75px',
                left: '6px',
                top: '6px',
                position: 'absolute',
              })
            var h = (this._stDescription = E.create('div'))
            m(h.style, {
              position: 'absolute',
              top: '85px',
              fontFamily: 'arial,sans-serif',
              fontSize: '13px',
              paddingLeft: '6px',
            }),
              s.appendChild(h),
              r.appendChild(s)
          },
          _updateView: function () {
            var t = this._container.style
            this._isOn || this._isOver
              ? ((t.backgroundPosition = '-49px 0'), (t.color = '#fff'))
              : ((t.backgroundPosition = '0 0'), (t.color = '#565656'))
          },
          _bind: function () {
            var n = this
            this._pano.on('dataload', function (t) {
              var r = t.data
              r
                ? ((n._currentSvId = r.panoId),
                  e.tileBaseUrl
                    ? (n._thumb.src = ''
                        .concat(e.tileBaseUrl, '?&sid=')
                        .concat(r.panoId, '&pos=0_0&z=0'))
                    : (n._thumb.src =
                        '//mapsv0.bdimg.com/scape/?qt=pdata&sid='.concat(
                          r.panoId,
                          '&pos=0_0&z=0&from=H5'
                        )),
                  (n._stDescription.innerHTML = r.roadName))
                : ((n._currentSvId = null),
                  (n._thumb.src = o + 'st-noresult.png'),
                  (n._stDescription.innerHTML = ''))
            })
            var r = this
            v.isPc &&
              (this._container.addEventListener('mouseover', function () {
                ;(r._isOver = !0), r._updateView()
              }),
              this._container.addEventListener('mouseout', function () {
                ;(r._isOver = !1), r._updateView()
              })),
              this._container.addEventListener('click', function () {
                r._isOn ? r._close() : r._open()
              }),
              this._map
                .getContainer()
                .addEventListener('mousemove', function (e) {
                  if (r._isOn) {
                    var n = (e = window.event || e).pageX || e.clientX,
                      i = e.pageY || e.clientY,
                      a = (function (t) {
                        for (var e = { left: 0, top: 0 }; t && t.offsetParent; )
                          (e.left += t.offsetLeft),
                            (e.top += t.offsetTop),
                            (t = t.offsetParent)
                        return e
                      })(r._map.container),
                      s = new yo(n - a.left, i - a.top),
                      u = r._map.pixelToPoint(s)
                    if (
                      ('' !== r._scout.style.display &&
                        v.isPc &&
                        ((r._scout.style.display = ''),
                        (r._infoWindow.style.display = '')),
                      (r._scout.style.left = s.x - 12 + 'px'),
                      (r._scout.style.top = s.y - 41 - 2 + 'px'),
                      (r._prePixel = r._curPixel),
                      (r._curPixel = s),
                      r._prePixel)
                    ) {
                      var h = s.x - r._prePixel.x
                      h > 0
                        ? (r._scout.style.backgroundPosition = '-48px 0')
                        : h < 0 && (r._scout.style.backgroundPosition = '0 0')
                    }
                    r._curPixel.y < 170
                      ? (r._infoStatus = 2)
                      : (r._infoStatus = 1),
                      r._curPixel.x < 66 && (r._infoStatus = 3),
                      r._curPixel.x > r._map.getSize().width - 56 - 10 &&
                        (r._infoStatus = 4)
                    var c =
                        1 === r._infoStatus || 2 === r._infoStatus ? 112 : 126,
                      l = 1 === r._infoStatus || 2 === r._infoStatus ? 119 : 105
                    ;(1 !== r._infoStatus && 2 !== r._infoStatus) ||
                      ((r._infoWindow.style.left =
                        r._curPixel.x - Math.round(c / 2) + 'px'),
                      1 === r._infoStatus
                        ? ((r._infoWindow.style.top =
                            r._curPixel.y - l - 42 + 'px'),
                          (r._infoWindow.style.backgroundPosition = '0 0'),
                          (r._thumb.style.top = '6px'),
                          (r._thumb.style.bottom = ''),
                          (r._stDescription.style.top = '85px'),
                          (r._stDescription.style.bottom = ''))
                        : ((r._infoWindow.style.top = r._curPixel.y + 2 + 'px'),
                          (r._infoWindow.style.backgroundPosition = '-112px 0'),
                          (r._thumb.style.top = ''),
                          (r._thumb.style.bottom = '6px'),
                          (r._stDescription.style.top = ''),
                          (r._stDescription.style.bottom = '85px')),
                      (r._infoWindow.style.width = '112px'),
                      (r._infoWindow.style.height = '119px'),
                      (r._thumb.style.left = '6px'),
                      (r._stDescription.style.left = '0')),
                      (3 !== r._infoStatus && 4 !== r._infoStatus) ||
                        ((r._infoWindow.style.top =
                          r._curPixel.y - Math.round(l / 2) - 20 + 'px'),
                        3 === r._infoStatus
                          ? ((r._infoWindow.style.left =
                              r._curPixel.x + 12 + 'px'),
                            (r._infoWindow.style.backgroundPosition =
                              '0 -119px'),
                            (r._thumb.style.left = '20px'),
                            (r._stDescription.style.left = '14px'))
                          : ((r._infoWindow.style.left =
                              r._curPixel.x - 12 - c + 'px'),
                            (r._infoWindow.style.backgroundPosition =
                              '-126px -119px'),
                            (r._thumb.style.left = '6px'),
                            (r._stDescription.style.left = '0')),
                        (r._infoWindow.style.width = '126px'),
                        (r._infoWindow.style.height = '105px')),
                      (r._infoWindow.style.backgroundImage = 'url("'.concat(
                        o,
                        'st-infowindow.gif")'
                      )),
                      r._timerId &&
                        (clearTimeout(r._timerId), (r._timerId = null)),
                      (r._timerId = setTimeout(function () {
                        ;(r._currentPoint = u),
                          (r._scout.style.backgroundPosition = '-24px 0')
                        var e = r._map.lnglatToMercator(u.lng, u.lat)
                        r._pano.setPosition(new t.Point(e[0], e[1]))
                      }, 200))
                  }
                }),
              this._map.addEventListener('click', function (t) {
                r._isOn &&
                  v.isMobile &&
                  (r._pano.setPosition(t.point), r._pano.show(), r._close()),
                  r._isOn &&
                    r._currentSvId &&
                    (r._pano.setId(r._currentSvId),
                    r._pano.show(),
                    r._map.config.enableWheelZoom &&
                      (r._map.disableScrollWheelZoom(),
                      (r.isMapEnableWheelZoom = !0)),
                    r._close())
              })
          },
          _open: function () {
            this._isOn ||
              ((this._isOn = !0),
              this._map.addTileLayer(this._panoCoverageLayer),
              v.isPc &&
                ((this._preDefaultCursor = this._map.getDefaultCursor()),
                (this._preDraggingCursor = this._map.getDraggingCursor()),
                this._map.setDefaultCursor('pointer'),
                this._map.setDraggingCursor('pointer'))),
              this._updateView()
          },
          _close: function () {
            this._isOn &&
              (this._map.removeTileLayer(this._panoCoverageLayer),
              v.isPc &&
                ((this._scout.style.display = 'none'),
                (this._infoWindow.style.display = 'none'),
                this._map.setDefaultCursor(this._preDefaultCursor),
                this._map.setDraggingCursor(this._preDraggingCursor)),
              (this._isOn = !1)),
              this._updateView()
          },
        }),
        new a(t.Control)
      )
    }),
    (t.getStreetViewCoverageLayer = function (t) {
      var e = new t.TileLayer({
        transparentPng: !0,
        dataType: 1,
        cacheSize: 32,
      })
      return (
        (e.zIndex = 110),
        (e.getTilesUrl = window.PANORAMA_URL
          ? function (t, e) {
              var n = window.PANORAMA_URL + '/tile',
                r = t.x,
                i = t.y
              return (
                window.BMAPGL_84 && (i = Math.pow(2, e) - i - 1),
                ''
                  .concat(n, '?customid=panorama&x=')
                  .concat(r, '&y=')
                  .concat(i, '&z=')
                  .concat(e, '&type=WGS84')
              )
            }
          : function (t, e) {
              var n = ['//mapsv0.bdimg.com/tile/', '//mapsv1.bdimg.com/tile/'],
                r = (Math.abs(t.x) + Math.abs(t.y)) % n.length
              return ''
                .concat(n[r], '?udt=')
                .concat('20150114', '&qt=tile&styles=')
                .concat('pl', '&x=')
                .concat(t.x, '&y=')
                .concat(t.y, '&z=')
                .concat(e)
                .replace(/-(\d+)/gi, 'M$1')
            }),
        e
      )
    }),
    (t.init = function (t, e) {
      return new Io(t, e)
    }),
    Object.defineProperty(t, '__esModule', { value: !0 })
})((Pano = {}))
window.BMapGL = window.BMapGL || {}
;(function (bo, eV) {
  var es = es || { version: '20150702', emptyFn: function () {} }
  ;(function () {
    es._log = []
    var i = 0
    var T = {}
    es.BaseClass = function (i8) {
      T[(this.hashCode = i8 || es.BaseClass.guid())] = this
    }
    es.BaseClass.guid = function () {
      return 'mz_' + (i++).toString(36)
    }
    es.BaseClass.create = function () {
      var i8 = new es.BaseClass()
      i8.decontrol()
      return i8
    }
    var e =
      (es.instance =
      es.I =
        function (i8) {
          return T[i8]
        })
    es.BaseClass.prototype.dispose = function () {
      if (this.hashCode) {
        delete T[this.hashCode]
      }
      for (var i8 in this) {
        if (typeof this[i8] != 'function') {
          delete this[i8]
        }
      }
    }
    es.BaseClass.prototype.getHashCode = function () {
      if (!this.hashCode) {
        T[(this.hashCode = es.BaseClass.guid())] = this
      }
      return this.hashCode
    }
    es.BaseClass.prototype.decontrol = function () {
      delete T[this.hashCode]
    }
    es.BaseClass.prototype.toString = function () {
      return '[object ' + (this._className || 'Object') + ']'
    }
    es.BaseClass.prototype._wlog = function (i9, ja) {
      var i8 = es._log
      if (i8.length > 100) {
        i8.reverse().length = 50
        i8.reverse()
      }
      i8[i8.length] =
        '[' +
        i9 +
        '][' +
        (this._className || 'Object') +
        ' ' +
        this.hashCode +
        '] ' +
        ja
    }
  })()
  Function.prototype.inherits = function (i8, T) {
    var e,
      i9,
      jb = this.prototype,
      ja = function () {}
    ja.prototype = i8.prototype
    i9 = this.prototype = new ja()
    if (typeof T == 'string') {
      i9._className = T
    }
    for (e in jb) {
      i9[e] = jb[e]
    }
    this.prototype.constructor = jb.constructor
    jb = ja = null
    return i9
  }
  es.BaseEvent = function (e, i) {
    this.type = e
    this.returnValue = true
    this.target = i || null
    this.currentTarget = this.srcElement = null
    this.cancelBubble = false
    this.domEvent = null
  }
  es.BaseClass.prototype.on = es.BaseClass.prototype.addEventListener =
    function (T, i) {
      if (typeof i !== 'function') {
        return this._wlog(
          'error',
          'addEventListener:' + i + ' is not a function'
        )
      }
      if (!this._listeners) {
        this._listeners = {}
      }
      var e = this._listeners
      if (T.indexOf('on') !== 0) {
        T = 'on' + T
      }
      if (typeof e[T] !== 'object') {
        e[T] = {}
      }
      var i8 = i.hashCode || es.BaseClass.guid()
      i.hashCode = i8
      if (e[T][i8]) {
        this._wlog('warning', 'repeat key:' + i8)
      }
      e[T][i8] = i
    }
  es.BaseClass.prototype.off = es.BaseClass.prototype.removeEventListener =
    function (T, i) {
      if (typeof i == 'function') {
        i = i.hashCode
      } else {
        if (typeof i !== 'string' && typeof i !== 'undefined') {
          return
        }
      }
      if (!this._listeners) {
        this._listeners = {}
      }
      if (T.indexOf('on') != 0) {
        T = 'on' + T
      }
      var e = this._listeners
      if (!e[T]) {
        return
      }
      if (i === undefined) {
        e[T] = {}
        return
      }
      if (e[T][i]) {
        delete e[T][i]
      }
    }
  es.BaseClass.prototype.fire = es.BaseClass.prototype.dispatchEvent =
    function (i8) {
      if (!this._listeners) {
        this._listeners = {}
      }
      var T,
        e = this._listeners,
        i9 = i8.type
      i8.target = i8.srcElement = i8.target || i8.srcElement || this
      i8.currentTarget = this
      if (typeof this[i9] == 'function') {
        this[i9](i8)
      }
      if (typeof e[i9] == 'object') {
        for (T in e[i9]) {
          if (typeof e[i9][T] == 'function') {
            e[i9][T].call(this, i8)
          }
        }
      }
      return i8.returnValue
    }
  es.BaseEvent.prototype.inherit = function (T) {
    var i = this
    this.domEvent = T = window.event || T
    i.clientX = T.clientX || T.pageX
    i.clientY = T.clientY || T.pageY
    i.offsetX = T.offsetX || T.layerX
    i.offsetY = T.offsetY || T.layerY
    i.screenX = T.screenX
    i.screenY = T.screenY
    i.ctrlKey = T.ctrlKey || T.metaKey
    i.shiftKey = T.shiftKey
    i.altKey = T.altKey
    return i
  }
  es.Browser = (function () {
    var T = navigator.userAgent
    var i9 = 0
    var e = 0
    var ja = 0
    var i = 0
    var je = 0
    var jc = 0
    var jd = 0
    var jb = 0
    var i8 = 0
    var jf = 0
    if (
      typeof window.opera === 'object' &&
      /Opera(\s|\/)(\d+(\.\d+)?)/.test(T)
    ) {
      ja = parseFloat(RegExp.$2)
    } else {
      if (/OPR(\/(\d+)(\..?)?)/.test(T)) {
        ja = parseInt(RegExp.$2, 10)
      } else {
        if (/Edge\/((\d+)\.\d+)/.test(T)) {
          i9 = parseInt(RegExp.$2, 10)
        } else {
          if (/MSIE (\d+(\.\d+)?)/.test(T)) {
            e = parseFloat(RegExp.$1)
          } else {
            if (T.indexOf('Trident') > -1 && /rv:(\d+(\.\d+)?)/.test(T)) {
              e = parseInt(RegExp.$1, 10)
            } else {
              if (/Firefox(\s|\/)(\d+(\.\d+)?)/.test(T)) {
                je = parseFloat(RegExp.$2)
              } else {
                if (
                  navigator.vendor === 'Netscape' &&
                  /Netscape(\s|\/)(\d+(\.\d+)?)/.test(T)
                ) {
                  jd = parseFloat(RegExp.$2)
                } else {
                  if (
                    T.indexOf('Safari') > -1 &&
                    /Version\/(\d+(\.\d+)?)/.test(T)
                  ) {
                    i = parseFloat(RegExp.$1)
                  }
                }
              }
            }
          }
        }
      }
    }
    if (T.indexOf('Trident') > -1 && /Trident\/(\d+(\.\d+)?)/.test(T)) {
      jb = parseInt(RegExp.$1, 10)
    } else {
      if (
        !e &&
        !i9 &&
        T.indexOf('Gecko') > -1 &&
        T.indexOf('KHTML') === -1 &&
        /rv\:(\d+(\.\d+)?)/.test(T)
      ) {
        i8 = parseFloat(RegExp.$1)
      } else {
        if (!i9 && /chrome\/(\d+(\.\d+)?)/i.test(T)) {
          jc = parseFloat(RegExp.$1)
        } else {
          if (!i9 && /AppleWebKit\/(\d+(\.\d+)?)/.test(T)) {
            jf = parseInt(RegExp.$1, 10)
          }
        }
      }
    }
    var jg = {
      edge: i9,
      ie: e,
      firefox: je,
      netscape: jd,
      opera: ja,
      safari: i,
      chrome: jc,
      gecko: i8,
      trident: jb,
      webkit: jf,
    }
    return jg
  })()
  window.FeBrowser = es.Browser
  es.Dom = {}
  es.Dom.createDom = function (i, e) {
    if (es.isIE && e && e.name) {
      i = '<' + i + ' name="' + es.String.escapeHTML(e.name) + '">'
    }
    var T = document.createElement(i)
    if (e) {
      es.Dom.setProperties(T, e)
    }
    return T
  }
  es.Dom.getOffset = function (i8) {
    var jb = es.Dom.getOwnerDocument(i8)
    var ja =
      es.isGecko > 0 &&
      jb.getBoxObjectFor &&
      es.Dom.getStyle(i8, 'position') == 'absolute' &&
      (i8.style.top === '' || i8.style.left === '')
    var jc = { left: 0, top: 0 }
    var i = es.isIE && !es.isStrict ? jb.body : jb.documentElement
    if (i8 == i) {
      return jc
    }
    var T = null
    var i9
    if (i8.getBoundingClientRect) {
      i9 = i8.getBoundingClientRect()
      jc.left =
        i9.left + Math.max(jb.documentElement.scrollLeft, jb.body.scrollLeft)
      jc.top =
        i9.top + Math.max(jb.documentElement.scrollTop, jb.body.scrollTop)
      jc.left -= jb.documentElement.clientLeft
      jc.top -= jb.documentElement.clientTop
      if (es.isIE && !es.isStrict) {
        jc.left -= 2
        jc.top -= 2
      }
    } else {
      if (jb.getBoxObjectFor && !ja) {
        i9 = jb.getBoxObjectFor(i8)
        var e = jb.getBoxObjectFor(i)
        jc.left = i9.screenX - e.screenX
        jc.top = i9.screenY - e.screenY
      } else {
        T = i8
        do {
          jc.left += T.offsetLeft
          jc.top += T.offsetTop
          if (es.isWebkit > 0 && es.Dom.getStyle(T, 'position') == 'fixed') {
            jc.left += jb.body.scrollLeft
            jc.top += jb.body.scrollTop
            break
          }
          T = T.offsetParent
        } while (T && T != i8)
        if (
          es.isOpera > 0 ||
          (es.isWebkit > 0 && es.Dom.getStyle(i8, 'position') == 'absolute')
        ) {
          jc.top -= jb.body.offsetTop
        }
        T = i8.offsetParent
        while (T && T != jb.body) {
          jc.left -= T.scrollLeft
          if (!es.isOpera || T.tagName != 'TR') {
            jc.top -= T.scrollTop
          }
          T = T.offsetParent
        }
      }
    }
    return jc
  }
  es.Dom.getOwnerDocument = function (e) {
    return e.nodeType == 9 ? e : e.ownerDocument || e.document
  }
  es.Dom.setProperties = function (i, e) {
    es.each(e, function (i8, T) {
      es.Dom._setProperty(i, T, i8)
    })
  }
  es.Dom._setProperty = function (i, e, T) {
    if (e == 'style') {
      i.style.cssText = T
    } else {
      if (e == 'class') {
        i.className = T
      } else {
        if (e == 'for') {
          i.htmlFor = T
        } else {
          if (e in es.Dom._DIRECT_ATTRIBUTE_MAP) {
            i.setAttribute(es.Dom._DIRECT_ATTRIBUTE_MAP[e], T)
          } else {
            i[e] = T
          }
        }
      }
    }
  }
  es.Dom._DIRECT_ATTRIBUTE_MAP = {
    cellpadding: 'cellPadding',
    cellspacing: 'cellSpacing',
    colspan: 'colSpan',
    rowspan: 'rowSpan',
    valign: 'vAlign',
    height: 'height',
    width: 'width',
    usemap: 'useMap',
    frameborder: 'frameBorder',
  }
  es.G = function () {
    for (var T = [], i8 = arguments.length - 1; i8 > -1; i8--) {
      var i9 = arguments[i8]
      T[i8] = null
      if (typeof i9 == 'object' && i9 && i9.dom) {
        T[i8] = i9.dom
      } else {
        if (
          (typeof i9 == 'object' && i9 && i9.tagName) ||
          i9 == window ||
          i9 == document
        ) {
          T[i8] = i9
        } else {
          if (typeof i9 == 'string' && (i9 = document.getElementById(i9))) {
            T[i8] = i9
          }
        }
      }
    }
    return T.length < 2 ? T[0] : T
  }
  es.ac = function (e, i) {
    if (!(e = this.G(e))) {
      return
    }
    i = this.trim(i)
    if (
      !new RegExp('(^| )' + i.replace(/(\W)/g, '\\$1') + '( |$)').test(
        e.className
      )
    ) {
      e.className = e.className.split(/\s+/).concat(i).join(' ')
    }
  }
  es.addClassName = es.ac
  es.each = function (ja, e) {
    if (typeof e != 'function') {
      return ja
    }
    if (ja) {
      if (ja.length === undefined) {
        for (var T in ja) {
          e.call(ja[T], ja[T], T)
        }
      } else {
        for (var i8 = 0, i9 = ja.length; i8 < i9; i8++) {
          e.call(ja[i8], ja[i8], i8)
        }
      }
    }
    return ja
  }
  es.extend = function (ja, i8) {
    if (ja && i8 && typeof i8 == 'object') {
      for (var i9 in i8) {
        ja[i9] = i8[i9]
      }
      var T = [
        'constructor',
        'hasOwnProperty',
        'isPrototypeOf',
        'propertyIsEnumerable',
        'toLocaleString',
        'toString',
        'valueOf',
      ]
      for (var e = 0, i; e < T.length; e++) {
        i = T[e]
        if (Object.prototype.hasOwnProperty.call(i8, i)) {
          ja[i] = i8[i]
        }
      }
    }
    return ja
  }
  es.hide = function () {
    es.each(arguments, function (e) {
      if ((e = es.G(e))) {
        e.style.display = 'none'
      }
    })
  }
  es.inherit = function (jc, i8, T) {
    var jb = jc.prototype
    var ja = function () {}
    ja.prototype = i8.prototype
    var i9 = (jc.prototype = new ja())
    if (typeof T == 'string') {
      i9._className = T
    }
    for (var e in jb) {
      i9[e] = jb[e]
    }
    jc.prototype.constructor = jb.constructor
    jb = null
    return i9
  }
  es.isIE = 0
  ;(function () {
    if (navigator.userAgent.indexOf('MSIE') > 0 && !window.opera) {
      ;/MSIE (\d+(\.\d+)?)/.test(navigator.userAgent)
      es.isIE = parseFloat(RegExp.$1)
    }
  })()
  es.rc = function (e, i) {
    if (!(e = this.G(e))) {
      return
    }
    i = this.trim(i)
    var T = e.className.replace(
      new RegExp('(^| +)' + i.replace(/(\W)/g, '\\$1') + '( +|$)', 'g'),
      '$2'
    )
    if (e.className != T) {
      e.className = T
    }
  }
  es.removeClassName = es.rc
  es.show = function () {
    this.each(arguments, function (e) {
      if ((e = es.G(e))) {
        e.style.display = ''
      }
    })
  }
  es.trim = function (e) {
    return e.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g, '')
  }
  es.getElementsByClassName = function (e, i) {
    if (e.getElementsByClassName) {
      return e.getElementsByClassName(i)
    } else {
      return (function T(jf, jd) {
        if (jd == null) {
          jd = document
        }
        var jc = [],
          jb = jd.getElementsByTagName('*'),
          i8 = jb.length,
          je = new RegExp('(^|\\s)' + jf + '(\\s|$)'),
          ja,
          i9
        for (ja = 0, i9 = 0; ja < i8; ja++) {
          if (je.test(jb[ja].className)) {
            jc[i9] = jb[ja]
            i9++
          }
        }
        return jc
      })(i, e)
    }
  }
  es.toggleClass = function (e, i) {
    if (es.hasClass(e, i)) {
      es.removeClassName(e, i)
    } else {
      es.addClassName(e, i)
    }
  }
  es.hasClass = function (i8, T) {
    if (!i8 || !i8.className || typeof i8.className != 'string') {
      return false
    }
    var i = -1
    try {
      i =
        i8.className == T ||
        i8.className.search(new RegExp('(\\s|^)' + T + '(\\s|$)'))
    } catch (i9) {
      return false
    }
    return i > -1
  }
  es.insertHTML = function (i8, e, T) {
    i8 = es.G(i8)
    if (i8 === null) {
      return i8
    }
    var i, i9
    if (i8.insertAdjacentHTML) {
      i8.insertAdjacentHTML(e, T)
    } else {
      i = i8.ownerDocument.createRange()
      e = e.toUpperCase()
      if (e == 'AFTERBEGIN' || e == 'BEFOREEND') {
        i.selectNodeContents(i8)
        i.collapse(e == 'AFTERBEGIN')
      } else {
        i9 = e == 'BEFOREBEGIN'
        i[i9 ? 'setStartBefore' : 'setEndAfter'](i8)
        i.collapse(i9)
      }
      i.insertNode(i.createContextualFragment(T))
    }
    return i8
  }
  if (
    typeof HTMLElement != 'undefined' &&
    HTMLElement.prototype.__lookupGetter__ &&
    !HTMLElement.prototype.__lookupGetter__('children') &&
    !window.opera
  ) {
    try {
      HTMLElement.prototype.__defineGetter__('children', function () {
        for (
          var T = [], i8 = 0, ja, i9 = 0, e = this.childNodes.length;
          i9 < e;
          i9++
        ) {
          ja = this.childNodes[i9]
          if (ja.nodeType == 1) {
            T[i8++] = ja
            if (ja.name) {
              if (!T[ja.name]) {
                T[ja.name] = []
              }
              T[ja.name][T[ja.name].length] = ja
            }
            if (ja.id) {
              T[ja.id] = ja
            }
          }
        }
        return T
      })
    } catch (iq) {}
  }
  if (
    typeof HTMLElement != 'undefined' &&
    !window.opera &&
    HTMLElement.prototype &&
    !HTMLElement.prototype.insertAdjacentHTML
  ) {
    HTMLElement.prototype.insertAdjacentHTML = function (i, T) {
      var i8 = this.ownerDocument.createRange()
      i8.setStartBefore(this)
      i8 = i8.createContextualFragment(T)
      switch (i) {
        case 'beforeBegin':
          this.parentNode.insertBefore(i8, this)
          break
        case 'afterBegin':
          this.insertBefore(i8, this.firstChild)
          break
        case 'beforeEnd':
          this.appendChild(i8)
          break
        case 'afterEnd':
          if (!this.nextSibling) {
            this.parentNode.appendChild(i8)
          } else {
            this.parentNode.insertBefore(i8, this.nextSibling)
          }
          break
      }
    }
  }
  if (typeof HTMLElement != 'undefined' && !window.opera) {
    HTMLElement.prototype.contains = function (e) {
      if (!e) {
        return false
      }
      if (e == this) {
        return true
      }
      while ((e = e.parentNode)) {
        if (e == this) {
          return true
        }
      }
      return false
    }
  }
  if (!es.Browser.ie && typeof Event != 'undefined' && !window.opera) {
    Event.prototype.__defineSetter__('returnValue', function (e) {
      if (!e) {
        this.preventDefault()
      }
      return e
    })
    Event.prototype.__defineSetter__('cancelBubble', function (e) {
      if (e) {
        this.stopPropagation()
      }
      return e
    })
  }
  es.each = function (i9, i8) {
    if (bG(i8)) {
      for (var T = 0, e = i9.length; T < e; T++) {
        if (i8.call(i9, i9[T], T) === false) {
          break
        }
      }
    }
    return i9
  }
  es.Platform = {
    x11: 0,
    macintosh: 0,
    windows: 0,
    android: 0,
    iphone: 0,
    ipad: 0,
  }
  for (var io in es.Platform) {
    if (es.Platform.hasOwnProperty(io)) {
      es.Platform[io] = new RegExp(io, 'i').test(window.navigator.userAgent)
        ? 1
        : 0
    }
  }
  if (typeof es.Dom === 'undefined') {
    es.Dom = {}
  }
  es.Dom.getComputedStyle = function (i, e) {
    var i8 = i.nodeType == 9 ? i : i.ownerDocument || i.document,
      T
    if (i8.defaultView && i8.defaultView.getComputedStyle) {
      T = i8.defaultView.getComputedStyle(i, null)
      if (T) {
        return T[e] || T.getPropertyValue(e)
      }
    } else {
      if (i.currentStyle) {
        return i.currentStyle[e] || ''
      }
    }
    return ''
  }
  var e7 = es.BaseEvent
  var cJ = es.BaseClass
  cJ.prototype.toString = function () {
    return this._className || ''
  }
  es.on = function (T, i, e) {
    if (!(T = es.G(T))) {
      return T
    }
    i = i.replace(/^on/, '')
    if (T.addEventListener) {
      T.addEventListener(i, e, false)
    } else {
      if (T.attachEvent) {
        T.attachEvent('on' + i, e)
      }
    }
    return T
  }
  es.un = function (T, i, e) {
    if (!(T = es.G(T))) {
      return T
    }
    i = i.replace(/^on/, '')
    if (T.removeEventListener) {
      T.removeEventListener(i, e, false)
    } else {
      if (T.detachEvent) {
        T.detachEvent('on' + i, e)
      }
    }
    return T
  }
  es.hc = function (i8, T) {
    if (!i8 || !i8.className || typeof i8.className != 'string') {
      return false
    }
    var i = -1
    try {
      i =
        i8.className == T ||
        i8.className.search(new RegExp('(\\s|^)' + T + '(\\s|$)'))
    } catch (i9) {
      return false
    }
    return i > -1
  }
  es.isEmptyObject = function (T) {
    if (Object.prototype.toString.call(T) === '[object Object]') {
      for (var e in T) {
        return false
      }
      return true
    } else {
      return false
    }
  }
  var bF = window.location.protocol === 'http:' ? 'http:' : 'https:'
  var dZ = {
    fontFamily:
      'Arial,Helvetica,"PingFang SC","Hiragino Sans GB",STHeiti,sans-serif',
    mapStyleNameIdPair: { default: 0, 'grayed-out': 1 },
    mapHost: bF + '//map.baidu.com',
    apiHost: bF + '//api.map.baidu.com',
    apiIMG: bF + '//api.map.baidu.com/images',
    staticHost: bF + '//webmap0.bdimg.com',
    imgPath: bF + '//webmap0.bdimg.com/image/api/',
    tileDomain: [
      bF + '//maponline0.bdimg.com',
      bF + '//maponline1.bdimg.com',
      bF + '//maponline2.bdimg.com',
      bF + '//maponline3.bdimg.com',
    ],
    panoTilePath: '//mapsv1.bdimg.com/scape/',
    optDomain: 'http://10.120.25.45:8017',
    rasterTilePath: '/tile/',
    vectorTilePath: '/pvd/',
    originTilePath: [bF + '//pcor.baidu.com'],
    stylePath: '//maponline0.bdimg.com/sty/',
    getIconSetPath: function (e) {
      var i = 'map_icons2x/'
      if (typeof e === 'string' && this.mapStyleNameIdPair[e] > 0) {
        i = 'map_icons2x_' + (this.mapStyleNameIdPair[e] - 1) + '/'
      }
      return bF + this.stylePath + i
    },
    getMapStyleFiles: function (T) {
      var i9 = true
      if (typeof T === 'string' && T !== 'default') {
        i9 = false
      }
      var ja = i9 ? '' : '_' + (this.mapStyleNameIdPair[T] - 1)
      var i = bp()
      var i8 = 'udt=' + i.udt + '&v=' + i.ver
      var e = bF + this.stylePath
      return [
        e + 'icons_2x' + ja + '.js?' + i8,
        e + 'fs' + ja + '.js?' + i8,
        e + 'indoor_fs.js?' + i8,
      ]
    },
    tvc: {
      ditu: {
        normal: { version: '088', updateDate: '20210726' },
        satellite: { version: '009', updateDate: '20210726' },
        normalTraffic: { version: '081', updateDate: '20210726' },
        satelliteTraffic: { version: '083', updateDate: '20210726' },
        mapJS: { version: '104', updateDate: '20210726' },
        satelliteStreet: { version: '083', updateDate: '20210726' },
        panoClick: { version: '1033', updateDate: '20180108' },
        panoUdt: { version: '20180108', updateDate: '20180108' },
        panoSwfAPI: { version: '20150123', updateDate: '20150123' },
        panoSwfPlace: { version: '20141112', updateDate: '20141112' },
        earthVector: { version: '001', updateDate: '20210726' },
      },
    },
    msv: { mapstyle: { updateDate: '20210726', version: '001' } },
  }
  dZ.imgResources = {
    blankGIF: dZ.staticHost + '/res/litemapapi/v1d1/images/blank.gif?20170501',
    markerPng:
      dZ.staticHost + '/res/litemapapi/v1d1/images/marker.png?20170501',
    locPng: dZ.staticHost + '/res/litemapapi/v1d1/images/loc.png?20180918',
    locNewPng:
      dZ.staticHost + '/res/litemapapi/v1d1/images/loc_new.png?20190314',
    zoomPng: dZ.staticHost + '/res/litemapapi/v1d1/images/zoombtn.png?20180918',
    mapLogoPng:
      dZ.staticHost + '/res/litemapapi/v1d1/images/logo-2x.png?20190226',
  }
  var w = dZ
  var ih = 'ruler.cur'
  if (es.Browser.ie || es.Browser.edge) {
    es.extend(w, {
      distCursor: 'url(' + w.imgPath + ih + '),crosshair',
      defaultCursor: 'url(' + w.imgPath + 'openhand.cur),default',
      draggingCursor: 'url(' + w.imgPath + 'closedhand.cur),move',
    })
  } else {
    if (es.Browser.firefox) {
      es.extend(w, {
        distCursor: 'url(' + w.imgPath + ih + '),crosshair',
        defaultCursor: '-moz-grab',
        draggingCursor: '-moz-grabbing',
      })
    } else {
      if (es.Browser.chrome || es.Browser.safari) {
        es.extend(w, {
          distCursor: 'url(' + w.imgPath + ih + ') 2 6,crosshair',
          defaultCursor: 'url(' + w.imgPath + 'openhand.cur) 8 8,default',
          draggingCursor: 'url(' + w.imgPath + 'closedhand.cur) 8 8,move',
        })
        if (es.Platform.macintosh) {
          w.defaultCursor = '-webkit-grab'
          w.draggingCursor = '-webkit-grabbing'
        }
      } else {
        es.extend(w, {
          distCursor: 'url(' + w.imgPath + ih + '),crosshair',
          defaultCursor: 'url(' + w.imgPath + 'openhand.cur),default',
          draggingCursor: 'url(' + w.imgPath + 'closedhand.cur),move',
        })
      }
    }
  }
  bo = bo || {}
  bo.version = 'gl'
  bo._register = []
  bo.register = function (e) {
    this._register[this._register.length] = e
  }
  bo.guid = 1
  bo.getGUID = function (e) {
    return (e || '') + bo.guid++
  }
  var ei = window.BMAP_AUTHENTIC_KEY || ''
  function M(e, i, i8) {
    var T = new Date()
    T.setTime(T.getTime() + i8 * 24 * 60 * 60 * 1000)
    document.cookie = e + '=' + escape(i) + ';expires=' + T.toGMTString()
  }
  function aU(e, i) {
    if (navigator.cookieEnabled) {
      return M(e, i, 30)
    }
    if (localStorage) {
      return localStorage.setItem(e, i)
    }
    if (sessionStorage) {
      return sessionStorage.setItem(e, i)
    }
  }
  bo.getSeckeyCid = function () {
    var i = +new Date()
    var e = bF + '//dlswbr.baidu.com/heicha/mw/abclite-2063-s.js?_t=' + i
    f5.load(e, hQ)
  }
  function hQ() {
    if (window.___abvk) {
      aU('SECKEY_ABVK', window.___abvk)
    }
  }
  window.__abbaidu_2063_cb = function (i) {
    var e = JSON.parse(i)
    aU('BMAP_SECKEY', e.data)
  }
  bo.bmapVerifyCbk = function (i9) {
    if (i9 && i9.error !== 0) {
      bo = null
      BMapGL = null
      var ja =
        '百度未授权使用地图API，可能是因为您提供的密钥不是有效的百度地图开放平台密钥，或此密钥未对本应用的百度地图JavaScriptAPI授权。您可以访问如下网址了解如何获取有效的密钥：https://lbs.baidu.com/apiconsole/key#。'
      switch (i9.error) {
        case 101:
          ja =
            '您所使用的密钥ak有问题，不支持jsapi服务，可以访问该网址了解如何获取有效密钥：http://lbsyun.baidu.com/apiconsole/key#。'
          break
        case 102:
          ja =
            'MCODE参数不存在，mobile类型MCODE参数必需，详情查看：http://lbsyun.baidu.com/apiconsole/key#。'
          break
        case 200:
          ja =
            'APP不存在，AK有误请检查再重试，详情查看：http://lbsyun.baidu.com/apiconsole/key#。'
          break
        case 201:
          ja =
            'APP被您禁用啦，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。'
          break
        case 202:
          ja =
            'APP被管理员删除啦，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。'
          break
        case 203:
          ja =
            'APP类型错误，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。'
          break
        case 210:
          ja =
            'APP IP校验失败，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。'
          break
        case 220:
          ja =
            'APP Referer校验失败。请检查该ak设置的白名单与访问所有的域名是否一致。详情查看：http://lbsyun.baidu.com/apiconsole/key#'
          break
        case 230:
          ja =
            'APP Mcode码校验失败，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。'
          break
        case 240:
          ja =
            'APP服务被禁用了，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。'
          break
        case 250:
          ja =
            '该用户不存在... 请登录 https://lbs.baidu.com 的控制台，注册成为开发者申请ak吧。'
          break
        case 251:
          ja =
            '该用户被自己删除啦，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情。'
          break
        case 252:
          ja =
            '该用户被管理员删除啦，可以访问 http://lbsyun.baidu.com/apiconsole/key# 了解如何获取有效密钥，或请联系我们了解详情。'
          break
        case 260:
          ja =
            '您所使用的密钥AK不包含该服务呢，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看服务选择情况，或请联系我们了解详情。'
          break
        case 261:
          ja =
            '您所使用的密钥AK的该服务被禁用啦，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看服务选择情况，或请联系我们了解详情。'
          break
        case 401:
          ja =
            '您所使用的AK并发超限了，请登录 http://lbsyun.baidu.com/cashier/quota#/home 了解详情。'
          break
        case 302:
          ja =
            '您所使用的AK天配额超限了，请登录 http://lbsyun.baidu.com/cashier/quota#/home 了解详情。'
          break
      }
      alert(ja)
      var T = document.getElementsByClassName('bmap-container')
      if (T) {
        for (var i8 = 0; i8 < T.length; i8++) {
          var e = T[i8]
          if (e && e.firstChild && e.firstChild.id === 'platform') {
            e.innerText = ''
          }
        }
      }
    }
  }
  bo.frequencyCbk = function (e) {
    if (e) {
      window.QTFrequency = e
    }
  }
  bo.verify = function () {
    var e =
      w.apiHost +
      '/?qt=verify&v=gl&type=webgl&ak=' +
      ei +
      '&callback=' +
      eV +
      '.bmapVerifyCbk'
    f5.load(e)
  }
  bo.frequency = function () {}
  bo.apiLoad = bo.apiLoad || function () {}
  function hi(i, e) {
    this._size = i
    this._cache = []
    this._totalGetTimes = 0
    this._totalHitTimes = 0
    this._options = { clearCallback: null, removeOldCallback: null }
    e = e || {}
    for (var T in e) {
      if (e.hasOwnProperty(T)) {
        this._options[T] = e[T]
      }
    }
  }
  hi.prototype.setData = function (T, i8) {
    var e = this._cache
    var i = this._size
    if (i === 0) {
      return
    }
    if (e.length > i) {
      this._removeOld()
    }
    if (!e[T]) {
      e.push(i8)
    }
    e[T] = i8
    i8._key_ = T
  }
  hi.prototype.getHitRate = function () {
    return Math.round((this._totalHitTimes / this._totalGetTimes) * 1000) / 1000
  }
  hi.prototype.getData = function (i) {
    var e = this._cache[i]
    if (e) {
      this._totalHitTimes++
    }
    this._totalGetTimes++
    return e
  }
  hi.prototype.removeData = function (i9) {
    if (this._options.clearCallback) {
      this._options.clearCallback(this._cache[i9])
    }
    var T = this._cache
    var ja = T[i9]
    for (var i8 = 0, e = T.length; i8 < e; i8++) {
      if (T[i8] === ja) {
        T.splice(i8, 1)
        break
      }
    }
    delete T[i9]
  }
  hi.prototype._removeOld = function () {
    var e = this._cache
    var i9 = Math.round(this._size * 0.6)
    for (var i8 = 0; i8 < i9; i8++) {
      var T = e[i8]._key_
      if (this._options.clearCallback) {
        this._options.clearCallback(e[T])
      }
      delete e[T]
    }
    e.splice(0, i9)
    if (this._options.removeOldCallback) {
      this._options.removeOldCallback()
    }
  }
  hi.prototype.clear = function () {
    var T = this._cache
    for (var i9 = 0, e = T.length; i9 < e; i9++) {
      var i8 = T[i9]._key_
      if (this._options.clearCallback) {
        this._options.clearCallback(T[i8])
      }
      delete T[i8]
    }
    this._cache = T = []
  }
  hi.prototype.forEach = function (i8) {
    var T = this._cache
    for (var ja = 0, e = T.length; ja < e; ja++) {
      var i9 = T[ja]._key_
      i8(T[i9])
    }
  }
  hi.prototype.getBatch = function (i9) {
    var e = []
    for (var i8 = 0, T = i9.length; i8 < T; i8++) {
      if (this.getData(i9[i8])) {
        e[e.length] = this.getData(i9[i8])
      }
    }
    return e
  }
  hi.prototype.clearExcept = function (ja) {
    var T = this._cache
    for (var e = T.length, i9 = e - 1; i9 >= 0; i9--) {
      var i8 = this._cache[i9]._key_
      if (!ja[i8]) {
        T.splice(i9, 1)
        if (this._options.clearCallback) {
          this._options.clearCallback(T[i8])
        }
        delete T[i8]
      }
    }
  }
  hi.prototype.getDataCount = function () {
    return this._cache.length
  }
  function hV() {}
  es.extend(hV.prototype, {
    centerAndZoomIn: function (jd, T, je) {
      var jb = this
      if (!jd && !T) {
        return
      }
      jd = jd || this.centerPoint
      T = T || this.zoomLevel
      T = this._getProperZoom(T).zoom
      if (this.mapType === BMAP_EARTH_MAP) {
        if (!this._earth) {
          this.mapType = BMAPGL_NORMAL_MAP
          this.temp.originMapType = BMAP_EARTH_MAP
          function jc() {
            jb._earth = new bo.Earth(jb, {
              showRealSunlight: jb.config.showRealSunlight,
              showMilkyway: jb.config.showMilkyway,
              earthBackground: jb.config.earthBackground,
            })
            jb._proxyEarthEvents()
            jb._changeEarthMapType(BMAP_EARTH_MAP)
            es.extend(jb, bo.EarthView.prototype)
            if (!jb._navigationCtrl && jb.config.showControls) {
              jb._navigationCtrl = new bo.NavigationControl3D(jb)
            }
            delete jb.temp.originMapType
          }
          gi.load('earth', function () {
            if (bo['FeatureStyle' + jb.config.style]) {
              jc()
            } else {
              jb.loadMapStyleFiles(function () {
                jc()
              })
            }
          })
        }
      }
      this.lastLevel = this.zoomLevel || T
      this.zoomLevel = T
      var i9 = new e7('onload')
      i9.point = jd
      i9.zoom = T
      this.centerPoint = this.restrictCenter(new cd(jd.lng, jd.lat))
      if (this.centerPoint.zoom) {
        this.zoomLevel = this.centerPoint.zoom
      }
      this.defaultZoomLevel = this.defaultZoomLevel || this.zoomLevel
      this.defaultCenter = this.defaultCenter || this.centerPoint
      if (!this.loaded && !(this.temp.originMapType === BMAP_EARTH_MAP)) {
        var i = this.config.defaultMaxBounds
        var ja = new h(i, 'baidu', this.mapType)
        var i8 = new gI({
          mapType: this.mapType,
          copyright: ja,
          customLayer: false,
          baseLayer: true,
          tileTypeName: 'web',
        })
        i8._isInnerLayer = true
        this.addTileLayer(i8)
        if (
          this.mapType === BMAP_SATELLITE_MAP &&
          this._isHybridShow === true
        ) {
          this._addHybirdMap()
        }
      }
      this.dispatchEvent(i9)
      this.loaded = true
      je = je || {}
      je.callback && je.callback()
    },
    _setPlatformPosition: function (je, jd, jh) {
      jh = jh || {}
      if (je === 0 && jd === 0 && !jh.point) {
        return
      }
      if (isNaN(jh.initMapOffsetX)) {
        jh.initMapOffsetX = this.offsetX
      }
      if (isNaN(jh.initMapOffsetY)) {
        jh.initMapOffsetY = this.offsetY
      }
      var jf = je + jh.initMapOffsetX
      var jc = jd + jh.initMapOffsetY
      if (jh.point) {
        var i = this.restrictCenter(jh.point)
        if (!i.equals(this.centerPoint)) {
          this.centerPoint = i.clone()
          this.fire(new e7('oncenter_changed'))
        }
      } else {
        var i8 = this.offsetX - jf
        var e = this.offsetY - jc
        var T = this.getZoomUnits()
        var jb = this.centerPoint.lng
        var ja = this.centerPoint.lat
        var i9 = new cd(jb, ja)
        this.centerPoint = this.restrictCenter(
          new cd(i9.lng + i8 * T, i9.lat - e * T),
          T
        )
        this.fire(new e7('oncenter_changed'))
        if (this.zoomLevel < 10) {
          jf = this.offsetX - (this.centerPoint.lng - i9.lng) / T
          jc = this.offsetY + (this.centerPoint.lat - i9.lat) / T
        }
      }
      this.offsetX = jf
      this.offsetY = jc
      var jg = this.platform.style
      jg.left = jf + 'px'
      jg.top = jc + 'px'
      this.maskLayer.style.left = -jf + 'px'
      this.maskLayer.style.top = -jc + 'px'
      if (jh.dispatchEvent !== false) {
        this.dispatchEvent(new e7('onmoving'))
      }
    },
    zoomTo: function (e, jb, jf) {
      jf = jf || {}
      jf.zoomCenter = jb
      if (jf.noAnimation !== true) {
        this.deepZoomTo(e, jf)
        return
      }
      if (typeof e !== 'number') {
        return
      }
      var i9 = dO[this.mapType]
      if (!i9) {
        return
      }
      var T = e
      e = this._getProperZoom(e).zoom
      if (e === this.zoomLevel) {
        var jc = new e7('onzoomexceeded')
        jc.targetZoom = T
        this.dispatchEvent(jc)
        jf.callback && jf.callback()
        return
      }
      this.lastLevel = this.zoomLevel
      if (jb) {
        this.temp._cPoint = jb
        this.temp._cPixel = this.pointToPixelIn(jb)
      } else {
        if (this.getInfoWindow()) {
          var je = this.getInfoWindow().getPoint()
          this.temp._cPixel = this.pointToPixelIn(je)
          this.temp._cPoint = je
        }
      }
      if (this.config.zoomCenter) {
        jb = this.config.zoomCenter
        this.temp._cPoint = jb
        this.temp._cPixel = this.pointToPixelIn(jb)
      }
      if (jb || (this.temp.infoWin && this.temp.infoWin.isOpen())) {
        var i = this.temp._cPoint
        var jd = this.temp._cPixel
        var i8 = this.getZoomUnits(e)
        var ja = new cd(
          i.lng + i8 * (this.width / 2 - jd.x),
          i.lat - i8 * (this.height / 2 - jd.y)
        )
        this.centerPoint = this.restrictCenter(ja, i8, e)
        if (this.centerPoint.zoom) {
          e = this.centerPoint.zoom
        }
      }
      if (jf.fireEvent !== false) {
        this.dispatchEvent(new e7('onzoomstart'))
      }
      if (e !== this.zoomLevel) {
        this.zoomLevel = e
        this.dispatchEvent(new e7('onzooming'))
        this.dispatchEvent(new e7('onzoomstartcode'))
      }
      if (jf.fireEvent !== false) {
        this.dispatchEvent(new e7('onzoomend'))
      }
      if (jf.callback) {
        jf.callback()
      }
    },
    deepZoomMedia: function (e) {
      var i = this
      if (!i.temp.isStdCtrlBusy) {
        i.temp.isStdCtrlBusy = true
        i.deepZoomTo(i.zoomLevel + e)
        setTimeout(function () {
          i.temp.isStdCtrlBusy = false
        }, 400)
      }
    },
    deepZoomTo: function (jc, i8) {
      i8 = i8 || {}
      var ja = jc - this.zoomLevel
      var i9 = this._getProperZoom(jc)
      if (i9.exceeded) {
        var e = new e7('onzoomexceeded')
        e.targetZoom = jc
        this.dispatchEvent(e)
        return
      }
      var i
      if (i8.zoomCenter) {
        i = this.pointToPixelIn(i8.zoomCenter)
      } else {
        if (this.getInfoWindow()) {
          i = this.pointToPixelIn(this.getInfoWindow().getPoint(), {
            zoom: this.lastLevel,
          })
        } else {
          var i = new eL(this.width / 2, this.height / 2)
        }
      }
      this.lastLevel = this.zoomLevel
      var jb = this.deepZoom || new ax(this)
      var T = ja > 0 ? 1 : -1
      jb.zoomMap(i, ja, T, null, i8)
    },
    flyToIn: function (jd, e) {
      if (e === this.zoomLevel) {
        this.panToIn(jd)
        return
      }
      var ja = this._getProperZoom(e)
      if (ja.exceeded) {
        var je = new e7('onzoomexceeded')
        je.targetZoom = e
        this.dispatchEvent(je)
        return
      }
      var jc = e - this.zoomLevel
      var T = new eL(this.width / 2, this.height / 2)
      var i = this.pointToPixelIn(jd)
      var jb = new h3(i.x - T.x, i.y - T.y)
      this.lastLevel = this.zoomLevel
      if (
        Math.abs(jc) >= 4 ||
        Math.abs(jb.width) > this.width ||
        Math.abs(jb.height) > this.height
      ) {
        this.centerAndZoomIn(jd, e)
        return
      }
      var i9 = this.deepZoom || new ax(this)
      var i8 = jc > 0 ? 1 : -1
      i9.zoomMap(i, jc, i8, jb)
    },
    panToIn: function (i, T) {
      T = T || {}
      if (!i || i.equals(this.centerPoint)) {
        T.callback && T.callback()
        return
      }
      var i8 = this.pointToPixelIn(i)
      var e = Math.round(this.width / 2)
      var i9 = Math.round(this.height / 2)
      if (
        Math.abs(e - i8.x) > this.width ||
        Math.abs(i9 - i8.y) > this.height ||
        T.noAnimation === true
      ) {
        this._panToIn(e - i8.x, i9 - i8.y, i)
        T.callback && T.callback()
      } else {
        this._panBy(e - i8.x, i9 - i8.y, T)
      }
    },
    _panToIn: function (i, e, i8) {
      var T = this.temp
      if (T.operating === true) {
        return
      }
      if (T.dragAni) {
        T.dragAni.stop()
        T.dragAni = null
        this.dispatchEvent(new e7('onmoveend'))
      }
      this.dispatchEvent(new e7('onmovestart'))
      this._setPlatformPosition(i, e, { point: i8 })
      this.dispatchEvent(new e7('onmoveend'))
    },
    panBy: function (i, e, T) {
      T = T || {}
      i = Math.round(i) || 0
      e = Math.round(e) || 0
      if (
        Math.abs(i) <= this.width &&
        Math.abs(e) <= this.height &&
        T.noAnimation !== true
      ) {
        this._panBy(i, e, T)
      } else {
        this._panToIn(i, e)
        T.callback && T.callback()
      }
    },
    _panBy: function (i, e, i9) {
      if (this.temp.operating === true) {
        return
      }
      i9 = i9 || {}
      this.dispatchEvent(new e7('onmovestart'))
      var i8 = this
      var T = i8.temp
      T.pl = i8.offsetX
      T.pt = i8.offsetY
      if (T.tlPan) {
        T.tlPan.cancel()
      }
      if (T.dragAni) {
        T.dragAni.stop()
        T.dragAni = null
        this.dispatchEvent(new e7('onmoveend'))
      }
      T.tlPan = new e0({
        fps: i9.fps || i8.config.fps,
        duration: i9.duration || i8.config.actionDuration,
        transition: i9.transition || fT.easeInOutQuad,
        render: function (ja) {
          this.terminative = i8.temp.operating
          if (i8.temp.operating) {
            return
          }
          i8._setPlatformPosition(Math.ceil(i * ja), Math.ceil(e * ja), {
            initMapOffsetX: T.pl,
            initMapOffsetY: T.pt,
          })
        },
        finish: function (ja) {
          i8.dispatchEvent(new e7('onmoveend'))
          i8.temp.tlPan = false
          if (i8.temp.stopArrow === true) {
            i8.temp.stopArrow = false
            if (i8.temp.arrow !== 0) {
              i8._arrow()
            }
          }
          i9.callback && i9.callback()
        },
      })
    },
    getCenterIn: function () {
      return this.centerPoint
    },
    getZoom: function () {
      return this.zoomLevel
    },
    setTilt: function () {},
    getTilt: function () {
      return this._tilt
    },
    setHeading: function () {},
    getHeading: function () {
      return this._heading
    },
    restrictCenter: function (jg, i, e) {
      this.isRestrict = false
      i = i || this.getZoomUnits()
      e = e || this.zoomLevel
      var je = this.pixelToPointIn(new eL(this.width, 0), {
        center: jg,
        zoom: e,
      })
      var jc = this.pixelToPointIn(new eL(0, this.height), {
        center: jg,
        zoom: e,
      })
      var jh = jg.lng
      var jm = jg.lat
      if (
        this.config.restrictBounds !== null &&
        !this.config.restrictBounds.isEmpty()
      ) {
        var jl = this.config.restrictBounds
        var i8 = jl.getSouthWest()
        var jj = jl.getNorthEast()
        var jf = ia.convertLL2MC(i8)
        var ja = ia.convertLL2MC(jj)
        jg.lng = this.calcNewLngByBounds(jh, jc, je, jf.lng, ja.lng, i)
        jg.lat = this.calcNewLatByBounds(jm, jc, je, jf.lat, ja.lat, i)
        return jg
      }
      var jd = this.pixelToPointIn(new eL(0, 0), { center: jg, zoom: e })
      var i9 = this.pixelToPointIn(new eL(0, this.height), {
        center: jg,
        zoom: e,
      })
      if (this.zoomLevel < 5) {
        if (jd.lat > gV.MAX_LAT && i9.lat < gV.MIN_LAT) {
          this.isRestrict = true
          var T = gV.MAX_LAT - jg.lat
          var jb = jg.lat - gV.MIN_LAT
          var jk
          if (T < jb) {
            jk = T / (this.height / 2)
          } else {
            jk = jb / (this.height / 2)
          }
          var ji = 18 - m(jk)
          this.zoomLevel = Math.ceil(ji)
          jg.zoom = Math.ceil(ji)
          return jg
        }
      }
      if (jd.lat > gV.MAX_LAT) {
        this.isRestrict = true
        jg.lat = gV.MAX_LAT - (this.height / 2) * i
      } else {
        if (i9.lat < gV.MIN_LAT) {
          this.isRestrict = true
          jg.lat = gV.MIN_LAT + (this.height / 2) * i
        }
      }
      return jg
    },
  })
  function gV(e, T) {
    if (typeof e === 'string') {
      e = document.getElementById(e)
    }
    cJ.call(this)
    this.container = e
    this.width = e.clientWidth
    this.height = e.clientHeight
    this.offsetX = 0
    this.offsetY = 0
    this._setStyle(e)
    e.unselectable = 'on'
    e.innerHTML = ''
    es.ac(e, 'bmap-container')
    e.appendChild(this.render())
    this._initDate = new Date()
    this.platform = e.children[0]
    this.maskLayer = this.platform.children[0]
    this._panes = {}
    this.centerPoint = new cd(0, 0)
    this.zoomLevel = 0
    this._heading = 0
    this._tilt = 0
    this._bounds = new ha()
    this.lastLevel = 0
    this._lock = false
    this._enableTiltZoom = 7
    this._enableHeadingZoom = 7
    this.defaultZoomLevel = null
    this.defaultCenter = null
    this.zoomEventStatus = 'idle'
    this.currentOperation = dI.idle
    this._setConfig(T)
    this._initMapRenderType()
    this._animationInfo = {}
    this._animationInfoUnstopable = {}
    this.suspendLoad = false
    this._customTileLabels = []
    if (this._renderType === 'webgl') {
      this._workerMgr = new iu(this)
      this._featureMgr = new bX()
      es.extend(this, x.prototype)
      this.jobScheduler = new ba(this)
      this.benchmark = new cB()
      this._setupWebGLMap()
      this.deviceInfo = { hardwareInfo: { renderer: '', vendor: '' } }
      if (cH.ifSupportWebGL._renderer) {
        this.deviceInfo.hardwareInfo.renderer = cH.ifSupportWebGL._renderer
        this.deviceInfo.hardwareInfo.vendor = cH.ifSupportWebGL._vendor
      }
    } else {
      es.extend(this, hV.prototype)
    }
    if (!dO[this.config.mapType]) {
      this.config.mapType = BMAPGL_NORMAL_MAP
    }
    if (this.config.mapType === BMAP_EARTH_MAP && !this.config.enableEarth) {
      if (this.forceEnableEarth() === false) {
        this.config.mapType = BMAPGL_NORMAL_MAP
      }
    }
    this.mapType = this.config.mapType
    this.preMapType = null
    if (this.config.enableEarth) {
      var ja = this.maskLayer.style
      ja.opacity = 0
      ja.background = '#000'
      if (this.config.mapType === BMAP_EARTH_MAP) {
        ja.opacity = 1
      }
      setTimeout(function () {
        ja.WebkitTransition = ja.transition = 'opacity .4s'
      }, 100)
    }
    this._isHybridShow = this.config.showStreetLayer
    this.temp = {
      operating: false,
      arrow: 0,
      lastDomMoveTime: 0,
      lastLoadTileTime: 0,
      lastMovingTime: 0,
      canKeyboard: false,
      I: function (i) {
        return es.I(i)
      },
      curSpots: [],
      curSpotsArray: [],
      curAreaSpot: null,
      spotsGuid: 1,
      registerIndex: -1,
      hoverOnSpot: null,
      isStdCtrlBusy: false,
    }
    window.InstanceCore = this.temp.I
    this.platform.style.cursor = this.config.defaultCursor
    this._bind()
    for (var i8 = 0; i8 < bo._register.length; i8++) {
      bo._register[i8](this)
    }
    this.temp.registerIndex = i8
    var i9 = this
    if (this._renderType === 'webgl') {
      gi.load('oppcgl', function () {
        i9._asyncRegister()
      })
    } else {
      gi.load('oppc', function () {
        i9._asyncRegister()
      })
    }
    if (this.config.mapType === 'B_EARTH_MAP') {
      if (!bo.Earth) {
        gi.load('earth', function () {})
      } else {
        i9._syncAndChangeMapType('B_EARTH_MAP')
      }
    }
  }
  gV.MAX_TILT = 87
  gV.MAX_DRAG_TILT = 73
  gV.MAX_DRAG_TILT_L2 = 50
  gV.MIN_TILT = 0
  gV.MAX_LAT = 19431424
  gV.MIN_LAT = -16023552
  gV.WORLD_SIZE_MC_HALF = 20037726.372307256
  gV.WORLD_SIZE_MC = gV.WORLD_SIZE_MC_HALF * 2
  gV.RIGHT_EDGE_POINT = new cd(gV.WORLD_SIZE_MC_HALF, 0)
  gV.LEFT_EDGE_POINT = new cd(-gV.WORLD_SIZE_MC_HALF, 0)
  gV.HIGH_RES_MIN_RATIO = 1.2
  gV.inherits(cJ, 'Map')
  var eT = {
    NORMAL: 'B_NORMAL_MAP',
    EARTH: 'B_EARTH_MAP',
    SATELLITE: 'B_STREET_MAP',
  }
  bo.MapTypeId = eT
  es.extend(gV.prototype, {
    render: function () {
      var e = bK('div', { id: 'platform' })
      var i8 = e.style
      i8.overflow = 'visible'
      i8.position = 'absolute'
      i8.zIndex = 5
      i8.top = i8.left = '0px'
      var i = bK('div', { id: 'mask', class: 'BMap_mask' })
      var T = i.style
      T.position = 'absolute'
      T.top = T.left = '0px'
      T.zIndex = '9'
      T.overflow = 'hidden'
      T.WebkitUserSelect = 'none'
      T.width = this.width + 'px'
      T.height = this.height + 'px'
      e.appendChild(i)
      return e
    },
    _initMapRenderType: function () {
      var e = this.config.forceRenderType
      if (e === 'dom') {
        this._renderType = 'dom'
        return
      } else {
        if (e === 'canvas') {
          if (cH.isModernBrowser && !cH.ifCanvas2dInBlackList()) {
            this._renderType = 'canvas'
            return
          } else {
            this._renderType = 'dom'
            return
          }
        } else {
          if (e === 'webgl') {
            if (cH.ifSupportWebGL()) {
              this._renderType = 'webgl'
              return
            }
          }
        }
      }
      if (cH.ifSupportWebGL() && cH.ifEnableWebGLMap()) {
        this._renderType = 'webgl'
        return
      }
      if (cH.isModernBrowser && cH.ifEnableCanvas2dMap()) {
        this._renderType = 'canvas'
        return
      }
      this._renderType = 'dom'
    },
    _setConfig: function (i) {
      i = i || {}
      this.config = {
        bottomOffset: 0,
        clickInterval: 200,
        enableDragging: true,
        enableRotate: true,
        enableTilt: true,
        enableKeyboard: false,
        enableDblclickZoom: true,
        enableContinuousZoom: true,
        enableWheelZoom: false,
        enableRotateGestures: true,
        enableTiltGestures: true,
        enablePinchZoom: true,
        fixCenterWhenPinch: false,
        enableAutoResize: true,
        zoomCenter: null,
        fps: es.Browser.ie ? 30 : 60,
        zoomerDuration: 240,
        actionDuration: 450,
        defaultCursor: w.defaultCursor,
        draggingCursor: w.draggingCursor,
        overlayMoveCursor: 'pointer',
        coordType: BMAP_COORD_MERCATOR,
        mapType: BMAPGL_NORMAL_MAP,
        drawer: BMAP_SYS_DRAWER,
        enableInertialDragging: true,
        drawMargin: 500,
        drawMarginGL: 500,
        enableFulltimeSpotClick: false,
        enableResizeOnCenter: false,
        isModernBrowser: cH.isModernBrowser,
        forceRenderType: '',
        textRenderType: null,
        ratio: fz() >= gV.HIGH_RES_MIN_RATIO ? 2 : 1,
        enableEarth: cH.ifEnableEarth(),
        defaultMaxBounds: new ha(
          new cd(-21364736, -10616832),
          new cd(23855104, 15859712)
        ),
        showControls: false,
        showRealSunlight: true,
        showMilkyway: true,
        earthBackground: null,
        showStreetLayer: true,
        minZoom: null,
        maxZoom: null,
        style: 'default',
        backgroundColor: null,
        enableIconClick: false,
        autoSafeArea: false,
        ak: null,
        webgl2: false,
        restrictCenter: true,
        restrictBounds: null,
        smaa: true,
        preserveDrawingBuffer: false,
        privateOn: false,
        privateRegions: null,
      }
      for (var T in i) {
        if (i.hasOwnProperty(T)) {
          this.config[T] = i[T]
          if (T === 'fixCenterWhenResize') {
            this.config.enableResizeOnCenter = i[T]
          }
        }
      }
      if (i.style) {
        if (i.style['styleId'] && i.style['styleId'].length < 32) {
          this.config.style = i.style['styleId']
        } else {
          this.config.style = i.style
        }
      }
      this._setTextRenderType()
      this._displayOptions = {
        poi: true,
        poiText: true,
        poiIcon: true,
        overlay: true,
        layer: true,
        building: true,
        indoor: true,
        street: true,
        skyColors: ['rgba(226, 237, 248, 0)', 'rgba(186, 211, 252, 1)'],
        isFlat: false,
        labelMargin: 0,
      }
      if (i.displayOptions) {
        for (var e in i.displayOptions) {
          if (i.displayOptions.hasOwnProperty(e)) {
            this._displayOptions[e] = i.displayOptions[e]
          }
        }
      }
      if (this.config.restrictCenter === false) {
        this._enableTiltZoom = 0
        this._enableHeadingZoom = 0
      }
    },
    getMinZoom: function () {
      var T
      if (dO[this.mapType][this._renderType]) {
        T = dO[this.mapType][this._renderType].minZoom
      } else {
        T = dO[this.mapType].minZoom
      }
      if (this.config.minZoom !== null && this.config.minZoom >= T) {
        T = this.config.minZoom
      }
      if (this.mapType === 'B_EARTH_MAP') {
        return T
      }
      var i = this.getSize()
      var e = this.worldSize(T)
      while (e < i.width) {
        T++
        e = this.worldSize(T)
      }
      return T
    },
    getMaxZoom: function () {
      var e
      if (dO[this.mapType][this._renderType]) {
        e = dO[this.mapType][this._renderType].maxZoom
      } else {
        e = dO[this.mapType].maxZoom
      }
      if (this.config.maxZoom !== null && this.config.maxZoom <= e) {
        e = this.config.maxZoom
      } else {
        if (this._renderType === 'webgl') {
          e = 21
        }
      }
      return e
    },
    _drawFrame: function () {
      this._webglMapScene._painter.draw()
    },
    _setupWebGLMap: function () {
      var e = this
      gi.load('mapgl', function () {
        e._asyncRegister()
      })
    },
    _setStyle: function (i) {
      var e = i.style
      e.overflow = 'hidden'
      if (b0(i).position !== 'absolute') {
        e.position = 'relative'
      }
      e.backgroundImage = 'url(' + w.imgPath + 'bg.png)'
      e.textAlign = 'left'
      e.touchAction = e.MSTouchAction = 'none'
    },
    _bind: function () {
      var e = this
      if (e._renderType !== 'webgl') {
        e._watchSize = function () {
          var T = e.getContainerSize()
          if (e.width !== T.width || e.height !== T.height) {
            var jb = (T.width - e.width) / 2
            var jd = (T.height - e.height) / 2
            var i8 = e.getZoomUnits()
            var ja = e.centerPoint
            if (ja && !e.config.enableResizeOnCenter) {
              e.centerPoint = new cd(ja.lng + jb * i8, ja.lat - jd * i8)
            }
            e.maskLayer.style.width = (e.width = T.width) + 'px'
            e.maskLayer.style.height = (e.height = T.height) + 'px'
            var i9 = new e7('onresize')
            i9.size = T
            e.dispatchEvent(i9)
            e.fire(new e7('onsize_changed'))
            var i = parseInt(e.platform.style.left, 10) || 0
            var jc = parseInt(e.platform.style.top, 10) || 0
            if (
              e.currentOperation !== 'undefined' &&
              e.currentOperation !== dI.idle &&
              (e.offsetX !== i || e.offsetY !== jc)
            ) {
              e._setPlatformPosition(i, jc)
            }
          }
        }
      } else {
        e._watchSize = function () {
          var i = e.getContainerSize()
          if (e.width !== i.width || e.height !== i.height) {
            var i8 = e.getSize()
            e.maskLayer.style.width = (e.width = i.width) + 'px'
            e.maskLayer.style.height = (e.height = i.height) + 'px'
            if (fz() !== e.config.ratio) {
              e.config.ratio = fz()
            }
            var i9 = new e7('onresize')
            i9.size = i
            e.dispatchEvent(i9)
            var T = new e7('onsize_changed')
            T.size = i
            T.oldSize = i8
            e.fire(T)
          }
        }
      }
      if (e.config.enableAutoResize) {
        e.temp.autoResizeTimer = setInterval(e._watchSize, 16)
      }
      this.on('size_changed', function () {
        var i = e.getMinZoom()
        if (e.zoomLevel < i) {
          e.setZoomIn(i, { noAnimation: true })
        }
      })
      this.on('zoom_changed', function () {
        this.dispatchEvent(new e7('onzooming'))
      })
    },
    addControl: function (e) {
      if (e && bG(e._i)) {
        e._i(this)
        this.dispatchEvent(new e7('onaddcontrol', e))
      }
    },
    removeControl: function (e) {
      if (e && bG(e.remove)) {
        e.remove()
        this.dispatchEvent(new e7('onremovecontrol', e))
      }
    },
    addContextMenu: function (e) {
      if (e) {
        e.initialize(this)
        this.dispatchEvent(new e7('onaddcontextmenu', e))
      }
    },
    removeContextMenu: function (e) {
      if (e) {
        this.dispatchEvent(new e7('onremovecontextmenu', e))
        e.remove()
      }
    },
    addDistrictLayer: function (e) {
      if (e) {
        e.initialize(this)
      }
    },
    removeDistrictLayer: function (e) {
      if (e) {
        e.removeDistrict(this, e)
      }
    },
    addOverlay: function (i) {
      if (i && bG(i._i)) {
        var T = new e7('onbeforeaddoverlay', i)
        T.overlay = i
        this.dispatchEvent(T)
        i._i(this)
        T = new e7('onaddoverlay', i)
        T.overlay = i
        this.dispatchEvent(T)
      }
    },
    removeOverlay: function (i) {
      if (i && bG(i.remove)) {
        var T = new e7('onremoveoverlay', i)
        T.overlay = i
        i.remove()
        this.dispatchEvent(T)
      }
    },
    clearOverlays: function () {
      this.dispatchEvent(new e7('onclearoverlays'))
    },
    addTileLayer: function (i9) {
      if (!i9) {
        return
      }
      for (var i8 = 0, e = this.tileMgr.tileLayers.length; i8 < e; i8++) {
        var T = this.tileMgr.tileLayers[i8]
        if (T === i9 || T.getMapType() === i9.getMapType()) {
          return
        }
      }
      i9.initialize(this)
      this.dispatchEvent(new e7('onaddtilelayer', i9))
    },
    removeTileLayer: function (e) {
      if (e) {
        e.remove()
        this.dispatchEvent(new e7('onremovetilelayer', e))
      }
    },
    getTileLayer: function (e) {
      if (this.tileMgr) {
        return this.tileMgr.getTileLayer(e)
      }
      return null
    },
    setMapType: function (e) {
      var i = this
      if (this.mapType === e || this._mapTypeChanging) {
        return
      }
      if (e === BMAP_EARTH_MAP && !this.config.enableEarth) {
        return
      }
      if (this._earth && this._earth.getLock()) {
        return
      }
      this._mapTypeChanging = true
      this.preMapType = this.mapType
      this._boundsInPreMapType = this.getBoundsIn()
      if (this.preMapType === BMAP_SATELLITE_MAP) {
        this._preStreetLayerShow = this._isHybridShow
      }
      if (e === BMAP_EARTH_MAP) {
        if (!bo.Earth) {
          gi.load('earth', function () {
            i._syncAndChangeMapType(e)
          })
          return
        }
        i._syncAndChangeMapType(e)
      } else {
        if (this.preMapType !== BMAP_EARTH_MAP) {
          this._changeFlatMapType(e)
          this._mapTypeChanging = false
        } else {
          this._setMapTypeStatus(e, function (T, i8) {
            var i9 = i._earth.getEarthCanvas()
            i._changeFlatMapType(e, this.preMapType)
            if (i._mapTypeChangAni) {
              i._mapTypeChangAni.stop()
            }
            i._mapTypeChangAni = cY.start({
              el: i9,
              style: 'opacity',
              startValue: 1,
              endValue: 0,
              duration: 200,
              callback: function () {
                i._mapTypeChangAni = null
                i._mapTypeChanging = false
              },
            })
            T = ia.convertLL2MC(T)
            if (i._renderType === 'webgl') {
              es.extend(i, x.prototype)
              i.setCenterIn(T, { noAnimation: true })
              i.setZoomIn(i8, { noAnimation: true })
            } else {
              es.extend(i, hV.prototype)
              i.centerAndZoomIn(T, i8)
            }
          })
        }
      }
    },
    _changeFlatMapType: function (jb) {
      if (!jb || !dO[jb]) {
        return
      }
      var jj = this.preMapType
      this.mapType = jb
      var i8 = this.getTileLayer(jj)
      if (i8) {
        this.removeTileLayer(i8)
      } else {
        if (this.tileMgr.tileLayers.length) {
          var ji = this.getTileLayer('B_NORMAL_MAP')
          if (ji) {
            this.removeTileLayer(ji)
          } else {
            ji = this.getTileLayer('B_SATELLITE_MAP')
            ji && this.removeTileLayer(ji)
          }
        }
      }
      this._preStreetLayerShow = this.config.showStreetLayer
      if (jj === BMAP_SATELLITE_MAP && this._preStreetLayerShow) {
        this._removeHybirdMap()
      }
      if (
        this.mapType !== BMAP_EARTH_MAP ||
        this._renderType !== 'webgl' ||
        this.baseLayerAdded !== true
      ) {
        var T = new ha(new cd(-21364736, -10616832), new cd(23855104, 15859712))
        var jg = new h(T, 'baidu', jb)
        var i9 = new gI({
          mapType: this.mapType,
          copyright: jg,
          dataType: this.mapType === BMAP_SATELLITE_MAP ? fY : gT,
          customLayer: this.mapType === BMAP_SATELLITE_MAP,
          baseLayer: true,
          transparentPng: true,
          tileTypeName: this.mapType === BMAP_SATELLITE_MAP ? 'web' : 'na',
        })
        i9._isInnerLayer = true
        i9.setZIndex(0)
        this.addTileLayer(i9)
        if (this._renderType === 'webgl' && !this.baseLayerAdded) {
          this.baseLayerAdded = true
        }
      }
      if (jb === BMAP_SATELLITE_MAP) {
        this._featureMgr.clearLabelOverlayData()
        this._featureMgr.setLabelData([])
        if (
          this._preStreetLayerShow === true ||
          typeof this._preStreetLayerShow === 'undefined'
        ) {
          this._addHybirdMap()
        }
      }
      var jd = this.tileMgr.tileLayers
      for (var jc = 0, ja = jd.length; jc < ja; jc++) {
        var je = jd[jc]
        var jh = je.tilesDiv
        if (!jh) {
          continue
        }
        if (!je._isInnerLayer && jh.style.visibility === 'hidden') {
          jh.style.visibility = ''
        }
      }
      var jf = new e7('onmaptypechange')
      jf.zoomLevel = this.zoomLevel
      jf.mapType = jb
      jf.exMapType = jj
      this.dispatchEvent(jf)
    },
    showStreetLayer: function (e) {
      e ? this._addHybirdMap() : this._removeHybirdMap()
    },
    hideStreetLayer: function (e) {
      this._hideStreetLayerOptions = e
      this._removeHybirdMap(e)
    },
    _addHybirdMap: function () {
      this._isHybridShow = true
      if (this.mapType === 'B_EARTH_MAP') {
        if (this._earth) {
          this._earth.showStreetLayer()
        }
        return
      }
      if (this._hybridTileLayer) {
        this.addTileLayer(this._hybridTileLayer)
        var jb = new e7('onstreetlayer_show')
        this.dispatchEvent(jb)
        return
      }
      var i9 = new ha(new cd(-21364736, -10616832), new cd(23855104, 15859712))
      var T = new h(i9, '', BMAP_HYBRID_MAP)
      var i = new gI({
        copyright: T,
        transparentPng: true,
        tileTypeName: 'web',
      })
      i._isInnerLayer = true
      var i8 = this.isCanvasMap()
      i.getTilesUrl = function (jc, jh) {
        var jf = dO.B_STREET_MAP
        var jg = iN('ditu', 'satelliteStreet')
        var jd = jg.ver
        var e = jg.udt
        var je =
          jf.tileUrls[Math.abs(jc.x + jc.y) % jf.tileUrls.length] +
          '?qt=vtile&x=' +
          (jc.x + '').replace(/-/gi, 'M') +
          '&y=' +
          (jc.y + '').replace(/-/gi, 'M') +
          '&z=' +
          jh +
          '&styles=sl&v=' +
          jd +
          '&udt=' +
          e +
          '$scaler=' +
          fz() +
          '&showtext=' +
          (i8 ? 0 : 1)
        return je
      }
      this._isHybridShow = true
      this.addTileLayer(i)
      this._hybridTileLayer = i
      var ja = new e7('onstreetlayer_show')
      this.dispatchEvent(ja)
    },
    _removeHybirdMap: function (i) {
      this._isHybridShow = false
      if (this.mapType === 'B_EARTH_MAP') {
        if (this._earth) {
          this._earth.hideStreetLayer(i)
        }
        return
      }
      if (this._hybridTileLayer) {
        this.removeTileLayer(this._hybridTileLayer)
        var T = new e7('onstreetlayer_hide')
        this.dispatchEvent(T)
      }
    },
    isStreetLayerShow: function () {
      return this._isHybridShow
    },
    getTileId: function (e, ja) {
      var i8 = dO[this.mapType]
      if (typeof i8 !== 'object') {
        return null
      }
      var T = i8.baseUnits * Math.pow(2, i8.zoomLevelBase - ja)
      var i9 = parseInt(e.lng / T, 10)
      var i = parseInt(e.lat / T, 10)
      return { row: i9, column: i, level: ja }
    },
    reset: function () {
      this.centerAndZoomIn(this.defaultCenter, this.defaultZoomLevel, true)
    },
    setOptions: function (i) {
      i = i || {}
      var i9 = this
      for (var i8 in i) {
        if (i.hasOwnProperty(i8)) {
          var T = true
          if (typeof i[i8] !== 'object') {
            T = i[i8] !== this.config[i8]
          }
          this.config[i8] = i[i8]
          if (i8 === 'fixCenterWhenResize') {
            this.config.enableResizeOnCenter = i[i8]
          }
          if (!T) {
            continue
          }
          switch (i8) {
            case 'style':
            case 'styleUrl':
              var e = { os: i.style.os, sv: i.style.sv }
              if (i8 === 'style' && i.styleUrl) {
                break
              }
              this.fire(new e7('onstyle_willchange'))
              this.loadMapStyleFiles(function () {
                var ja = new e7('onlayer_update')
                ja.name = 'na'
                i9.fire(ja)
              }, e)
              break
            case 'enableAutoResize':
              if (i[i8] === true) {
                this.enableAutoResize()
              } else {
                this.disableAutoResize()
              }
              break
            case 'displayOptions':
              this.setDisplayOptions(i[i8])
              break
          }
        }
      }
    },
    setPrivateStatus: function (i) {
      if (typeof i === 'boolean') {
        if (this.config.privateOn !== i) {
          this.config.privateOn = i
          var e = new e7('onlayer_update')
          e.name = 'na'
          this.fire(e)
        }
      }
    },
    getPrivateStatus: function () {
      return this.config.privateOn
    },
    setPrivateRegions: function (i9) {
      if (i9 && i9 instanceof Array) {
        var i8 = true
        for (var T = 0; T < i9.length; T++) {
          if (i9[T] instanceof cp) {
            continue
          } else {
            i8 = false
            break
          }
        }
        if (i8) {
          this.config.privateRegions = i9
          var e = new e7('onlayer_update')
          e.name = 'na'
          this.fire(e)
        }
      }
    },
    getPrivateRegions: function () {
      if (!this.config.privateRegions) {
        return null
      } else {
        return this.config.privateRegions
      }
    },
    enableDragging: function () {
      this.config.enableDragging = true
    },
    disableDragging: function () {
      this.config.enableDragging = false
    },
    enableInertialDragging: function () {
      this.config.enableInertialDragging = true
    },
    disableInertialDragging: function () {
      this.config.enableInertialDragging = false
    },
    enableScrollWheelZoom: function () {
      this.config.enableWheelZoom = true
    },
    disableScrollWheelZoom: function () {
      this.config.enableWheelZoom = false
    },
    enableContinuousZoom: function () {
      this.config.enableContinuousZoom = true
    },
    disableContinuousZoom: function () {
      this.config.enableContinuousZoom = false
    },
    enableResizeOnCenter: function () {
      this.config.enableResizeOnCenter = true
    },
    disableResizeOnCenter: function () {
      this.config.enableResizeOnCenter = false
    },
    enableDoubleClickZoom: function () {
      this.config.enableDblclickZoom = true
    },
    disableDoubleClickZoom: function () {
      this.config.enableDblclickZoom = false
    },
    enableKeyboard: function () {
      this.config.enableKeyboard = true
    },
    disableKeyboard: function () {
      this.config.enableKeyboard = false
    },
    getSize: function () {
      return new h3(this.width, this.height)
    },
    enablePinchToZoom: function () {
      this.config.enablePinchZoom = true
    },
    disablePinchToZoom: function () {
      this.config.enablePinchZoom = false
    },
    enableTilt: function () {
      this.config.enableTilt = true
    },
    disableTilt: function () {
      this.config.enableTilt = false
    },
    enableRotate: function () {
      this.config.enableRotate = true
    },
    disableRotate: function () {
      this.config.enableRotate = false
    },
    enableAutoResize: function () {
      this.config.enableAutoResize = true
      this._watchSize()
      if (!this.temp.autoResizeTimer) {
        this.temp.autoResizeTimer = setInterval(this._watchSize, 16)
      }
    },
    disableAutoResize: function () {
      this.config.enableAutoResize = false
      if (this.temp.autoResizeTimer) {
        clearInterval(this.temp.autoResizeTimer)
        this.temp.autoResizeTimer = null
      }
    },
    checkResize: function () {
      this._watchSize()
    },
    resize: function () {
      this._watchSize()
    },
    getContainerSize: function () {
      return new h3(this.container.clientWidth, this.container.clientHeight)
    },
    _getProperZoom: function (T) {
      if (!T) {
        T = this.zoomLevel
      }
      var i = this.getMinZoom()
      var e = this.getMaxZoom()
      var i8 = false
      if (T < i) {
        i8 = true
        T = i
      }
      if (T > e) {
        i8 = true
        T = e
      }
      if (this._renderType !== 'webgl') {
        T = Math.round(T)
      }
      return { zoom: T, exceeded: i8 }
    },
    getContainer: function () {
      return this.container
    },
    getZoomUnits: function (T) {
      if (this.mapType === BMAP_EARTH_MAP) {
        return Math.pow(2, 18 - this._earth.getImageZoom())
      }
      var e = dO[this.mapType]
      if (typeof e !== 'object') {
        return null
      }
      var i = T || this.zoomLevel
      return Math.pow(2, e.zoomLevelBase - i)
    },
    pointToPixelIn: function (jj, jl) {
      if (!jj) {
        return
      }
      jl = jl || {}
      if (this.mapType === BMAP_EARTH_MAP) {
        var ja
        if (!jj._llPt) {
          ja = ia.convertMC2LL(jj)
          jj._llPt = ja
        }
        ja = jj._llPt
        var jf = null
        var i9 = null
        if (typeof jl.zoom === 'number') {
          var ji = this._earth
          var jk = ji._getEarthZoomByImgZoom(jl.zoom)
          if (jk <= 3) {
            jf = ji._generateTmpPMatrix(jk)
          }
          i9 = ji._generateTmpMVMatrix(ji.getCenter(), jk)
        }
        var jb = this._earth.fromLatLngToPixel(ja, {
          useRound: false,
          isCalcOnBack: true,
          matrixInfo: { modelViewMatrix: i9, projectionMatrix: jf },
        })
        return jb
      }
      if (
        (this._heading % 360 === 0 && this._tilt === 0) ||
        !this._webglMapCamera
      ) {
        var jh = this.getZoomUnits(jl.zoom)
        var jd = jl.center || this.centerPoint
        var i8 = this.width / 2
        var jc = this.height / 2
        var jg
        if (jj.lng * jd.lng < 0) {
          var i = Math.abs(jj.lng - jd.lng)
          var e = (ev._mc180X * 2 - i) / jh
          if (jd.lng < 0) {
            jg = i8 - e
          } else {
            jg = i8 + e
          }
        } else {
          jg = (jj.lng - jd.lng) / jh + i8
        }
        var je = (jd.lat - jj.lat) / jh + jc
        if (jl.useRound !== false) {
          jg = Math.round(jg)
          je = Math.round(je)
        }
        return new eL(jg, je)
      }
      var T = this._webglMapCamera.fromMCToScreenPixel(jj.lng, jj.lat, jl)
      if (jl.useRound === false) {
        return T
      }
      T.x = Math.round(T.x)
      T.y = Math.round(T.y)
      return T
    },
    pixelToPointIn: function (e, jf) {
      if (!e) {
        return
      }
      jf = jf || {}
      if (this.mapType === BMAP_EARTH_MAP) {
        if (typeof jf.zoom === 'number') {
          var jd = this._earth
          var ja = null
          var T = null
          var je = jd._getEarthZoomByImgZoom(jf.zoom)
          if (je <= 3) {
            ja = jd._generateTmpPMatrix(je)
          }
          T = jd._generateTmpMVMatrix(jd.getCenter(), je)
        }
        var i = this._earth.fromPixelToLatLng(e, {
          matrixInfo: { modelViewMatrix: T, projectionMatrix: ja },
        })
        if (i === null) {
          return null
        }
        return ia.convertLL2MC(i)
      }
      if (
        (this._heading % 360 !== 0 || this._tilt > 0) &&
        this._webglMapCamera
      ) {
        return this._webglMapCamera.fromScreenPixelToMC(e.x, e.y, jf)
      }
      var jb = jf.center || this.centerPoint
      var jc = this.getZoomUnits(jf.zoom)
      var i9 = jb.lng + jc * (e.x - this.width / 2)
      var i8 = jb.lat - jc * (e.y - this.height / 2)
      return new cd(i9, i8)
    },
    pointToOverlayPixelIn: function (e, i8) {
      i8 = i8 || {}
      var T = this.pointToPixelIn(e, {
        zoom: i8.zoom,
        center: i8.center,
        forLabel: true,
        frustumTest: true,
        useRound: i8.useRound,
      })
      if (!T) {
        return
      }
      if (i8.fixPosition && this.mapType !== 'B_EARTH_MAP') {
        var i9 = this.getSize()
        var i = this.worldSize(i8.zoom)
        if (T.x > i9.width) {
          while (T.x > i9.width) {
            T.x -= i
          }
        } else {
          if (T.x < 0) {
            while (T.x < 0) {
              T.x += i
            }
          }
        }
      }
      if (this._renderType === 'webgl') {
        return T
      }
      T.x -= this.offsetX
      T.y -= this.offsetY
      return T
    },
    overlayPixelToPointIn: function (i, e) {
      if (!i) {
        return
      }
      var T = i.clone()
      if (this._renderType !== 'webgl') {
        T.x += this.offsetX
        T.y += this.offsetY
      }
      return this.pixelToPointIn(T, e)
    },
    getProjection: function () {
      return new ia()
    },
    lnglatToMercator: function (e, i8) {
      var i = new cd(e, i8)
      var T = ia.convertLL2MC(i)
      return [T.lng, T.lat]
    },
    mercatorToLnglat: function (i, e) {
      if (isNaN(i) || isNaN(e)) {
        return []
      }
      i = parseFloat(i)
      e = parseFloat(e)
      var i8 = new cd(i, e)
      var T = ia.convertMC2LL(i8)
      return [T.lng, T.lat]
    },
    getBoundsIn: function () {
      var jl = arguments[0]
      if (this.mapType === BMAP_EARTH_MAP && this._earth) {
        var jf = this._earth.getCustomBounds()
        if (!jf) {
          return this.config.defaultMaxBounds
        }
        var je = jf.getSouthWest()
        var e = jf.getNorthEast()
        if (je.lng > e.lng) {
          e.lng = 180
        }
        var jC = ia.convertLL2MC(je)
        var js = ia.convertLL2MC(e)
        var ji = this.config.defaultMaxBounds
        var jr = Math.max(jC.lng, ji.sw.lng)
        var jq = Math.max(jC.lat, ji.sw.lat)
        var jk = Math.min(js.lng, ji.ne.lng)
        var jj = Math.min(js.lat, ji.ne.lat)
        var jn = new ha(new cd(jr, jq), new cd(jk, jj))
        jn.pointBottomLeft = new cd(jr, jq)
        jn.pointBottomRight = new cd(jk, jq)
        jn.pointTopLeft = new cd(jr, jj)
        jn.pointTopRight = new cd(jk, jj)
        jn.setMinMax()
        jn.makeNormalizedPoint(this._earth.getHeading())
        return jn
      }
      jl = jl || {}
      var i9 = jl.margins || [0, 0, 0, 0]
      var jx = this.pixelToPointIn({ x: i9[3], y: this.height - i9[2] }, jl)
      var jB = this.pixelToPointIn({ x: this.width - i9[1], y: i9[0] }, jl)
      var jp = typeof jl.heading === 'number' ? jl.heading : this._heading % 360
      var T = typeof jl.tilt === 'number' ? jl.tilt : this._tilt
      var jh = this._webglMapCamera
      if ((jp === 0 && T === 0) || !jh) {
        this._bounds.setSouthWest(jx)
        this._bounds.setNorthEast(jB)
        this._bounds.pointBottomLeft = jx
        this._bounds.pointBottomRight = new cd(jB.lng, jx.lat)
        this._bounds.pointTopRight = jB
        this._bounds.pointTopLeft = new cd(jx.lng, jB.lat)
        this._bounds.setMinMax()
        this._bounds.makeNormalizedPoint(jp)
        return this._bounds
      }
      var jo = this.pixelToPointIn({ x: i9[3], y: i9[0] }, jl)
      var i8 = jh.getPosition()
      var jD = Math.sqrt(
        Math.pow(jo.lng - i8[0], 2) + Math.pow(jo.lat - i8[1], 2)
      )
      var jy = this.getZoomUnits()
      var jF = jD / jy
      var jv = jh._frustumSideLen
      var jd = jh._fovy
      if (jF > jv || 90 - T < jd / 2) {
        var jE = [jo.lng - i8[0], jo.lat - i8[1]]
        if (90 - T < jd / 2) {
          jE[0] = -jE[0]
          jE[1] = -jE[1]
        }
        var jw = jv * jy
        var jc = [(jE[0] / jD) * jw + i8[0], (jE[1] / jD) * jw + i8[1]]
        var jt = [jB.lng - i8[0], jB.lat - i8[1]]
        if (90 - T < jd / 2) {
          jt[0] = -jt[0]
          jt[1] = -jt[1]
        }
        var ja = [(jt[0] / jD) * jw + i8[0], (jt[1] / jD) * jw + i8[1]]
        jo.lng = jc[0]
        jo.lat = jc[1]
        jB.lng = ja[0]
        jB.lat = ja[1]
      }
      var jm = this.pixelToPointIn(
        { x: this.width - i9[1], y: this.height - i9[2] },
        jl
      )
      var ju = [jx, jB, jo, jm]
      var jA = ju[0].lng
      var jG = ju[0].lat
      var jb = ju[0].lng
      var jg = ju[0].lat
      for (var jz = 1; jz < 4; jz++) {
        if (ju[jz].lng < jA) {
          jA = ju[jz].lng
        }
        if (ju[jz].lng > jb) {
          jb = ju[jz].lng
        }
        if (ju[jz].lat < jG) {
          jG = ju[jz].lat
        }
        if (ju[jz].lat > jg) {
          jg = ju[jz].lat
        }
      }
      this._bounds.setSouthWest(new cd(jA, jG))
      this._bounds.setNorthEast(new cd(jb, jg))
      this._bounds.pointTopLeft = jo
      this._bounds.pointTopRight = jB
      this._bounds.pointBottomRight = jm
      this._bounds.pointBottomLeft = jx
      this._bounds.makeNormalizedPoint(jp)
      this._bounds.setMinMax()
      return this._bounds
    },
    isLoaded: function () {
      return !!this.loaded
    },
    _getBestLevel: function (i, jh) {
      var ja = 0
      if (this._renderType === 'webgl' && !bJ()) {
        ja = 100
      }
      var jb = jh.margins || [10, 10, 10, 10]
      var i8 = jh.zoomFactor || 0
      var jc = jb[1] + jb[3]
      var i9 = jb[0] + jb[2]
      var e = this.getMinZoom()
      var jg = this.getMaxZoom()
      var jf = i.toSpan()
      var je = jf.width / (this.width - jc - ja)
      var jd = jf.height / (this.height - i9 - ja)
      var T = 18 - m(Math.max(je, jd))
      if (T < e) {
        T = e
      }
      if (T > jg) {
        T = jg
      }
      T += i8
      if (this._renderType !== 'webgl') {
        T = Math.floor(T)
      }
      return T
    },
    getViewportIn: function (jh, i9) {
      if (this.mapType === BMAP_EARTH_MAP) {
        jh = jh || []
        var jb = []
        for (var ji = 0; ji < jh.length; ji++) {
          if (!jh[ji]) {
            continue
          }
          jb.push(ia.convertMC2LL(jh[ji]))
        }
        var jj = this._earth.getViewportIn(jb, i9)
        var i8 = jj.center
        var jf = jj.zoom
        var jn = ia.convertLL2MC(i8)
        return { center: jn, zoom: jf }
      }
      var jd = { center: this.getCenterIn(), zoom: this.getZoom() }
      if (!jh || jh.length === 0) {
        return jd
      }
      i9 = i9 || {}
      var jc
      if (jh instanceof ha) {
        jc = jh
      } else {
        var ja = jh
        jc = new ha()
        for (var jg = ja.length - 1; jg >= 0; jg--) {
          jc.extend(ja[jg])
        }
        if (jc.isEmpty()) {
          return jd
        }
      }
      var jm = jc.getCenter()
      var e = this._getBestLevel(jc, i9)
      if (i9.margins) {
        var T = i9.margins
        var jl = (T[1] - T[3]) / 2
        var je = (T[0] - T[2]) / 2
        var jk = this.getZoomUnits(e)
        jm.lng = jm.lng + jk * jl
        jm.lat = jm.lat + jk * je
      }
      return { center: jm, zoom: e }
    },
    setViewportIn: function (i8, i9) {
      if (this.mapType === BMAP_EARTH_MAP) {
        var jd
        if (i8 && i8.center) {
          var T = ia.convertMC2LL(i8.center)
          var jb = this._earth._getEarthZoomByImgZoom(i8.zoom, T)
          jd = { center: T, zoom: jb }
        } else {
          jd = []
          for (var ja = 0; ja < i8.length; ja++) {
            var jc = ia.convertMC2LL(i8[ja])
            jd[ja] = new b8(jc.lat, jc.lng)
          }
        }
        this._earth.setViewportIn(jd, i9)
        return
      }
      var e
      if (i8 && i8.center) {
        e = i8
      } else {
        e = this.getViewportIn(i8, i9)
      }
      i9 = i9 || {}
      if (this._renderType === 'webgl') {
        this.centerAndZoomIn(e.center, e.zoom, i9)
        return
      }
      if (e.zoom === this.zoomLevel && i9.enableAnimation !== false) {
        this.panToIn(e.center, { duration: 200, callback: i9.callback })
      } else {
        this.centerAndZoomIn(e.center, e.zoom, i9)
      }
    },
    addSpots: function (T, i) {
      if (!T || T.length === 0) {
        return
      }
      i = i || {}
      var ja = i.zIndex || 0
      var i9 =
        typeof i.enableMultiResponse === 'undefined'
          ? true
          : !!i.enableMultiResponse
      this.spotsPool = this.spotsPool || {}
      var e = 'sp' + this.temp.spotsGuid++
      this.spotsPool[e] = {
        spots: T.slice(0),
        zIndex: ja,
        enableMultiResponse: i9,
      }
      var i8 = this
      gi.load('hotspot', function () {
        i8._asyncRegister()
      })
      return e
    },
    getSpots: function (e) {
      return (this.spotsPool[e] && this.spotsPool[e].spots) || []
    },
    removeSpots: function (e) {
      if (!e || !this.spotsPool[e]) {
        return
      }
      delete this.spotsPool[e]
    },
    clearSpots: function () {
      delete this.spotsPool
    },
    getIconByClickPosition: function (i) {
      if (!this.config.enableIconClick || !this._spotsMgr) {
        return null
      }
      var e = this._spotsMgr.getSpotsByScreenPosition(i)
      if (e[0] && e[0].userdata) {
        var T = e[0].userdata
        return { name: T.name, uid: T.uid, position: T.iconPoint || e[0].pt }
      }
      return null
    },
    setBounds: function (e) {
      dO[this.mapType].bounds = e.clone()
    },
    getCoordType: function () {
      return this.config.coordType
    },
    getPanes: function () {
      return this._panes
    },
    getInfoWindow: function () {
      if (this.temp.infoWin && this.temp.infoWin.isOpen()) {
        return this.temp.infoWin
      }
      return null
    },
    getDistanceIn: function (i9, e) {
      if (!i9 || !e) {
        return
      }
      if (i9.equals(e)) {
        return 0
      }
      if (this.mapType === BMAP_EARTH_MAP) {
        var i8 = ia.convertMC2LL(i9)
        var T = ia.convertMC2LL(e)
        return this._earth.getDistance(i8, T)
      }
      var i = ia.getDistanceByMC(i9, e)
      return i
    },
    getOverlays: function () {
      var ja = []
      var jb = this._overlays
      var i9 = this._customOverlays
      if (jb) {
        for (var i8 in jb) {
          if (jb[i8] instanceof d6) {
            ja.push(jb[i8])
          }
        }
      }
      if (i9) {
        for (var T = 0, e = i9.length; T < e; T++) {
          ja.push(i9[T])
        }
      }
      return ja
    },
    getMapType: function () {
      return this.mapType
    },
    getMapCoordType: function () {
      return this.coordType
    },
    _asyncRegister: function () {
      for (var e = this.temp.registerIndex; e < bo._register.length; e++) {
        bo._register[e](this)
      }
      this.temp.registerIndex = e
    },
    setDefaultCursor: function (e) {
      this.config.defaultCursor = e
      if (this.platform) {
        this.platform.style.cursor = this.config.defaultCursor
      }
    },
    getDefaultCursor: function () {
      return this.config.defaultCursor
    },
    setOverlayMoveCursor: function (e) {
      this.config.overlayMoveCursor = e
    },
    getOverlayMoveCursor: function () {
      return this.config.overlayMoveCursor
    },
    setDraggingCursor: function (e) {
      this.config.draggingCursor = e
    },
    getDraggingCursor: function () {
      return this.config.draggingCursor
    },
    _syncAndChangeMapType: function (e) {
      var i = this
      if (i._renderType === 'webgl' && i.getTilt() > gV.MAX_DRAG_TILT_L2) {
        i.setTilt(gV.MAX_DRAG_TILT_L2, {
          callback: function () {
            i._changeEarthMapType(e)
          },
        })
      } else {
        i._changeEarthMapType(e)
      }
    },
    _changeEarthMapType: function (T) {
      var i8 = this
      var jb = i8.tileMgr.tileLayers
      if (this._mapTypeChangAni) {
        this._mapTypeChangAni.stop()
      }
      var ja
      if (this._earth) {
        ja = this._earth.getEarthCanvas()
      }
      if (!this._earth) {
        this.maskLayer.style.opacity = 1
        this.maskLayer.style.zIndex = 999
        this.maskLayer.style.background = '#000'
      }
      this._mapTypeChangAni = new e0({
        duration: 400,
        render: function (e) {
          if (!i8._earth) {
            return
          }
          ja.style.opacity = e
        },
        finish: function () {
          for (var e = jb.length - 1, jc = e; jc >= 0; jc--) {
            var je = jb[jc].tilesDiv
            if (je) {
              je.style.visibility = 'hidden'
            }
            if (jb[jc]._isInnerLayer && i8._renderType !== 'webgl') {
              i8.removeTileLayer(jb[jc])
            }
          }
          i8._mapTypeChangAni = null
          i8._mapTypeChanging = false
          function jd() {
            var ji = i8.getZoom() - 2
            var jj = i8.getCenterIn()
            var jg = ia.convertMC2LL(jj)
            i8._earth = new bo.Earth(i8, {
              center: jg,
              zoom: ji,
              showRealSunlight: i8.config.showRealSunlight,
              showMilkyway: i8.config.showMilkyway,
              earthBackground: i8.config.earthBackground,
            })
            i8._proxyEarthEvents()
            var jf = i8.mapType
            i8.mapType = T
            var jh = new e7('onmaptypechange')
            jh.zoomLevel = this.zoomLevel
            jh.mapType = T
            jh.exMapType = jf
            i8.dispatchEvent(jh)
            i8._setMapTypeStatus(T)
            es.extend(i8, bo.EarthView.prototype)
            if (!i8._navigationCtrl && i8.config.showControls) {
              i8._navigationCtrl = new eu(i8)
            }
          }
          if (!i8._earth) {
            if (bo['FeatureStyle' + i8.config.style]) {
              jd()
            } else {
              i8.loadMapStyleFiles(function () {
                jd()
              })
            }
          }
          if (parseInt(i8.maskLayer.style.opacity, 10) === 1) {
            setTimeout(function () {
              i8.maskLayer.style.zIndex = 9
              i8.maskLayer.style.opacity = 0
            }, 1000)
          }
        },
      })
      if (!this._earth) {
        return
      }
      var i = this.mapType
      this.mapType = T
      var i9 = new e7('onmaptypechange')
      i9.zoomLevel = this.zoomLevel
      i9.mapType = T
      i9.exMapType = i
      this.dispatchEvent(i9)
      i8._setMapTypeStatus(T)
      es.extend(i8, bo.EarthView.prototype)
    },
    getMapStyleId: function () {
      if (typeof this.config.style === 'string') {
        return this.config.style
      }
      return this.config.mapStyleId || 'custom'
    },
    _setMapTypeStatus: function (T) {
      var jc = arguments[1]
      if (T === BMAP_EARTH_MAP) {
        var ja = this._earth.getEarthCanvas()
        if (ja) {
          ja.style.display = ''
        }
        var jd = { noAnimation: true }
        this._earth.setCenter(ia.convertMC2LL(this.centerPoint), jd)
        this._earth.setImageZoom(this.zoomLevel, jd)
        this._earth.setTilt(this.getTilt(), jd)
        this._earth.setHeading(this.getHeading(), jd)
      } else {
        if (this.preMapType === BMAP_EARTH_MAP && this._earth) {
          var jb = this._earth
          var i8 = jb.getMapZoom()
          var i9 = jb._imageRawZoom || i8
          var i = i9 - i8
          var e = jb.getCenter()
          if (this._renderType === 'webgl') {
            this._tilt = jb.getTilt()
            if (this.zoomLevel > 7) {
              this._heading = jb.getHeading()
              jc && jc(e, i8)
              return
            }
            if (jb.getHeading() !== 0) {
              jb.setTilt(this.getTilt())
              jb.setHeading(this.getHeading(), {
                callback: function () {
                  jc && jc(e, i8)
                },
              })
            } else {
              jc && jc(e, i8)
            }
            return
          }
          if (i < 0.1 && jb.getTilt() === 0 && jb.getHeading() === 0) {
            jc && jc(e, i8)
            return
          }
          jb.setTilt(0)
          jb.setHeading(0)
          jb.setZoom(jb.getZoom() - i, {
            callback: function () {
              jc && jc(e, i8)
            },
          })
        }
      }
    },
    _proxyEarthEvents: function () {
      var i9 = this
      var ja = this._earth
      ja.on('tilesload', function (i) {
        i9.fire(i)
      })
      ja.on('centerandzoom', function (i) {
        i9.dispatchEvent(new e7('onmoveend'))
        i9.dispatchEvent(new e7('onzoomend'))
      })
      function i8(i) {
        i9.fire(i)
      }
      var e = [
        'zoomstart',
        'zoomend',
        'tilesload',
        'sunlighttime_change',
        'sunlighttime_clear',
        'centerandzoom',
        'animation_start',
        'animation_stop',
        'movestart',
        'moveend',
        'moving',
        'dragstart',
        'dragend',
        'dragging',
      ]
      for (var T = 0; T < e.length; T++) {
        ja.on(e[T], i8)
      }
    },
    forceEnableEarth: function () {
      this.config.forceEnableEarth = true
      this.config.enableEarth = cH.ifEnableEarth(true)
      this.dispatchEvent(new e7('forceenableearth'))
      return this.config.enableEarth
    },
    setLock: function (e) {
      if (this.mapType === BMAP_EARTH_MAP) {
        this._earth.setLock(e)
      }
      this._lock = e
    },
    getLock: function () {
      if (this.mapType === BMAP_EARTH_MAP) {
        return this._earth.getLock()
      }
      return this._lock
    },
    getEarth: function () {
      return this._earth
    },
    isSupportEarth: function () {
      return this.config.enableEarth
    },
    isCanvasMap: function () {
      return !!(
        this._renderType === 'canvas' && this.getMapType() !== 'B_EARTH_MAP'
      )
    },
    getCanvasMapCoordByUid: function (i9) {
      if (this._renderType === 'webgl') {
        var ja = this.tileMgr.tileLayers
        for (var i8 = 0; i8 < ja.length; i8++) {
          if (ja[i8].labelProcessor) {
            return ja[i8].labelProcessor.getLabelByUid(i9, '')
          }
        }
        return null
      }
      var e = this.canvas2dMapMgr._labelClick
      var T = e.findLabelByUid(i9)
      return T ? new cd(T.iconPos.geoX, T.iconPos.geoY) : null
    },
    loadBizData: function (i) {
      var e = new e7('onloadbizdata')
      e.data = i
      this.dispatchEvent(e)
    },
    unloadBizData: function () {
      var e = new e7('onunloadbizdata')
      this.dispatchEvent(e)
    },
    zoomIn: function (e) {
      this.setZoomIn(this.zoomLevel + 1, { zoomCenter: e })
    },
    zoomOut: function (e) {
      this.setZoomIn(this.zoomLevel - 1, { zoomCenter: e })
    },
    setMaxZoom: function (e) {
      if (this._renderType === 'webgl') {
        this.config.maxZoom = e <= 21 ? e : 21
      } else {
        this.config.maxZoom = e <= 19 ? e : 19
      }
    },
    setMinZoom: function (e) {
      this.config.minZoom = e >= 3 ? e : 3
    },
    setCenterIn: function (e, i) {
      this.panToIn(e, i)
    },
    getRenderType: function () {
      return this._renderType
    },
    getSolarInfo: function (i8) {
      i8 = i8 || this._initDate
      var T = eZ(i8)
      var e = ia.convertLL2MC(new cd(T[0], T[1]))
      var jg = e.latLng
      var jb = bo.Projection.convertMC2LL(this.centerPoint)
      var jd = i8.getUTCHours()
      var jf = jd + (24 * jb.lng) / 360
      var je = jf - 12
      var jc = je * 60 * 0.25
      var ja = Math.asin(
        Math.sin(hH(jb.lat)) * Math.sin(hH(jg.lat)) +
          Math.cos(hH(jb.lat)) * Math.cos(hH(jg.lat)) * Math.cos(hH(jc))
      )
      var i9 = Math.asin(
        (Math.sin(hH(jc)) * Math.cos(hH(jg.lat))) / Math.cos(ja)
      )
      var i = 'north'
      if (jb.lat < jg.lat) {
        i = 'south'
      }
      return {
        zenith: e,
        solarAltitude: ja,
        solarAzimuth: i9,
        centerPosition: i,
        position: e,
      }
    },
    setDisplayOptions: function (T) {
      if (!T) {
        return
      }
      for (var e in this._displayOptions) {
        if (this._displayOptions.hasOwnProperty(e)) {
          if (
            typeof T[e] === 'boolean' ||
            (e === 'skyColors' && typeof T.skyColors === 'object') ||
            (e === 'labelMargin' && typeof T.labelMargin === 'number')
          ) {
            this._displayOptions[e] = T[e]
          }
        }
      }
      var i = this.getMapType()
      if (i === eT.NORMAL) {
        this.fire(new e7('ondisplayoptions_changed'))
      } else {
        if (i === eT.EARTH && this._earth) {
          this._earth.fire(new e7('ondisplayoptions_changed'))
        }
      }
    },
    getHorizonPosY: function (e) {
      if (!e || !this._webglMapCamera) {
        return null
      }
      var i = this._webglMapCamera.fromMCToScreenPixel(e.lng, e.lat, {
        heading: 0,
      })
      return i.y
    },
    getIndoorInfo: function () {
      if (!this._indoorMgr) {
        return
      }
      return this._indoorMgr.getData()
    },
    showIndoor: function (e, T) {
      var i = new e7('onindoor_status_changed')
      i.uid = e
      i.floor = T
      this.fire(i)
    },
    addAreaSpot: function (e, T) {
      if (!e || e.length === 0) {
        return
      }
      T = T || {}
      this.areaSpots = this.areaSpots || {}
      var i = T.id || 'sp' + this.temp.spotsGuid++
      this.areaSpots[i] = { spot: e, userData: T.userData }
      var i8 = this
      gi.load('hotspot', function () {
        i8._asyncRegister()
      })
      return i
    },
    getAreaSpot: function (e) {
      if (this.areaSpots && this.areaSpots[e]) {
        return this.areaSpots[e]
      }
      return null
    },
    removeAreaSpot: function (e) {
      if (!e || !this.areaSpots[e]) {
        return
      }
      delete this.areaSpots[e]
    },
    clearAreaSpots: function () {
      this.areaSpots = {}
    },
    resetSpotStatus: function () {
      this.fire(new e7('onspot_status_reset'))
    },
    hightlightSpotByUid: function (e, T) {
      var i = new e7('onspot_highlight')
      i.uid = e
      i.tilePosStr = T
      this.fire(i)
    },
    setZoomIn: function (i, e) {
      e = e || {}
      this.zoomTo(i, e.zoomCenter || null, e)
    },
    restrictBounds: function (e) {
      if (e instanceof ha) {
        this.config.restrictBounds = e
        this.restrictCenter(this.getCenterIn())
        this.fire(new e7('oncenter_changed'))
      }
    },
    getCurrentMaxTilt: function () {
      var e = this.zoomLevel
      if (this.mapType === 'B_EARTH_MAP') {
        return gV.MAX_DRAG_TILT_L2
      }
      if (this.config.restrictCenter === false) {
        return gV.MAX_DRAG_TILT
      }
      if (e >= 19) {
        return gV.MAX_DRAG_TILT
      } else {
        if (e <= 18) {
          if (e < this._enableTiltZoom) {
            if (e >= this._enableTiltZoom - 2) {
              return (1 - (this._enableTiltZoom - e) / 2) * gV.MAX_DRAG_TILT_L2
            }
            return 0
          }
          return gV.MAX_DRAG_TILT_L2
        } else {
          return (
            (gV.MAX_DRAG_TILT - gV.MAX_DRAG_TILT_L2) * (e - 18) +
            gV.MAX_DRAG_TILT_L2
          )
        }
      }
    },
    worldSize: function (i) {
      var e = i || this.zoomLevel
      return gV.WORLD_SIZE_MC / this.getZoomUnits(e)
    },
    setTrafficOn: function (e) {
      if (e && Number(e) > 1) {
        iB.setZIndex(Number(e))
      }
      this.addTileLayer(iB)
    },
    setTrafficOff: function () {
      this.removeTileLayer(iB)
    },
    showOverlayContainer: function () {
      this.setDisplayOptions({ overlay: true })
    },
    hideOverlayContainer: function () {
      this.setDisplayOptions({ overlay: false })
    },
    addLabelsToMapTile: function (T) {
      for (var e = 0; e < T.length; e++) {
        if (typeof T[e].type === 'undefined') {
          T[e].type = 'fixed'
        }
        if (typeof T[e].rank !== 'number') {
          T[e].rank = 50000
        }
        T[e].pt = T[e].position
        T[e].custom = true
        T[e].processedInZoom = 0
        this._customTileLabels.push(T[e])
      }
      this.dispatchEvent(new e7('onadd_tile_labels'))
    },
    removeLabelsFromMapTile: function (T) {
      for (var i8 = 0; i8 < T.length; i8++) {
        for (var e = 0; e < this._customTileLabels.length; e++) {
          if (this._customTileLabels[e].uid === T[i8]) {
            this._customTileLabels.splice(e, 1)
          }
        }
      }
      this.dispatchEvent(new e7('onremove_tile_labels'))
    },
    clearLabels: function () {
      this._customTileLabels.length = 0
      this.dispatchEvent(new e7('onclear_labels'))
    },
    loadMapStyleFiles: function (ja, e) {
      this.customLoaded = false
      var T = this.config.style
      var i9 = this.config.styleUrl
      var i8 = this
      this._setTextRenderType()
      if (typeof T === 'string' && !i9) {
        if (bo['FeatureStyle' + T]) {
          this.customLoaded = true
          i8.fire(new e7('onstyle_loaded'))
          ja()
          return
        }
        bo['FeatureStyle' + T] = window.FeatureStyle
        bo['iconSetInfo' + T] = window.iconSetInfo_high
        bo.indoorStyle = window.indoorStyle
        f5.load(w.getMapStyleFiles(T), function () {
          if (i8.config.style === T) {
            bo['FeatureStyle' + T] = window.FeatureStyle
            bo['iconSetInfo' + T] = window.iconSetInfo_high
            bo.indoorStyle = window.indoorStyle
            i8.customLoaded = true
            i8.fire(new e7('onstyle_loaded'))
            ja()
          }
        })
      } else {
        var i = T
        t.init(i8)
        t.getStyleJson(i, function (jc) {
          var jh = ei
          var jj = bo.getGUID('custom')
          i8.config.mapStyleId = jj
          var jf = {}
          es.extend(jf, jc)
          var jd = Math.floor(i8.getZoom())
          var jg
          window['styleCbk_' + jj] = function (jk, jl) {
            if (jl !== jg) {
              return
            }
            if (typeof jk === 'string') {
              jk = JSON.parse(jk)
            }
            t.onStyleDataBack(jk, jd, jj, jf, jh, bo['customStyleInfo_' + jj])
            i8.customLoaded = true
            i8.fire(new e7('onstyle_loaded'))
            ja()
          }
          bo['customStyleInfo_' + jj] = {
            zoomRegion: {},
            zoomStyleBody: [],
            zoomFrontStyle: {},
          }
          var ji = t.getStyleUrl(
            jc,
            jh,
            'styleCbk_' + jj,
            jd,
            e,
            bo['customStyleInfo_' + jj]
          )
          var jb = ji.split('?')[0]
          jg = ji.split('?')[1]
          if (i9) {
            jb = i9
            jg = jb.split('?')[1]
          }
          if (!bo.iconSetInfoCustom) {
            var je = w.getMapStyleFiles('default')
            je.splice(1, 1)
            f5.load(je, function () {
              bo.iconSetInfoCustom = window.iconSetInfo_high
              bo.indoorStyle = window.indoorStyle
              if (jb.indexOf('jsonp') > '-1') {
                f5.load(jb)
              } else {
                bo['customStyleInfo_' + jj].xhr = hh.post(
                  jb,
                  jg,
                  window['styleCbk_' + jj]
                )
              }
            })
          } else {
            if (jb.indexOf('jsonp') > '-1') {
              f5.load(jb)
            } else {
              bo['customStyleInfo_' + jj].xhr = hh.post(
                jb,
                jg,
                window['styleCbk_' + jj]
              )
            }
          }
        })
      }
    },
    getFeatureStyleTags: function () {
      var e = []
      var i9 = Object.keys(bo)
      for (var i8 = 0; i8 < i9.length; i8++) {
        var T = i9[i8]
        if (T.indexOf('FeatureStyle') > -1 && bo[T]) {
          e.push(T)
        }
      }
      return e
    },
    setCopyrightOffset: function (i8, i) {
      var T = new e7('oncopyrightoffsetchange', { logo: i8, cpy: i })
      this.dispatchEvent(T)
    },
    _setTextRenderType: function (e) {
      if (e) {
        this.config.textRenderType = e
        return
      }
      if (this.config.textRenderType !== null) {
        return
      }
      if (bJ()) {
        this.config.textRenderType = 'canvas'
      } else {
        if (typeof this.config.style === 'string') {
          this.config.textRenderType = 'image'
        } else {
          this.config.textRenderType = 'canvas'
        }
      }
    },
    destroy: function () {
      this._destroyed = true
      this.fire(new e7('ondestroy'))
    },
    centerAndZoom: function (e, jb, T) {
      if (Object.prototype.toString.call(jb) !== '[object Undefined]') {
        jb = parseInt(jb, 10)
      }
      if (typeof e === 'string') {
        var i8 = this
        var ja = new a6()
        ja.getPoint(e, function (jc) {
          e = jc
          var jd = ia.convertLL2MC(e)
          i8.centerAndZoomIn(jd, jb, T)
        })
      } else {
        if (this.config.coordType === BMAP_COORD_GCJ02) {
          var i9 = hA(e, 3)
          var i = ia.convertLL2MC(i9)
        } else {
          var i = ia.convertLL2MC(e)
        }
        this.centerAndZoomIn(i, jb, T)
      }
    },
    pointToPixel: function (e, T) {
      var i = ia.convertLL2MC(e)
      var i8 = {}
      es.extend(i8, T)
      if (i8 && i8.center) {
        i8.center = ia.convertLL2MC(i8.center)
      }
      return this.pointToPixelIn(i, i8)
    },
    pixelToPoint: function (T, i) {
      var i8 = {}
      es.extend(i8, i)
      if (i8 && i8.center) {
        i8.center = ia.convertLL2MC(i8.center)
      }
      var e = this.pixelToPointIn(T, i8)
      return ia.convertMC2LL(e)
    },
    pointToOverlayPixel: function (e, T) {
      var i = ia.convertLL2MC(e)
      var i8 = {}
      es.extend(i8, T)
      if (i8 && i8.center) {
        i8.center = ia.convertLL2MC(i8.center)
      }
      return this.pointToOverlayPixelIn(i, i8)
    },
    overlayPixelToPoint: function (T, i) {
      var i8 = {}
      es.extend(i8, i)
      if (i8 && i8.center) {
        i8.center = ia.convertLL2MC(i8.center)
      }
      var e = this.overlayPixelToPointIn(T, i8)
      return ia.convertMC2LL(e)
    },
    setViewport: function (T, i8) {
      var e
      if (T && T.center) {
        e = {}
        es.extend(e, T)
        e.center = ia.convertLL2MC(e.center)
      } else {
        e = []
        for (var i9 = 0; i9 < T.length; i9++) {
          e[i9] = ia.convertLL2MC(T[i9])
        }
      }
      this.setViewportIn(e, i8)
    },
    getViewport: function (ja, i8) {
      var T
      if (ja && ja.length) {
        T = []
        for (var i9 = 0; i9 < ja.length; i9++) {
          T[i9] = ia.convertLL2MC(ja[i9])
        }
      } else {
        if (ja instanceof ha) {
          T = new ha(
            ia.convertLL2MC(ja.getSouthWest()),
            ia.convertLL2MC(ja.getNorthEast())
          )
          T.setMinMax()
        }
      }
      var e = this.getViewportIn(T, i8)
      e.center = ia.convertMC2LL(e.center)
      return e
    },
    getDistance: function (i9, T) {
      var i = ia.convertLL2MC(i9)
      var i8 = ia.convertLL2MC(T)
      var e = this.getDistanceIn(i, i8)
      return e
    },
    setCenter: function (e, T) {
      if (typeof e === 'string') {
        var i8 = this
        var ja = new a6()
        ja.getPoint(e, function (jb) {
          e = jb
          var jc = ia.convertLL2MC(e)
          i8.setCenterIn(jc, T)
        })
      } else {
        if (this.config.coordType === BMAP_COORD_GCJ02) {
          var i9 = hA(e, 3)
          var i = ia.convertLL2MC(i9)
        } else {
          var i = ia.convertLL2MC(e)
        }
        this.setCenterIn(i, T)
      }
    },
    setZoom: function (T, e) {
      var i = {}
      es.extend(i, e)
      if (i && i.zoomCenter) {
        i.zoomCenter = ia.convertLL2MC(i.zoomCenter)
      }
      this.setZoomIn(T, i)
    },
    flyTo: function (e, i9, T) {
      if (this.config.coordType === BMAP_COORD_GCJ02) {
        var i8 = hA(e, 3)
        var i = ia.convertLL2MC(i8)
      } else {
        var i = ia.convertLL2MC(e)
      }
      this.flyToIn(i, i9, T)
    },
    panTo: function (e, T) {
      var i = ia.convertLL2MC(e)
      this.panToIn(i, T)
    },
    getCenter: function () {
      var e = this.getCenterIn()
      if (this.config.coordType === BMAP_COORD_GCJ02) {
        var i = ia.convertMC2LL(e)
        return ec(i)
      }
      return ia.convertMC2LL(e)
    },
    getBounds: function () {
      var e = this.getBoundsIn()
      var i = new ha(
        ia.convertMC2LL(e.getSouthWest()),
        ia.convertMC2LL(e.getNorthEast())
      )
      return i
    },
    setMapStyleV2: function (e) {
      if (typeof e === 'string') {
        this._setTextRenderType('image')
      } else {
        this._setTextRenderType('canvas')
      }
      this.setOptions({ style: e })
    },
    startViewAnimation: function (T) {
      var e = T._options.delay
      var i = this
      setTimeout(function () {
        T._start(i)
      }, e)
    },
    pauseViewAnimation: function (e) {
      e._pause(this)
    },
    continueViewAnimation: function (e) {
      e._continue(this)
    },
    cancelViewAnimation: function (e) {
      e._cancel(this)
    },
    getMapScreenshot: function () {
      return this._webglMapScene._painter._canvas.toDataURL()
    },
  })
  window.BMAP_NORMAL_MAP = 'B_NORMAL_MAP'
  window.BMAPGL_NORMAL_MAP = 'B_NORMAL_MAP'
  window.BMAP_SATELLITE_MAP = 'B_SATELLITE_MAP'
  window.BMAP_HYBRID_MAP = 'B_STREET_MAP'
  window.BMAP_EARTH_MAP = 'B_EARTH_MAP'
  window.BMAP_NONE_MAP = 'B_NONE_MAP'
  window.BMAP_COORD_MERCATOR = 1
  window.BMAP_COORD_GCJ02 = 2
  window.BMAP_SYS_DRAWER = 0
  window.BMAP_SVG_DRAWER = 1
  window.BMAP_VML_DRAWER = 2
  window.BMAP_CANVAS_DRAWER = 3
  var t = {
    environment: 'jsapi',
    map: null,
    ontilesloaded: false,
    onstyle_loaded: false,
    init: function (i) {
      var e = this
      e.map = i
      this.changeCopyright()
      this.setEnvironment(e.map.config.style)
      this.resetEventListener()
    },
    resetEventListener: function () {
      var e = this
      this.ontilesloaded = false
      this.onstyle_loaded = false
      e.map.addEventListener('ontilesloaded', e.checkLoadedStatus)
      e.map.addEventListener('onstyle_loaded', e.checkLoadedStatus)
    },
    checkLoadedStatus: function (i) {
      t[i.type] = true
      if (t.ontilesloaded && t.onstyle_loaded) {
        this.dispatchEvent(new e7('onstylechangetilesloaded'))
        this.removeEventListener('ontilesloaded', t.checkLoadedStatus)
        this.removeEventListener('onstyle_loaded', t.checkLoadedStatus)
      }
    },
    changeCopyright: function () {
      var e = this
      if (e.map.cpyCtrl) {
        e.map.cpyCtrl.hide()
        if (e.environment !== 'customEditor') {
          e.map.setCopyrightOffset(new h3(1, 1))
        }
      } else {
        e.map.addEventListener('oncopyrightaddend', function () {
          e.map.cpyCtrl.hide()
          if (e.environment !== 'customEditor') {
            e.map.setCopyrightOffset(new h3(1, 1))
          }
        })
      }
    },
    setEnvironment: function (e) {
      if (e.customEditor) {
        this.environment = 'customEditor'
        aN.map = this.map
      } else {
        if (e.sharing) {
          this.environment = 'sharing'
        } else {
          if (e.preview) {
            this.environment = 'preview'
          } else {
            this.environment = 'jsapi'
          }
        }
      }
    },
    getStyleJson: function (i8, ja) {
      var i9 = this
      if (i8.styleJson) {
        ja && ja(i8.styleJson)
      } else {
        if (i8.styleId) {
          var i = i8.styleId
          var e = (Math.random() * 100000).toFixed(0)
          bo['_cbk_si_phpui' + e] = function (jc) {
            var jb = []
            if (
              jc.result &&
              jc.result['error'] === 0 &&
              jc.content &&
              jc.content['status'] === 0
            ) {
              jb = i9.parseJson(jc.content['data']['json'])
              ja && ja(jb)
            } else {
              ja && ja('default')
            }
          }
          bo['_cbk_si_api' + e] = function (jc) {
            var jb = []
            if (jc.status === 0) {
              if (jc.info) {
                jb = i9.parseJson(jc.info['json'])
              } else {
                jb = i9.parseJson(jc.data['json'])
              }
              ja && ja(jb)
            } else {
              ja && ja('default')
            }
          }
          var T = ''
          switch (this.environment) {
            case 'jsapi':
              T =
                dZ.apiHost +
                '/?qt=custom_map&v=3.0&style_id=' +
                i +
                '&type=publish&ak=' +
                ei
              T += '&callback=' + eV + '._cbk_si_phpui' + e
              break
            case 'sharing':
              T += '/apiconsole/custommap/getSharingJson'
              T += '?styleid=' + i + '&type=edit'
              T += '&ck=' + eV + '._cbk_si_api' + e
              break
            case 'preview':
              T += '/apiconsole/custommap/getJson'
              T += '?styleid=' + i + '&type=edit'
              T += '&ck=' + eV + '._cbk_si_api' + e
              break
          }
          f5.load(T)
        } else {
          ja && ja('default')
        }
      }
    },
    parseJson: function (T) {
      if (T === null || T === '') {
        return []
      }
      var i = {
        t: 'featureType',
        e: 'elementType',
        v: 'visibility',
        c: 'color',
        o: 'opacity',
        l: 'lightness',
        s: 'saturation',
        w: 'weight',
        z: 'level',
        h: 'hue',
        f: 'fontsize',
        zri: 'curZoomRegionId',
        zr: 'curZoomRegion',
      }
      var i9 = {
        all: 'all',
        g: 'geometry',
        'g.f': 'geometry.fill',
        'g.s': 'geometry.stroke',
        l: 'labels',
        'l.t.f': 'labels.text.fill',
        'l.t.s': 'labels.text.stroke',
        'l.t': 'labels.text',
        'l.i': 'labels.icon',
        'g.tf': 'geometry.topfill',
        'g.sf': 'geometry.sidefill',
      }
      var i8 = T.split(',')
      var e = i8.map(function (jd) {
        var jc = jd.split('|').map(function (jj) {
          var jh = i[jj.split(':')[0]]
          var jg = i9[jj.split(':')[1]]
            ? i9[jj.split(':')[1]]
            : jj.split(':')[1]
          switch (jg) {
            case 'poi':
              jg = 'poilabel'
              break
            case 'districtlabel':
              jg = 'districtlabel'
              break
          }
          var ji = {}
          ji[jh] = jg
          return ji
        })
        var ja = jc[0]
        var jf = 1
        if (jc[1]['elementType']) {
          jf = 2
          es.extend(ja, jc[1])
        }
        var je = {}
        for (var jb = jf; jb < jc.length; jb++) {
          es.extend(je, jc[jb])
        }
        return es.extend(ja, { stylers: je })
      })
      return e
    },
    getStyleUrl: function (i9, jc, ja, i, e, i8) {
      this.styleJson = i9
      var T =
        w.apiHost +
        '/custom/v2/mapstyle?version=' +
        4 +
        '&ak=' +
        jc +
        '&is_all=true&is_new=1&'
      var jb = this.styleJson2styleStringV2(i9, i, i8)
      T += 'styles=' + encodeURIComponent(jb)
      if (e && e.os && e.sv) {
        T += '&os=' + e.os + '&sv=' + e.sv
      }
      return T
    },
    styleJson2styleStringV2: function (e, jg, jc) {
      var jh = {
        featureType: 't',
        elementType: 'e',
        visibility: 'v',
        color: 'c',
        opacity: 'o',
        lightness: 'l',
        saturation: 's',
        weight: 'w',
        level: 'z',
        hue: 'h',
        fontsize: 'f',
      }
      var ji = {
        all: 'all',
        geometry: 'g',
        'geometry.fill': 'g.f',
        'geometry.stroke': 'g.s',
        labels: 'l',
        'labels.text.fill': 'l.t.f',
        'labels.text.stroke': 'l.t.s',
        'labels.text': 'l.t',
        'labels.icon': 'l.i',
        'geometry.topfill': 'g.tf',
        'geometry.sidefill': 'g.sf',
      }
      var jj = []
      for (var i8 = this.map.getMinZoom(); i8 <= this.map.getMaxZoom(); i8++) {
        jc.zoomFrontStyle[i8] = {}
      }
      jc.zoomFrontStyle.main = {}
      var T = false
      for (var i8 = 0; !!e[i8]; i8++) {
        var jf = e[i8]
        if (this.isOnlyZoomStyler(jf)) {
          continue
        }
        jg = this.getFrontZoom(jf, jg)
        if (
          (jf.featureType === 'land' ||
            jf.featureType === 'all' ||
            jf.featureType === 'background') &&
          typeof jf.elementType === 'string' &&
          (jf.elementType === 'geometry' ||
            jf.elementType === 'geometry.fill' ||
            jf.elementType === 'all') &&
          jf.stylers &&
          !T
        ) {
          if (jf.stylers['color']) {
            jc.bmapLandColor = jf.stylers['color']
          }
          if (jf.stylers['opacity']) {
            jc.bmapLandColor = jf.stylers['opacity']
          }
          if (jf.stylers['visibility'] && jf.stylers['visibility'] === 'off') {
            jc.bmapLandColor = '#00000000'
          }
          if (jf.featureType === 'land') {
            T = true
          }
        }
        if (
          jf.featureType === 'building' &&
          typeof jf.elementType === 'string' &&
          jf.elementType === 'geometry.fill'
        ) {
          jc.buildingFill = true
        }
        if (
          jf.featureType === 'roadarrow' &&
          jf.elementType === 'labels.icon' &&
          jf.stylers
        ) {
          var jd = jf.stylers['visibility']
          jc.zoomFrontStyle[jg]['bmapRoadarrowVisibility'] = jd
        }
        var i9 = {}
        es.extend(i9, jf)
        var jb = i9.stylers
        delete i9.stylers
        es.extend(i9, jb)
        var ja = []
        for (var je in jh) {
          if (i9[je]) {
            if (this.isEditorZoomKeys(je)) {
              continue
            }
            if (je === 'elementType') {
              ja.push(jh[je] + ':' + ji[i9[je]])
            } else {
              switch (i9[je]) {
                case 'poilabel':
                  i9[je] = 'poi'
                  break
                case 'districtlabel':
                  i9[je] = 'label'
                  break
              }
              ja.push(jh[je] + ':' + i9[je])
            }
          }
        }
        if (ja.length > 2) {
          jj.push(ja.join('|'))
        }
      }
      return jj.join(',')
    },
    getFrontZoom: function (i, e) {
      var T = i.stylers['level']
      if (T === undefined) {
        return 'main'
      } else {
        return parseInt(T, 10)
      }
    },
    isZoomConfig: function (e) {
      var i = e.stylers['level']
      if (i === undefined) {
        return false
      } else {
        return true
      }
    },
    isOnlyZoomStyler: function (e) {
      var i = {}
      es.extend(i, e.stylers)
      delete i.curZoomRegionId
      delete i.curZoomRegion
      delete i.level
      if (es.isEmptyObject(i)) {
        return true
      } else {
        return false
      }
    },
    isSelectZoom: function (i, e) {
      var T = i.stylers['level']
      if (T === undefined) {
        return true
      } else {
        if (T === e + '') {
          return true
        } else {
          return false
        }
      }
    },
    isEditorZoomKeys: function (e) {
      var i = { curZoomRegionId: true, curZoomRegion: true }
      if (i[e]) {
        return true
      } else {
        return false
      }
    },
    getZoomRegion: function (e, i) {
      var i8 = e.stylers['level']
      var T = {}
      es.extend(T, i)
      if (i8 === undefined) {
        return T
      } else {
        T[parseInt(i8, 10)] = true
        return T
      }
    },
    onStyleDataBack: function (i9, e, i, i8, jb, T) {
      if (i9.status !== 0) {
        return
      }
      if (i9.data.style.length === 3) {
        if (!T.baseFs) {
          T.baseFs = i9.data.style
        }
        bo.StyleBody = i9.data.style[2]
      } else {
        bo.StyleBody = i9.data.style
      }
      var ja = T.baseFs
      bo['FeatureStyle' + i] = ja
      this.updateFrontFeatureStyle(T)
    },
    updateFrontFeatureStyle: function (T) {
      if (T.zoomFrontStyle.main['bmapRoadarrowVisibility']) {
        for (var e = this.map.getMinZoom(); e <= this.map.getMaxZoom(); e++) {
          if (!T.zoomFrontStyle[e]['bmapRoadarrowVisibility']) {
            T.zoomFrontStyle[e]['bmapRoadarrowVisibility'] =
              T.zoomFrontStyle.main['bmapRoadarrowVisibility']
          }
        }
      }
    },
  }
  var aN = {
    map: null,
    labelCache: {},
    calcDrawMc: function (T, i, e) {
      var i8 = []
      switch (i) {
        case 'fill':
          i8 = this.calcFill(T, e)
          break
        case 'line':
          break
        case 'building3d':
          i8 = this.calcBuilding3d(T, e)
          break
      }
      return i8
    },
    calcFill: function (i9, T) {
      var ja = []
      for (var i8 = 0; i8 < i9.length; i8 = i8 + 5) {
        var e = this.coordToMc(
          { x: i9[i8], y: i9[i8 + 1] },
          T.row,
          T.col,
          T.mercatorSize,
          T.baseTileSize
        )
        ja.push(e[0], e[1])
      }
      return ja
    },
    calcLine: function (i9, T) {
      var ja = []
      var jb = new Int16Array(i9.buffer)
      for (var i8 = 0; i8 < jb.length; i8 = i8 + 10) {
        var e = this.coordToMc(
          { x: jb[i8] / 10, y: jb[i8 + 1] / 10 },
          T.row,
          T.col,
          T.mercatorSize,
          T.baseTileSize
        )
        ja.push(e[0], e[1])
      }
      return ja
    },
    calcBuilding3d: function (ja, T) {
      var jb = []
      var i8 = {}
      for (var i9 = 0; i9 < ja.length / 2; i9 = i9 + 7) {
        if (ja[i9] === ja[i9 - 7] && ja[i9 + 1] === ja[i9 - 6]) {
          continue
        }
        if (i8[ja[i9].toString() + ja[i9 + 1].toString()]) {
          continue
        }
        i8[ja[i9].toString() + ja[i9 + 1].toString()] = true
        var e = this.coordToMc(
          { x: ja[i9], y: ja[i9 + 1] },
          T.row,
          T.col,
          T.mercatorSize,
          T.baseTileSize
        )
        jb.push(e[0], e[1])
      }
      return jb
    },
    coordToMc: function (i9, i8, e, i, T) {
      return [i9.x * (i / T) + e * i, i9.y * (i / T) + i8 * i]
    },
    addDrawIntoAreaSpots: function (e, i9) {
      if (t.environment !== 'customEditor') {
        return
      }
      if (!i9.styleIds) {
        return
      }
      for (var T = 0; T < i9.styleIds.length; T++) {
        var jc = 0
        if (T > 0) {
          jc = i9.verticesLength[T - 1]
        }
        end = i9.verticesLength[T]
        var ja = []
        var i8 = ''
        if (i9.vertex) {
          ja = i9.vertex
          i8 = 'building3d'
        } else {
          if (i9.data[0]) {
            ja = i9.data[0]
            i8 = i9.type
          } else {
            continue
          }
        }
        var jb = this.calcDrawMc(ja.slice(jc, end), i8, e)
        this.map.addAreaSpot(jb, {
          userData: { styleId: i9.styleIds[T], type: 'mapstyle' },
        })
      }
    },
    addLabelIntoAreaSpots: function (e) {
      if (t.environment !== 'customEditor') {
        return
      }
      for (var i9 = 0; i9 < e.length; i9++) {
        var ja = e[i9]
        for (var i8 = 0; i8 < ja.fixedLabel.length; i8++) {
          var T = ja.fixedLabel[i8]
          if (!T._mcBds) {
            continue
          }
          var jb = [
            T._mcBds[0].lng,
            T._mcBds[0].lat,
            T._mcBds[0].lng,
            T._mcBds[1].lat,
            T._mcBds[1].lng,
            T._mcBds[1].lat,
            T._mcBds[1].lng,
            T._mcBds[0].lat,
          ]
          if (!this.labelCache[jb.join()]) {
            this.labelCache[jb.join()] = true
            this.map.addAreaSpot(jb, {
              userData: { styleId: T.styleId, type: 'mapstyle', name: T.name },
            })
          }
        }
      }
    },
  }
  function b4(i, e, i8, T) {
    this.cx = 3 * i
    this.bx = 3 * (i8 - i) - this.cx
    this.ax = 1 - this.cx - this.bx
    this.cy = 3 * e
    this.by = 3 * (T - e) - this.cy
    this.ay = 1 - this.cy - this.by
    this.p1x = i
    this.p1y = T
    this.p2x = i8
    this.p2y = T
  }
  b4.prototype.sampleCurveX = function (e) {
    return ((this.ax * e + this.bx) * e + this.cx) * e
  }
  b4.prototype.sampleCurveY = function (e) {
    return ((this.ay * e + this.by) * e + this.cy) * e
  }
  b4.prototype.sampleCurveDerivativeX = function (e) {
    return (3 * this.ax * e + 2 * this.bx) * e + this.cx
  }
  b4.prototype.solveCurveX = function (e, jd) {
    if (typeof jd === 'undefined') {
      jd = 0.000001
    }
    var jc
    var jb
    var i9
    var T
    var i8
    for (i9 = e, i8 = 0; i8 < 8; i8++) {
      T = this.sampleCurveX(i9) - e
      if (Math.abs(T) < jd) {
        return i9
      }
      var ja = this.sampleCurveDerivativeX(i9)
      if (Math.abs(ja) < 0.000001) {
        break
      }
      i9 = i9 - T / ja
    }
    jc = 0
    jb = 1
    i9 = e
    if (i9 < jc) {
      return jc
    }
    if (i9 > jb) {
      return jb
    }
    while (jc < jb) {
      T = this.sampleCurveX(i9)
      if (Math.abs(T - e) < jd) {
        return i9
      }
      if (e > T) {
        jc = i9
      } else {
        jb = i9
      }
      i9 = (jb - jc) * 0.5 + jc
    }
    return i9
  }
  b4.prototype.solve = function (e, i) {
    return this.sampleCurveY(this.solveCurveX(e, i))
  }
  var fT = {}
  function e0(T) {
    var e = {
      duration: 1000,
      fps: 30,
      delay: 0,
      transition: fT.linear,
      dropLastAnimation: false,
    }
    if (T) {
      for (var i8 in T) {
        e[i8] = T[i8]
      }
    }
    if (T.beginTime) {
      this._beginTime = T.beginTime
    }
    this._callbacks = []
    this._options = e
    if (e.delay) {
      var i9 = this
      setTimeout(function () {
        i9._doStart()
      }, e.delay)
    } else {
      this._doStart()
    }
    this._pauseTime = 0
  }
  e0.INFINITE = 'INFINITE'
  e0.prototype._doStart = function () {
    if (this._isPausing) {
      var e = performance.now() || new Date().getTime()
      this._pauseTime += e - this._isPausing
      this._isPausing = undefined
    }
    if (window.requestAnimationFrame) {
      var i = this
      i._timer = window.requestAnimationFrame(function (T) {
        i._loop(T)
      })
    } else {
      this._beginTime = new Date().getTime()
      if (this._options.duration === e0.INFINITE) {
        this._endTime = null
      } else {
        this._endTime = this._beginTime + this._options.duration
      }
      this._loop()
    }
  }
  e0.prototype._loop = function (i8) {
    var jb = this
    i8 = i8 || new Date().getTime()
    i8 = i8 - this._pauseTime
    if (!this._beginTime) {
      this._beginTime = i8
    }
    if (!this._endTime && typeof this._options.duration === 'number') {
      this._endTime = this._beginTime + this._options.duration
    }
    if (jb._endTime !== null && i8 >= jb._endTime) {
      if (jb._options.dropLastAnimation === false) {
        jb._options.render(jb._options.transition(1), 1, i8)
      }
      if (typeof jb._options.finish === 'function') {
        jb._options.finish(i8, this)
      }
      for (var ja = 0, e = jb._callbacks.length; ja < e; ja++) {
        jb._callbacks[ja]()
      }
      return
    }
    var i9
    if (typeof jb._options.duration === 'number') {
      i9 = (i8 - jb._beginTime) / jb._options.duration
      jb.schedule = jb._options.transition(i9)
    } else {
      i9 = i8 - jb._beginTime
      jb.schedule = 0
    }
    jb._options.render(jb.schedule, i9, i8)
    if (!jb.terminative) {
      if (window.requestAnimationFrame) {
        jb._timer = requestAnimationFrame(function T(i) {
          jb._loop(i)
        })
      } else {
        jb._timer = setTimeout(function () {
          jb._loop()
        }, 1000 / jb._options.fps)
      }
    }
  }
  e0.prototype.stop = function (i, e) {
    this.terminative = true
    if (this._timer) {
      if (window.cancelAnimationFrame) {
        cancelAnimationFrame(this._timer)
      } else {
        clearTimeout(this._timer)
      }
      this._timer = null
      if (typeof this._options.onStop === 'function') {
        this._options.onStop(e)
      }
    }
    if (i) {
      this._endTime = this._beginTime
      this._loop()
    }
  }
  e0.prototype.pause = function () {
    if (!this._isPausing) {
      this.stop()
      this.terminative = undefined
      this._isPausing = performance.now() || new Date().getTime()
    }
  }
  e0.prototype.cancel = function () {
    this.stop()
  }
  e0.prototype.append = function (e) {
    this._callbacks.push(e)
    return this
  }
  fT = {
    _p1: 1,
    _p2: 1 * 1.525,
    linear: function (e) {
      return e
    },
    reverse: function (e) {
      return 1 - e
    },
    easeInQuad: function (e) {
      return e * e
    },
    easeInCubic: function (e) {
      return Math.pow(e, 3)
    },
    easeInBiquad: function (e) {
      return Math.pow(e, 4)
    },
    easeInBack: function (e) {
      return e * e * ((fT._p1 + 1) * e - fT._p1)
    },
    easeOutQuad: function (e) {
      return -(e * (e - 2))
    },
    easeOutCubic: function (e) {
      return Math.pow(e - 1, 3) + 1
    },
    easeOutBiquad: function (e) {
      return 1 - Math.pow(e - 1, 4)
    },
    easeOutBack: function (e) {
      return (e = e - 1) * e * ((fT._p1 + 1) * e + fT._p1) + 1
    },
    easeInOutQuad: function (e) {
      if (e < 0.5) {
        return e * e * 2
      } else {
        return -2 * (e - 2) * e - 1
      }
    },
    easeInOutCubic: function (e) {
      if (e < 0.5) {
        return Math.pow(e, 3) * 4
      } else {
        return Math.pow(e - 1, 3) * 4 + 1
      }
    },
    easeInOutBiquad: function (e) {
      if (e < 0.5) {
        return Math.pow(e, 4) * 8
      } else {
        return 1 - Math.pow(e - 1, 4) * 8
      }
    },
    easeInOutSine: function (e) {
      return (1 - Math.cos(Math.PI * e)) / 2
    },
  }
  fT.ease = (function () {
    var e = new b4(0.4, 0, 0.6, 1)
    return function (i) {
      return e.solve(i)
    }
  })()
  fT['ease-in'] = fT.easeInQuad
  fT['ease-out'] = fT.easeOutQuad
  var cY = {
    start: function (je) {
      var i8 = je.el
      var e = je.style
      var i = je.startValue
      var jb = je.endValue
      var i9 = je.duration || 1400
      var ja = je.transition || fT.linear
      var jd = je.callback
      var jc = jb - i
      var T = je.unit || ''
      return new e0({
        fps: 60,
        duration: i9,
        transition: ja,
        render: function (jf) {
          i8.style[e] = i + jc * jf + T
        },
        finish: function () {
          jd && jd()
        },
      })
    },
  }
  function n(i9, T) {
    cJ.call(this)
    this.keyframes = i9
    var e = { duration: 1000, delay: 0, transition: fT.linear, interation: 1 }
    if (T) {
      for (var i8 in T) {
        e[i8] = T[i8]
      }
    }
    this._options = e
  }
  n.inherits(cJ, 'ViewAnimation')
  n.prototype._start = function (ja) {
    var T = this
    T.map = ja
    var i9 = new e7('onanimationstart')
    T.dispatchEvent(i9)
    this._initStatus(T.map)
    var i8 = this._options.duration
    var i = this._options.interation
    var jb = this._options.transition
    var jc = 0
    T.poiStatus = T.map._displayOptions.poi
    if (T.poiStatus) {
      T.map.setDisplayOptions({ poi: false })
    }
    T.map.viewAnimationTime = new Date().getTime()
    this.animation = new e0({
      duration: i8,
      transition: jb,
      start: function (e) {},
      render: function (jd, e) {
        if (jd === 0) {
          T._initStatus(T.map)
        } else {
          T._setViewByRate(jd)
        }
      },
      finish: function (je, jd) {
        if (++jc < i || i === 'INFINITE') {
          var jf = new e7('onanimationiterations')
          T.dispatchEvent(jf)
          delete jd._beginTime
          delete jd._endTime
          jd._doStart()
        } else {
          var jf = new e7('onanimationend')
          T.dispatchEvent(jf)
          delete T.map.viewAnimationTime
          T.map.setDisplayOptions({ poi: T.poiStatus })
        }
      },
    })
  }
  n.prototype._getTotalDuration = function (e, i) {
    if (e === e0.INFINITE) {
      return e0.INFINITE
    } else {
      return e * i
    }
  }
  n.prototype._initStatus = function (e) {
    if (this.keyframes[0]) {
      e.setCenter(this.keyframes[0].center, { noAnimation: true })
      e.setZoom(this.keyframes[0].zoom, { noAnimation: true })
      e.setTilt(this.keyframes[0].tilt, { noAnimation: true })
      e.setHeading(this.keyframes[0].heading, { noAnimation: true })
    }
  }
  n.prototype._setViewByRate = function (i8) {
    for (var e = 0; e < this.keyframes.length - 1; e++) {
      var i9 = this.keyframes[e]
      var T = this.keyframes[e + 1]
      if (i8 >= i9.percentage && i8 < T.percentage) {
        this.map.setHeading(this._getHeadingDelta(i9, T, i8), {
          noAnimation: true,
        })
        this.map.setTilt(this._getTiltDelta(i9, T, i8), { noAnimation: true })
        this.map.setCenter(this._getCenterDelta(i9, T, i8), {
          noAnimation: true,
        })
        this.map.setZoom(this._getZoomDelta(i9, T, i8), { noAnimation: true })
      }
    }
  }
  n.prototype._getHeadingDelta = function (T, i, e) {
    var i9 = (e - T.percentage) / (i.percentage - T.percentage)
    var i8 = T.heading + (i.heading - T.heading) * i9
    return i8
  }
  n.prototype._getTiltDelta = function (T, i, e) {
    var i9 = (e - T.percentage) / (i.percentage - T.percentage)
    var i8 = T.tilt + (i.tilt - T.tilt) * i9
    return i8
  }
  n.prototype._getCenterDelta = function (T, i, e) {
    var i9 = (e - T.percentage) / (i.percentage - T.percentage)
    var i8 = T.center.add(i.center.sub(T.center).mult(i9))
    return i8
  }
  n.prototype._getZoomDelta = function (i8, T, i) {
    var i9 = (i - i8.percentage) / (T.percentage - i8.percentage)
    var e = i8.zoom + (T.zoom - i8.zoom) * i9
    return e
  }
  n.prototype._pause = function (e) {
    this.animation.pause()
  }
  n.prototype._continue = function (e) {
    this.animation._doStart()
  }
  n.prototype._cancel = function (T) {
    T.setDisplayOptions({ poi: this.poiStatus })
    this.animation.cancel()
    delete T.viewAnimationTime
    var i = new e7('onanimationcancel')
    this.dispatchEvent(i)
  }
  var cm = undefined
  var eW = {
    is64Bit: function () {
      if (/Windows/.test(navigator.userAgent)) {
        if (/Win64; x64/.test(navigator.userAgent)) {
          return true
        } else {
          if (/WOW64/.test(navigator.userAgent)) {
            return true
          } else {
            return false
          }
        }
      }
      return true
    },
    isIOS112: function aW(e) {
      return /11_2/.test(navigator.userAgent)
    },
    canUseWebAssembly: function (i) {
      if (cm !== undefined) {
        i && i(cm)
        return
      }
      if (window.WebAssembly && this.is64Bit()) {
        if (window.disableWebAssembly === true) {
          cm = false
          i && i(cm)
        } else {
          if (!b9()) {
            cm = true
            i && i(cm)
          } else {
            if (this.isIOS112()) {
              cm = false
              i && i(cm)
            } else {
              var e = new Uint8Array([
                0, 97, 115, 109, 1, 0, 0, 0, 1, 133, 128, 128, 128, 0, 1, 96, 0,
                1, 127, 3, 130, 128, 128, 128, 0, 1, 0, 4, 132, 128, 128, 128,
                0, 1, 112, 0, 0, 5, 131, 128, 128, 128, 0, 1, 0, 1, 6, 129, 128,
                128, 128, 0, 0, 7, 145, 128, 128, 128, 0, 2, 6, 109, 101, 109,
                111, 114, 121, 2, 0, 4, 109, 97, 105, 110, 0, 0, 10, 138, 128,
                128, 128, 0, 1, 132, 128, 128, 128, 0, 0, 65, 42, 11,
              ])
              WebAssembly.instantiate(e).then(
                function (T) {
                  cm = true
                  i && i(cm)
                },
                function (T) {
                  cm = false
                  i && i(cm)
                }
              )
            }
          }
        }
      } else {
        cm = false
        i && i(cm)
      }
    },
  }
  var aA = {}
  bo.Utils = aA
  function i0(e) {
    return e.style
  }
  function hc(i) {
    if (es.Browser.ie > 0) {
      i.unselectable = 'on'
      i.selectstart = function () {
        return false
      }
      i.onmousedown = function (T) {
        T.preventDefault()
        return false
      }
    } else {
      var e = i0(i)
      e.MozUserSelect = 'none'
      e.WebkitUserSelect = 'none'
      i.addEventListener(
        'mousedown',
        function (T) {
          T.preventDefault()
        },
        false
      )
    }
  }
  function aI(e) {
    return e && e.parentNode && e.parentNode.nodeType !== 11
  }
  function bA(i, e) {
    i.insertAdjacentHTML('beforeEnd', e)
    return i.lastChild
  }
  function fb(T, i) {
    var i8 = document.createElement('div')
    i8.innerHTML = i
    var e = i8.childNodes[0]
    return T.parentNode.insertBefore(e, T)
  }
  function ad(i) {
    i = i || window.event
    i.stopPropagation ? i.stopPropagation() : (i.cancelBubble = true)
  }
  function b(i) {
    i = i || window.event
    i.preventDefault ? i.preventDefault() : (i.returnValue = false)
    return false
  }
  function gC(i) {
    ad(i)
    return b(i)
  }
  function f9() {
    var e = document.documentElement
    var i = document.body
    if (e && (e.scrollTop || e.scrollLeft)) {
      return [e.scrollTop, e.scrollLeft]
    } else {
      if (i) {
        return [i.scrollTop, i.scrollLeft]
      } else {
        return [0, 0]
      }
    }
  }
  function hu(i9) {
    if (!i9) {
      return
    }
    i9.onload = i9.onerror = null
    var T = i9.attributes,
      i8,
      e,
      ja
    if (T) {
      e = T.length
      for (i8 = 0; i8 < e; i8 += 1) {
        ja = T[i8].name
        if (typeof i9[ja] === 'function') {
          i9[ja] = null
        }
      }
    }
    T = i9.children
    if (T) {
      e = T.length
      for (i8 = 0; i8 < e; i8 += 1) {
        hu(i9.children[i8])
      }
    }
  }
  function fd(i, jb, ja) {
    var i9 = jb.lng - ja.lng
    var i8 = jb.lat - ja.lat
    if (i9 === 0) {
      return Math.abs(i.lng - jb.lng)
    }
    if (i8 === 0) {
      return Math.abs(i.lat - jb.lat)
    }
    var T = i8 / i9
    var e = jb.lat - T * jb.lng
    return Math.abs(T * i.lng - i.lat + e) / Math.sqrt(T * T + 1)
  }
  function b1(i, e) {
    if (!i || !e) {
      return
    }
    return Math.round(
      Math.sqrt(Math.pow(i.x - e.x, 2) + Math.pow(i.y - e.y, 2))
    )
  }
  function dW(i, e) {
    if (!i || !e) {
      return 0
    }
    return Math.round(
      Math.sqrt(Math.pow(i.lng - e.lng, 2) + Math.pow(i.lat - e.lat, 2))
    )
  }
  function eE(T, i) {
    var e = Math.round((T.x + i.x) / 2)
    var i8 = Math.round((T.y + i.y) / 2)
    return new eL(e, i8)
  }
  function il(e, T) {
    var i = []
    T =
      T ||
      function (i9) {
        return i9
      }
    for (var i8 in e) {
      i.push(i8 + '=' + T(e[i8]))
    }
    return i.join('&')
  }
  function bK(T, i, ja) {
    var jb = document.createElement(T)
    if (ja) {
      jb = document.createElementNS(ja, T)
    }
    i = i || {}
    for (var i8 in i) {
      var i9 = { for: 'htmlFor', class: 'cssClass' }[i8] || i8
      if (i8 === 'style') {
        jb.style.cssText = i[i8]
        continue
      }
      if (i8 === 'class') {
        es.ac(jb, i[i8])
        continue
      }
      if (jb.setAttribute) {
        jb.setAttribute(i9, i[i8])
      } else {
        try {
          jb[i9] = i[i8]
        } catch (jb) {}
      }
    }
    return jb
  }
  function b0(e) {
    if (e.currentStyle) {
      return e.currentStyle
    } else {
      if (e.ownerDocument && e.ownerDocument.defaultView) {
        return e.ownerDocument.defaultView.getComputedStyle(e, null)
      }
    }
  }
  function bG(e) {
    return typeof e === 'function'
  }
  function fy(e) {
    return e === void 0
  }
  function iz(e, i) {
    return Object.prototype.hasOwnProperty.call(e, i)
  }
  function f(i9, ja) {
    if (fy(i9.length)) {
      for (var i8 in i9) {
        if (iz(i9, i8)) {
          ja.call(null, i8, i9[i8])
        }
      }
    } else {
      var T = i9.length
      if (T) {
        for (var e = 0; e < T; e++) {
          ja.call(null, e, i9[e])
        }
      }
    }
  }
  function ak(i, e) {
    if (!e) {
      return i
    }
    f(e, function (T, i8) {
      i[T] = i8
    })
    return i
  }
  var gm = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='
  function cV(i9) {
    var T = ''
    var jg
    var je
    var jc = ''
    var jf
    var jd
    var jb
    var ja = ''
    var i8 = 0
    var e = /[^A-Za-z0-9+/=]/g
    if (!i9 || e.exec(i9)) {
      return i9
    }
    i9 = i9.replace(/[^A-Za-z0-9+/=]/g, '')
    do {
      jf = gm.indexOf(i9.charAt(i8++))
      jd = gm.indexOf(i9.charAt(i8++))
      jb = gm.indexOf(i9.charAt(i8++))
      ja = gm.indexOf(i9.charAt(i8++))
      jg = (jf << 2) | (jd >> 4)
      je = ((jd & 15) << 4) | (jb >> 2)
      jc = ((jb & 3) << 6) | ja
      T = T + String.fromCharCode(jg)
      if (jb !== 64) {
        T = T + String.fromCharCode(je)
      }
      if (ja !== 64) {
        T = T + String.fromCharCode(jc)
      }
      jg = je = jc = ''
      jf = jd = jb = ja = ''
    } while (i8 < i9.length)
    return T
  }
  function ik(e) {
    return btoa(encodeURIComponent(e))
  }
  function fk(e) {
    return decodeURIComponent(atob(e))
  }
  ;(function (e) {
    if (!e.Utils) {
      e.Utils = {}
    }
    var i = e.Utils
    i.format = (function () {
      function T(jb, ja, jc) {
        var i9 = jc[+ja]
        return typeof i9 === 'function' ? i9(ja) : i9
      }
      function i8(jb, ja, jc) {
        var je = ja
        var jf = []
        var i9 = ja.split(':')
        if (i9.length === 2) {
          je = i9[0]
          jf.push(i9[1])
        }
        var jd = typeof jc[je]
        if (jd === 'function') {
          return jc[je].apply(undefined, jf)
        } else {
          if (jd === 'undefined') {
            return jb
          } else {
            return String(jc[je])
          }
        }
      }
      return function (i9, ja) {
        var jc = ja.splice ? T : i8
        var jb = i9.splice ? i9.join('') : i9
        return jb.replace(/{([a-zA-Z0-9_$:.]+)}/g, function (je, jd) {
          return jc(je, jd, ja)
        })
      }
    })()
    i.ErrorMonitor = function (i8, T, i9) {}
    eW.canUseWebAssembly(function (T) {
      i.canUseWebAssembly = T
    })
  })(bo)
  function bJ() {
    return b9() || g4()
  }
  function b9() {
    var e = navigator.userAgent
    if (e.indexOf('iPhone') > -1 || e.indexOf('iPad') > -1) {
      return true
    }
    return false
  }
  function g4() {
    var e = navigator.userAgent
    if (e.indexOf('Android') > -1) {
      return true
    }
    return false
  }
  function hH(e) {
    return (e * Math.PI) / 180
  }
  function eD(e) {
    return (e / Math.PI) * 180
  }
  function bs(e, i9) {
    var i8 = Math.pow(10, i9)
    if (typeof e === 'number') {
      return Math.round(e * i8) / i8
    }
    for (var T = 0; T < e.length; T++) {
      e[T] = bs(e[T], i9)
    }
    return e
  }
  function bV(T, i, e) {
    if (T < i) {
      T = i
    } else {
      if (T > e) {
        T = e
      }
    }
    return T
  }
  function dJ(e, i) {
    while (e < 0) {
      e += i
    }
    return e % i
  }
  function g0(i, e) {
    return (i >= 0 && e >= 0) || (i < 0 && e < 0)
  }
  function G(i) {
    if (i._gl) {
      return i._gl
    }
    var e = {
      alpha: true,
      antialias: false,
      failIfMajorPerformanceCaveat: false,
      preserveDrawingBuffer: false,
      stencil: false,
    }
    var T = i.getContext('webgl', e) || i.getContext('experimental-webgl', e)
    i._gl = T
    return T
  }
  function hF(i8, T) {
    for (var e = 0; e < T.length; e++) {
      es.on(i8, T[e], ad)
    }
  }
  function em(i, T, e) {
    T[e] = i.getUniformLocation(T, e)
  }
  function bM(i9, ja, e, T, i) {
    var i8 = ''
    switch (i) {
      case 'mat4':
        i9.uniformMatrix4fv(ja[e], false, T)
        return
      case 'v3':
        i8 = 'uniform3fv'
        break
      case 'f':
        i8 = 'uniform1f'
        break
      case 'i':
        i8 = 'uniform1i'
        break
    }
    if (i8 === '') {
      throw 'error'
    }
    i9[i8](ja[e], T)
  }
  function gL(jg, e) {
    while (jg < 0) {
      jg += 360
    }
    jg = jg % 360
    var i8 = e.width
    var jf = e.height
    var jb = i8
    var T = jf
    if (jg < 90) {
      var i = Math.sin(hH(jg)) * i8
      var jd = Math.sin(hH(jg)) * jf
      var je = Math.cos(hH(jg)) * i8
      var ja = Math.cos(hH(jg)) * jf
      var jb = Math.ceil(je + jd)
      var T = Math.ceil(i + ja)
    } else {
      if (jg < 180) {
        var jg = jg - 90
        var i = Math.sin(hH(jg)) * i8
        var jd = Math.sin(hH(jg)) * jf
        var je = Math.cos(hH(jg)) * i8
        var ja = Math.cos(hH(jg)) * jf
        var jb = Math.ceil(i + ja)
        var T = Math.ceil(je + jd)
      } else {
        if (jg < 270) {
          var jg = jg - 180
          var i = Math.sin(hH(jg)) * i8
          var jd = Math.sin(hH(jg)) * jf
          var je = Math.cos(hH(jg)) * i8
          var ja = Math.cos(hH(jg)) * jf
          var jb = Math.ceil(je + jd)
          var T = Math.ceil(i + ja)
        } else {
          var jg = jg - 270
          var i = Math.sin(hH(jg)) * i8
          var jd = Math.sin(hH(jg)) * jf
          var je = Math.cos(hH(jg)) * i8
          var ja = Math.cos(hH(jg)) * jf
          var jb = Math.ceil(i + ja)
          var T = Math.ceil(je + jd)
        }
      }
    }
    var jc = jb - i8
    var i9 = T - jf
    return [0 - jc / 2, 0 - i9 / 2, i8 + jc / 2, jf + i9 / 2]
  }
  function bU(e) {
    if (e.toDataURL() === bU._blankData) {
      return true
    }
    return false
  }
  function P(i9, i8, T) {
    var i = [T.lng - i9.lng, T.lat - i9.lat]
    var e = [i8.lng - i9.lng, i8.lat - i9.lat]
    return i[0] * e[1] - i[1] * e[0]
  }
  function h1(ja, i9, T) {
    var e
    var jb
    var i8
    var i
    if (ja.lng < i9.lng) {
      e = ja.lng
      i8 = i9.lng
    } else {
      e = i9.lng
      i8 = ja.lng
    }
    if (ja.lat < i9.lat) {
      jb = ja.lat
      i = i9.lat
    } else {
      jb = i9.lat
      i = ja.lat
    }
    if (T.lng < e || T.lng > i8 || T.lat < jb || T.lat > i) {
      return false
    }
    return true
  }
  function h9(jc, jb, ja, i8) {
    var i9 = P(ja, i8, jc)
    var T = P(ja, i8, jb)
    var i = P(jc, jb, ja)
    var e = P(jc, jb, i8)
    if (i9 * T < 0 && i * e < 0) {
      return true
    } else {
      if (i9 === 0 && h1(ja, i8, jc)) {
        return true
      } else {
        if (T === 0 && h1(ja, i8, jb)) {
          return true
        } else {
          if (i === 0 && h1(jc, jb, ja)) {
            return true
          } else {
            if (e === 0 && h1(jc, jb, i8)) {
              return true
            } else {
              return false
            }
          }
        }
      }
    }
  }
  function gO(T, i) {
    var e = i.parentNode
    if (e.lastChild === i) {
      e.appendChild(T)
    } else {
      e.insertBefore(T, i.nextSibling)
    }
  }
  function dp(je, jf) {
    if (jf === 0) {
      return je
    }
    var jd = 0
    var jb = 0
    if (!je) {
      throw '异常'
    }
    if (je.length === 0) {
      return []
    }
    for (var i9 = 1, T = je.length - 1; i9 < T; i9++) {
      var jc = fd(je[i9], je[0], je[je.length - 1])
      if (jc > jd) {
        jb = i9
        jd = jc
      }
    }
    var e = []
    if (jd >= jf) {
      var jh = je.slice(0, jb)
      var jg = je.slice(jb, je.length)
      var ja = dp(jh, jf)
      var i8 = dp(jg, jf)
      for (var i9 = 0, T = ja.length; i9 < T; i9++) {
        e.push(ja[i9])
      }
      for (var i9 = 0, T = i8.length; i9 < T; i9++) {
        e.push(i8[i9])
      }
    } else {
      e.push(je[0])
      e.push(je[je.length - 1])
    }
    return e
  }
  function m(e) {
    if (Math.log2) {
      return Math.log2(e)
    }
    return Math.log(e) / Math.LN2
  }
  function cO(T, i, e) {
    return Math.min(e, Math.max(i, T))
  }
  function aj(e, i) {
    if (!i) {
      return e
    }
    var ja = i[0]
    var i9 = i[1]
    var i8 = i[2]
    var T = i[3]
    var jc = []
    var jb = []
    jc[0] = T * e[0] + i8 * e[2]
    jc[1] = e[1]
    jc[2] = -i8 * e[0] + T * e[2]
    jb[0] = jc[0]
    jb[1] = i9 * jc[1] - ja * jc[2]
    jb[2] = ja * jc[1] + i9 * jc[2]
    return jb
  }
  var k = Math.PI / 180
  var f4 = 180 / Math.PI
  function eZ(T) {
    var i = (T - Date.UTC(2000, 0, 1, 12)) / 86400000 / 36525
    var e = ((d3.utcDay.floor(T) - T) / 86400000) * 360 - 180
    return [e - eO(i) * f4, dv(i) * f4]
  }
  function eO(i8) {
    var i9 = bf(i8)
    var i = dB(i8)
    var T = hC(i8)
    var ja = Math.tan(hB(i8) / 2)
    ja *= ja
    return (
      ja * Math.sin(2 * T) -
      2 * i9 * Math.sin(i) +
      4 * i9 * ja * Math.sin(i) * Math.cos(2 * T) -
      0.5 * ja * ja * Math.sin(4 * T) -
      1.25 * i9 * i9 * Math.sin(2 * i)
    )
  }
  function dv(e) {
    return Math.asin(Math.sin(hB(e)) * Math.sin(bk(e)))
  }
  function bk(e) {
    return (
      iV(e) - (0.00569 + 0.00478 * Math.sin((125.04 - 1934.136 * e) * k)) * k
    )
  }
  function iV(e) {
    return hC(e) + ie(e)
  }
  function dB(e) {
    return (357.52911 + e * (35999.05029 - 0.0001537 * e)) * k
  }
  function hC(i) {
    var e = (280.46646 + i * (36000.76983 + i * 0.0003032)) % 360
    return ((e < 0 ? e + 360 : e) / 180) * Math.PI
  }
  function ie(i) {
    var e = dB(i)
    return (
      (Math.sin(e) * (1.914602 - i * (0.004817 + 0.000014 * i)) +
        Math.sin(e + e) * (0.019993 - 0.000101 * i) +
        Math.sin(e + e + e) * 0.000289) *
      k
    )
  }
  function hB(e) {
    return c4(e) + 0.00256 * Math.cos((125.04 - 1934.136 * e) * k) * k
  }
  function c4(e) {
    return (
      (23 +
        (26 + (21.448 - e * (46.815 + e * (0.00059 - e * 0.001813))) / 60) /
          60) *
      k
    )
  }
  function bf(e) {
    return 0.016708634 - e * (0.000042037 + 1.267e-7 * e)
  }
  function fz() {
    return window.devicePixelRatio || 1
  }
  function hO(T) {
    var i
    var e
    var i8
    if (T >= 0) {
      i8 = Math.floor(T / 65536) * 65536
      i = i8
      e = T - i8
    } else {
      i8 = Math.floor(-T / 65536) * 65536
      i = -i8
      e = T + i8
    }
    return [i, e]
  }
  function ch(e) {
    if (e.lng >= 0 && e.lat >= 0) {
      return new cd(e.lng - 10000000, e.lat - 6000000)
    }
    if (e.lng >= 0 && e.lat < 0) {
      return new cd(e.lng - 10000000, e.lat + 6000000)
    }
    if (e.lng < 0 && e.lat >= 0) {
      return new cd(e.lng + 10000000, e.lat - 6000000)
    }
    if (e.lng < 0 && e.lat < 0) {
      return new cd(e.lng + 10000000, e.lat + 6000000)
    }
  }
  var hl = null
  if (window.performance && window.performance.now) {
    hl = function () {
      return performance.now()
    }
  } else {
    if (Date.now) {
      hl = function () {
        return Date.now()
      }
    } else {
      hl = function () {
        return new Date().getTime()
      }
    }
  }
  function gZ(i8, e, i) {
    var T = 'mouseWheel'
    if (es.Platform.macintosh) {
      if (!isNaN(i8) && (i8 < 10 || i8 !== 120) && e % 1 === 0 && e < 5) {
        T = 'padScroll'
      }
      if (es.Browser.firefox && e % 1 === 0 && e < 5 && i === 0) {
        T = 'padScroll'
      }
    }
    if (es.Browser.safari && i8 === 12) {
      T = 'mouseWheel'
    }
    return T
  }
  function bB(jh, jc) {
    var jg = jh[0]
    var jf = jh[1]
    var i8 = false
    for (var jb = 0, ja = jc.length - 2; jb < jc.length; jb += 2) {
      var je = jc[jb]
      var i9 = jc[jb + 1]
      var jd = jc[ja]
      var T = jc[ja + 1]
      var e = i9 > jf !== T > jf && jg < ((jd - je) * (jf - i9)) / (T - i9) + je
      if (e) {
        i8 = !i8
      }
      ja = jb
    }
    return i8
  }
  function am(i9, jb) {
    var e = jb.length
    var T = 0
    var ja = false
    for (var i8 = 0; i8 < e; i8++) {
      T = i8 === e - 1 ? 0 : T + 1
      if (
        jb[i8].lat !== jb[T].lat &&
        ((i9.lat >= jb[i8].lat && i9.lat < jb[T].lat) ||
          (i9.lat >= jb[T].lat && i9.lat < jb[i8].lat)) &&
        i9.lng <
          ((jb[T].lng - jb[i8].lng) * (i9.lat - jb[i8].lat)) /
            (jb[T].lat - jb[i8].lat) +
            jb[i8].lng
      ) {
        ja = !ja
      }
    }
    return ja
  }
  function dm(T, e, i, i8) {
    i8 = i8 || 0.4
    if (T > i) {
      T = Math.pow(T - i + 1, i8) + i - 1
    } else {
      if (T < e) {
        T = e - Math.pow(e - T + 1, i8) + 1
      }
    }
    return T
  }
  function eo(jc) {
    var ja = ''
    for (var T = 0; T < jc.length; T++) {
      var jd = jc.charCodeAt(T) << 1
      var e = jd.toString(2)
      var i9 = e.length
      var jg = e
      if (i9 < 8) {
        jg = '00000000' + e
        jg = jg.substr(e.length, 8)
      }
      ja += jg
    }
    var je = 5 - (ja.length % 5)
    var i8 = []
    for (var T = 0; T < je; T++) {
      i8[T] = '0'
    }
    ja = i8.join('') + ja
    var jf = []
    for (var T = 0; T < ja.length / 5; T++) {
      var jd = ja.substr(T * 5, 5)
      var jb = parseInt(jd, 2) + 50
      jf.push(String.fromCharCode(jb))
    }
    return jf.join('') + je.toString()
  }
  function iN(T, i) {
    var e = bo.TILE_VERSION || window.TILE_VERSION
    if (!e || !e[T] || !e[T][i] || !e[T][i].version || !e[T][i].updateDate) {
      e = w.tvc
    }
    return { ver: e[T][i].version, udt: e[T][i].updateDate }
  }
  function bp() {
    var e = bo.MSV || window.MSV
    if (!e || !e.mapstyle || !e.mapstyle.updateDate || !e.mapstyle.version) {
      e = w.msv
    }
    return { ver: e.mapstyle.version, udt: e.mapstyle.updateDate }
  }
  function c8(e, i9) {
    var i8 = e.slice(0)
    for (var T = 0; T < i8.length; T++) {
      i8[T] += i9
    }
    return i8
  }
  var gg = null
  function gv(e) {
    if (gg) {
      return
    }
    e.fire(new e7('onloadtile'))
    gg = setTimeout(function () {
      gg = null
    }, 1000)
  }
  function aC() {
    if (
      y('//map.baidu.com') ||
      y('//maps.baidu.com') ||
      y('//ditu.baidu.com')
    ) {
      return true
    }
    return false
  }
  aA.inMapHost = aC()
  if (typeof window._inMapHost === 'boolean') {
    aA.inMapHost = window._inMapHost
  }
  function y(i) {
    var T = window.location
    var e = document.createElement('a')
    e.href = i
    return (
      e.hostname === T.hostname &&
      e.port === T.port &&
      e.protocol === T.protocol
    )
  }
  var du = [72.685732, 0.193351, 136.10888, 54.392257]
  var er = [72.6892532, 0.1939743381, 136.1168614, 54.392257]
  var s = [72.69566833, 0.1999420909, 136.1232863, 54.39791217]
  var hD = 158
  var cX = [
    98.789081, 122.948721, 107.857301, 118.082148, 119.126627, 128.021934,
    79.939914, 99.021873, 119.912937, 122.084572, 127.906381, 130.933385,
    106.496057, 108.066113, 119.818772, 126.367919, 111.789929, 119.311401,
    100.742164, 102.220151, 99.853589, 100.781289, 97.522631, 98.834615,
    99.092638, 99.892947, 122.905967, 123.761867, 123.716213, 125.494726,
    123.723977, 124.755034, 125.475833, 126.398284, 125.471687, 126.065118,
    130.817003, 133.605851, 127.900156, 128.656536, 128.646633, 129.625389,
    132.88057, 134.104549, 117.365548, 119.230813, 116.073074, 117.416898,
    114.406274, 116.123791, 116.479038, 119.591534, 110.566812, 111.851324,
    74.465162, 79.993155, 82.858046, 91.345214, 85.71485, 98.969834, 127.651377,
    129.532029, 129.462275, 130.209769, 133.716214, 134.731053, 134.366834,
    135.103133, 130.854579, 131.32966, 115.499125, 117.530421, 115.765224,
    116.734157, 108.524336, 110.601747, 121.351282, 124.612037, 126.151954,
    127.332751, 91.273562, 95.604179, 79.87318, 82.935667, 76.413314, 78.336484,
    78.275229, 79.993668, 83.956612, 85.725267, 85.500637, 89.346601, 97.990127,
    98.94176, 106.641956, 108.599215, 111.386259, 111.810312, 111.578597,
    111.803167, 115.99273, 117.010413, 116.24461, 116.675246, 119.422198,
    119.909078, 120.646056, 121.38098, 120.335038, 120.662183, 124.579855,
    125.773243, 126.207803, 126.774849, 95.565331, 102.037736, 95.576121,
    96.158028, 95.556699, 97.799055, 91.296205, 93.348146, 93.321994, 94.690522,
    89.339313, 90.540241, 82.263039, 82.882528, 78.335615, 80.023512, 76.623947,
    78.352608, 73.495149, 74.48155, 74.846872, 76.479412, 91.560058, 94.871116,
    88.759515, 89.235995, 83.237883, 83.965264, 82.292123, 83.246813, 81.876477,
    83.253307, 80.75212, 81.463265, 86.463409, 88.267232, 102.199623,
    104.225963, 112.153727, 116.823265, 108.965663, 113.021145, 111.166575,
    117.972799,
  ]
  var cW = [
    22.548416, 42.276971, 17.227969, 22.7346, 41.292761, 50.741667, 30.365133,
    42.324913, 21.701924, 22.69335, 42.4176, 48.936335, 21.429059, 22.648399,
    50.650499, 52.914825, 42.20449, 45.199078, 21.13391, 22.568612, 21.441033,
    22.583349, 23.73862, 25.298628, 22.00409, 22.563095, 38.97849, 41.338631,
    40.287973, 41.330108, 39.732801, 40.343252, 40.966852, 41.323446, 40.719312,
    41.05937, 44.869472, 48.009884, 41.336325, 42.443362, 42.008104, 42.434713,
    45.873151, 48.205746, 45.132322, 46.784582, 45.133383, 46.392803, 45.148771,
    45.740273, 47.478161, 50.064393, 42.216229, 43.461282, 37.014302, 40.662281,
    42.219985, 47.31417, 27.726965, 30.466651, 48.911271, 49.642488, 48.831706,
    49.434487, 46.941762, 48.37425, 47.651781, 48.463782, 42.851964, 44.905396,
    47.598273, 48.438467, 48.409141, 48.901651, 42.22756, 42.906402, 52.821047,
    53.578094, 50.701837, 51.654278, 42.292419, 44.392214, 42.295918, 45.385017,
    34.680866, 37.027803, 30.743515, 37.066586, 28.245649, 30.406053, 47.270872,
    48.497371, 25.238932, 27.778469, 42.215754, 42.540416, 43.427677, 44.689208,
    44.685587, 44.994131, 48.878657, 49.318659, 49.281099, 49.624515, 50.710468,
    51.306809, 52.90717, 53.331981, 52.903016, 53.107959, 52.900867, 53.250033,
    51.638073, 52.400678, 42.229657, 42.691928, 43.061242, 43.891083, 42.663095,
    43.074222, 44.37174, 45.180155, 44.375135, 44.974219, 47.3035, 48.053221,
    45.352401, 46.807875, 40.563053, 42.040289, 40.581871, 41.405172, 38.516328,
    40.178756, 35.790476, 37.02337, 26.825605, 27.761303, 27.197399, 27.74932,
    29.147561, 30.37813, 29.570893, 30.062042, 30.045026, 30.380952, 29.998038,
    30.385203, 48.487385, 49.16832, 22.395733, 22.598229, 7.441114, 11.501436,
    3.767491, 9.000793, 12.642067, 17.406563,
  ]
  var bR = [
    98.795985, 122.960792, 107.867379, 118.093451, 119.139658, 128.035888,
    79.948212, 99.029524, 119.923388, 122.094977, 127.918527, 130.94789,
    106.50606, 108.076783, 119.8329, 126.382207, 111.803567, 119.324928,
    100.749858, 102.227985, 99.860885, 100.788921, 97.529435, 98.841564,
    99.100017, 99.90035, 122.917416, 123.774367, 123.728314, 125.507211,
    123.736065, 124.767299, 125.488463, 126.410675, 125.484326, 126.07764,
    130.830784, 133.620042, 127.912178, 128.668957, 128.658937, 129.638599,
    132.894179, 134.119086, 117.379378, 119.244569, 116.086736, 117.431212,
    114.420233, 116.137458, 116.492775, 119.605527, 110.579401, 111.86488,
    74.468228, 80.001908, 82.867432, 91.353788, 85.721075, 98.976964,
    127.664757, 129.546833, 129.476893, 130.22449, 133.730358, 134.745235,
    134.381034, 135.1178, 130.868117, 131.34409, 115.513245, 117.544751,
    115.779271, 116.748045, 108.536254, 110.614326, 121.365534, 124.626434,
    126.165992, 127.347013, 91.281869, 95.611754, 79.879648, 82.945041,
    76.413314, 78.345207, 78.275229, 80.002329, 83.956612, 85.734098, 85.510186,
    89.356499, 97.997001, 98.948845, 106.653208, 108.610811, 111.400183,
    111.824179, 111.592224, 111.817136, 116.00682, 117.024631, 116.258574,
    116.689291, 119.436876, 119.922961, 120.659806, 121.395479, 120.349116,
    120.676014, 124.59389, 125.787788, 126.221756, 126.788962, 95.572955,
    102.046581, 95.583772, 96.165551, 95.564318, 97.806095, 91.30446, 93.356438,
    93.330319, 94.698145, 89.349129, 90.548677, 82.268802, 82.892025, 78.335615,
    80.032266, 76.625755, 78.361413, 73.498248, 74.490992, 74.846872, 76.488771,
    91.563521, 94.878444, 88.768214, 89.244787, 83.247076, 83.974127, 82.29595,
    83.256003, 81.885315, 83.26249, 80.760619, 81.472404, 86.470983, 88.276988,
    102.207537, 104.234614, 112.164795, 116.833667, 108.965663, 113.032246,
    111.166575, 117.983363,
  ]
  var bQ = [
    22.551183, 42.284787, 17.227969, 22.738314, 41.300981, 50.749638, 30.368087,
    42.332701, 21.705055, 22.696452, 42.426047, 48.944674, 21.432184, 22.651387,
    50.657409, 52.92296, 42.212192, 45.206905, 21.137031, 22.57186, 21.444502,
    22.586566, 23.741571, 25.301472, 22.006806, 22.56637, 38.985114, 41.346531,
    40.295617, 41.338581, 39.740021, 40.351012, 40.974644, 41.331562, 40.726852,
    41.067192, 44.877158, 48.018285, 41.344597, 42.451798, 42.016305, 42.443235,
    45.880906, 48.214001, 45.140027, 46.792775, 45.141083, 46.400433, 45.156418,
    45.748281, 47.485889, 50.071879, 42.223667, 43.469487, 37.019867, 40.668675,
    42.226823, 47.321605, 27.72944, 30.469853, 48.919002, 49.650614, 48.840188,
    49.443166, 46.949801, 48.382798, 47.660603, 48.472692, 42.859946, 44.913298,
    47.605896, 48.445914, 48.41698, 48.909667, 42.23507, 42.914193, 52.8281,
    53.585952, 50.709311, 51.662219, 42.29968, 44.399225, 42.302746, 45.391958,
    34.680866, 37.03377, 30.743515, 37.07228, 28.245649, 30.408935, 47.277693,
    48.504255, 25.241528, 27.780726, 42.223363, 42.548418, 43.435888, 44.696952,
    44.693193, 45.00187, 48.886267, 49.326755, 49.288642, 49.632304, 50.717486,
    51.314369, 52.914204, 53.33964, 52.910094, 53.115926, 52.908382, 53.258095,
    51.64533, 52.408305, 42.236825, 42.699126, 43.068466, 43.898632, 42.670403,
    43.082219, 44.379045, 45.187742, 44.382336, 44.981379, 47.310362, 48.06019,
    45.359099, 46.814439, 40.569751, 42.047741, 40.587956, 41.41263, 38.519192,
    40.185033, 35.790476, 37.029005, 26.825605, 27.763896, 27.199658, 27.751649,
    29.150192, 30.381073, 29.573886, 30.065162, 30.047775, 30.384089, 30.001277,
    30.388525, 48.494118, 49.173841, 22.398528, 22.601198, 7.441114, 11.505968,
    3.767491, 9.005209, 12.642067, 17.410886,
  ]
  var Y = 95
  var cE = [
    110.3961374, 105.0743788, 96.8991824, 95.61810411, 93.82412598, 91.3892353,
    91.38931858, 89.08325955, 87.22469808, 86.26278402, 85.17353, 85.23741211,
    82.86627441, 81.90481038, 79.59687147, 80.39829237, 79.93319363,
    77.80279948, 75.2557704, 73.49357829, 73.1892532, 73.87758816, 74.4064738,
    74.10215224, 75.46409695, 76.77739692, 78.28299615, 78.15499485,
    78.37920654, 78.89145345, 79.69282199, 81.19938178, 81.80830295,
    83.89093424, 85.94149523, 87.86447266, 89.03414958, 90.05918132,
    91.10026937, 92.15733832, 93.74361735, 95.82597331, 97.95655545,
    97.12363037, 98.2129739, 99.2068571, 101.6587874, 102.5239084, 102.2356106,
    105.0249238, 106.0992342, 107.8617093, 111.6439372, 109.591869, 112.284586,
    117.7961157, 118.9495128, 114.2076584, 118.693565, 123.1475225, 122.730705,
    120.9361393, 123.4207441, 122.3787782, 122.1385425, 121.5904281,
    121.1773763, 120.6805404, 120.2483355, 122.795807, 122.8759077, 121.3060262,
    122.1392177, 123.7418799, 126.4177599, 128.5647409, 129.7194884,
    131.2259136, 131.9950494, 133.6289931, 135.6168614, 131.3875545,
    130.8743365, 128.6303223, 126.0997773, 124.4015375, 122.22161, 119.6586483,
    119.7866827, 118.5685878, 116.5177976, 114.819101, 119.0812964, 116.453265,
    111.7431171,
  ]
  var cC = [
    43.2190351, 42.38053385, 43.17417589, 44.42226915, 45.09863634, 45.56708116,
    47.33599718, 48.68832709, 49.62448486, 48.9482175, 48.4800472, 47.33564399,
    47.43948676, 46.03452067, 45.20221788, 43.34563043, 42.32965739,
    41.39690972, 40.82972331, 39.95567654, 39.25892877, 38.36098768,
    38.05441569, 37.16878445, 36.38899414, 35.36126817, 34.30953451,
    32.58503879, 31.56975694, 30.77800266, 30.43559814, 29.7744892, 30.0931977,
    28.71103299, 27.70739665, 27.5775472, 27.01096137, 27.77857883, 27.50707954,
    26.50328315, 26.70387804, 27.95548557, 27.29428901, 23.64685493,
    23.62310601, 21.67493381, 20.77751465, 21.32070991, 22.1824113, 22.31232964,
    22.51316054, 16.80037679, 13.19749864, 0.6939743381, 1.541660428,
    10.50208252, 15.58926975, 17.89090007, 19.94928467, 22.18490153,
    25.37285292, 25.61456434, 30.62532552, 31.08099284, 31.89238173,
    32.50092692, 32.80325765, 34.25546956, 35.15486138, 36.90170139, 37.8348272,
    37.941604, 38.6480797, 38.96797201, 40.98146918, 41.25573296, 42.07218153,
    42.49132813, 44.65259766, 44.69330702, 48.62286865, 48.09383952,
    49.19628499, 50.03402317, 53.27678901, 53.62976345, 53.89420546,
    52.98933322, 52.01872884, 50.23210259, 50.18807048, 47.49769857,
    47.34362712, 46.50502143, 45.24770128,
  ]
  var ea = [
    98.7895, 122.954182, 107.860913, 118.087007, 119.133165, 128.029533,
    79.941749, 99.023087, 119.916883, 122.08841, 127.912143, 130.941471,
    106.499502, 108.070244, 119.826245, 126.375818, 111.797006, 119.318387,
    100.743285, 102.221517, 99.854448, 100.782445, 97.522928, 98.835028,
    99.093518, 99.893783, 122.910927, 123.767769, 123.721954, 125.50077,
    123.729657, 124.760724, 125.481902, 126.404079, 125.477737, 126.071019,
    130.824331, 133.613395, 127.905767, 128.662524, 128.652527, 129.6321,
    132.887552, 134.11249, 117.37297, 119.237999, 116.080154, 117.424589,
    114.413586, 116.130948, 116.486264, 119.598927, 110.5728, 111.858437,
    74.465162, 79.995337, 82.860821, 91.347291, 85.716024, 98.970481,
    127.658331, 129.540202, 129.470528, 130.21808, 133.723748, 134.738785,
    134.374555, 135.111443, 130.861475, 131.337438, 115.506627, 117.538123,
    115.772783, 116.741632, 108.529656, 110.60782, 121.358945, 124.619773,
    126.159424, 127.340582, 91.275275, 95.605228, 79.874427, 82.938601,
    76.413314, 78.338763, 78.275229, 79.995765, 83.956612, 85.727511, 85.503554,
    89.349858, 97.990418, 98.942257, 106.646704, 108.604437, 111.393667,
    111.817723, 111.585811, 111.810645, 116.000232, 117.018216, 116.252108,
    116.682705, 119.430384, 119.916417, 120.653168, 121.38883, 120.342727,
    120.669383, 124.587426, 125.781376, 126.215282, 126.782323, 95.566367,
    102.040026, 95.577158, 96.159009, 95.557772, 97.799728, 91.298032,
    93.350057, 93.323794, 94.691771, 89.342471, 90.542019, 82.264229, 82.885485,
    78.335615, 80.025844, 76.623947, 78.355027, 73.495149, 74.484473, 74.846872,
    76.482208, 91.560117, 94.871859, 88.761692, 89.23822, 83.240549, 83.967602,
    82.292367, 83.2495, 81.878825, 83.256003, 80.75421, 81.465955, 86.465421,
    88.270356, 102.201019, 104.228033, 112.158282, 116.827153, 108.965663,
    113.025767, 111.166575, 117.97687,
  ]
  var d9 = [
    22.545421, 42.279053, 17.226272, 22.731982, 41.294917, 50.743316, 30.361986,
    42.326603, 21.699185, 22.690751, 42.419757, 48.938435, 21.426505, 22.64567,
    50.651745, 52.916705, 42.20641, 45.201064, 21.131326, 22.565685, 21.438288,
    22.580379, 23.735785, 25.295582, 22.001087, 22.560315, 38.979333, 41.340757,
    40.28938, 41.332289, 39.734164, 40.344718, 40.968803, 41.325813, 40.721073,
    41.061503, 44.871533, 48.012179, 41.338366, 42.445601, 42.010343, 42.436934,
    45.875217, 48.208327, 45.134237, 46.786509, 45.135376, 46.394665, 45.150734,
    45.742257, 47.480099, 50.065931, 42.217982, 43.46329, 37.014057, 40.662848,
    42.221079, 47.315558, 27.723432, 30.46385, 48.913298, 49.644555, 48.83396,
    49.436824, 46.944059, 48.376613, 47.654503, 48.466331, 42.854333, 44.907682,
    47.600253, 48.440245, 48.410926, 48.903468, 42.229292, 42.908294, 52.822466,
    53.58012, 50.703491, 51.656037, 42.29378, 44.393379, 42.296912, 45.385809,
    34.679282, 37.027699, 30.740622, 37.066377, 28.241967, 30.403134, 47.271949,
    48.49848, 25.235818, 27.774976, 42.217425, 42.542102, 43.429763, 44.691016,
    44.687044, 44.995758, 48.880431, 49.320551, 49.282865, 49.626267, 50.711607,
    51.308382, 52.908547, 53.333963, 52.904419, 53.109706, 52.902338, 53.251938,
    51.639701, 52.402205, 42.231045, 42.693581, 43.062756, 43.892771, 42.664519,
    43.075927, 44.372942, 45.1815, 44.376327, 44.975476, 47.304623, 48.054453,
    45.353174, 46.808493, 40.563653, 42.041556, 40.582164, 41.4064, 38.51618,
    40.179105, 35.789745, 37.023144, 26.825402, 27.757641, 27.193806, 27.745766,
    29.144229, 30.375186, 29.567889, 30.059102, 30.041938, 30.378006, 29.995047,
    30.382338, 48.48834, 49.169021, 22.392816, 22.595333, 7.439914, 11.500161,
    3.766676, 9.000793, 12.640512, 17.406563,
  ]
  var e6 = 3000
  var f8 = 0.00002
  var f7 = 0.000003
  var hY = 0.0174532925194
  var gR = 0.0065
  var gQ = 0.006
  var dg = 40000
  var eX = 0
  var ig = 1
  var ar = 2
  var he = 3
  var eQ = 4
  var gy = 1e-10
  var hK = 6370996.81
  var e9 = 100000000
  function gG(T, i9, i, i8) {
    var e = arguments.length
    this.ll = {}
    this.ru = {}
    if (e === 0) {
    } else {
      if (e === 4) {
        this.normalize(T, i9, i, i8)
      }
    }
  }
  gG.prototype.contains = function (e) {
    if (
      e.lng > this.ll.lng &&
      e.lng < this.ru.lng &&
      e.lat > this.ll.lat &&
      e.lat < this.ru.lat
    ) {
      return he
    }
    if (
      Math.abs(e.lng - this.ll.lng) < gy ||
      Math.abs(e.lng - this.ru.lng) < gy ||
      Math.abs(e.lat - this.ll.lat) < gy ||
      Math.abs(e.y - this.ru.lat) > gy
    ) {
      return ar
    }
    return eX
  }
  gG.prototype.normalize = function (i, i8, e, T) {
    if (i > e) {
      this.ll.lng = e
      this.ru.lng = i
    } else {
      this.ll.lng = i
      this.ru.lng = e
    }
    if (i8 > T) {
      this.ll.lat = T
      this.ru.lat = i8
    } else {
      this.ll.lat = i8
      this.ru.lat = T
    }
  }
  function d0(i, i8, e, T) {
    this.sp = { lng: i, lat: i8 }
    this.ep = { lng: e, lat: T }
    this.mbr = new gG(i, i8, e, T)
  }
  function hm(i8, e, ja, i9) {
    for (var T = 0; T < i9; T = T + 2) {
      if (
        i8.lng >= e[T] &&
        i8.lng <= e[T + 1] &&
        i8.lat >= ja[T] &&
        i8.lat <= ja[T + 1]
      ) {
        return true
      }
    }
    return false
  }
  function fE(jd) {
    var i = jd.lng
    var jc = jd.lat
    var i8 = Math.sqrt(i * i + jc * jc)
    var ja = Math.atan2(jc, i)
    var T = i8 + fO(jc)
    var i9 = ja + fN(i)
    var e = T * Math.cos(i9)
    var jb = T * Math.sin(i9)
    return { lng: e + gR, lat: jb + gQ }
  }
  function aQ(jd) {
    var i = jd.lng - gR
    var jc = jd.lat - gQ
    var i8 = Math.sqrt(i * i + jc * jc)
    var ja = Math.atan2(jc, i)
    var T = i8 - fO(jc)
    var i9 = ja - fN(i)
    var e = T * Math.cos(i9)
    var jb = T * Math.sin(i9)
    return { lng: e, lat: jb }
  }
  function fO(e) {
    return Math.sin(e * e6 * hY) * f8
  }
  function fN(e) {
    return Math.cos(e * e6 * hY) * f7
  }
  function al(T, i, e) {
    return (i.lng - T.lng) * (e.lat - T.lat) - (e.lng - T.lng) * (i.lat - T.lat)
  }
  function gW(i, e) {
    return Math.abs(i - e) <= gy
  }
  function fU(i8, T) {
    var i = i8.lat * hY
    var jd = i8.lng * hY
    var e = T.lat * hY
    var jc = T.lng * hY
    var ja = Math.cos(i) * Math.cos(e)
    var i9 = Math.cos(jd) * Math.cos(jc)
    var jf = Math.sin(i) * Math.sin(e)
    var je = Math.sin(jd) * Math.sin(jc)
    var jg = ja * i9 + ja * je + jf
    if (jg < -1) {
      jg = -1
    } else {
      if (jg > 1) {
        jg = 1
      }
    }
    var jb = Math.acos(jg) * hK
    return jb
  }
  function g(jc, jb) {
    var i = jc.lat * hY
    var e = jb.lat * hY
    var i8 = jc.lng * hY
    var T = jb.lng * hY
    var ja = i - e
    var i9 = i8 - T
    var jd =
      Math.sin(ja / 2) * Math.sin(ja / 2) +
      Math.cos(i) * Math.cos(e) * Math.sin(i9 / 2) * Math.sin(i9 / 2)
    return 2 * Math.asin(Math.sqrt(jd)) * hK
  }
  function fS(jd, T) {
    var jf = bq(jd, T)
    var je = 180
    var jc = 90
    var jb = -180
    var i9 = -90
    var ja = T.sp
    var i8 = T.ep
    je = ja.lng < i8.lng ? ja.lng : i8.lng
    jc = ja.lat < i8.lat ? ja.lat : i8.lat
    jb = ja.lng < i8.lng ? ja.lng : i8.lng
    i9 = ja.lat < i8.lat ? ja.lat : i8.lat
    if (jf.lng <= jb && jf.lng >= je && jf.lng <= i9 && jf.lat >= jc) {
      return fU(jd, jf)
    } else {
      var i = g(jd, T.sp)
      var e = g(jd, T.ep)
      return i < e ? i : e
    }
  }
  function aR(i, e) {}
  function bu(i, i8, e, T) {
    return Math.sqrt((i - e) * (i - e) + (i8 - T) * (i8 - T))
  }
  function bq(jj, jb) {
    var ja = jj.lng
    var ji = jj.lat
    var i9 = jb.sp.lng
    var jh = jb.sp.lat
    var T = jb.ep.lng
    var jf = jb.ep.lat
    var jg = jf - jh
    var je = i9 - T
    if (gW(jg, 0) && gW(je, 0)) {
      return jb.sp
    }
    var jd = T * jh - i9 * jf
    var jc = je * ja - jg * ji
    var e = jg * jg - je * je
    var i8 = je * jc - jg * jd
    var i = jg * jc + je * jd
    return { lng: i8 / e, lat: -i / e }
  }
  function by(i8) {
    var T = 0
    for (var e = 0; e < Y; ++e) {
      if (cC[e] <= i8.lat) {
        if (cC[(e + 1) % Y] > i8.lat) {
          if (
            al(
              { lng: cE[e], lat: cC[e] },
              { lng: cE[(e + 1) % Y], lat: cC[(e + 1) % Y] },
              i8
            ) > 0
          ) {
            ++T
          }
        }
      } else {
        if (cC[(e + 1) % Y] <= i8.lat) {
          if (
            al(
              { lng: cE[e], lat: cC[e] },
              { lng: cE[(e + 1) % Y], lat: cC[(e + 1) % Y] },
              i8
            ) < 0
          ) {
            --T
          }
        }
      }
    }
    return T === 0 ? eX : he
  }
  function iQ(i8) {
    var jb = {}
    if (
      i8.lng < er[0] - 0.4 ||
      i8.lat < er[1] - 0.4 ||
      i8.lng > er[2] + 0.4 ||
      i8.lat > er[3] + 0.4
    ) {
      jb.lng = i8.lng
      jb.lat = i8.lat
      return jb
    } else {
      if (hm(i8, ea, d9, hD)) {
        jb = fE(i8)
        return jb
      }
    }
    var e = 0
    var je = dg
    var T = 0
    var jc = new gG()
    var jd = 1
    if (by(i8) === eX) {
      for (var ja = 0; ja < Y; ++ja) {
        var i9 = new d0(cE[ja], cC[ja], cE[(ja + 1) % Y], cC[(ja + 1) % Y])
        jc.ll.lng = i9.mbr.ll.lng - 0.5
        jc.ll.lat = i9.mbr.ll.lat - 0.5
        jc.ru.lng = i9.mbr.ru.lng + 0.5
        jc.ru.lat = i9.mbr.ru.lat + 0.5
        if (jc.contains(i8) === eX) {
          continue
        }
        T = fS(i8, i9)
        if (T < je) {
          je = T
        }
      }
      if (je < dg) {
        e = (dg - je) / dg
        jd = 2
      }
    } else {
      jd = 3
      e = 1
    }
    var jf = fE(i8)
    jb = {
      lng: i8.lng + (jf.lng - i8.lng) * e,
      lat: i8.lat + (jf.lat - i8.lat) * e,
    }
    return jb
  }
  function et(i) {
    var T = {}
    if (
      i.lng < s[0] - 0.4 ||
      i.lat < s[1] - 0.4 ||
      i.lng > s[2] + 0.4 ||
      i.lat > s[3] + 0.4
    ) {
      T.lng = i.lng
      T.lat = i.lat
      return T
    } else {
      if (hm(i, bR, bQ, hD)) {
        T = aQ(i)
        return T
      }
    }
    var e = iQ(i)
    if (i.lng === e.lng && i.lat === e.lng) {
      T.lng = i.lng
      T.lat = i.lat
      return T
    }
    return decryptPt1(i, iQ)
  }
  function hA(i, e) {
    if (e === 3 && i instanceof cd) {
      var T = iQ(i)
      return new cd(T.lng, T.lat)
    } else {
      return i
    }
  }
  function ec(i, e) {
    if (e === 3 && i instanceof cd) {
      var T = et(i)
      return new cd(T.lng, T.lat)
    } else {
      if (e === 5 && i instanceof cd) {
        return new cd(i.lng, i.lat)
      } else {
        return i
      }
    }
  }
  function l(ja) {
    var jb = JSON.stringify(ja)
    var i9 = 0,
      T,
      i8,
      e
    if (jb.length === 0) {
      return i9
    }
    for (T = 0, e = jb.length; T < e; T++) {
      i8 = jb.charCodeAt(T)
      i9 = (i9 << 5) - i9 + i8
      i9 |= 0
    }
    return i9
  }
  function cF() {
    var i = new Date().getTime()
    var e = 'xxxyxxxy'.replace(/[xy]/g, function (i8) {
      var T = (i + Math.random() * 16) % 16 | 0
      i = Math.floor(i / 16)
      return (i8 == 'x' ? T : (T & 3) | 8).toString(16)
    })
    return e
  }
  function gi() {}
  es.extend(gi, {
    Request: { INITIAL: -1, WAITING: 0, LOADED: 1, COMPLETED: 2 },
    Dependency: {
      poly: ['marker'],
      layer: ['poly'],
      hotspot: ['poly'],
      infowindow: ['marker', 'hotspot'],
      simpleInfowindow: ['marker'],
      tools: ['marker', 'poly'],
      mapgl: ['glcommon', 'poly'],
      earth: ['glcommon'],
      control: ['scommon'],
      scommon: [],
      localSearch: ['scommon'],
      otherSearch: ['scommon'],
      route: ['scommon'],
      buslineSearch: ['route'],
      autocomplete: ['scommon'],
    },
    MD5Mapping: {
      control: 'kwffal',
      marker: 'e02l2b',
      poly: 'lcsh2p',
      layer: '$layer$',
      infowindow: '31m5ti',
      simpleInfowindow: '0qldrr',
      hotspot: 'd0krkc',
      menu: 'struav',
      tools: 'najlxi',
      oppc: 'oqjocq',
      oppcgl: 'nwyyxt',
      mapgl: 'm40xmm',
      markeranimation: 'rvcm5k',
      earth: 'w1bbrx',
      glcommon: 'foemmp',
      localSearch: 'jovzjp',
      scommon: 'imxvlq',
      otherSearch: 'pxtwlz',
      route: 'pzqrmt',
      buslineSearch: 'zhbcyq',
      autocomplete: 'ms3swy',
    },
    Config: {
      baseUrl: w.apiHost + '/getmodules?v=1.0&type=webgl',
      jsModPath: (aA.inMapHost ? '' : w.mapHost) + '/res/newui/',
      timeout: 5000,
    },
    delayFlag: false,
    Module: { modules: {}, modulesNeedToLoad: [] },
    _getMd5ModsStr: function (ja) {
      var i9 = []
      for (var jc = 0, T = ja.length; jc < T; jc++) {
        var jb = ja[jc]
        var e = this.MD5Mapping[jb]
        var i8 = '$' + jb + '$'
        if (e !== i8) {
          i9.push(jb + '_' + e)
        }
      }
      return i9.join(',')
    },
    load: function (i, ja, i8) {
      var e = this.getModuleInfo(i)
      if (e.status === this.Request.COMPLETED) {
        if (i8 === true) {
          ja()
        }
      } else {
        if (e.status === this.Request.INITIAL) {
          this.combine(i)
          this.addToLoadQueue(i)
          var T = this
          if (T.delayFlag === false) {
            T.delayFlag = true
            setTimeout(function () {
              var jb =
                T.Config.baseUrl +
                '&mod=' +
                T._getMd5ModsStr(T.Module.modulesNeedToLoad)
              f5.load(jb)
              T.Module.modulesNeedToLoad.length = 0
              T.delayFlag = false
            }, 1)
          }
          e.status = this.Request.WAITING
          function i9(jd) {
            var jc = T.getModuleInfo(i)
            if (jc.status !== T.Request.COMPLETED) {
              if (window.map) {
                var jb = new e7('onmod_timeout')
                jb.timeout = jd / 1000
                jb.moduleName = i
                window.map.fire(jb)
              }
            }
          }
          setTimeout(i9, this.Config.timeout, this.Config.timeout)
          setTimeout(i9, this.Config.timeout * 2, this.Config.timeout * 2)
        }
        if (ja) {
          e.callbacks.push(ja)
        }
      }
    },
    combine: function (e) {
      if (e && this.Dependency[e]) {
        var i8 = this.Dependency[e]
        for (var T = 0; T < i8.length; T++) {
          this.combine(i8[T])
          if (!this.Module.modules[i8[T]]) {
            this.addToLoadQueue(i8[T])
          }
        }
      }
    },
    addToLoadQueue: function (e) {
      var i = this.getModuleInfo(e)
      if (i.status === this.Request.INITIAL) {
        i.status = this.Request.WAITING
        this.Module.modulesNeedToLoad.push(e)
      }
    },
    run: function (T, i8) {
      var jc = this.getModuleInfo(T)
      var jf = this.Dependency[T]
      if (jf) {
        for (var ja = 0; ja < jf.length; ja++) {
          var jb = this.getModuleInfo(jf[ja])
          if (jb.status !== this.Request.COMPLETED) {
            jb.modsNeedToRun.push({ name: T, code: i8 })
            return
          }
        }
      }
      try {
        eval(i8)
      } catch (jd) {
        return
      }
      jc.status = this.Request.COMPLETED
      for (var ja = 0, i9 = jc.callbacks.length; ja < i9; ja++) {
        jc.callbacks[ja]()
      }
      jc.callbacks.length = 0
      for (ja = 0; ja < jc.modsNeedToRun.length; ja++) {
        var je = jc.modsNeedToRun[ja]
        this.run(je.name, je.code)
      }
      jc.modsNeedToRun.length = 0
    },
    getModuleInfo: function (i) {
      var e
      if (!this.Module.modules[i]) {
        this.Module.modules[i] = {
          status: this.Request.INITIAL,
          callbacks: [],
          modsNeedToRun: [],
        }
      }
      e = this.Module.modules[i]
      return e
    },
  })
  window._jsload = function (i9, ja) {
    var i = gi.getModuleInfo(i9)
    i.status = gi.Request.LOADED
    if (ja !== '') {
      gi.run(i9, ja)
    } else {
      if (window.map) {
        var e = new e7('ongetmodules_fail')
        e.moduleName = i9
        window.map.fire(e)
      }
      var T = document.createElement('script')
      var i8 = gi.MD5Mapping[i9]
      T.src = gi.Config.jsModPath + i9 + '_' + i8 + '.js'
      document.getElementsByTagName('head')[0].appendChild(T)
    }
  }
  function cB() {
    this._timeData = {}
  }
  var bm
  if (typeof window !== 'undefined') {
    bm = window
  } else {
    bm = self
  }
  cB.prototype.mark = function (e) {
    this._timeData[e] = this._getTime()
  }
  cB.prototype.getMark = function (e) {
    return this._timeData[e]
  }
  cB.prototype.getTime = function (i, e) {
    return parseFloat((this._timeData[e] - this._timeData[i]).toFixed(2))
  }
  cB.prototype.print = function () {}
  cB.prototype.clear = function () {
    this._timeData = {}
  }
  if (bm.performance && bm.performance.now) {
    cB.prototype._getTime = function () {
      return performance.now()
    }
  } else {
    cB.prototype._getTime = function () {
      return Date.now()
    }
  }
  !(function (i, T) {
    T((i.d3 = i.d3 || {}))
  })(window, function (jL) {
    function j3(ka, kb, T, j9) {
      function e(i) {
        return ka((i = new Date(+i))), i
      }
      return (
        (e.floor = e),
        (e.ceil = function (i) {
          return ka((i = new Date(i - 1))), kb(i, 1), ka(i), i
        }),
        (e.round = function (i) {
          var kc = e(i),
            kd = e.ceil(i)
          return kd - i > i - kc ? kc : kd
        }),
        (e.offset = function (i, kc) {
          return kb((i = new Date(+i)), null == kc ? 1 : Math.floor(kc)), i
        }),
        (e.range = function (kd, i, kc) {
          var ke = []
          if (
            ((kd = e.ceil(kd)),
            (kc = null == kc ? 1 : Math.floor(kc)),
            !(i > kd && kc > 0))
          ) {
            return ke
          }
          do {
            ke.push(new Date(+kd))
          } while ((kb(kd, kc), ka(kd), i > kd))
          return ke
        }),
        (e.filter = function (i) {
          return j3(
            function (kc) {
              for (; ka(kc), !i(kc); ) {
                kc.setTime(kc - 1)
              }
            },
            function (kc, kd) {
              for (; --kd >= 0; ) {
                for (; kb(kc, 1), !i(kc); ) {}
              }
            }
          )
        }),
        T &&
          ((e.count = function (i, kc) {
            return (
              jN.setTime(+i),
              jR.setTime(+kc),
              ka(jN),
              ka(jR),
              Math.floor(T(jN, jR))
            )
          }),
          (e.every = function (i) {
            return (
              (i = Math.floor(i)),
              isFinite(i) && i > 0
                ? i > 1
                  ? e.filter(
                      j9
                        ? function (kc) {
                            return j9(kc) % i === 0
                          }
                        : function (kc) {
                            return e.count(0, kc) % i === 0
                          }
                    )
                  : e
                : null
            )
          })),
        e
      )
    }
    function jS(e) {
      return j3(
        function (i) {
          i.setDate(i.getDate() - ((i.getDay() + 7 - e) % 7)),
            i.setHours(0, 0, 0, 0)
        },
        function (i, T) {
          i.setDate(i.getDate() + 7 * T)
        },
        function (i, T) {
          return (
            (T - i - (T.getTimezoneOffset() - i.getTimezoneOffset()) * jM) / j0
          )
        }
      )
    }
    function jK(e) {
      return j3(
        function (i) {
          i.setUTCDate(i.getUTCDate() - ((i.getUTCDay() + 7 - e) % 7)),
            i.setUTCHours(0, 0, 0, 0)
        },
        function (i, T) {
          i.setUTCDate(i.getUTCDate() + 7 * T)
        },
        function (i, T) {
          return (T - i) / j0
        }
      )
    }
    var jN = new Date(),
      jR = new Date(),
      jY = j3(
        function () {},
        function (i, T) {
          i.setTime(+i + T)
        },
        function (i, T) {
          return T - i
        }
      )
    jY.every = function (e) {
      return (
        (e = Math.floor(e)),
        isFinite(e) && e > 0
          ? e > 1
            ? j3(
                function (i) {
                  i.setTime(Math.floor(i / e) * e)
                },
                function (i, T) {
                  i.setTime(+i + T * e)
                },
                function (i, T) {
                  return (T - i) / e
                }
              )
            : jY
          : null
      )
    }
    var j7 = jY.range,
      j5 = 1000,
      jM = 60000,
      j2 = 3600000,
      jU = 86400000,
      j0 = 604800000,
      je = j3(
        function (e) {
          e.setTime(Math.floor(e / j5) * j5)
        },
        function (i, T) {
          i.setTime(+i + T * j5)
        },
        function (i, T) {
          return (T - i) / j5
        },
        function (e) {
          return e.getUTCSeconds()
        }
      ),
      j4 = je.range,
      jT = j3(
        function (e) {
          e.setTime(Math.floor(e / jM) * jM)
        },
        function (i, T) {
          i.setTime(+i + T * jM)
        },
        function (i, T) {
          return (T - i) / jM
        },
        function (e) {
          return e.getMinutes()
        }
      ),
      jm = jT.range,
      jG = j3(
        function (i) {
          var T = (i.getTimezoneOffset() * jM) % j2
          0 > T && (T += j2), i.setTime(Math.floor((+i - T) / j2) * j2 + T)
        },
        function (i, T) {
          i.setTime(+i + T * j2)
        },
        function (i, T) {
          return (T - i) / j2
        },
        function (e) {
          return e.getHours()
        }
      ),
      jZ = jG.range,
      jw = j3(
        function (e) {
          e.setHours(0, 0, 0, 0)
        },
        function (i, T) {
          i.setDate(i.getDate() + T)
        },
        function (i, T) {
          return (
            (T - i - (T.getTimezoneOffset() - i.getTimezoneOffset()) * jM) / jU
          )
        },
        function (e) {
          return e.getDate() - 1
        }
      ),
      jd = jw.range,
      jt = jS(0),
      jv = jS(1),
      i9 = jS(2),
      jr = jS(3),
      jg = jS(4),
      jJ = jS(5),
      jQ = jS(6),
      jb = jt.range,
      jI = jv.range,
      jk = i9.range,
      jF = jr.range,
      jV = jg.range,
      jH = jJ.range,
      j6 = jQ.range,
      jX = j3(
        function (e) {
          e.setDate(1), e.setHours(0, 0, 0, 0)
        },
        function (i, T) {
          i.setMonth(i.getMonth() + T)
        },
        function (i, T) {
          return (
            T.getMonth() -
            i.getMonth() +
            12 * (T.getFullYear() - i.getFullYear())
          )
        },
        function (e) {
          return e.getMonth()
        }
      ),
      j8 = jX.range,
      jq = j3(
        function (e) {
          e.setMonth(0, 1), e.setHours(0, 0, 0, 0)
        },
        function (i, T) {
          i.setFullYear(i.getFullYear() + T)
        },
        function (i, T) {
          return T.getFullYear() - i.getFullYear()
        },
        function (e) {
          return e.getFullYear()
        }
      )
    jq.every = function (e) {
      return isFinite((e = Math.floor(e))) && e > 0
        ? j3(
            function (i) {
              i.setFullYear(Math.floor(i.getFullYear() / e) * e),
                i.setMonth(0, 1),
                i.setHours(0, 0, 0, 0)
            },
            function (i, T) {
              i.setFullYear(i.getFullYear() + T * e)
            }
          )
        : null
    }
    var jj = jq.range,
      jO = j3(
        function (e) {
          e.setUTCSeconds(0, 0)
        },
        function (i, T) {
          i.setTime(+i + T * jM)
        },
        function (i, T) {
          return (T - i) / jM
        },
        function (e) {
          return e.getUTCMinutes()
        }
      ),
      jy = jO.range,
      jx = j3(
        function (e) {
          e.setUTCMinutes(0, 0, 0)
        },
        function (i, T) {
          i.setTime(+i + T * j2)
        },
        function (i, T) {
          return (T - i) / j2
        },
        function (e) {
          return e.getUTCHours()
        }
      ),
      ju = jx.range,
      js = j3(
        function (e) {
          e.setUTCHours(0, 0, 0, 0)
        },
        function (i, T) {
          i.setUTCDate(i.getUTCDate() + T)
        },
        function (i, T) {
          return (T - i) / jU
        },
        function (e) {
          return e.getUTCDate() - 1
        }
      ),
      jp = js.range,
      jo = jK(0),
      jn = jK(1),
      jl = jK(2),
      ji = jK(3),
      jh = jK(4),
      jc = jK(5),
      ja = jK(6),
      i8 = jo.range,
      jE = jn.range,
      j1 = jl.range,
      jP = ji.range,
      jW = jh.range,
      jD = jc.range,
      jC = ja.range,
      jB = j3(
        function (e) {
          e.setUTCDate(1), e.setUTCHours(0, 0, 0, 0)
        },
        function (i, T) {
          i.setUTCMonth(i.getUTCMonth() + T)
        },
        function (i, T) {
          return (
            T.getUTCMonth() -
            i.getUTCMonth() +
            12 * (T.getUTCFullYear() - i.getUTCFullYear())
          )
        },
        function (e) {
          return e.getUTCMonth()
        }
      ),
      jA = jB.range,
      jf = j3(
        function (e) {
          e.setUTCMonth(0, 1), e.setUTCHours(0, 0, 0, 0)
        },
        function (i, T) {
          i.setUTCFullYear(i.getUTCFullYear() + T)
        },
        function (i, T) {
          return T.getUTCFullYear() - i.getUTCFullYear()
        },
        function (e) {
          return e.getUTCFullYear()
        }
      )
    jf.every = function (e) {
      return isFinite((e = Math.floor(e))) && e > 0
        ? j3(
            function (i) {
              i.setUTCFullYear(Math.floor(i.getUTCFullYear() / e) * e),
                i.setUTCMonth(0, 1),
                i.setUTCHours(0, 0, 0, 0)
            },
            function (i, T) {
              i.setUTCFullYear(i.getUTCFullYear() + T * e)
            }
          )
        : null
    }
    var jz = jf.range
    ;(jL.timeInterval = j3),
      (jL.timeMillisecond = jY),
      (jL.timeMilliseconds = j7),
      (jL.utcMillisecond = jY),
      (jL.utcMilliseconds = j7),
      (jL.timeSecond = je),
      (jL.timeSeconds = j4),
      (jL.utcSecond = je),
      (jL.utcSeconds = j4),
      (jL.timeMinute = jT),
      (jL.timeMinutes = jm),
      (jL.timeHour = jG),
      (jL.timeHours = jZ),
      (jL.timeDay = jw),
      (jL.timeDays = jd),
      (jL.timeWeek = jt),
      (jL.timeWeeks = jb),
      (jL.timeSunday = jt),
      (jL.timeSundays = jb),
      (jL.timeMonday = jv),
      (jL.timeMondays = jI),
      (jL.timeTuesday = i9),
      (jL.timeTuesdays = jk),
      (jL.timeWednesday = jr),
      (jL.timeWednesdays = jF),
      (jL.timeThursday = jg),
      (jL.timeThursdays = jV),
      (jL.timeFriday = jJ),
      (jL.timeFridays = jH),
      (jL.timeSaturday = jQ),
      (jL.timeSaturdays = j6),
      (jL.timeMonth = jX),
      (jL.timeMonths = j8),
      (jL.timeYear = jq),
      (jL.timeYears = jj),
      (jL.utcMinute = jO),
      (jL.utcMinutes = jy),
      (jL.utcHour = jx),
      (jL.utcHours = ju),
      (jL.utcDay = js),
      (jL.utcDays = jp),
      (jL.utcWeek = jo),
      (jL.utcWeeks = i8),
      (jL.utcSunday = jo),
      (jL.utcSundays = i8),
      (jL.utcMonday = jn),
      (jL.utcMondays = jE),
      (jL.utcTuesday = jl),
      (jL.utcTuesdays = j1),
      (jL.utcWednesday = ji),
      (jL.utcWednesdays = jP),
      (jL.utcThursday = jh),
      (jL.utcThursdays = jW),
      (jL.utcFriday = jc),
      (jL.utcFridays = jD),
      (jL.utcSaturday = ja),
      (jL.utcSaturdays = jC),
      (jL.utcMonth = jB),
      (jL.utcMonths = jA),
      (jL.utcYear = jf),
      (jL.utcYears = jz),
      Object.defineProperty(jL, '__esModule', { value: !0 })
  })
  function eC(e) {
    this._elemType = e
    this._objCollection = {}
  }
  eC.prototype.get = function () {
    var i = null
    for (var e in this._objCollection) {
      if (this._objCollection[e] && this._objCollection[e]._free === true) {
        this._objCollection[e]._free = false
        return this._objCollection[e]
      }
    }
    i = bK(this._elemType)
    e = bo.getGUID('obj_pool_')
    this._objCollection[e] = i
    return i
  }
  eC.prototype.free = function (e) {
    if (!e) {
      return
    }
    e._free = true
    if (e.tagName.toLowerCase() === 'img') {
      e.src = ''
      e.crossOrigin = null
      e.onload = e.onerror = null
    }
  }
  eC.prototype.clear = function () {
    for (var e in this._objCollection) {
      if (
        this._objCollection[e] &&
        this._objCollection[e].tagName.toLowerCase === 'img'
      ) {
        this._objCollection[e].onload = this._objCollection[e].onerror = null
      }
    }
    this._objCollection = {}
  }
  var hh = {
    get: function (i, i9, e, T) {
      var i8 = new XMLHttpRequest()
      i8.open('GET', i, true)
      i8.timeout = 10000
      i8.ontimeout = function () {
        T && T()
      }
      i8.onreadystatechange = function (ja) {
        if (this.readyState === 4) {
          if (this.status === 200) {
            i9 && i9(i8.responseText)
          } else {
            e && e()
          }
        }
      }
      i8.send()
    },
    post: function (i, ja, i9, e, T) {
      var i8 = new XMLHttpRequest()
      i8.open('POST', i, true)
      i8.setRequestHeader('Content-type', 'application/x-www-form-urlencoded')
      i8.timeout = 10000
      i8.ontimeout = function () {
        T && T()
      }
      i8.onreadystatechange = function (jb) {
        if (this.readyState === 4) {
          if (this.status === 200) {
            i9 && i9(i8.responseText, ja)
          } else {
            e && e()
          }
        }
      }
      i8.send(ja)
      return i8
    },
  }
  var f5 = (function (e) {
    function i(ja, T, i9) {
      var i8 = bK('script', {
        src: ja,
        type: 'text/javascript',
        charset: 'utf-8',
      })
      if (i8.addEventListener) {
        i8.addEventListener(
          'load',
          function (jc) {
            var jb = jc.target
            jb.parentNode.removeChild(jb)
            T && T()
          },
          false
        )
        i8.addEventListener(
          'error',
          function (jc) {
            if (jc) {
              var jb = jc.target
              jb && jb.parentNode && jb.parentNode.removeChild(jb)
            }
            i9 && i9(null)
          },
          false
        )
      } else {
        if (i8.attachEvent) {
          i8.attachEvent('onreadystatechange', function (jc) {
            var jb = window.event.srcElement
            if (
              jb &&
              (jb.readyState === 'loaded' || jb.readyState === 'complete')
            ) {
              jb.parentNode.removeChild(jb)
            }
            T && T()
          })
        }
      }
      e.getElementsByTagName('head')[0].appendChild(i8)
    }
    return {
      load: function (jb, T, i8) {
        if (typeof jb === 'string') {
          i(jb, T, i8)
        } else {
          if (jb.length > 0) {
            var ja = jb.length
            for (var i9 = 0; i9 < ja; i9++) {
              i(jb[i9], function () {
                ja--
                if (ja === 0 && T) {
                  T()
                }
              })
            }
          }
        }
      },
    }
  })(window.document)
  function hb() {}
  hb.instances = {}
  hb.getInstance = function (i, T) {
    if (hb.instances[i]) {
      return hb.instances[i]
    }
    var e = new i3(i, T)
    hb.instances[i] = e
    return e
  }
  function i3(e, i) {
    this._name = e
    this._baseZoom = 18
    this._opts = { tileSize: 256 }
    es.extend(this._opts, i || {})
  }
  i3.mapZoomBaseIndex = [
    8, 8, 8, 8, 7, 7, 6, 6, 5, 5, 4, 3, 3, 3, 2, 2, 1, 1, 0, 0, 0, 0, 0, 0, 0,
    0,
  ]
  i3.baseScaleZoom = [19, 17, 15, 12, 10, 9, 7, 5, 3]
  i3.baseScaleZoomMercatorSize = [
    512, 2048, 4096, 32768, 65536, 262144, 1048576, 4194304, 8388608,
  ]
  i3.mapZoomBaseZoomMapping = [
    3, 3, 3, 3, 5, 5, 7, 7, 9, 9, 10, 12, 12, 12, 15, 15, 17, 17, 19, 19, 19,
    19, 19, 19, 19, 19,
  ]
  i3.mapZoomStartZoomMapping = [
    3, 3, 3, 3, 4, 4, 6, 6, 8, 8, 10, 11, 11, 11, 14, 14, 16, 16, 18, 18, 18,
    18, 18, 18, 18, 18,
  ]
  i3.baseScaleTileSize = [1024, 1024, 512, 512, 256, 512, 512, 512, 256]
  i3.mapZoomTileSize = [
    256,
    256,
    256,
    256,
    256,
    512,
    256,
    512,
    256,
    512,
    256,
    256,
    512,
    1024,
    256,
    512,
    512,
    1024,
    512,
    1024,
    2048,
    4096,
    4096 * 2,
    4096 * 2 * 2,
    4096 * 2 * 2 * 2,
    4096 * 2 * 2 * 2 * 2,
  ]
  i3.baseZoomInfo = {
    3: [3],
    5: [4, 5],
    7: [6, 7],
    9: [8, 9],
    10: [10],
    12: [11, 12, 13],
    15: [14, 15],
    17: [16, 17],
    19: [18, 19, 20, 21, 22, 23, 24, 25],
  }
  i3.prototype = {
    getName: function () {
      return this._name
    },
    getTileSize: function (e) {
      e = Math.floor(e)
      if (e < 3) {
        e = 3
      }
      if (this._name === 'na') {
        return i3.mapZoomTileSize[e]
      }
      return this._opts.tileSize
    },
    getBaseTileSize: function (i) {
      i = Math.floor(i)
      if (this._name === 'na') {
        var e = i3.mapZoomBaseZoomMapping[i]
        return i3.mapZoomTileSize[e]
      }
      return this._opts.tileSize
    },
    getDataZoom: function (e) {
      e = Math.floor(e)
      if (this._name === 'na') {
        return i3.mapZoomBaseZoomMapping[e]
      }
      return e
    },
    getZoomUnits: function (e) {
      return Math.pow(2, this._baseZoom - e)
    },
    getMercatorSize: function (T, i) {
      if (this._name === 'na') {
        T = Math.floor(T)
        var e = i3.mapZoomBaseIndex[T]
        return i3.baseScaleZoomMercatorSize[e]
      }
      return this._opts.tileSize * this.getZoomUnits(i)
    },
    getBaseZoom: function () {
      return this._baseZoom
    },
    getParentTile: function (i8, je, jd, T, i) {
      if (this._name === 'na') {
        var i9 = i3.baseZoomInfo[jd]
        T--
        if (i9.indexOf(T) > -1) {
          return { col: i8, row: je, zoom: jd, useZoom: T }
        } else {
          var jb = i3.mapZoomBaseIndex[jd]
          var ja = i3.baseScaleZoom[jb + 1]
          if (!ja) {
            return null
          }
          var jc = this.getFactorByZooms(ja, jd)
          var e = i3.baseZoomInfo[ja]
          return {
            col: Math.floor(i8 / jc),
            row: Math.floor(je / jc),
            zoom: ja,
            useZoom: e[e.length - 1],
          }
        }
        return null
      }
      if (jd - 1 < i) {
        return null
      }
      return {
        col: Math.floor(i8 / 2),
        row: Math.floor(je / 2),
        zoom: jd - 1,
        useZoom: jd - 1,
      }
    },
    getChildTiles: function (i9, jb, e, T, ji, jo) {
      if (this._name === 'na') {
        var i8 = i3.baseZoomInfo[e]
        T += jo
        if (i8.indexOf(T) > -1) {
          return [{ col: i9, row: jb, zoom: e, useZoom: T }]
        } else {
          var jm = 0
          var jj = e
          while (jm < jo) {
            var jn = i3.mapZoomBaseIndex[jj]
            var jd = i3.baseScaleZoom[jn - 1]
            if (!jd) {
              return null
            }
            var je = i3.baseZoomInfo[jd]
            if (je[jo - 1]) {
              var jf = []
              var jh = this.getFactorByZooms(e, jd)
              var i = i9 * jh
              var jg = jb * jh
              for (var jl = 0; jl < jh; jl++) {
                var ja = i + jl
                for (var jk = 0; jk < jh; jk++) {
                  var jc = jg + jk
                  jf.push({ col: ja, row: jc, zoom: jd, useZoom: je[jo - 1] })
                }
              }
              return jf
            }
            jm += je.length
            if (jo === je.length) {
              jj = jd
            }
          }
        }
        return null
      }
      var jf = []
      if (e + jo > ji) {
        return null
      }
      var jh = Math.pow(2, jo)
      var i = i9 * jh
      var jg = jb * jh
      var jd = e + jo
      var jf = []
      for (var jl = 0; jl < 2; jl++) {
        var ja = i + jl
        for (var jk = 0; jk < 2; jk++) {
          var jc = jg + jk
          jf.push({ col: ja, row: jc, zoom: jd, useZoom: jd })
        }
      }
      return jf
    },
    getFactorByZooms: function (i, i8) {
      var T = i3.mapZoomBaseIndex[i]
      var i9 = i3.mapZoomBaseIndex[i8]
      var e = i3.baseScaleZoomMercatorSize[T]
      var ja = i3.baseScaleZoomMercatorSize[i9]
      return e / ja
    },
  }
  var cH = {}
  var V = ['swiftshader', 'microsoft basic render driver']
  var gB = ['intel', 'nvidia', 'amd', 'apple', 'geforce']
  function fW(e) {
    e = e.toLowerCase()
    if (V.indexOf(e) >= 0) {
      return true
    }
    if (e.indexOf('mobile') >= 0) {
      return true
    }
    return false
  }
  function ce(T) {
    T = T.toLowerCase()
    for (var e = 0; e < gB.length; e++) {
      if (T.indexOf(gB[e]) >= 0) {
        return true
      }
    }
    return false
  }
  function i2(e) {
    if (!e) {
      return false
    }
    if (fW(e)) {
      return false
    }
    if (ce(e)) {
      return true
    }
    return false
  }
  cH.ifEnableEarth = function (i) {
    var e = cH.ifEnableEarth
    if (!i && typeof e._enable === 'boolean') {
      return e._enable
    }
    if (cH.ifSupportWebGL()) {
      e._enable = true
      return true
    }
    e._enable = false
    return false
  }
  cH.ifEnableWebGLMap = function (i) {
    var e = cH.ifEnableWebGLMap
    if (!i && typeof e._enable === 'boolean') {
      return e._enable
    }
    if (cH.ifSupportWebGL()) {
      if (aA.inMapHost) {
        e._enable = true
        return true
      } else {
        if (
          window.Blob ||
          window.BlobBuilder ||
          window.WebKitBlobBuilder ||
          window.MozBlobBuilder
        ) {
          e._enable = true
          return true
        } else {
          e._enable = false
          return false
        }
      }
    }
    e._enable = false
    return false
  }
  cH.params = {}
  cH.ifSupportWebGL = function () {
    var i = cH.ifSupportWebGL
    if (typeof i._supportWebGL === 'boolean') {
      return i._supportWebGL
    }
    if (!window.WebGLRenderingContext) {
      i._supportWebGL = false
      return false
    }
    var T = document.createElement('canvas')
    T.width = 300
    T.height = 150
    var i9 = null
    var jf = {
      alpha: true,
      antialias: false,
      failIfMajorPerformanceCaveat: true,
      preserveDrawingBuffer: false,
      stencil: false,
    }
    try {
      i9 = T.getContext('webgl', jf) || T.getContext('experimental-webgl', jf)
    } catch (jb) {
      i._supportWebGL = false
    }
    if (i9 === null) {
      i._supportWebGL = false
    } else {
      i._supportWebGL = true
      var jd = i9.getExtension('WEBGL_debug_renderer_info')
      var jc = ''
      if (jd) {
        jc = i9.getParameter(jd.UNMASKED_RENDERER_WEBGL)
        if (i2(jc) === true) {
          i._supportWebGL = true
        }
        var je = i9.getParameter(jd.UNMASKED_VENDOR_WEBGL)
        i._renderer = jc
        i._vendor = je
      }
      if (!jd && es.Browser.firefox) {
        i._supportWebGL = true
      }
      if (!jd && es.Platform.macintosh) {
        i._supportWebGL = true
      }
      if (
        i9.drawingBufferWidth !== T.width ||
        i9.drawingBufferHeight !== T.height
      ) {
        i._supportWebGL = false
      }
      if (i9.getParameter(i9.MAX_VERTEX_TEXTURE_IMAGE_UNITS) < 4) {
        i._supportWebGL = false
      }
      var i8 = i9.getParameter(i9.MAX_TEXTURE_SIZE)
      cH.params.maxTextureSize = i8
      if (i8 < 4096) {
        i._supportWebGL = false
      }
      var ja = i9.getParameter(i9.MAX_TEXTURE_IMAGE_UNITS)
      if (ja < 8) {
        i._supportWebGL = false
      }
      if (
        !i9.getShaderPrecisionFormat ||
        i9.getShaderPrecisionFormat(i9.FRAGMENT_SHADER, i9.HIGH_FLOAT)
          .precision < 23
      ) {
        i._supportWebGL = false
      }
    }
    return i._supportWebGL
  }
  cH.ifSupportCanvas2d = function () {
    var i9 = cH.ifSupportCanvas2d
    if (typeof i9.supportCanvas2d === 'boolean') {
      return i9.supportCanvas2d
    }
    var T = document.createElement('canvas')
    var i = null
    try {
      i = T.getContext('2d')
    } catch (i8) {
      i9.supportCanvas2d = false
    }
    if (i === null) {
      i9.supportCanvas2d = false
    } else {
      i9.supportCanvas2d = true
    }
    return i9.supportCanvas2d
  }
  cH.ifCanvas2dInBlackList = function () {
    return true
  }
  cH.ifEnableCanvas2dMap = function () {
    return false
    var i = navigator.userAgent
    var e = 0
    var i8 = 0
    var i9 = 0
    if (/macintosh/gi.test(i)) {
      var T = 0
      if (
        /(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(i) &&
        !/chrome/i.test(i)
      ) {
        T = parseInt(RegExp['\x241'] || RegExp['\x242'], 10)
      }
      if (T > 0) {
        return false
      }
      return true
    }
    if (/windows nt (\d+\.\d)/gi.test(i)) {
      i8 = parseFloat(RegExp.$1)
      if (i8 >= 6.1) {
        if (/chrome\/(\d+\.\d)/i.test(i)) {
          e = parseFloat(RegExp.$1)
          if (e >= 31) {
            return true
          }
        }
        if (/MSIE (\d+(\.\d+)?)/.test(i)) {
          i9 = parseFloat(RegExp.$1)
          if (i9 >= 10) {
            return true
          }
        }
        if (/Firefox/.test(i)) {
          return true
        }
        if (/rv:11.0/gi.test(i)) {
          return true
        }
        if (/edge/gi.test(i)) {
          return true
        }
      }
    }
    return false
  }
  cH.ifSupportCSS3 = function (jc, i) {
    var jb = document.createElement('div')
    var ja = 'Webkit Moz O ms'.split(' ')
    var e = ja.length
    var T = ''
    var i8 = jb.style
    if (jc in i8) {
      T = jc
    }
    jc = jc.replace(/^[a-z]/, function (jd) {
      return jd.toUpperCase()
    })
    while (e--) {
      var i9 = ja[e] + jc
      if (i9 in i8) {
        T = i9
        break
      }
    }
    if (i) {
      return T
    } else {
      return T.length > 0 ? true : false
    }
  }
  cH.isModernBrowser = cH.ifSupportCanvas2d() && cH.ifSupportCSS3('transform')
  function at(i, e) {
    this._size = i
    this._curSize = 0
    this._cache = {}
    this._least = null
    this._most = null
    this._options = { clearCallback: null, removeOldCallback: null }
    e = e || {}
    for (var T in e) {
      this._options[T] = e[T]
    }
    this._getDataTimes = 0
    this._hitTimes = 0
  }
  at.prototype.setData = function (i8, ja) {
    var i = this._cache
    var T = this._size
    if (T === 0) {
      return
    }
    var e = this._curSize
    if (e === T) {
      this._removeOld()
    }
    var i9
    if (!i[i8]) {
      i9 = { key: i8, data: ja, older: null, newwer: null }
      i[i8] = i9
      if (this._least === null) {
        this._least = i9
      }
      if (this._most === null) {
        this._most = i9
      }
      this._curSize++
    } else {
      i9 = i[i8]
      i9.data = ja
      if (this._most === i9) {
        return
      }
      i9.older && (i9.older.newer = i9.newer)
      i9.newer && (i9.newer.older = i9.older)
      if (this._least === i9) {
        this._least = i9.newer
      }
    }
    if (this._most && this._most !== i9) {
      this._most.newer = i9
      i9.older = this._most
      this._most = i9
      i9.newer = null
    }
  }
  at.prototype.getData = function (e) {
    var i = this._cache[e]
    this._getDataTimes++
    if (i) {
      this._hitTimes++
      var T = i.data
      if (this._most === i) {
        return T
      }
      i.older && (i.older.newer = i.newer)
      i.newer && (i.newer.older = i.older)
      if (this._least === i) {
        this._least = i.newer
      }
      this._most.newer = i
      i.older = this._most
      i.newer = null
      this._most = i
      return T
    }
    return null
  }
  at.prototype.getAllData = function () {
    return this._cache
  }
  at.prototype.getHitRate = function () {
    return this._hitTimes / this._getDataTimes
  }
  at.prototype.removeData = function (i) {
    var e = this._cache
    var T = e[i]
    if (!T) {
      return
    }
    if (this._options.clearCallback) {
      this._options.clearCallback(T.data, T.key)
    }
    T.older && (T.older.newer = T.newer)
    T.newer && (T.newer.older = T.older)
    if (this._least === T) {
      this._least = T.newer
    }
    if (this._most === T) {
      this._most = T.older
    }
    delete e[i]
    this._curSize--
  }
  at.prototype._removeOld = function () {
    var e = this._cache
    var i8 = Math.round(this._size * 0.6)
    var T = 0
    while (this._least && T < i8) {
      var i = this._least
      this._least = i.newer
      i.newer && (i.newer.older = null)
      if (this._options.clearCallback) {
        this._options.clearCallback(i.data, i.key)
      }
      delete e[i.key]
      T++
    }
    this._curSize -= T
    if (this._options.removeOldCallback) {
      this._options.removeOldCallback()
    }
  }
  at.prototype.clear = function () {
    var e = this._cache
    var i = this._least
    if (this._options.clearCallback) {
      while (i) {
        this._options.clearCallback(i.data, i.key)
        i = i.newer
      }
    }
    this._least = this._most = null
    this._cache = {}
    this._curSize = 0
  }
  at.prototype.forEach = function (e) {
    var i = this._least
    while (i) {
      e(i.data)
      i = i.newer
    }
  }
  at.prototype.clearExcept = function (i) {
    var e = this._cache
    var T = this._least
    while (T) {
      if (!i[T.key]) {
        if (this._options.clearCallback) {
          this._options.clearCallback(T.data, T.key)
        }
        T.older && (T.older.newer = T.newer)
        T.newer && (T.newer.older = T.older)
        if (this._least === T) {
          this._least = T.newer
        }
        if (this._most === T) {
          this._most = T.older
        }
        delete e[T.key]
        this._curSize--
      }
      T = T.newer
    }
  }
  !(function (T, i) {
    'object' == typeof bo && 'undefined' != typeof module
      ? (module.exports = i())
      : 'function' == typeof define && define.amd
      ? define(i)
      : ((T =
          'undefined' != typeof globalThis ? globalThis : T || self).gcoord =
          i())
  })(this, function () {
    /* *****************************************************************************
        Copyright (c) Microsoft Corporation.

        Permission to use, copy, modify, and/or distribute this software for any
        purpose with or without fee is hereby granted.

        THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
        REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
        AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
        INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
        LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
        OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
        PERFORMANCE OF THIS SOFTWARE.
        ***************************************************************************** */
    var jM = function () {
        return (jM =
          Object.assign ||
          function (jR) {
            for (var i, T = 1, jT = arguments.length; T < jT; T++) {
              for (var jS in (i = arguments[T])) {
                Object.prototype.hasOwnProperty.call(i, jS) && (jR[jS] = i[jS])
              }
            }
            return jR
          }).apply(this, arguments)
      },
      jx = Math.sin,
      jz = Math.cos,
      jD = Math.sqrt,
      jC = Math.abs,
      jQ = Math.PI,
      jI = 6378245,
      jw = 0.006693421622965823
    function jL(T, i) {
      return T >= 72.004 && T <= 137.8347 && i >= 0.8293 && i <= 55.8271
    }
    function jO(jT, jS) {
      var jW,
        i,
        jY,
        T =
          ((jY =
            300 +
            (jW = jT - 105) +
            2 * (i = jS - 35) +
            0.1 * jW * jW +
            0.1 * jW * i +
            0.1 * jD(jC(jW))),
          (jY += (2 * (20 * jx(6 * jW * jQ) + 20 * jx(2 * jW * jQ))) / 3),
          (jY += (2 * (20 * jx(jW * jQ) + 40 * jx((jW / 3) * jQ))) / 3) +
            (2 * (150 * jx((jW / 12) * jQ) + 300 * jx((jW / 30) * jQ))) / 3),
        jR = (function (j1, j0) {
          var jZ =
            2 * j1 -
            100 +
            3 * j0 +
            0.2 * j0 * j0 +
            0.1 * j1 * j0 +
            0.2 * jD(jC(j1))
          return (
            (jZ += (2 * (20 * jx(6 * j1 * jQ) + 20 * jx(2 * j1 * jQ))) / 3),
            (jZ += (2 * (20 * jx(j0 * jQ) + 40 * jx((j0 / 3) * jQ))) / 3),
            jZ + (2 * (160 * jx((j0 / 12) * jQ) + 320 * jx((j0 * jQ) / 30))) / 3
          )
        })(jT - 105, jS - 35),
        jV = (jS / 180) * jQ,
        jU = jx(jV),
        jX = jD((jU = 1 - jw * jU * jU))
      return [
        (T = (180 * T) / ((jI / jX) * jz(jV) * jQ)),
        (jR = (180 * jR) / (((jI * (1 - jw)) / (jU * jX)) * jQ)),
      ]
    }
    function jF(jR) {
      var i = jR[0],
        T = jR[1]
      if (!jL(i, T)) {
        return [i, T]
      }
      var jS = jO(i, T)
      return [i + jS[0], T + jS[1]]
    }
    function jy(jT) {
      var jX = jT[0],
        T = jT[1]
      if (!jL(jX, T)) {
        return [jX, T]
      }
      for (
        var jR = [jX, T],
          jV = jR[0],
          jS = jR[1],
          jW = jF([jV, jS]),
          jU = jW[0] - jX,
          jY = jW[1] - T;
        jC(jU) > 0.000001 || jC(jY) > 0.000001;

      ) {
        ;(jU = (jW = jF([(jV -= jU), (jS -= jY)]))[0] - jX), (jY = jW[1] - T)
      }
      return [jV, jS]
    }
    var jJ = Math.sin,
      jK = Math.cos,
      jg = Math.atan2,
      jN = Math.sqrt,
      jv = (3000 * Math.PI) / 180
    function jB(jR) {
      var i = jR[0] - 0.0065,
        T = jR[1] - 0.006,
        jT = jN(i * i + T * T) - 0.00002 * jJ(T * jv),
        jS = jg(T, i) - 0.000003 * jK(i * jv)
      return [jT * jK(jS), jT * jJ(jS)]
    }
    function jk(jR) {
      var i = jR[0],
        T = jR[1],
        jT = jN(i * i + T * T) + 0.00002 * jJ(T * jv),
        jS = jg(T, i) + 0.000003 * jK(i * jv)
      return [jT * jK(jS) + 0.0065, jT * jJ(jS) + 0.006]
    }
    var js = 180 / Math.PI,
      jb = Math.PI / 180,
      jd = 6378137,
      jP = 20037508.342789244
    function jp(i) {
      return [
        (i[0] * js) / jd,
        (0.5 * Math.PI - 2 * Math.atan(Math.exp(-i[1] / jd))) * js,
      ]
    }
    function jE(jR) {
      var i =
          Math.abs(jR[0]) <= 180 ? jR[0] : jR[0] - 360 * (jR[0] < 0 ? -1 : 1),
        T = [
          jd * i * jb,
          jd * Math.log(Math.tan(0.25 * Math.PI + 0.5 * jR[1] * jb)),
        ]
      return (
        T[0] > jP && (T[0] = jP),
        T[0] < -jP && (T[0] = -jP),
        T[1] > jP && (T[1] = jP),
        T[1] < -jP && (T[1] = -jP),
        T
      )
    }
    var jo,
      jn,
      jm,
      ju,
      jj,
      i8,
      jt = Math.abs,
      jG = [12890594.86, 8362377.87, 5591021, 3481989.83, 1678043.12, 0],
      ji = [75, 60, 45, 30, 15, 0],
      ja = [
        [
          1.410526172116255e-8, 0.00000898305509648872, -1.9939833816331,
          200.9824383106796, -187.2403703815547, 91.6087516669843,
          -23.38765649603339, 2.57121317296198, -0.03801003308653, 17337981.2,
        ],
        [
          -7.435856389565537e-9, 0.000008983055097726239, -0.78625201886289,
          96.32687599759846, -1.85204757529826, -59.36935905485877,
          47.40033549296737, -16.50741931063887, 2.28786674699375, 10260144.86,
        ],
        [
          -3.030883460898826e-8, 0.00000898305509983578, 0.30071316287616,
          59.74293618442277, 7.357984074871, -25.38371002664745,
          13.45380521110908, -3.29883767235584, 0.32710905363475, 6856817.37,
        ],
        [
          -1.981981304930552e-8, 0.000008983055099779535, 0.03278182852591,
          40.31678527705744, 0.65659298677277, -4.44255534477492,
          0.85341911805263, 0.12923347998204, -0.04625736007561, 4482777.06,
        ],
        [
          3.09191371068437e-9, 0.000008983055096812155, 0.00006995724062,
          23.10934304144901, -0.00023663490511, -0.6321817810242,
          -0.00663494467273, 0.03430082397953, -0.00466043876332, 2555164.4,
        ],
        [
          2.890871144776878e-9, 0.000008983055095805407, -3.068298e-8,
          7.47137025468032, -0.00000353937994, -0.02145144861037,
          -0.00001234426596, 0.00010322952773, -0.00000323890364, 826088.5,
        ],
      ],
      jH = [
        [
          -0.0015702102444, 111320.7020616939, 1704480524535203,
          -10338987376042340, 26112667856603880, -35149669176653700,
          26595700718403920, -10725012454188240, 1800819912950474, 82.5,
        ],
        [
          0.0008277824516172526, 111320.7020463578, 647795574.6671607,
          -4082003173.641316, 10774905663.51142, -15171875531.51559,
          12053065338.62167, -5124939663.577472, 913311935.9512032, 67.5,
        ],
        [
          0.00337398766765, 111320.7020202162, 4481351.045890365,
          -23393751.19931662, 79682215.47186455, -115964993.2797253,
          97236711.15602145, -43661946.33752821, 8477230.501135234, 52.5,
        ],
        [
          0.00220636496208, 111320.7020209128, 51751.86112841131,
          3796837.749470245, 992013.7397791013, -1221952.21711287,
          1340652.697009075, -620943.6990984312, 144416.9293806241, 37.5,
        ],
        [
          -0.0003441963504368392, 111320.7020576856, 278.2353980772752,
          2485758.690035394, 6070.750963243378, 54821.18345352118,
          9540.606633304236, -2710.55326746645, 1405.483844121726, 22.5,
        ],
        [
          -0.0003218135878613132, 111320.7020701615, 0.00369383431289,
          823725.6402795718, 0.46104986909093, 2351.343141331292,
          1.58060784298199, 8.77738589078284, 0.37238884252424, 7.45,
        ],
      ]
    function jh(jS, T, jR) {
      var jU = jt(T) / jR[9],
        jT = jR[0] + jR[1] * jt(jS),
        i =
          jR[2] +
          jR[3] * jU +
          jR[4] * Math.pow(jU, 2) +
          jR[5] * Math.pow(jU, 3) +
          jR[6] * Math.pow(jU, 4) +
          jR[7] * Math.pow(jU, 5) +
          jR[8] * Math.pow(jU, 6)
      return [(jT *= jS < 0 ? -1 : 1), (i *= T < 0 ? -1 : 1)]
    }
    function jA(jR) {
      for (var i = jR[0], T = jR[1], jT = [], jS = 0; jS < ji.length; jS++) {
        if (jt(T) > ji[jS]) {
          jT = jH[jS]
          break
        }
      }
      return jh(i, T, jT)
    }
    function jf(jR) {
      for (var i = jR[0], T = jR[1], jT = [], jS = 0; jS < jG.length; jS++) {
        if (T >= jG[jS]) {
          jT = ja[jS]
          break
        }
      }
      return jh(i, T, jT)
    }
    function je(T, i) {
      if (!T) {
        throw new Error(i)
      }
    }
    function jq(i) {
      return !!i && '[object Array]' === Object.prototype.toString.call(i)
    }
    function jl(i) {
      return !isNaN(Number(i)) && null !== i && !jq(i)
    }
    function jc() {
      for (var jR = [], i = 0; i < arguments.length; i++) {
        jR[i] = arguments[i]
      }
      var T = jR.length - 1
      return function () {
        for (var jS = [], jU = 0; jU < arguments.length; jU++) {
          jS[jU] = arguments[jU]
        }
        for (var jT = T, e = jR[T].apply(null, jS); jT--; ) {
          e = jR[jT].call(null, e)
        }
        return e
      }
    }
    function i9(j8, jX, jZ) {
      if ((void 0 === jZ && (jZ = !1), null !== j8)) {
        for (
          var j2,
            j1,
            kb,
            j4,
            jW,
            j7,
            ka,
            j3,
            jY = 0,
            j5 = 0,
            j6 = j8.type,
            jS = 'FeatureCollection' === j6,
            j9 = 'Feature' === j6,
            jV = jS ? j8.features.length : 1,
            j0 = 0;
          j0 < jV;
          j0++
        ) {
          jW = (j3 =
            !!(ka = jS ? j8.features[j0].geometry : j9 ? j8.geometry : j8) &&
            'GeometryCollection' === ka.type)
            ? ka.geometries.length
            : 1
          for (var jU = 0; jU < jW; jU++) {
            var jT = 0,
              T = 0
            if (null !== (j4 = j3 ? ka.geometries[jU] : ka)) {
              var jR = j4.type
              switch (
                ((jY =
                  !jZ || ('Polygon' !== jR && 'MultiPolygon' !== jR) ? 0 : 1),
                jR)
              ) {
                case null:
                  break
                case 'Point':
                  if (!1 === jX((j7 = j4.coordinates), j5, j0, jT, T)) {
                    return !1
                  }
                  j5++, jT++
                  break
                case 'LineString':
                case 'MultiPoint':
                  for (j7 = j4.coordinates, j2 = 0; j2 < j7.length; j2++) {
                    if (!1 === jX(j7[j2], j5, j0, jT, T)) {
                      return !1
                    }
                    j5++, 'MultiPoint' === jR && jT++
                  }
                  'LineString' === jR && jT++
                  break
                case 'Polygon':
                case 'MultiLineString':
                  for (j7 = j4.coordinates, j2 = 0; j2 < j7.length; j2++) {
                    for (j1 = 0; j1 < j7[j2].length - jY; j1++) {
                      if (!1 === jX(j7[j2][j1], j5, j0, jT, T)) {
                        return !1
                      }
                      j5++
                    }
                    'MultiLineString' === jR && jT++, 'Polygon' === jR && T++
                  }
                  'Polygon' === jR && jT++
                  break
                case 'MultiPolygon':
                  for (j7 = j4.coordinates, j2 = 0; j2 < j7.length; j2++) {
                    for (T = 0, j1 = 0; j1 < j7[j2].length; j1++) {
                      for (kb = 0; kb < j7[j2][j1].length - jY; kb++) {
                        if (!1 === jX(j7[j2][j1][kb], j5, j0, jT, T)) {
                          return !1
                        }
                        j5++
                      }
                      T++
                    }
                    jT++
                  }
                  break
                case 'GeometryCollection':
                  for (j2 = 0; j2 < j4.geometries.length; j2++) {
                    if (!1 === i9(j4.geometries[j2], jX, jZ)) {
                      return !1
                    }
                  }
                  break
                default:
                  throw new Error('Unknown Geometry Type')
              }
            }
          }
        }
      }
    }
    !(function (i) {
      ;(i.WGS84 = 'WGS84'),
        (i.WGS1984 = 'WGS84'),
        (i.EPSG4326 = 'WGS84'),
        (i.GCJ02 = 'GCJ02'),
        (i.AMap = 'GCJ02'),
        (i.BD09 = 'BD09'),
        (i.BD09LL = 'BD09'),
        (i.Baidu = 'BD09'),
        (i.BMap = 'BD09'),
        (i.BD09MC = 'BD09MC'),
        (i.BD09Meter = 'BD09MC'),
        (i.EPSG3857 = 'EPSG3857'),
        (i.EPSG900913 = 'EPSG3857'),
        (i.EPSG102100 = 'EPSG3857'),
        (i.WebMercator = 'EPSG3857'),
        (i.WM = 'EPSG3857')
    })(i8 || (i8 = {}))
    var jr = {
      WGS84: {
        to:
          ((jo = {}),
          (jo[i8.GCJ02] = jF),
          (jo[i8.BD09] = jc(jk, jF)),
          (jo[i8.BD09MC] = jc(jA, jk, jF)),
          (jo[i8.EPSG3857] = jE),
          jo),
      },
      GCJ02: {
        to:
          ((jn = {}),
          (jn[i8.WGS84] = jy),
          (jn[i8.BD09] = jk),
          (jn[i8.BD09MC] = jc(jA, jk)),
          (jn[i8.EPSG3857] = jc(jE, jy)),
          jn),
      },
      BD09: {
        to:
          ((jm = {}),
          (jm[i8.WGS84] = jc(jy, jB)),
          (jm[i8.GCJ02] = jB),
          (jm[i8.EPSG3857] = jc(jE, jy, jB)),
          (jm[i8.BD09MC] = jA),
          jm),
      },
      EPSG3857: {
        to:
          ((ju = {}),
          (ju[i8.WGS84] = jp),
          (ju[i8.GCJ02] = jc(jF, jp)),
          (ju[i8.BD09] = jc(jk, jF, jp)),
          (ju[i8.BD09MC] = jc(jA, jk, jF, jp)),
          ju),
      },
      BD09MC: {
        to:
          ((jj = {}),
          (jj[i8.WGS84] = jc(jy, jB, jf)),
          (jj[i8.GCJ02] = jc(jB, jf)),
          (jj[i8.EPSG3857] = jc(jE, jy, jB, jf)),
          (jj[i8.BD09] = jf),
          jj),
      },
    }
    return jM(jM({}, i8), {
      CRSTypes: i8,
      transform: function (jV, jT, jU) {
        if (
          (je(!!jV, 'The args[0] input coordinate is required'),
          je(!!jT, 'The args[1] original coordinate system is required'),
          je(!!jU, 'The args[2] target coordinate system is required'),
          jT === jU)
        ) {
          return jV
        }
        var jX = jr[jT]
        je(!!jX, 'Invalid original coordinate system: ' + jT)
        var jW = jX.to[jU]
        je(!!jW, 'Invalid target coordinate system: ' + jU)
        var T = typeof jV
        if (
          (je(
            'string' === T || 'object' === T,
            'Invalid input coordinate type: ' + T
          ),
          'string' === T)
        ) {
          try {
            jV = JSON.parse(jV)
          } catch (jT) {
            throw new Error('Invalid input coordinate: ' + jV)
          }
        }
        var jS = !1
        jq(jV) &&
          (je(jV.length >= 2, 'Invalid input coordinate: ' + jV),
          je(jl(jV[0]) && jl(jV[1]), 'Invalid input coordinate: ' + jV),
          (jV = jV.map(Number)),
          (jS = !0))
        var jR = jW
        return jS
          ? jR(jV)
          : (i9(jV, function (jY) {
              var i
              ;(i = jR(jY)), (jY[0] = i[0]), (jY[1] = i[1])
            }),
            jV)
      },
    })
  })
  var gM = {
    ColorRefTable: {
      aliceblue: ['#f0f8ff', 'rgb(240,248,255)'],
      antiquewhite: ['#faebd7', 'rgb(250,235,215)'],
      aqua: ['#00ffff', 'rgb(0,255,255)'],
      aquamarine: ['#7fffd4', 'rgb(127,255,212)'],
      azure: ['#f0ffff', 'rgb(240,255,255)'],
      beige: ['#f5f5dc', 'rgb(245,245,220)'],
      bisque: ['#ffe4c4', 'rgb(255,228,196)'],
      black: ['#000000', 'rgb(0,0,0)'],
      blanchedalmond: ['#ffebcd', 'rgb(255,235,205)'],
      blue: ['#0000ff', 'rgb(0,0,255)'],
      blueviolet: ['#8a2be2', 'rgb(138,43,226)'],
      brown: ['#a52a2a', 'rgb(165,42,42)'],
      burlywood: ['#deb887', 'rgb(222,184,135)'],
      cadetblue: ['#5f9ea0', 'rgb(95,158,160)'],
      chartreuse: ['#7fff00', 'rgb(127,255,0)'],
      chocolate: ['#d2691e', 'rgb(210,105,30)'],
      coral: ['#ff7f50', 'rgb(255,127,80)'],
      cornflowerblue: ['#6495ed', 'rgb(100,149,237)'],
      cornsilk: ['#fff8dc', 'rgb(255,248,220)'],
      crimson: ['#dc143c', 'rgb(220,20,60)'],
      cyan: ['#00ffff', 'rgb(0,255,255)'],
      darkblue: ['#00008b', 'rgb(0,0,139)'],
      darkcyan: ['#008b8b', 'rgb(0,139,139)'],
      darkgoldenrod: ['#b8860b', 'rgb(184,134,11)'],
      darkgray: ['#a9a9a9', 'rgb(169,169,169)'],
      darkgreen: ['#006400', 'rgb(0,100,0)'],
      darkgrey: ['#a9a9a9', 'rgb(169,169,169)'],
      darkkhaki: ['#bdb76b', 'rgb(189,183,107)'],
      darkmagenta: ['#8b008b', 'rgb(139,0,139)'],
      darkolivegreen: ['#556b2f', 'rgb(85,107,47)'],
      darkorange: ['#ff8c00', 'rgb(255,140,0)'],
      darkorchid: ['#9932cc', 'rgb(153,50,204)'],
      darkred: ['#8b0000', 'rgb(139,0,0)'],
      darksalmon: ['#e9967a', 'rgb(233,150,122)'],
      darkseagreen: ['#8fbc8f', 'rgb(143,188,143)'],
      darkslateblue: ['#483d8b', 'rgb(72,61,139)'],
      darkslategray: ['#2f4f4f', 'rgb(47,79,79)'],
      darkslategrey: ['#2f4f4f', 'rgb(47,79,79)'],
      darkturquoise: ['#00ced1', 'rgb(0,206,209)'],
      darkviolet: ['#9400d3', 'rgb(148,0,211)'],
      deeppink: ['#ff1493', 'rgb(255,20,147)'],
      deepskyblue: ['#00bfff', 'rgb(0,191,255)'],
      dimgray: ['#696969', 'rgb(105,105,105)'],
      dimgrey: ['#696969', 'rgb(105,105,105)'],
      dodgerblue: ['#1e90ff', 'rgb(30,144,255)'],
      firebrick: ['#b22222', 'rgb(178,34,34)'],
      floralwhite: ['#fffaf0', 'rgb(255,250,240)'],
      forestgreen: ['#228b22', 'rgb(34,139,34)'],
      fuchsia: ['#ff00ff', 'rgb(255,0,255)'],
      gainsboro: ['#dcdcdc', 'rgb(220,220,220)'],
      ghostwhite: ['#f8f8ff', 'rgb(248,248,255)'],
      gold: ['#ffd700', 'rgb(255,215,0)'],
      goldenrod: ['#daa520', 'rgb(218,165,32)'],
      gray: ['#808080', 'rgb(128,128,128)'],
      green: ['#008000', 'rgb(0,128,0)'],
      greenyellow: ['#adff2f', 'rgb(173,255,47)'],
      grey: ['#808080', 'rgb(128,128,128)'],
      honeydew: ['#f0fff0', 'rgb(240,255,240)'],
      hotpink: ['#ff69b4', 'rgb(255,105,180)'],
      indianred: ['#cd5c5c', 'rgb(205,92,92)'],
      indigo: ['#4b0082', 'rgb(75,0,130)'],
      ivory: ['#fffff0', 'rgb(255,255,240)'],
      khaki: ['#f0e68c', 'rgb(240,230,140)'],
      lavender: ['#e6e6fa', 'rgb(230,230,250)'],
      lavenderblush: ['#fff0f5', 'rgb(255,240,245)'],
      lawngreen: ['#7cfc00', 'rgb(124,252,0)'],
      lemonchiffon: ['#fffacd', 'rgb(255,250,205)'],
      lightblue: ['#add8e6', 'rgb(173,216,230)'],
      lightcoral: ['#f08080', 'rgb(240,128,128)'],
      lightcyan: ['#e0ffff', 'rgb(224,255,255)'],
      lightgoldenrodyellow: ['#fafad2', 'rgb(250,250,210)'],
      lightgray: ['#d3d3d3', 'rgb(211,211,211)'],
      lightgreen: ['#90ee90', 'rgb(144,238,144)'],
      lightgrey: ['#d3d3d3', 'rgb(211,211,211)'],
      lightpink: ['#ffb6c1', 'rgb(255,182,193)'],
      lightsalmon: ['#ffa07a', 'rgb(255,160,122)'],
      lightseagreen: ['#20b2aa', 'rgb(32,178,170)'],
      lightskyblue: ['#87cefa', 'rgb(135,206,250)'],
      lightslategray: ['#778899', 'rgb(119,136,153)'],
      lightslategrey: ['#778899', 'rgb(119,136,153)'],
      lightsteelblue: ['#b0c4de', 'rgb(176,196,222)'],
      lightyellow: ['#ffffe0', 'rgb(255,255,224)'],
      lime: ['#00ff00', 'rgb(0,255,0)'],
      limegreen: ['#32cd32', 'rgb(50,205,50)'],
      linen: ['#faf0e6', 'rgb(250,240,230)'],
      magenta: ['#ff00ff', 'rgb(255,0,255)'],
      maroon: ['#800000', 'rgb(128,0,0)'],
      mediumaquamarine: ['#66cdaa', 'rgb(102,205,170)'],
      mediumblue: ['#0000cd', 'rgb(0,0,205)'],
      mediumorchid: ['#ba55d3', 'rgb(186,85,211)'],
      mediumpurple: ['#9370db', 'rgb(147,112,219)'],
      mediumseagreen: ['#3cb371', 'rgb(60,179,113)'],
      mediumslateblue: ['#7b68ee', 'rgb(123,104,238)'],
      mediumspringgreen: ['#00fa9a', 'rgb(0,250,154)'],
      mediumturquoise: ['#48d1cc', 'rgb(72,209,204)'],
      mediumvioletred: ['#c71585', 'rgb(199,21,133)'],
      midnightblue: ['#191970', 'rgb(25,25,112)'],
      mintcream: ['#f5fffa', 'rgb(245,255,250)'],
      mistyrose: ['#ffe4e1', 'rgb(255,228,225)'],
      moccasin: ['#ffe4b5', 'rgb(255,228,181)'],
      navajowhite: ['#ffdead', 'rgb(255,222,173)'],
      navy: ['#000080', 'rgb(0,0,128)'],
      oldlace: ['#fdf5e6', 'rgb(253,245,230)'],
      olive: ['#808000', 'rgb(128,128,0)'],
      olivedrab: ['#6b8e23', 'rgb(107,142,35)'],
      orange: ['#ffa500', 'rgb(255,165,0)'],
      orangered: ['#ff4500', 'rgb(255,69,0)'],
      orchid: ['#da70d6', 'rgb(218,112,214)'],
      palegoldenrod: ['#eee8aa', 'rgb(238,232,170)'],
      palegreen: ['#98fb98', 'rgb(152,251,152)'],
      paleturquoise: ['#afeeee', 'rgb(175,238,238)'],
      palevioletred: ['#db7093', 'rgb(219,112,147)'],
      papayawhip: ['#ffefd5', 'rgb(255,239,213)'],
      peachpuff: ['#ffdab9', 'rgb(255,218,185)'],
      peru: ['#cd853f', 'rgb(205,133,63)'],
      pink: ['#ffc0cb', 'rgb(255,192,203)'],
      plum: ['#dda0dd', 'rgb(221,160,221)'],
      powderblue: ['#b0e0e6', 'rgb(176,224,230)'],
      purple: ['#800080', 'rgb(128,0,128)'],
      red: ['#ff0000', 'rgb(255,0,0)'],
      rosybrown: ['#bc8f8f', 'rgb(188,143,143)'],
      royalblue: ['#4169e1', 'rgb(65,105,225)'],
      saddlebrown: ['#8b4513', 'rgb(139,69,19)'],
      salmon: ['#fa8072', 'rgb(250,128,114)'],
      sandybrown: ['#f4a460', 'rgb(244,164,96)'],
      seagreen: ['#2e8b57', 'rgb(46,139,87)'],
      seashell: ['#fff5ee', 'rgb(255,245,238)'],
      sienna: ['#a0522d', 'rgb(160,82,45)'],
      silver: ['#c0c0c0', 'rgb(192,192,192)'],
      skyblue: ['#87ceeb', 'rgb(135,206,235)'],
      slateblue: ['#6a5acd', 'rgb(106,90,205)'],
      slategray: ['#708090', 'rgb(112,128,144)'],
      slategrey: ['#708090', 'rgb(112,128,144)'],
      snow: ['#fffafa', 'rgb(255,250,250)'],
      springgreen: ['#00ff7f', 'rgb(0,255,127)'],
      steelblue: ['#4682b4', 'rgb(70,130,180)'],
      tan: ['#d2b48c', 'rgb(210,180,140)'],
      teal: ['#008080', 'rgb(0,128,128)'],
      thistle: ['#d8bfd8', 'rgb(216,191,216)'],
      tomato: ['#ff6347', 'rgb(255,99,71)'],
      turquoise: ['#40e0d0', 'rgb(64,224,208)'],
      violet: ['#ee82ee', 'rgb(238,130,238)'],
      wheat: ['#f5deb3', 'rgb(245,222,179)'],
      white: ['#ffffff', 'rgb(255,255,255)'],
      whitesmoke: ['#f5f5f5', 'rgb(245,245,245)'],
      yellow: ['#ffff00', 'rgb(255,255,0)'],
      yellowgreen: ['#9acd32', 'rgb(154,205,50)'],
    },
    parseHexToRgbaArray: function (ja) {
      var jb = ja.replace('#', '')
      if (jb.length === 3) {
        jb += 'f'
      } else {
        if (jb.length === 6) {
          jb += 'ff'
        }
      }
      var e = []
      var i9 = jb.length
      var i8 = i9 === 8 ? 2 : 1
      for (var T = 0; T < i9; T = T + i8) {
        if (i8 === 2) {
          e.push(parseInt(jb.slice(T, T + 2), 16))
        } else {
          e.push(parseInt(jb.slice(T, T + 1) + jb.slice(T, T + 1), 16))
        }
      }
      return e
    },
    parseRgbaStrToArray: function (i) {
      var e = [0, 0, 0, 255]
      if (i.indexOf('rgba(') === 0) {
        var i8 = i.replace('rgba(', '').replace(')', '')
        var T = i8.split(',')
        e[0] = parseInt(T[0], 10)
        e[1] = parseInt(T[1], 10)
        e[2] = parseInt(T[2], 10)
        e[3] = Math.round(parseFloat(T[3]) * 255)
      } else {
        if (i.indexOf('rgb(') === 0) {
          var i8 = i.replace('rgb(', '').replace(')', '')
          var i9 = i8.split(',')
          e[0] = parseInt(i9[0], 10)
          e[1] = parseInt(i9[1], 10)
          e[2] = parseInt(i9[2], 10)
          e[3] = 255
        }
      }
      return e
    },
    parseHexAndOpacityToRgbaArray: function (i9, ja) {
      var T = []
      var jd = /^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/
      var jc = i9.toLowerCase()
      if (jd.test(jc)) {
        if (jc.length === 4) {
          var e = '#'
          for (var jb = 1; jb < 4; jb++) {
            e += jc.slice(jb, jb + 1).concat(jc.slice(jb, jb + 1))
          }
          jc = e
        }
        for (var i8 = 1; i8 < 7; i8 += 2) {
          T.push(parseInt(jc.slice(i8, i8 + 2), 16))
        }
        T.push(ja)
      }
      return T
    },
    parseCSSColor: function (e) {
      if (e.indexOf('#') === 0) {
        return gM.parseHexToRgbaArray(e)
      }
      return gM.parseRgbaStrToArray(e)
    },
    rgbToHSV: function (i9) {
      var e = i9[0] / 255
      var T = i9[1] / 255
      var ja = i9[2] / 255
      var jd = Math.max(e, T, ja)
      var i8 = Math.min(e, T, ja)
      var jc = jd - i8
      var i
      if (jc === 0) {
        i = 0
      } else {
        if (jd === e) {
          i = 60 * (((T - ja) / jc) % 6)
        } else {
          if (jd === T) {
            i = 60 * ((ja - e) / jc + 2)
          } else {
            if (jd === ja) {
              i = 60 * ((e - T) / jc + 4)
            }
          }
        }
      }
      var je = jd === 0 ? 0 : jc / jd
      var jb = jd
      while (i < 0) {
        i += 360
      }
      return [i, je, jb]
    },
    hsvToRGB: function (i8) {
      var jc = i8[2] * i8[1]
      var T = jc * (1 - Math.abs(((i8[0] / 60) % 2) - 1))
      var i = i8[2] - jc
      var i9 = i8[0]
      var jb
      var ja
      var e
      if (i9 >= 0 && i9 < 60) {
        jb = jc
        ja = T
        e = 0
      } else {
        if (i9 >= 60 && i9 < 120) {
          jb = T
          ja = jc
          e = 0
        } else {
          if (i9 >= 120 && i9 < 180) {
            jb = 0
            ja = jc
            e = T
          } else {
            if (i9 >= 180 && i9 < 240) {
              jb = 0
              ja = T
              e = jc
            } else {
              if (i9 >= 240 && i9 < 300) {
                jb = T
                ja = 0
                e = jc
              } else {
                if (i9 >= 300 && i9 < 360) {
                  jb = jc
                  ja = 0
                  e = T
                }
              }
            }
          }
        }
      }
      jb = (jb + i) * 255 > 255 ? 255 : (jb + i) * 255
      ja = (ja + i) * 255 > 255 ? 255 : (ja + i) * 255
      e = (e + i) * 255 > 255 ? 255 : (e + i) * 255
      return [Math.round(jb), Math.round(ja), Math.round(e)]
    },
    formatColorCssToRgbaArray: function (ja, T, i8) {
      i8 = typeof i8 !== 'boolean' ? true : i8
      if (typeof ja !== 'string') {
        return i8 ? [0, 0, 0, 1] : [0, 0, 0, 255]
      }
      var i = (ja || 'Black').trim().toLowerCase()
      var e = []
      var i9 = gM.ColorRefTable[i]
      if (i9 !== undefined) {
        i = i9[0]
      }
      e = gM.parseCSSColor(i)
      if (T !== undefined && !isNaN(Number(T))) {
        T = Number(T)
        e[3] = gM.fitTo(T, 0, 1)
      } else {
        e[3] = Number((e[3] / 255).toFixed(2))
      }
      if (!i8) {
        e[3] = Math.floor(e[3] * 255)
      }
      return e
    },
    fitTo: function (T, i, e) {
      if (T < i) {
        T = i
      } else {
        if (T > e) {
          T = e
        }
      }
      return T
    },
    generateColorRamp: function (e, je, jf, i8, jk) {
      jf = jf || []
      i8 = i8 || '#ccc'
      jk = jk || 1
      const T = document.createElement('canvas')
      const jl = T.getContext('2d')
      T.width = 256
      T.height = jk
      const ja = je[0]
      const jh = je[je.length - 1]
      if (e.length === je.length) {
        const ji = jl.createLinearGradient(0, 0, 256, 1)
        for (var jd = 0; jd < e.length; ++jd) {
          var jj = (je[jd] - ja) / (jh - ja)
          ji.addColorStop(jj, e[jd])
        }
        jl.fillStyle = ji
        jl.fillRect(0, 0, 256, jk)
      } else {
        if (e.length - je.length === -1) {
          var jc = 0
          var i9 = 1
          for (var jd = 0; jd < e.length; ++jd) {
            var jg = (je[i9] - ja) / (jh - ja)
            var jj = Math.floor(jg * 256)
            jl.fillStyle = e[jd]
            jl.fillRect(jc, 0, jj, jk)
            jc = jj
            i9++
          }
        } else {
          jl.fillStyle = i8 || '#ccc'
          jl.fillRect(0, 0, 256, jk)
        }
      }
      if (e.length - je.length <= -1 && jf.length === 2) {
        jl.fillStyle = i8 || '#ccc'
        var jg = (jf[0] - ja) / (jh - ja)
        var jj = Math.floor(jg * 256)
        jl.fillRect(0, 0, jj, jk)
        jg = (jf[1] - ja) / (jh - ja)
        jj = Math.floor(jg * 256)
        jl.fillRect(jj, 0, 255, jk)
      }
      var jb = new Uint8Array(
        new Uint8ClampedArray(jl.getImageData(0, 0, 256, jk).data)
      )
      return { canvas: T, data: jb, width: 256, height: jk }
    },
  }
  ;(function (ja) {
    function jk(jp, js) {
      var jr = (jp & 65535) + (js & 65535)
      var jq = (jp >> 16) + (js >> 16) + (jr >> 16)
      return (jq << 16) | (jr & 65535)
    }
    function jj(jp, jq) {
      return (jp << jq) | (jp >>> (32 - jq))
    }
    function je(ju, jr, jq, jp, jt, js) {
      return jk(jj(jk(jk(jr, ju), jk(jp, js)), jt), jq)
    }
    function e(jr, jq, jv, ju, jp, jt, js) {
      return je((jq & jv) | (~jq & ju), jr, jq, jp, jt, js)
    }
    function jb(jr, jq, jv, ju, jp, jt, js) {
      return je((jq & ju) | (jv & ~ju), jr, jq, jp, jt, js)
    }
    function jh(jr, jq, jv, ju, jp, jt, js) {
      return je(jq ^ jv ^ ju, jr, jq, jp, jt, js)
    }
    function jn(jr, jq, jv, ju, jp, jt, js) {
      return je(jv ^ (jq | ~ju), jr, jq, jp, jt, js)
    }
    function T(jz, ju) {
      jz[ju >> 5] |= 128 << ju % 32
      jz[(((ju + 64) >>> 9) << 4) + 14] = ju
      var jr
      var jt
      var js
      var jq
      var jp
      var jy = 1732584193
      var jx = -271733879
      var jw = -1732584194
      var jv = 271733878
      for (jr = 0; jr < jz.length; jr += 16) {
        jt = jy
        js = jx
        jq = jw
        jp = jv
        jy = e(jy, jx, jw, jv, jz[jr], 7, -680876936)
        jv = e(jv, jy, jx, jw, jz[jr + 1], 12, -389564586)
        jw = e(jw, jv, jy, jx, jz[jr + 2], 17, 606105819)
        jx = e(jx, jw, jv, jy, jz[jr + 3], 22, -1044525330)
        jy = e(jy, jx, jw, jv, jz[jr + 4], 7, -176418897)
        jv = e(jv, jy, jx, jw, jz[jr + 5], 12, 1200080426)
        jw = e(jw, jv, jy, jx, jz[jr + 6], 17, -1473231341)
        jx = e(jx, jw, jv, jy, jz[jr + 7], 22, -45705983)
        jy = e(jy, jx, jw, jv, jz[jr + 8], 7, 1770035416)
        jv = e(jv, jy, jx, jw, jz[jr + 9], 12, -1958414417)
        jw = e(jw, jv, jy, jx, jz[jr + 10], 17, -42063)
        jx = e(jx, jw, jv, jy, jz[jr + 11], 22, -1990404162)
        jy = e(jy, jx, jw, jv, jz[jr + 12], 7, 1804603682)
        jv = e(jv, jy, jx, jw, jz[jr + 13], 12, -40341101)
        jw = e(jw, jv, jy, jx, jz[jr + 14], 17, -1502002290)
        jx = e(jx, jw, jv, jy, jz[jr + 15], 22, 1236535329)
        jy = jb(jy, jx, jw, jv, jz[jr + 1], 5, -165796510)
        jv = jb(jv, jy, jx, jw, jz[jr + 6], 9, -1069501632)
        jw = jb(jw, jv, jy, jx, jz[jr + 11], 14, 643717713)
        jx = jb(jx, jw, jv, jy, jz[jr], 20, -373897302)
        jy = jb(jy, jx, jw, jv, jz[jr + 5], 5, -701558691)
        jv = jb(jv, jy, jx, jw, jz[jr + 10], 9, 38016083)
        jw = jb(jw, jv, jy, jx, jz[jr + 15], 14, -660478335)
        jx = jb(jx, jw, jv, jy, jz[jr + 4], 20, -405537848)
        jy = jb(jy, jx, jw, jv, jz[jr + 9], 5, 568446438)
        jv = jb(jv, jy, jx, jw, jz[jr + 14], 9, -1019803690)
        jw = jb(jw, jv, jy, jx, jz[jr + 3], 14, -187363961)
        jx = jb(jx, jw, jv, jy, jz[jr + 8], 20, 1163531501)
        jy = jb(jy, jx, jw, jv, jz[jr + 13], 5, -1444681467)
        jv = jb(jv, jy, jx, jw, jz[jr + 2], 9, -51403784)
        jw = jb(jw, jv, jy, jx, jz[jr + 7], 14, 1735328473)
        jx = jb(jx, jw, jv, jy, jz[jr + 12], 20, -1926607734)
        jy = jh(jy, jx, jw, jv, jz[jr + 5], 4, -378558)
        jv = jh(jv, jy, jx, jw, jz[jr + 8], 11, -2022574463)
        jw = jh(jw, jv, jy, jx, jz[jr + 11], 16, 1839030562)
        jx = jh(jx, jw, jv, jy, jz[jr + 14], 23, -35309556)
        jy = jh(jy, jx, jw, jv, jz[jr + 1], 4, -1530992060)
        jv = jh(jv, jy, jx, jw, jz[jr + 4], 11, 1272893353)
        jw = jh(jw, jv, jy, jx, jz[jr + 7], 16, -155497632)
        jx = jh(jx, jw, jv, jy, jz[jr + 10], 23, -1094730640)
        jy = jh(jy, jx, jw, jv, jz[jr + 13], 4, 681279174)
        jv = jh(jv, jy, jx, jw, jz[jr], 11, -358537222)
        jw = jh(jw, jv, jy, jx, jz[jr + 3], 16, -722521979)
        jx = jh(jx, jw, jv, jy, jz[jr + 6], 23, 76029189)
        jy = jh(jy, jx, jw, jv, jz[jr + 9], 4, -640364487)
        jv = jh(jv, jy, jx, jw, jz[jr + 12], 11, -421815835)
        jw = jh(jw, jv, jy, jx, jz[jr + 15], 16, 530742520)
        jx = jh(jx, jw, jv, jy, jz[jr + 2], 23, -995338651)
        jy = jn(jy, jx, jw, jv, jz[jr], 6, -198630844)
        jv = jn(jv, jy, jx, jw, jz[jr + 7], 10, 1126891415)
        jw = jn(jw, jv, jy, jx, jz[jr + 14], 15, -1416354905)
        jx = jn(jx, jw, jv, jy, jz[jr + 5], 21, -57434055)
        jy = jn(jy, jx, jw, jv, jz[jr + 12], 6, 1700485571)
        jv = jn(jv, jy, jx, jw, jz[jr + 3], 10, -1894986606)
        jw = jn(jw, jv, jy, jx, jz[jr + 10], 15, -1051523)
        jx = jn(jx, jw, jv, jy, jz[jr + 1], 21, -2054922799)
        jy = jn(jy, jx, jw, jv, jz[jr + 8], 6, 1873313359)
        jv = jn(jv, jy, jx, jw, jz[jr + 15], 10, -30611744)
        jw = jn(jw, jv, jy, jx, jz[jr + 6], 15, -1560198380)
        jx = jn(jx, jw, jv, jy, jz[jr + 13], 21, 1309151649)
        jy = jn(jy, jx, jw, jv, jz[jr + 4], 6, -145523070)
        jv = jn(jv, jy, jx, jw, jz[jr + 11], 10, -1120210379)
        jw = jn(jw, jv, jy, jx, jz[jr + 2], 15, 718787259)
        jx = jn(jx, jw, jv, jy, jz[jr + 9], 21, -343485551)
        jy = jk(jy, jt)
        jx = jk(jx, js)
        jw = jk(jw, jq)
        jv = jk(jv, jp)
      }
      return [jy, jx, jw, jv]
    }
    function ji(jq) {
      var jr
      var jp = ''
      var js = jq.length * 32
      for (jr = 0; jr < js; jr += 8) {
        jp += String.fromCharCode((jq[jr >> 5] >>> jr % 32) & 255)
      }
      return jp
    }
    function jd(jq) {
      var js
      var jp = []
      jp[(jq.length >> 2) - 1] = undefined
      for (js = 0; js < jp.length; js += 1) {
        jp[js] = 0
      }
      var jr = jq.length * 8
      for (js = 0; js < jr; js += 8) {
        jp[js >> 5] |= (jq.charCodeAt(js / 8) & 255) << js % 32
      }
      return jp
    }
    function jc(jp) {
      return ji(T(jd(jp), jp.length * 8))
    }
    function jo(jr, ju) {
      var jq
      var jt = jd(jr)
      var jp = []
      var js = []
      var jv
      jp[15] = js[15] = undefined
      if (jt.length > 16) {
        jt = T(jt, jr.length * 8)
      }
      for (jq = 0; jq < 16; jq += 1) {
        jp[jq] = jt[jq] ^ 909522486
        js[jq] = jt[jq] ^ 1549556828
      }
      jv = T(jp.concat(jd(ju)), 512 + ju.length * 8)
      return ji(T(js.concat(jv), 512 + 128))
    }
    function jm(js) {
      var jr = '0123456789abcdef'
      var jq = ''
      var jp
      var jt
      for (jt = 0; jt < js.length; jt += 1) {
        jp = js.charCodeAt(jt)
        jq += jr.charAt((jp >>> 4) & 15) + jr.charAt(jp & 15)
      }
      return jq
    }
    function jf(jp) {
      return unescape(encodeURIComponent(jp))
    }
    function i8(jp) {
      return jc(jf(jp))
    }
    function jg(jp) {
      return jm(i8(jp))
    }
    function i(jp, jq) {
      return jo(jf(jp), jf(jq))
    }
    function jl(jp, jq) {
      return jm(i(jp, jq))
    }
    function i9(jq, jr, jp) {
      if (!jr) {
        if (!jp) {
          return jg(jq)
        }
        return i8(jq)
      }
      if (!jp) {
        return jl(jr, jq)
      }
      return i(jr, jq)
    }
    if (typeof define === 'function' && define.amd) {
      define(function () {
        return i9
      })
    } else {
      if (typeof module === 'object' && module.exports) {
        module.exports = i9
      } else {
        ja.md5 = i9
      }
    }
  })(this)
  var co = {
    levels: { INFO: 'info', WARNING: 'warning', ERROR: 'error' },
    category: { JS: 'js', RESOURCE: 'resource', AJAX: 'ajax' },
    config: { jsError: true, resourceError: true, ajaxError: true },
    hosts: 'api.map.baidu.com|webmap0.bdimg.com|maponline0.bdimg.com|',
    ignoreUrl: 'api.map.baidu.com/images/blank.gif',
    sender: true,
    collections: [],
    sendError: function () {},
    init: function (i, e, T) {
      this.hosts += i ? i : ''
      ak && ak(this.config, e)
      this.sender = true
      if (T) {
        this.sender = false
      }
      this.hosts = this.urlScope(this.hosts)
      this.sendError = this.notifyError()
      var i8 =
        typeof window !== 'undefined'
          ? window
          : typeof global !== 'undefined'
          ? global
          : typeof self !== 'undefined'
          ? self
          : {}
      this.config.jsError && this.handleJavaScriptError(i8)
      this.config.resourceError && this.handleResourceError(i8)
      this.config.ajaxError && this.handleAjaxError(i8)
    },
    handleJavaScriptError: function (T) {
      var e = this
      var i = T.onerror
      T.onerror = function (jc, jb, i8, ja, i9) {
        if (e.isFetch(e.category.JS) && e.hostExit(jb)) {
          if (i9 && i9.stack) {
            e.sendError({
              title: jc,
              msg: i9.stack,
              category: e.category.JS,
              level: e.levels.ERROR,
            })
          } else {
            if (typeof jc === 'string') {
              e.sendError({
                title: jc,
                msg: JSON.stringify({
                  resourceUrl: jb,
                  rowNum: i8,
                  colNum: ja,
                }),
                category: 'js',
                level: e.levels.ERROR,
              })
            }
          }
        }
        if (i && bG(i)) {
          i && i.apply(T, arguments)
        }
      }
    },
    handleResourceError: function (i) {
      var e = this
      i.addEventListener(
        'error',
        function (ja) {
          if (ja) {
            var jb = ja.target || ja.srcElement
            var i9 =
              jb instanceof HTMLScriptElement ||
              jb instanceof HTMLLinkElement ||
              jb instanceof HTMLImageElement
            if (!i9) {
              if (!i.onerror) {
                var T = ja.filename || null
                if (!e.isFetch(e.category.JS) || !e.hostExit(T)) {
                  return
                }
                if (ja.error && ja.error.stack) {
                  e.sendError({
                    title: ja.message,
                    msg: ja.error.stack,
                    category: e.category.JS,
                    level: e.levels.ERROR,
                  })
                } else {
                  if (typeof ja.message === 'string') {
                    e.sendError({
                      title: ja.message,
                      msg: JSON.stringify({
                        resourceUrl: T,
                        rowNum: ja.lineno,
                        colNum: ja.cowno,
                      }),
                      category: e.category.JS,
                      level: e.levels.ERROR,
                    })
                  }
                }
              }
              return
            }
            var i8 = jb.src || jb.href
            if (e.isFetch(e.category.RESOURCE) && e.hostExit(i8)) {
              e.sendError({
                title: jb.nodeName,
                msg: i8,
                category: e.category.RESOURCE,
                level: e.levels.ERROR,
              })
            }
          }
        },
        true
      )
    },
    handleAjaxError: function (ja) {
      var e = this
      var i9 = ja.location.protocol
      if (i9 === 'file:') {
        return
      }
      if (!ja.XMLHttpRequest) {
        return
      }
      var i = ja.XMLHttpRequest
      var T = i.prototype.send
      var i8 = function (jc) {
        if (jc && jc.currentTarget && jc.currentTarget.status !== 200) {
          var jb = jc.target.responseURL
          if (e.isFetch(e.category.AJAX) && e.hostExit(jb)) {
            e.sendError({
              title: jb,
              msg: JSON.stringify({
                response: jc.target.response,
                responseURL: jb,
                status: jc.target.status,
                statusText: jc.target.statusText,
              }),
              category: e.category.AJAX,
              level: e.levels.ERROR,
            })
          }
        }
      }
      i.prototype.send = function () {
        if (this['addEventListener']) {
          this['addEventListener']('error', i8)
          this['addEventListener']('load', i8)
          this['addEventListener']('abort', i8)
        } else {
          var jb = this['onreadystatechange']
          this['onreadystatechange'] = function (jc) {
            if (this.readyState === 4) {
              i8(jc)
            }
            jb && jb.apply(this, arguments)
          }
        }
        return T.apply(this, arguments)
      }
    },
    notifyError: function (T) {
      var i = T || 1000
      this._idleWorkerTicker = (function (i8) {
        return function () {
          i8.runJob()
        }
      })(this)
      var e = this
      return function (i9) {
        if (i9.url) {
          if (!e.isFetch(i9.category)) {
            return
          }
          var i8 = i9.url || ''
          if (!e.hostExit(i8)) {
            return
          }
          delete i9.url
        }
        if (!navigator.onLine) {
          return
        }
        e.collections.push(i9)
        e.checkJob(i)
      }
    },
    runJob: function () {
      if (this.collections.length === 0) {
        clearInterval(this.idleWork)
        this.idleWork = null
        return
      }
      var i9 = this.collections.slice(0, 2)
      var T = ik(JSON.stringify({ dataset: i9 }))
      var i8 = new Date().getTime()
      var i =
        dZ.apiIMG +
        '/blank.gif?product=jsapi&v=gl&l=' +
        T +
        '&ak=' +
        ei +
        '&t=' +
        i8
      if (this.sender) {
        try {
          var jb = document.createElement('div')
          jb.style =
            'width:0;height:0;visibility: hidden;opacity: 0;z-index:-999;background-image: url(' +
            i +
            ');'
          document.querySelector('BODY').appendChild(jb)
          setTimeout(function () {
            document.querySelector('BODY').removeChild(jb)
          })
        } catch (ja) {}
      }
      this.collections.splice(0, 2)
      if (this.collections.length === 0) {
        clearInterval(this.idleWork)
        this.idleWork = null
      }
    },
    checkJob: function (e) {
      if (!this.idleWork && this._idleWorkerTicker) {
        this.idleWork = setInterval(this._idleWorkerTicker, e)
      }
    },
    urlScope: function (i8) {
      var T = {}
      var ja = Object.keys(w)
      if (w && ja.length > 0) {
        for (var i9 in w) {
          if (w[i9] && typeof w[i9] !== 'function') {
            T[i9] = w[i9]
          }
        }
      }
      try {
        var jc = JSON.stringify(T)
        if (jc.length > 2) {
          return i8 + '|' + jc
        } else {
          return i8
        }
      } catch (jb) {
        return i8
      }
    },
    hostExit: function (i) {
      try {
        if (i && i.indexOf('//') === 0) {
          i = window.location.protocol + i
        }
        var T = new URL(i)
        if (!T || !T.host) {
          return false
        }
        var i9 = T.host + T.pathname
        if (
          this.ignoreUrl.indexOf(i9) === -1 &&
          this.hosts.indexOf(T.host) > -1
        ) {
          return true
        }
        return false
      } catch (i8) {
        return false
      }
    },
    isFetch: function (e) {
      return this.config[e + 'Error'] || false
    },
  }
  bo.fetchDebug = co
  var iT = {
    request: function (jh, jk, jd, je, ji) {
      var jc = new Date()['getTime']()
      var i9 = (Math.random() * 100000)['toFixed'](0)
      bo._rd['_cbk' + i9] = function (jp) {
        if (jp.result && jp.result['error'] && jp.result['error'] === 202) {
          alert('该AK因为恶意行为已经被管理员封禁！')
          return
        }
        jd = jd || {}
        jh && jh(jp, jd)
        delete bo._rd['_cbk' + i9]
      }
      je = je || ''
      var jj
      var jf
      if (jd && jd.useEncodeURI) {
        jj = il(jk, encodeURI)
        jf = il(jk)
      } else {
        jj = il(jk, encodeURIComponent)
        jf = il(jk)
      }
      var jo = this
      var T =
        w.apiHost + '/' + je + '?' + jj + '&ie=utf-8&oue=1&fromproduct=jsapi'
      var e =
        w.apiHost + '/' + je + '?' + jf + '&ie=utf-8&oue=1&fromproduct=jsapi'
      if (!ji) {
        T += '&res=api'
        e += '&res=api'
      }
      T += '&callback=' + eV + '._rd._cbk' + i9
      e += '&callback=' + eV + '._rd._cbk' + i9
      var i = window.___abvk
        ? window.___abvk
        : this.getSeckeyCidItem('SECKEY_ABVK')
      var jb = this.getSeckeyCidItem('BMAP_SECKEY')
      var jl = encodeURIComponent(i + ',' + jb)
      var ja = i + ',' + jb
      T += '&ak=' + ei + '&v=gl&seckey=' + jl + '&timeStamp=' + jc
      e += '&ak=' + ei + '&v=gl&seckey=' + ja + '&timeStamp=' + jc
      var jn = 'F5L2O6R6AD8990O'
      var jm = 'H0A9P8P7Y6ABQO0'
      var i8 = e.substr(e.indexOf('?') + 1)
      var jg = md5(md5(i8 + jn) + jm)
      T += '&sign=' + jg.substring(jg.length - 12)
      f5.load(T)
    },
    getSeckeyCidItem: function (i) {
      if (navigator.cookieEnabled) {
        var T = new RegExp('(^| )' + i + '=([^;]*)(;|$)')
        var e = document.cookie.match(T)
        if (e) {
          return unescape(e[2])
        }
        return -1
      }
      if (localStorage) {
        return localStorage.getItem(i) ? localStorage.getItem(i) : -1
      }
      if (sessionStorage) {
        return sessionStorage.getItem(i) ? localStorage.getItem(i) : -1
      }
    },
  }
  window.srqtimer = null
  window.firstTime = true
  window.srqcount = 0
  bo._rd = {}
  var cS = {
    request: function (jb, e) {
      if (e) {
        var ja = (Math.random() * 100000).toFixed(0)
        BMapGL._rd['_cbk' + ja] = function (jd) {
          e && e(jd)
          delete BMapGL._rd['_cbk' + ja]
        }
        jb += '&callback=BMapGL._rd._cbk' + ja
      }
      function i9(je) {
        var jd
        var jf = new RegExp('(^| )' + je + '=([^;]*)(;|$)')
        if ((jd = document.cookie.match(jf))) {
          return unescape(jd[2])
        } else {
          return -1
        }
      }
      var T = window.___abvk
        ? window.___abvk
        : this.getSeckeyCidItem('SECKEY_ABVK')
      var jc = this.getSeckeyCidItem('BMAP_SECKEY')
      var i = encodeURIComponent(T + ',' + jc)
      jb += '&seckey=' + i
      var i8 = bK('script', {
        src: jb,
        type: 'text/javascript',
        charset: 'utf-8',
      })
      if (i8.addEventListener) {
        i8.addEventListener(
          'load',
          function (je) {
            var jd = je.target
            jd.parentNode.removeChild(jd)
          },
          false
        )
        i8.addEventListener(
          'error',
          function (jd) {
            e && e([, , , , ,])
          },
          false
        )
      } else {
        if (i8.attachEvent) {
          i8.attachEvent('onreadystatechange', function (je) {
            var jd = window.event.srcElement
            if (
              jd &&
              (jd.readyState == 'loaded' || jd.readyState == 'complete')
            ) {
              jd.parentNode.removeChild(jd)
            }
          })
        }
      }
      document.getElementsByTagName('head')[0].appendChild(i8)
      i8 = null
    },
    getSeckeyCidItem: function (i) {
      if (navigator.cookieEnabled) {
        var T = new RegExp('(^| )' + i + '=([^;]*)(;|$)')
        var e = document.cookie.match(T)
        if (e) {
          return unescape(e[2])
        }
        return -1
      }
      if (localStorage) {
        return localStorage.getItem(i) ? localStorage.getItem(i) : -1
      }
      if (sessionStorage) {
        return sessionStorage.getItem(i) ? localStorage.getItem(i) : -1
      }
    },
  }
  function f0() {
    this._map = null
    this._container
    this._type = 'control'
    this.blockInfoWindow = true
    this._visible = true
  }
  f0.inherits(cJ, 'Control')
  es.extend(f0.prototype, {
    initialize: function (e) {
      this._map = e
      if (this._container) {
        if (this._opts && this._opts.container) {
          this._opts.container.appendChild(this._container)
        } else {
          e.container.appendChild(this._container)
        }
        return this._container
      }
      return
    },
    _i: function (e) {
      if (!this._container && this.initialize && bG(this.initialize)) {
        this._container = this.initialize(e)
      }
      this._opts = this._opts || { printable: false }
      this._setStyle()
      this._setPosition()
      if (this._container) {
        this._container._jsobj = this
      }
    },
    _setStyle: function () {
      var i = this._container
      if (i) {
        var e = i.style
        e.position = 'absolute'
        e.zIndex = this._cZIndex || '10'
        e.MozUserSelect = 'none'
        if (!this._opts.printable) {
          es.ac(i, 'BMap_noprint')
        }
        es.on(i, 'contextmenu', gC)
      }
    },
    remove: function () {
      this._map = null
      if (!this._container) {
        return
      }
      this._container.parentNode &&
        this._container.parentNode.removeChild(this._container)
      this._container._jsobj = null
      this._container = null
    },
    _render: function (e) {
      if (this._opts && this._opts.container) {
        this._container = bA(
          this._opts.container,
          '<div unselectable="on"></div>'
        )
      } else {
        var i = '<div unselectable="on"></div>'
        if (e && e.config.autoSafeArea && b9()) {
          this._safeAreaContainer = bA(this._map.container, i)
          this._safeAreaContainer.style.position = 'absolute'
          this._safeAreaContainer.style.bottom = 'env(safe-area-inset-bottom)'
          this._container = bA(this._safeAreaContainer, i)
        } else {
          this._container = bA(this._map.container, i)
        }
      }
      if (this._visible === false) {
        this._container.style.display = 'none'
      }
      return this._container
    },
    _setPosition: function () {
      this.setAnchor(this._opts.anchor)
    },
    setAnchor: function (i8) {
      if (
        this.anchorFixed ||
        typeof i8 !== 'number' ||
        isNaN(i8) ||
        i8 < BMAP_ANCHOR_TOP_LEFT ||
        i8 > BMAP_ANCHOR_BOTTOM_RIGHT
      ) {
        i8 = this.defaultAnchor
      }
      this._opts.offset = this._opts.offset || this.defaultOffset
      var T = this._opts.anchor
      this._opts.anchor = i8
      if (!this._container) {
        return
      }
      var ja = this._container
      var e = this._opts.offset.width
      var i9 = this._opts.offset.height
      ja.style.left = ja.style.top = ja.style.right = ja.style.bottom = 'auto'
      switch (i8) {
        case BMAP_ANCHOR_TOP_LEFT:
          ja.style.top = i9 + 'px'
          ja.style.left = e + 'px'
          break
        case BMAP_ANCHOR_TOP_RIGHT:
          ja.style.top = i9 + 'px'
          ja.style.right = e + 'px'
          break
        case BMAP_ANCHOR_BOTTOM_LEFT:
          ja.style.bottom = i9 + 'px'
          ja.style.left = e + 'px'
          break
        case BMAP_ANCHOR_BOTTOM_RIGHT:
          ja.style.bottom = i9 + 'px'
          ja.style.right = e + 'px'
          break
        default:
          break
      }
      var i = ['TL', 'TR', 'BL', 'BR']
      es.rc(this._container, 'anchor' + i[T])
      es.ac(this._container, 'anchor' + i[i8])
    },
    getAnchor: function () {
      return this._opts.anchor
    },
    setOffset: function (e) {
      if (!e) {
        return
      }
      this._opts = this._opts || {}
      this._opts.offset = new h3(e.width, e.height)
      if (!this._container) {
        return
      }
      this.setAnchor(this._opts.anchor)
    },
    getOffset: function () {
      return this._opts.offset
    },
    getDom: function () {
      return this._container
    },
    show: function () {
      if (this._visible === true) {
        return
      }
      this._visible = true
      if (this._container) {
        this._container.style.display = ''
      }
      this.dispatchEvent(new e7('onshow'))
    },
    hide: function () {
      if (this._visible === false) {
        return
      }
      this._visible = false
      if (this._container) {
        this._container.style.display = 'none'
      }
      this.dispatchEvent(new e7('onhide'))
    },
    isPrintable: function () {
      return !!this._opts.printable
    },
    isVisible: function () {
      if (!this._container && !this._map) {
        return false
      }
      return !!this._visible
    },
    _asyncLoadCode: function () {
      var e = this
      gi.load('control', function () {
        if (e._asyncDraw) {
          e._asyncDraw()
        }
      })
    },
  })
  var dL = { TOP_LEFT: 0, TOP_RIGHT: 1, BOTTOM_LEFT: 2, BOTTOM_RIGHT: 3 }
  bo.ControlAnchor = dL
  window.BMAP_ANCHOR_TOP_LEFT = 0
  window.BMAP_ANCHOR_TOP_RIGHT = 1
  window.BMAP_ANCHOR_BOTTOM_LEFT = 2
  window.BMAP_ANCHOR_BOTTOM_RIGHT = 3
  function ft(e) {
    f0.call(this)
    e = e || {}
    this._opts = { printable: false }
    es.extend(this._opts, e)
    this._copyrightCollection = []
    this.defaultAnchor = BMAP_ANCHOR_BOTTOM_LEFT
    this.defaultOffset = new h3(5, 2)
    this.setAnchor(e.anchor)
    this._canShow = true
    this.sateMapStyle = false
    this.blockInfoWindow = false
    this._asyncLoadCode()
  }
  ft.inherits(f0, 'CopyrightControl')
  es.extend(ft.prototype, {
    initialize: function (e) {
      this._map = e
      return this._container
    },
    addCopyright: function (i8) {
      var e = { minZoom: 0, bounds: null, content: '', mapType: '' }
      for (var T in i8) {
        e[T] = i8[T]
      }
      if (this._map) {
        var jb = e.minZoom
        if (
          jb === -1 ||
          jb < this._map.getMinZoom() ||
          jb > this._map.getMaxZoom()
        ) {
          e.minZoom = this._map.getMinZoom()
        }
        if (e.mapType !== '' && !dO[e.mapType]) {
          e.mapType = BMAPGL_NORMAL_MAP
        }
      }
      var i9 = this.getCopyright(i8.id)
      if (i9) {
        for (var ja in e) {
          i9[ja] = e[ja]
        }
      } else {
        this._copyrightCollection.push(e)
      }
    },
    getCopyright: function (i8) {
      for (var T = 0, e = this._copyrightCollection.length; T < e; T++) {
        if (this._copyrightCollection[T].id === i8) {
          return this._copyrightCollection[T]
        }
      }
    },
    addSateMapStyle: function () {
      this.sateMapStyle = true
      if (this._container) {
        es.ac(this._container, 'BMap_cpyCtrl_w')
      }
    },
    removeSateMapStyle: function () {
      this.sateMapStyle = false
      if (this._container) {
        es.rc(this._container, 'BMap_cpyCtrl_w')
      }
    },
  })
  function bj(e) {
    f0.call(this)
    e = e || {}
    this.canCheckSize = e.canCheckSize === false ? false : true
    this.curCityName = ''
    this.curCityCode = ''
    this.defaultOffset = new h3(10, 10)
    this.defaultAnchor = dL.TOP_LEFT
    this.onChangeBefore = []
    this.onChangeAfter = []
    this.onChangeSuccess = []
    this._opts = {
      printable: false,
      offset: e.offset || this.defaultOffset,
      anchor: e.anchor || this.defaultAnchor,
      expand: !!e.expand,
    }
    if (e.onChangeBefore && bG(e.onChangeBefore)) {
      this.onChangeBefore.push(e.onChangeBefore)
    }
    if (e.onChangeAfter && bG(e.onChangeAfter)) {
      this.onChangeAfter.push(e.onChangeAfter)
    }
    if (e.onChangeSuccess && bG(e.onChangeSuccess)) {
      this.onChangeSuccess.push(e.onChangeSuccess)
    }
    this.setAnchor(e.anchor)
    this._asyncLoadCode()
  }
  bj.inherits(f0, 'CityListControl')
  es.extend(bj.prototype, {
    initialize: function (e) {
      this._map = e
      return this._container
    },
  })
  function i7(e) {
    f0.call(this)
    e = e || {}
    this._opts = { printable: false }
    this._opts = es.extend(es.extend(this._opts, { unit: 'metric' }), e)
    this.defaultAnchor = BMAP_ANCHOR_BOTTOM_LEFT
    this.defaultOffset = new h3(81, 18)
    if (bJ()) {
      this.defaultOffset = new h3(75, 10)
    }
    this.setAnchor(e.anchor)
    this._units = {
      metric: { name: 'metric', conv: 1, incon: 1000, u1: '米', u2: '公里' },
      us: { name: 'us', conv: 3.2808, incon: 5280, u1: '英尺', u2: '英里' },
    }
    this.sateMapStyle = false
    if (!this._units[this._opts.unit]) {
      this._opts.unit = 'metric'
    }
    this._scaleText = null
    this._numberArray = {}
    this._asyncLoadCode()
  }
  window.BMAP_UNIT_METRIC = 'metric'
  window.BMAP_UNIT_IMPERIAL = 'us'
  i7.inherits(f0, 'ScaleControl')
  es.extend(i7.prototype, {
    initialize: function (e) {
      this._map = e
      return this._container
    },
    setUnit: function (e) {
      this._opts.unit =
        (this._units[e] && this._units[e].name) || this._opts.unit
    },
    getUnit: function () {
      return this._opts.unit
    },
    addSateMapStyle: function () {
      this.sateMapStyle = true
      var e = this._container
      if (e) {
        es.ac(e.children[0], 'dark')
      }
    },
    removeSateMapStyle: function () {
      this.sateMapStyle = false
      var e = this._container
      if (e) {
        es.rc(e.children[0], 'dark')
      }
    },
  })
  window.BMAP_NAVIGATION_CONTROL_LARGE = 0
  window.BMAP_NAVIGATION_CONTROL_SMALL = 1
  window.BMAP_NAVIGATION_CONTROL_PAN = 2
  window.BMAP_NAVIGATION_CONTROL_ZOOM = 3
  window.BMAP_NAVIGATION_CONTROL_ANIM = 4
  function iE(e) {
    f0.call(this)
    e = e || {}
    this._opts = { printable: false }
    es.extend(this._opts, e)
    this.controlHeight = [
      {
        width: 65,
        height: 227,
        zoomHeight: 227,
        zoomWidth: 37,
        sliderHeight: 180,
      },
      {
        width: 65,
        height: 47,
        zoomHeight: this._opts.forceNew === true ? 56 : 47,
        zoomWidth: 37,
        sliderHeight: 0,
      },
      { width: 37, height: 57, zoomHeight: 0, zoomWidth: 0, sliderHeight: 0 },
      { width: 26, height: 56, zoomHeight: 56, zoomWidth: 6, sliderHeight: 0 },
      {
        width: 56,
        height: 47,
        zoomHeight: 47,
        zoomWidth: 37,
        sliderHeight: 180,
      },
    ]
    this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT
    this.defaultOffset = new h3(10, 10)
    this.setAnchor(e.anchor)
    this.setType(e.type)
    this._maxTotalZoomLv = 19
    this._minZoomLevel = -1
    this._maxZoomLevel = -1
    this._totalZoomLv = -1
    this._sliderInterval = 10
    this._sliderHeight = 180
    this._minBarY = 1
    this._maxBarY = -1
    this._curBarY = -1
    this._zoomDom = null
    this._zoomBtnDom = null
    this._sliderDom = null
    this._sliderBaseDom = null
    this._cZIndex = '1100'
    this._asyncLoadCode()
  }
  iE.inherits(f0, 'NavigationControl')
  es.extend(iE.prototype, {
    initialize: function (e) {
      this._map = e
      return this._container
    },
    setType: function (e) {
      if (
        typeof e == 'number' &&
        e >= BMAP_NAVIGATION_CONTROL_LARGE &&
        e <= BMAP_NAVIGATION_CONTROL_ANIM
      ) {
        this._opts.type = e
      } else {
        this._opts.type = BMAP_NAVIGATION_CONTROL_LARGE
      }
    },
    getType: function () {
      return this._opts.type
    },
  })
  function u(i) {
    f0.call(this)
    i = i || {}
    this._opts = { printable: false }
    this.defaultAnchor = BMAP_ANCHOR_TOP_RIGHT
    this.defaultOffset = new h3(10, 10)
    this.setAnchor(i.anchor)
    this._opts = es.extend(
      es.extend(this._opts, { offset: this.defaultOffset, enableSwitch: true }),
      i
    )
    var e = this
    gi.load('control', function () {
      e._asyncDraw()
    })
  }
  u.inherits(f0, 'MapTypeControl')
  es.extend(u.prototype, {
    initialize: function (e) {
      this._map = e
      return this._container
    },
    showStreetLayer: function (e) {
      this._map.showStreetLayer(e)
    },
  })
  function id(e) {
    f0.call(this)
    e = e || {}
    this._opts = {}
    this._opts = es.extend(this._opts, e)
    this._zoomInDisabled = false
    this._zoomOutDisabled = false
    this._zoomInTapped = false
    this._zoomOutTapped = false
    this.defaultAnchor = dL.BOTTOM_RIGHT
    this.defaultOffset = new h3(15, 20)
    this.setAnchor(e.anchor)
    this._asyncLoadCode()
  }
  id.inherits(f0, 'ZoomControl')
  es.extend(id.prototype, {
    initialize: function (e) {
      this._map = e
      return this._container
    },
  })
  function fJ(e) {
    f0.call(this)
    e = e || {}
    this._opts = { autoZoom: true, autoViewport: true }
    this._opts = es.extend(this._opts, e)
    this.defaultAnchor = dL.BOTTOM_LEFT
    this.defaultOffset = new h3(10, 50)
    this.watchPosition = this._opts.watchPosition || false
    this.useCompass = this._opts.useCompass || false
    this.locMarker = null
    this.locLevel = 16
    this.setAnchor(this._opts.anchor)
    this.onLocationStart = e.onLocationStart || null
    this._asyncLoadCode()
  }
  fJ.inherits(f0, 'LocationControl')
  es.extend(fJ.prototype, {
    initialize: function (e) {
      this._map = e
      return this._container
    },
    startLocation: function () {
      this._startLocationCalled = true
    },
    stopLocationTrace: function () {},
    setOptions: function (e) {
      e = e || {}
      es.extend(this._opts, e)
    },
  })
  function br(e) {
    f0.call(this)
    e = e || {}
    this._opts = {}
    this._opts = es.extend(this._opts, e)
    this.defaultAnchor = dL.BOTTOM_LEFT
    this.defaultOffset = new h3(5, 15)
    if (bJ()) {
      this.defaultOffset = new h3(10, 10)
    }
    this.setAnchor(e.anchor)
  }
  br.inherits(f0, 'LogoControl')
  es.extend(br.prototype, {
    initialize: function (i) {
      this._map = i
      var e = (this._container = document.createElement('div'))
      e.innerHTML =
        '<img src="' +
        w.apiHost +
        '/images/logo_hd.png"  style="height:21px;width:62px;"/>'
      i.getContainer().appendChild(e)
      return e
    },
  })
  function an(e, i) {
    this._map = e
    this._indoorInfo = i
    this._visible = true
    this._adjustVisible = true
    this._isMobile = bJ()
    this._sizeConfig = {
      FLOOR_BTN_HEIGHT: this._isMobile ? 35 : 26,
      SWITCH_ARROW_HEIGHT: this._isMobile ? 20 : 15,
    }
    this._init()
  }
  an.prototype._init = function () {
    this._render()
    this._bindDom()
    this._bind()
    this._adjustDisplayHeight()
    var e = new e7('onindoor_bar_show')
    e.uid = this._indoorInfo.uid
    this._map.dispatchEvent(e)
  }
  an.prototype._render = function () {
    if (!this._indoorInfo) {
      return
    }
    var jc = this._isMobile
    var e = (this._div = bK('div'))
    es.ac(e, 'floor-select-container')
    jc && es.ac(e, 'mobile')
    jc && es.ac(e, 'all-border-radius')
    var i = (this._btnTop = bK('button'))
    es.ac(i, 'floor-switch-top')
    es.ac(i, 'top-border-radius')
    var ja = bK('div')
    es.ac(ja, 'floor-switch-top-icon')
    i.appendChild(ja)
    var i9 = (this._btnBottom = bK('button'))
    var T = bK('div')
    es.ac(T, 'floor-switch-bottom-icon')
    i9.appendChild(T)
    es.ac(i9, 'floor-switch-bottom')
    es.ac(i9, 'bottom-border-radius')
    var i8 = (this._floorsContainer = bK('div'))
    es.ac(i8, 'floors-container')
    i8.appendChild(this._createFloorsDom())
    this._div.appendChild(i)
    this._div.appendChild(i8)
    this._div.appendChild(i9)
    var jd = 0
    if (this._btnTop.style.display === '') {
      jd = 2 * this._sizeConfig.SWITCH_ARROW_HEIGHT
    }
    this._div.style.height =
      parseInt(this._floorsContainer.style.height, 10) + jd + 'px'
    this._map.getContainer().appendChild(this._div)
    if (!jc) {
      var jb = this
      setTimeout(function () {
        jb._div.style.right = '20px'
      }, 20)
    }
  }
  an.prototype._createFloorsDom = function () {
    if (!this._indoorInfo) {
      return
    }
    var T = (this._ol = bK('ol'))
    var ja = this._indoorInfo.currentFloor
    for (var i9 = this._indoorInfo.floors.length - 1; i9 >= 0; i9--) {
      var jb = this._indoorInfo.floors[i9].floorName
      var e = bK('li')
      var i8 = bK('button')
      es.ac(i8, 'btn-select-floor')
      if (i9 === ja) {
        es.ac(i8, 'selected')
      }
      i8.setAttribute('data-floor', i9)
      i8.innerHTML = jb
      e.appendChild(i8)
      T.appendChild(e)
    }
    return T
  }
  an.prototype._updateUI = function () {
    if (!this._ol) {
      this._render()
      this._bind()
      this._adjustDisplayHeight()
      return
    }
    this._ol = null
    this._ol = this._createFloorsDom()
    this._floorsContainer.innerHTML = ''
    this._floorsContainer.appendChild(this._ol)
    this._adjustDisplayHeight()
  }
  an.prototype._bindDom = function () {
    var e = this
    es.on(this._floorsContainer, 'click', function (i8) {
      var T = i8.target || i8.srcElement
      if (T.tagName.toLowerCase() === 'button') {
        e._map.showIndoor(
          e._indoorInfo.uid,
          parseInt(T.getAttribute('data-floor'), 10)
        )
        var i = new e7('onindoor_bar_click')
        i.uid = e._indoorInfo.uid
        e._map.dispatchEvent(i)
      }
    })
    es.on(this._floorsContainer, 'mouseover', function (T) {
      var i = T.target
      if (i.tagName.toLowerCase() === 'button') {
        es.ac(i, 'hover')
      }
    })
    es.on(this._floorsContainer, 'mouseout', function (T) {
      var i = T.target
      if (i.tagName.toLowerCase() === 'button') {
        es.rc(i, 'hover')
      }
    })
    es.on(this._floorsContainer, 'touchstart', function (T) {
      var i = T.target
      if (i.tagName.toLowerCase() === 'button') {
        es.ac(i, 'onmousedown')
      }
    })
    es.on(this._floorsContainer, 'touchend', function (T) {
      var i = T.target
      if (i.tagName.toLowerCase() === 'button') {
        es.rc(i, 'onmousedown')
      }
    })
    es.on(this._btnTop, 'mouseover', function (i) {
      if (this._disable) {
        return
      }
      es.ac(this, 'hover')
    })
    es.on(this._btnTop, 'mouseout', function (i) {
      es.rc(this, 'hover')
    })
    es.on(this._btnBottom, 'mouseover', function (i) {
      if (this._disable) {
        return
      }
      es.ac(this, 'hover')
    })
    es.on(this._btnBottom, 'mouseout', function (i) {
      es.rc(this, 'hover')
    })
    es.on(this._btnTop, 'touchstart', function (i) {
      if (this.className.indexOf('disable') > -1) {
        return
      }
      es.ac(this, 'onmousedown')
    })
    es.on(this._btnTop, 'touchend', function (i) {
      es.rc(this, 'onmousedown')
    })
    es.on(this._btnBottom, 'touchstart', function (i) {
      if (this.className.indexOf('disable') > -1) {
        return
      }
      es.ac(this, 'onmousedown')
    })
    es.on(this._btnBottom, 'touchend', function (i) {
      es.rc(this, 'onmousedown')
    })
    es.on(this._btnTop, 'click', function (i) {
      e._setBarSliderTop(parseInt(e._ol.style.top, 10) + 26)
    })
    es.on(this._btnBottom, 'click', function (i) {
      e._setBarSliderTop(parseInt(e._ol.style.top, 10) - 26)
    })
    es.on(this._div, 'mousemove', ad)
    es.on(this._div, 'wheel', gC)
    es.on(this._div, 'mousewheel', gC)
    this._map.addEventListener('resize', function () {
      e._adjustDisplayHeight()
    })
  }
  an.prototype._adjustDisplayHeight = function () {
    if (!this._indoorInfo) {
      return
    }
    var ja = this._map.getSize().height
    var jb = this._sizeConfig.FLOOR_BTN_HEIGHT
    var jc = ja - 291 - 100
    if (this._isMobile) {
      jc = ja - 12 - 108 - this._map.config.bottomOffset
    }
    var e = this._indoorInfo.floors.length
    var T = e * jb
    var i8 = e
    var je = 0
    var jf = this._floorsContainer.children[0]
    if (T > jc) {
      this._showArrow = true
      es.rc(jf.children[0].children[0], 'top-border-radius')
      es.rc(jf.children[e - 1].children[0], 'bottom-border-radius')
    } else {
      this._showArrow = false
      es.ac(jf.children[0].children[0], 'top-border-radius')
      es.ac(jf.children[e - 1].children[0], 'bottom-border-radius')
    }
    while (T > jc) {
      if (i8 === 0) {
        break
      }
      i8--
      je = 2 * this._sizeConfig.SWITCH_ARROW_HEIGHT
      T = i8 * jb + je
    }
    this._currentDisplayHeight = T
    if (i8 < 3) {
      this._setAdjustVisbile(false)
    } else {
      this._setAdjustVisbile(true)
    }
    this._floorsContainer.style.height = i8 * jb + 'px'
    var i9 = this._indoorInfo.currentFloor
    var i = e - i9
    var jd = i9 - 1
    this._div.style.height =
      parseInt(this._floorsContainer.style.height, 10) + je + 'px'
    var jg = -(e - (i9 + Math.round(i8 / 2))) * jb
    this._setBarSliderTop(jg)
    if (i8 < e) {
      es.show(this._btnTop)
      es.show(this._btnBottom)
    } else {
      es.hide(this._btnTop)
      es.hide(this._btnBottom)
      this._setBarSliderTop(0)
    }
    if (this._isMobile) {
      this._div.style.bottom = 108 + this._map.config.bottomOffset + 'px'
    }
  }
  an.prototype._setBarSliderTop = function (i8) {
    var T = 26
    var i = this._indoorInfo.floors.length
    var e = i * T
    if (this._currentDisplayHeight) {
      if (this._showArrow) {
        e = this._currentDisplayHeight - 30
      } else {
        e = this._currentDisplayHeight
      }
    }
    if (e - i8 >= i * T) {
      i8 = e - i * T
      es.ac(this._btnBottom, 'disable')
      es.rc(this._btnBottom, 'hover')
      this._btnBottom._disable = true
    } else {
      es.rc(this._btnBottom, 'disable')
      this._btnBottom._disable = false
    }
    if (i8 >= 0) {
      i8 = 0
      es.ac(this._btnTop, 'disable')
      es.rc(this._btnTop, 'hover')
      this._btnTop._disable = true
    } else {
      es.rc(this._btnTop, 'disable')
      this._btnTop._disable = false
    }
    this._ol.style.top = i8 + 'px'
  }
  an.prototype._setAdjustVisbile = function (e) {
    if (this._adjustVisible === e) {
      return
    }
    this._adjustVisible = e
    if (e && this._visible) {
      this._div.style.right = '20px'
    } else {
      this._div.style.right = '-30px'
    }
  }
  an.prototype._bind = function () {
    var i = this._map
    var e = this
    i.on('indoor_status_changed', function (jc) {
      if (e._visible === false) {
        return
      }
      var T = e._ol
      var ja = jc.uid
      if (!ja) {
        return
      }
      var jb = jc.floor
      for (var i9 = 0; i9 < T.children.length; i9++) {
        var i8 = T.children[i9].children[0]
        if (parseInt(i8.getAttribute('data-floor'), 10) === jb) {
          es.ac(i8, 'selected')
        } else {
          es.rc(i8, 'selected')
        }
      }
    })
    i.on('zoomend', function (T) {
      if (this.getZoom() < 17) {
        e._setAdjustVisbile(false)
      } else {
        e._setAdjustVisbile(true)
      }
    })
  }
  an.prototype.setInfo = function (e) {
    if (this._indoorInfo && this._indoorInfo.uid === e.uid) {
      return
    }
    this._indoorInfo = e
    this._updateUI()
  }
  an.prototype.show = function () {
    if (this._visible === true) {
      return
    }
    this._visible = true
    if (!this._isMobile) {
      this._div.style.right = '20px'
    } else {
      this._div.style.display = ''
    }
    var e = new e7('onindoor_bar_show')
    e.uid = this._indoorInfo.uid
    this._map.dispatchEvent(e)
  }
  an.prototype.hide = function () {
    if (this._visible === false) {
      return
    }
    this._visible = false
    if (!this._isMobile) {
      this._div.style.right = '-30px'
    } else {
      this._div.style.display = 'none'
    }
  }
  function eu(e) {
    this._opts = e || {}
    this.defaultOffset = new h3(2, 80)
    this.defaultAnchor = BMAP_ANCHOR_TOP_RIGHT
    if (this._opts.anchor === undefined) {
      this.setAnchor(this.defaultAnchor)
    } else {
      this.setAnchor(this._opts.anchor)
    }
    this._firstAnimation = true
  }
  eu.inherits(f0, 'NavigationControl3D')
  es.extend(eu.prototype, {
    initialize: function (T) {
      this._map = T
      this._createDom()
      this._bindDom()
      this._bind()
      if (!bJ()) {
        this._headingControl = new hL(this._map, this._div)
      }
      this._tiltControl = new cv(this._map, this._div)
      this._render()
      var i = this._map.getMapType()
      var e = this
      if (i === 'B_EARTH_MAP' || this._map._renderType === 'webgl') {
        e._div.style.opacity = '1'
        e._div.style.visibility = 'visible'
      } else {
        e._div.style.opacity = '0'
        e._div.style.visibility = 'hidden'
      }
      return this._container
    },
    _createDom: function () {
      var i = (this._div = document.createElement('div'))
      this._container = i
      var e = i.style
      e.position = 'absolute'
      e.zIndex = 5
      e.width = '52px'
      e.height = '82px'
      e.right = '-3px'
      e.bottom = '79px'
      e.opacity = '0'
      e.visibility = 'hidden'
      e.WebkitTransition = e.transition =
        'opacity .3s ease-out,visibility .3s ease-out'
    },
    _render: function () {
      var e = document.getElementById('map-operate')
      if (e) {
        e.appendChild(this._div)
      } else {
        this._map.getContainer().appendChild(this._div)
      }
    },
    _bindDom: function () {
      this._div.addEventListener('mousemove', ad)
    },
    _bind: function () {
      if (this._map._renderType === 'webgl') {
        return
      }
      var e = this
      this._map.on('maptypechange', function () {
        if (this.mapType === 'B_EARTH_MAP') {
          if (e._firstAnimation) {
            e._firstAnimation = false
            setTimeout(function () {
              e._div.style.opacity = '1'
              e._div.style.visibility = 'visible'
            }, 300)
          } else {
            e._div.style.opacity = '1'
            e._div.style.visibility = 'visible'
          }
        } else {
          e._div.style.opacity = '0'
          e._div.style.visibility = 'hidden'
        }
      })
    },
  })
  function hL(T, i) {
    this._map = T
    this._target = T
    var i8 = T.temp.originMapType || T.mapType
    if (i8 === 'B_EARTH_MAP' && T._earth) {
      this._target = T._earth
    }
    this._outContainer = i || T.getContainer()
    this._imgRatio = fz() >= gV.HIGH_RES_MIN_RATIO ? 2 : 1
    this._imgPath =
      w.imgPath +
      'earth-navi-control-pc4' +
      (this._imgRatio === 2 ? '-2x.png' : '.png')
    this._enabled = true
    var e = this
    this._setHeadingOptions = {
      callback: function () {
        e._target.setLock(false)
      },
    }
    this._init()
  }
  es.extend(hL.prototype, {
    _init: function () {
      this._createDom()
      this._render()
      this._bindDom()
      this._bind()
      this._updateUI()
      this._checkEnable()
    },
    _checkEnable: function () {
      if (this._target.getZoom() >= this._target._enableHeadingZoom) {
        this.enable()
      } else {
        this.disable()
      }
    },
    _createDom: function () {
      var i = (this._div = bK('div'))
      var e = i.style
      e.position = 'absolute'
      e.zIndex = 5
      e.top = '0'
      e.left = '0'
      e.width = '52px'
      e.height = '54px'
      e.background = 'url(' + this._imgPath + ') no-repeat'
      e.backgroundSize = '266px auto'
      this._rotateCCW = this._createButton()
      this._rotateCCW.title = '逆时针转动'
      e = this._rotateCCW.style
      e.left = '2px'
      e.top = '5px'
      e.zIndex = '1'
      e.width = '15px'
      e.height = '42px'
      e.backgroundPosition = '-75px -5px'
      this._rotateCW = this._createButton()
      this._rotateCW.title = '顺时针转动'
      e = this._rotateCW.style
      e.right = '2px'
      e.top = '5px'
      e.zIndex = '1'
      e.width = '15px'
      e.height = '42px'
      e.backgroundPosition = '-75px -5px'
      e.WebkitTransform = e.transform = 'scaleX(-1)'
      this._compass = this._createButton()
      this._compass.title = '恢复正北方向'
      e = this._compass.style
      e.left = '19px'
      e.top = '4px'
      e.width = '14px'
      e.height = '44px'
      e.backgroundPosition = '-56px -4px'
      e.WebkitTransform = e.transform = 'rotate(0deg)'
      this._div.appendChild(this._rotateCCW)
      this._div.appendChild(this._compass)
      this._div.appendChild(this._rotateCW)
      this._domRendered = true
    },
    _createButton: function () {
      var e = bK('button')
      var i = e.style
      i.position = 'absolute'
      i.outline = 'none'
      i.border = 'none'
      i.background = 'url(' + this._imgPath + ') no-repeat'
      i.backgroundSize = '266px auto'
      i.cursor = 'pointer'
      return e
    },
    _render: function () {
      this._outContainer.appendChild(this._div)
    },
    enable: function () {
      this._enabled = true
      if (this._domRendered) {
        this._rotateCCW.style.cursor = 'pointer'
        this._rotateCCW.style.opacity = 1
        this._rotateCW.style.cursor = 'pointer'
        this._rotateCW.style.opacity = 1
        this._compass.style.cursor = 'pointer'
        this._compass.style.opacity = 1
      }
    },
    disable: function () {
      this._enabled = false
      if (this._domRendered) {
        this._rotateCCW.style.cursor = ''
        this._rotateCCW.style.opacity = 0.4
        this._rotateCW.style.cursor = ''
        this._rotateCW.style.opacity = 0.4
        this._compass.style.cursor = ''
        this._compass.style.opacity = 0.4
      }
    },
    _bindDom: function () {
      hF(this._div, ['mousedown', 'click', 'dblclick'])
      var i = this._map
      var e = this
      this._rotateCW.addEventListener(
        'click',
        function () {
          if (e._isOperating || e._enabled === false) {
            return
          }
          if (e._target.getLock()) {
            return
          }
          if (e._target.getHeading() === 360) {
            e._target.setHeading(0)
          }
          e._target.setLock(true)
          e._target.setHeading(
            e._target.getHeading() + 90,
            e._setHeadingOptions
          )
          i.fire(new e7('onrotatecwclick'))
        },
        false
      )
      this._rotateCCW.addEventListener(
        'click',
        function () {
          if (e._isOperating || e._enabled === false) {
            return
          }
          if (e._target.getLock()) {
            return
          }
          if (e._target.getHeading() === -360) {
            e._target.setHeading(0)
          }
          e._target.setLock(true)
          e._target.setHeading(
            e._target.getHeading() - 90,
            e._setHeadingOptions
          )
          i.fire(new e7('onrotateccwclick'))
        },
        false
      )
      this._rotateCW.addEventListener(
        'mouseover',
        function () {
          if (e._enabled === false) {
            return
          }
          this.style.backgroundPosition = '-89px -5px'
        },
        false
      )
      this._rotateCW.addEventListener(
        'mouseout',
        function () {
          if (e._enabled === false) {
            return
          }
          this.style.backgroundPosition = '-75px -5px'
        },
        false
      )
      this._rotateCCW.addEventListener(
        'mouseover',
        function () {
          if (e._enabled === false) {
            return
          }
          this.style.backgroundPosition = '-89px -5px'
        },
        false
      )
      this._rotateCCW.addEventListener(
        'mouseout',
        function () {
          if (e._enabled === false) {
            return
          }
          this.style.backgroundPosition = '-75px -5px'
        },
        false
      )
      this._compass.addEventListener(
        'click',
        function () {
          if (e._isOperating || e._enabled === false) {
            return
          }
          if (e._target.getLock()) {
            return
          }
          e._target.setLock(true)
          var T = false
          if (e._target.getTilt() !== 0) {
            T = true
            e._target.setTilt(0, e._setHeadingOptions)
          }
          if (e._target.getHeading() % 360 !== 0) {
            T = true
            e._target.resetHeading(e._setHeadingOptions)
          }
          if (!T) {
            e._target.setLock(false)
          }
          i.fire(new e7('oncompassclick'))
        },
        false
      )
    },
    _bind: function () {
      var e = this
      this._bindTarget(this._target)
      if (this._map._renderType === 'webgl') {
        this._map.addEventListener('maptypechange', function (i) {
          if (this.mapType === 'B_EARTH_MAP') {
            e._target = e._map._earth
          } else {
            e._target = e._map
          }
          e._bindTarget(e._target)
          e._checkEnable()
        })
      }
    },
    _bindTarget: function (i) {
      if (i === this._map && this._mapBinded) {
        return
      }
      if (i === this._map._earth && this._earthBinded) {
        return
      }
      var e = this
      i.addEventListener('heading_changed', function (T) {
        e._updateUI()
      })
      i.addEventListener('animation_start', function (T) {
        e._isOperating = true
      })
      i.addEventListener('animation_end', function (T) {
        e._isOperating = false
      })
      i.on('load', function () {
        e._checkEnable()
      })
      i.on('zoom_changed', function () {
        e._checkEnable()
      })
      if (i === this._map) {
        this._mapBinded = true
      } else {
        this._earthBinded = true
      }
    },
    _updateUI: function () {
      var e = this._target.getHeading()
      var i = this._compass.style
      i.WebkitTransform = i.transform = 'rotate(' + e + 'deg)'
    },
    hide: function () {
      this._div.style.display = 'none'
    },
    show: function () {
      this._div.style.display = 'block'
    },
  })
  function cv(T, i) {
    this._map = T
    this._target = T
    var i8 = T.temp.originMapType || T.mapType
    if (i8 === 'B_EARTH_MAP' && T._earth) {
      this._target = T._earth
    }
    this._outContainer = i || T.getContainer()
    this._imgRatio = fz() >= gV.HIGH_RES_MIN_RATIO ? 2 : 1
    this._imgPath =
      w.imgPath +
      'gl-navi-control-pc4' +
      (this._imgRatio === 2 ? '-2x.png' : '.png')
    this._enabled = true
    var e = this
    this._setTiltOptions = {
      callback: function () {
        e._target.setLock(false)
      },
    }
    this._init()
  }
  es.extend(cv.prototype, {
    _init: function () {
      this._createDom()
      this._render()
      this._bindDom()
      this._bind()
      this._checkEnable()
    },
    _checkEnable: function () {
      if (this._target.getZoom() >= this._target._enableTiltZoom) {
        this.enable()
      } else {
        this.disable()
      }
    },
    _createDom: function () {
      var e = (this._div = bK('button'))
      e.title = '倾斜'
      var i = e.style
      i.position = 'absolute'
      i.zIndex = 5
      i.outline = 'none'
      i.border = 'none'
      i.cursor = 'pointer'
      i.width = '26px'
      i.height = '26px'
      i.top = '56px'
      i.right = '13px'
      i.background = 'url(' + this._imgPath + ') no-repeat #fff'
      i.backgroundSize = '266px auto'
      i.backgroundPosition = '-110px 1px'
      i.boxShadow = '1px 2px 1px rgba(0, 0, 0, 0.15)'
    },
    enable: function () {
      this._enabled = true
      if (this._div) {
        this._div.style.cursor = 'pointer'
      }
      this._updateUI()
    },
    disable: function () {
      this._enabled = false
      if (this._div) {
        this._div.style.cursor = ''
      }
      this._updateUI()
    },
    _render: function () {
      this._outContainer.appendChild(this._div)
    },
    _bindDom: function () {
      var e = this
      this._div.addEventListener(
        'mousedown',
        function (i8) {
          if (!e._enabled) {
            return
          }
          if (e._target.getLock()) {
            return
          }
          var i = e._target.getTilt()
          var T
          if (i === e._map.getCurrentMaxTilt()) {
            T = 'out'
          } else {
            if (i === 0) {
              T = 'in'
            } else {
              T = e._preTrend ? e._preTrend : 'in'
            }
          }
          e._curTrend = T
          e._clickTimer = setTimeout(function () {
            e._map.fire(new e7('ontiltmsdown'))
            e._tiltAni = new e0({
              duration: 9999999,
              render: function (i9) {
                i = e._target.getTilt()
                if (T === 'in' && i < e._map.getCurrentMaxTilt()) {
                  e._target.setTilt(i + 1, { noAnimation: true })
                } else {
                  if (T === 'out' && i > 0) {
                    e._target.setTilt(i - 1, { noAnimation: true })
                  }
                }
              },
              finish: function () {
                e._tiltAni = null
              },
            })
            e._clickTimer = null
          }, 200)
          i8.stopPropagation()
        },
        false
      )
      this._div.addEventListener(
        'mouseup',
        function (i) {
          if (!e._enabled) {
            return
          }
          if (e._tiltAni) {
            e._tiltAni.stop()
          }
          e._preTrend = e._curTrend
        },
        false
      )
      this._div.addEventListener(
        'click',
        function (i8) {
          if (!e._enabled) {
            return
          }
          if (!e._clickTimer) {
            return
          }
          if (e._target.getLock()) {
            return
          }
          clearTimeout(e._clickTimer)
          e._map.fire(new e7('ontiltclick'))
          var i = e._target.getTilt()
          e._target.setLock(true)
          i8.stopPropagation()
          var T = e._map.getCurrentMaxTilt()
          if (e._curTrend === 'in') {
            e._target.setTilt(T, e._setTiltOptions)
          } else {
            if (e._curTrend === 'out') {
              e._target.setTilt(0, e._setTiltOptions)
            } else {
              if (i < T) {
                e._target.setTilt(T, e._setTiltOptions)
              } else {
                e._target.setTilt(0, e._setTiltOptions)
              }
            }
          }
        },
        false
      )
      this._div.addEventListener(
        'mouseover',
        function (i) {
          if (!e._enabled) {
            return
          }
          e._mouseOver = true
          e._updateUI()
        },
        false
      )
      this._div.addEventListener(
        'mouseout',
        function (i) {
          if (!e._enabled) {
            return
          }
          e._mouseOver = false
          e._updateUI()
        },
        false
      )
      hF(this._div, ['mousedown', 'click', 'dblclick'])
    },
    _bind: function () {
      var e = this
      var i = this._map
      this._bindTarget(this._target)
      if (this._map._renderType === 'webgl') {
        this._map.addEventListener('maptypechange', function (T) {
          if (this.mapType === 'B_EARTH_MAP') {
            e._target = e._map._earth
          } else {
            e._target = e._map
          }
          e._bindTarget(e._target)
          e._checkEnable()
        })
      }
    },
    _bindTarget: function (i) {
      if (i === this._map && this._mapBinded) {
        return
      }
      if (i === this._map._earth && this._earthBinded) {
        return
      }
      var e = this
      i.on('load', function () {
        e._checkEnable()
      })
      i.on('zoom_changed', function () {
        e._checkEnable()
      })
      i.on('tilt_changed', function () {
        e._updateUI()
      })
      if (i === this._map) {
        this._mapBinded = true
      } else {
        this._earthBinded = true
      }
    },
    _updateUI: function () {
      var T = this._target.getTilt()
      var i = 0
      var i8 = 0
      var e = 0
      if (T > 0) {
        i = 78
      }
      if (this._mouseOver) {
        e = 52
      }
      if (this._enabled === false) {
        i8 = 26
        e = 0
        i = 0
      }
      var i9 = '-' + (110 + i + i8 + e) + 'px 1px'
      this._div && (this._div.style.backgroundPosition = i9)
      if (this._enabled) {
        if (T > 0) {
          this._div && (this._div.title = '恢复')
        } else {
          this._div && (this._div.title = '倾斜')
        }
      } else {
        this._div && (this._div.title = '请放大地图后操作')
      }
    },
    hide: function () {
      this._div.style.display = 'none'
    },
    show: function () {
      this._div.style.display = 'block'
    },
  })
  function gz(i) {
    cJ.call(this)
    this._opts = { container: null, cursor: 'default' }
    this._opts = es.extend(this._opts, i)
    this._type = 'contextmenu'
    this._map = null
    this._container
    this._left = 0
    this._top = 0
    this._items = []
    this._rItems = []
    this._dividers = []
    this._enable = true
    this.curPixel = null
    this.curPoint = null
    this._isOpen = false
    var e = this
    gi.load('menu', function () {
      e._draw()
    })
  }
  gz.inherits(cJ, 'ContextMenu')
  es.extend(gz.prototype, {
    initialize: function (e) {
      this._map = e
    },
    remove: function () {
      this._map = null
    },
    addItem: function (i9, e) {
      if (!i9 || i9._type != 'menuitem' || i9._text == '' || i9._width <= 0) {
        return
      }
      for (var i8 = 0, T = this._items.length; i8 < T; i8++) {
        if (this._items[i8] === i9) {
          return
        }
      }
      if (e === undefined || e > this._items.length - 1) {
        e = -1
      }
      i9._insertIndex = e
      if (e === -1) {
        this._items.push(i9)
        this._rItems.push(i9)
      } else {
        this._items.splice(e, 0, i9)
        this._rItems.splice(e, 0, i9)
      }
    },
    removeItem: function (i8) {
      if (!i8 || i8._type != 'menuitem') {
        return
      }
      for (var T = 0, e = this._items.length; T < e; T++) {
        if (this._items[T] === i8) {
          this._items[T].remove()
          this._items.splice(T, 1)
          delete i8._insertIndex
          e--
        }
      }
      for (var T = 0, e = this._rItems.length; T < e; T++) {
        if (this._rItems[T] === i8) {
          this._rItems[T].remove()
          this._rItems.splice(T, 1)
          delete i8._insertIndex
          e--
        }
      }
    },
    addSeparator: function (e) {
      if (e === undefined || e > this._items.length - 1) {
        e = -1
      }
      var i = {
        _type: 'divider',
        _dIndex: this._dividers.length,
        _insertIndex: e,
      }
      this._dividers.push({ dom: null })
      if (e === -1) {
        this._items.push(i)
      } else {
        this._items.splice(e, 0, i)
      }
    },
    removeSeparator: function (T) {
      if (!this._dividers[T]) {
        return
      }
      for (var i8 = 0, e = this._items.length; i8 < e; i8++) {
        if (
          this._items[i8] &&
          this._items[i8]._type == 'divider' &&
          this._items[i8]._dIndex == T
        ) {
          this._items.splice(i8, 1)
          e--
        }
        if (
          this._items[i8] &&
          this._items[i8]._type == 'divider' &&
          this._items[i8]._dIndex > T
        ) {
          this._items[i8]._dIndex--
        }
      }
      this._dividers.splice(T, 1)
    },
    getDom: function () {
      return this._container
    },
    show: function () {
      if (this._isOpen == true) {
        return
      }
      this._isOpen = true
    },
    hide: function () {
      if (this._isOpen == false) {
        return
      }
      this._isOpen = false
    },
    setCursor: function (e) {
      if (!e) {
        return
      }
      this._opts.cursor = e
    },
    getItem: function (e) {
      return this._rItems[e]
    },
    enable: function () {
      this._enable = true
    },
    disable: function () {
      this._enable = false
    },
  })
  function g8(T, i8, i) {
    if (!T || !i8 || typeof i8 != 'function') {
      return
    }
    cJ.call(this)
    this._opts = { width: 100, id: '' }
    i = i || {}
    this._opts.width = i.width * 1 ? i.width : 100
    this._opts.id = i.id ? i.id : ''
    this._text = T + ''
    this._callback = i8
    this._map = null
    this._type = 'menuitem'
    this._contextmenu = null
    this._container = null
    this._enabled = true
    var e = this
    gi.load('menu', function () {
      e._draw()
    })
  }
  g8.inherits(cJ, 'MenuItem')
  es.extend(g8.prototype, {
    initialize: function (e, i) {
      this._map = e
      this._contextmenu = i
    },
    remove: function () {
      this._contextmenu = null
      this._map = null
    },
    setText: function (e) {
      if (!e) {
        return
      }
      this._text = e + ''
    },
    getDom: function () {
      return this._container
    },
    enable: function () {
      this._enabled = true
    },
    disable: function () {
      this._enabled = false
    },
  })
  function ha(e, i) {
    this.setSouthWest(e)
    this.setNorthEast(i)
  }
  es.extend(ha.prototype, {
    isEmpty: function () {
      return this.sw === null && this.ne === null
    },
    equals: function (e) {
      if (!e || e.isEmpty() || this.isEmpty()) {
        return false
      }
      return this.sw.equals(e.sw) && this.ne.equals(e.ne)
    },
    containsBounds: function (e) {
      if (!e || e.isEmpty() || this.isEmpty()) {
        return false
      }
      return (
        e.sw.lng > this.sw.lng &&
        e.ne.lng < this.ne.lng &&
        e.sw.lat > this.sw.lat &&
        e.ne.lat < this.ne.lat
      )
    },
    getCenter: function () {
      if (this.isEmpty()) {
        return null
      }
      return new cd(
        (this.sw.lng + this.ne.lng) / 2,
        (this.sw.lat + this.ne.lat) / 2
      )
    },
    intersects: function (T) {
      if (!T || T.isEmpty() || this.isEmpty()) {
        return null
      }
      if (
        Math.max(T.sw.lng, T.ne.lng) < Math.min(this.sw.lng, this.ne.lng) ||
        Math.min(T.sw.lng, T.ne.lng) > Math.max(this.sw.lng, this.ne.lng) ||
        Math.max(T.sw.lat, T.ne.lat) < Math.min(this.sw.lat, this.ne.lat) ||
        Math.min(T.sw.lat, T.ne.lat) > Math.max(this.sw.lat, this.ne.lat)
      ) {
        return null
      }
      var i9 = Math.max(this.sw.lng, T.sw.lng)
      var i = Math.min(this.ne.lng, T.ne.lng)
      var i8 = Math.max(this.sw.lat, T.sw.lat)
      var e = Math.min(this.ne.lat, T.ne.lat)
      return new ha(new cd(i9, i8), new cd(i, e))
    },
    setMinMax: function () {
      this.minX = this.sw ? this.sw.lng : null
      this.minY = this.sw ? this.sw.lat : null
      this.maxX = this.ne ? this.ne.lng : null
      this.maxY = this.ne ? this.ne.lat : null
    },
    containsPoint: function (e) {
      if (!e) {
        return
      }
      return (
        e.lng >= this.sw.lng &&
        e.lng <= this.ne.lng &&
        e.lat >= this.sw.lat &&
        e.lat <= this.ne.lat
      )
    },
    extend: function (e) {
      if (!e) {
        return
      }
      var i = e.lng
      var T = e.lat
      if (!this.sw) {
        this.sw = e.clone()
      }
      if (!this.ne) {
        this.ne = e.clone()
      }
      if (this.sw.lng > i) {
        this.sw.lng = i
      }
      if (this.ne.lng < i) {
        this.ne.lng = i
      }
      if (this.sw.lat > T) {
        this.sw.lat = T
      }
      if (this.ne.lat < T) {
        this.ne.lat = T
      }
    },
    getMin: function () {
      return this.sw
    },
    getMax: function () {
      return this.ne
    },
    getSouthWest: function () {
      return this.sw
    },
    getNorthEast: function () {
      return this.ne
    },
    setSouthWest: function (e) {
      this.sw = e ? e.clone() : null
    },
    setNorthEast: function (e) {
      this.ne = e ? e.clone() : null
    },
    clone: function () {
      return new ha(this.sw, this.ne)
    },
    toSpan: function () {
      if (this.isEmpty()) {
        return new h3(0, 0)
      }
      return new h3(
        Math.abs(this.ne.lng - this.sw.lng),
        Math.abs(this.ne.lat - this.sw.lat)
      )
    },
    div: function (e) {
      if (!e || e.isEmpty() || this.isEmpty()) {
        return 0
      }
      return (
        ((this.ne.lng - this.sw.lng) * (this.ne.lat - this.sw.lat)) /
        ((e.ne.lng - e.sw.lng) * (e.ne.lat - e.sw.lat))
      )
    },
    makeNormalizedPoint: function (e) {
      this.normalizedTopLeft = this.pointTopLeft.clone()
      this.normalizedTopRight = this.pointTopRight.clone()
      this.normalizedBottomRight = this.pointBottomRight.clone()
      this.normalizedBottomLeft = this.pointBottomLeft.clone()
      while (e < 0) {
        e += 360
      }
      e = e % 360
      if ((e >= 0 && e < 90) || (e >= 270 && e < 360)) {
        if (this.normalizedTopRight.lng < this.normalizedTopLeft.lng) {
          this.normalizedTopRight.lng += gV.WORLD_SIZE_MC
        }
        if (this.normalizedBottomRight.lng < this.normalizedBottomLeft.lng) {
          this.normalizedBottomRight.lng += gV.WORLD_SIZE_MC
        }
      } else {
        if (this.normalizedTopLeft.lng < this.normalizedTopRight.lng) {
          this.normalizedTopLeft.lng += gV.WORLD_SIZE_MC
        }
        if (this.normalizedBottomLeft.lng < this.normalizedBottomRight.lng) {
          this.normalizedBottomLeft.lng += gV.WORLD_SIZE_MC
        }
      }
    },
    toString: function () {
      return 'Bounds'
    },
  })
  function cd(e, i) {
    if (isNaN(e)) {
      e = cV(e)
      e = isNaN(e) ? 0 : e
    }
    if (typeof e === 'string') {
      e = parseFloat(e)
    }
    if (isNaN(i)) {
      i = cV(i)
      i = isNaN(i) ? 0 : i
    }
    if (typeof i === 'string') {
      i = parseFloat(i)
    }
    this.lng = e
    this.lat = i
  }
  cd.prototype.equals = function (i) {
    if (!i) {
      return false
    }
    var i8 = Math.abs(this.lat - i.lat)
    var T = Math.abs(this.lng - i.lng)
    var e = 1e-8
    if (i8 < e && T < e) {
      return true
    }
    return false
  }
  cd.prototype.clone = function () {
    return new cd(this.lng, this.lat)
  }
  cd.prototype.add = function (e) {
    return new cd(this.lng + e.lng, this.lat + e.lat)
  }
  cd.prototype.sub = function (e) {
    return new cd(this.lng - e.lng, this.lat - e.lat)
  }
  cd.prototype.mult = function (e) {
    return new cd(this.lng * e, this.lat * e)
  }
  cd.prototype.div = function (e) {
    return new cd(this.lng / e, this.lat / e)
  }
  cd.prototype.mag = function () {
    return Math.sqrt(this.lng * this.lng + this.lat * this.lat)
  }
  cd.prototype.toString = function () {
    return 'Point'
  }
  function ia() {}
  es.extend(ia, {
    EARTHRADIUS: 6370996.81,
    MCBAND: [12890594.86, 8362377.87, 5591021, 3481989.83, 1678043.12, 0],
    LLBAND: [86, 60, 45, 30, 15, 0],
    MC2LL: [
      [
        1.410526172116255e-8, 0.00000898305509648872, -1.9939833816331,
        200.9824383106796, -187.2403703815547, 91.6087516669843,
        -23.38765649603339, 2.57121317296198, -0.03801003308653, 17337981.2,
      ],
      [
        -7.435856389565537e-9, 0.000008983055097726239, -0.78625201886289,
        96.32687599759846, -1.85204757529826, -59.36935905485877,
        47.40033549296737, -16.50741931063887, 2.28786674699375, 10260144.86,
      ],
      [
        -3.030883460898826e-8, 0.00000898305509983578, 0.30071316287616,
        59.74293618442277, 7.357984074871, -25.38371002664745,
        13.45380521110908, -3.29883767235584, 0.32710905363475, 6856817.37,
      ],
      [
        -1.981981304930552e-8, 0.000008983055099779535, 0.03278182852591,
        40.31678527705744, 0.65659298677277, -4.44255534477492,
        0.85341911805263, 0.12923347998204, -0.04625736007561, 4482777.06,
      ],
      [
        3.09191371068437e-9, 0.000008983055096812155, 0.00006995724062,
        23.10934304144901, -0.00023663490511, -0.6321817810242,
        -0.00663494467273, 0.03430082397953, -0.00466043876332, 2555164.4,
      ],
      [
        2.890871144776878e-9, 0.000008983055095805407, -3.068298e-8,
        7.47137025468032, -0.00000353937994, -0.02145144861037,
        -0.00001234426596, 0.00010322952773, -0.00000323890364, 826088.5,
      ],
    ],
    LL2MC: [
      [
        -0.0015702102444, 111320.7020616939, 1704480524535203,
        -10338987376042340, 26112667856603880, -35149669176653700,
        26595700718403920, -10725012454188240, 1800819912950474, 82.5,
      ],
      [
        0.0008277824516172526, 111320.7020463578, 647795574.6671607,
        -4082003173.641316, 10774905663.51142, -15171875531.51559,
        12053065338.62167, -5124939663.577472, 913311935.9512032, 67.5,
      ],
      [
        0.00337398766765, 111320.7020202162, 4481351.045890365,
        -23393751.19931662, 79682215.47186455, -115964993.2797253,
        97236711.15602145, -43661946.33752821, 8477230.501135234, 52.5,
      ],
      [
        0.00220636496208, 111320.7020209128, 51751.86112841131,
        3796837.749470245, 992013.7397791013, -1221952.21711287,
        1340652.697009075, -620943.6990984312, 144416.9293806241, 37.5,
      ],
      [
        -0.0003441963504368392, 111320.7020576856, 278.2353980772752,
        2485758.690035394, 6070.750963243378, 54821.18345352118,
        9540.606633304236, -2710.55326746645, 1405.483844121726, 22.5,
      ],
      [
        -0.0003218135878613132, 111320.7020701615, 0.00369383431289,
        823725.6402795718, 0.46104986909093, 2351.343141331292,
        1.58060784298199, 8.77738589078284, 0.37238884252424, 7.45,
      ],
    ],
    getDistanceByMC: function (ja, i8) {
      if (!ja || !i8) {
        return 0
      }
      var i
      var i9
      var e
      var T
      ja = this.convertMC2LL(ja)
      if (!ja) {
        return 0
      }
      i = hH(ja.lng)
      i9 = hH(ja.lat)
      i8 = this.convertMC2LL(i8)
      if (!i8) {
        return 0
      }
      e = hH(i8.lng)
      T = hH(i8.lat)
      return this.getDistance(i, e, i9, T)
    },
    getDistanceByLL: function (ja, i8) {
      if (!ja || !i8) {
        return 0
      }
      ja.lng = this.getLoop(ja.lng, -180, 180)
      ja.lat = this.getRange(ja.lat, -80, 84)
      i8.lng = this.getLoop(i8.lng, -180, 180)
      i8.lat = this.getRange(i8.lat, -80, 84)
      var i
      var e
      var i9
      var T
      i = hH(ja.lng)
      i9 = hH(ja.lat)
      e = hH(i8.lng)
      T = hH(i8.lat)
      return this.getDistance(i, e, i9, T)
    },
    proximityCovertMC2LL: function (e) {
      if (e === null) {
        return e
      }
      if (e.lng < 180 && e.lng > -180 && e.lat < 90 && e.lat > -90) {
        return e
      }
      return this.convertMC2LL(e)
    },
    convertMC2LL: function (e) {
      if (e === null) {
        return e
      }
      if (!e) {
        return new cd(0, 0)
      }
      var T
      var i9
      T = new cd(Math.abs(e.lng), Math.abs(e.lat))
      for (var i8 = 0; i8 < this.MCBAND.length; i8++) {
        if (T.lat >= this.MCBAND[i8]) {
          i9 = this.MC2LL[i8]
          break
        }
      }
      var ja = this.convertor(e, i9)
      return new b8(ja.lat, ja.lng)
    },
    convertLL2MC: function (jb) {
      if (!jb) {
        return new cd(0, 0)
      }
      var jd = jb.lat
      var i8 = jb.lng
      i8 = this.getLoop(jb.lng, -180, 180)
      jd = bV(jd, -85, 85)
      var ja
      for (var i9 = 0; i9 < this.LLBAND.length; i9++) {
        if (jd >= this.LLBAND[i9]) {
          ja = this.LL2MC[i9]
          break
        }
      }
      if (!ja) {
        for (i9 = 0; i9 < this.LLBAND.length; i9++) {
          if (jd <= -this.LLBAND[i9]) {
            ja = this.LL2MC[i9]
            break
          }
        }
      }
      var T = new cd(i8, jd)
      var jc = this.convertor(T, ja)
      var e = new cd(jc.lng, jc.lat)
      e.latLng = new b8(jb.lat, jb.lng)
      return e
    },
    convertor: function (T, i8) {
      if (!T || !i8) {
        return
      }
      var e = i8[0] + i8[1] * Math.abs(T.lng)
      var i = Math.abs(T.lat) / i8[9]
      var i9 =
        i8[2] +
        i8[3] * i +
        i8[4] * i * i +
        i8[5] * i * i * i +
        i8[6] * i * i * i * i +
        i8[7] * i * i * i * i * i +
        i8[8] * i * i * i * i * i * i
      e *= T.lng < 0 ? -1 : 1
      i9 *= T.lat < 0 ? -1 : 1
      return new cd(e, i9)
    },
    getDistance: function (i, e, i8, T) {
      return (
        this.EARTHRADIUS *
        Math.acos(
          Math.sin(i8) * Math.sin(T) +
            Math.cos(i8) * Math.cos(T) * Math.cos(e - i)
        )
      )
    },
    getRange: function (T, i, e) {
      if (i != null) {
        T = Math.max(T, i)
      }
      if (e != null) {
        T = Math.min(T, e)
      }
      return T
    },
    getLoop: function (T, i, e) {
      while (T > e) {
        T -= e - i
      }
      while (T < i) {
        T += e - i
      }
      return T
    },
  })
  es.extend(ia.prototype, {
    lnglatToMercator: function (e) {
      return ia.convertLL2MC(e)
    },
    lngLatToPoint: function (e) {
      var i = ia.convertLL2MC(e)
      return new eL(i.lng, i.lat)
    },
    mercatorToLnglat: function (e) {
      return ia.convertMC2LL(e)
    },
    pointToLngLat: function (i) {
      var e = new cd(i.x, i.y)
      var T = ia.convertMC2LL(e)
      return new b8(T.lat, T.lng)
    },
    pointToPixel: function (i, ja, i9, i8) {
      if (!i) {
        return
      }
      i = this.lnglatToMercator(i)
      var T = this.getZoomUnits(ja)
      var e = Math.round((i.lng - i9.lng) / T + i8.width / 2)
      var jb = Math.round((i9.lat - i.lat) / T + i8.height / 2)
      return new eL(e, jb)
    },
    mercatorToPixel: function (ja, i9, i8, T) {
      if (!ja) {
        return
      }
      var i = this.getZoomUnits(i9)
      var e = Math.round((ja.lng - i8.lng) / i + T.width / 2)
      var jb = Math.round((i8.lat - ja.lat) / i + T.height / 2)
      return new eL(e, jb)
    },
    pixelToPoint: function (i8, jb, ja, i9) {
      if (!i8) {
        return
      }
      var i = this.getZoomUnits(jb)
      var T = ja.lng + i * (i8.x - i9.width / 2)
      var jc = ja.lat - i * (i8.y - i9.height / 2)
      var e = new cd(T, jc)
      return this.mercatorToLnglat(e)
    },
    tileToBound: function (i8, jc) {
      var i = i8.col
      var jf = i8.row
      var je = i8.baseTileSize
      var jd = this.getZoomUnits(i8.zoom)
      var T = { x: Math.round(jc.lng / jd), y: Math.round(jc.lat / jd) }
      var ja = {
        lbx: i * je,
        lby: jf * je,
        rtx: (i + 1) * je,
        rty: (jf + 1) * je,
      }
      var e = {
        lbx: jc.lng + (ja.lbx - T.x) * jd,
        lby: jc.lat + (ja.lby - T.y) * jd,
        rtx: jc.lng + (ja.rtx - T.x) * jd,
        rty: jc.lat + (ja.rty - T.y) * jd,
      }
      var i9 = ia.convertMC2LL(new cd(e.lbx, e.lby))
      var jb = ia.convertMC2LL(new cd(e.rtx, e.rty))
      return {
        MC: new ha(new cd(e.lbx, e.lby), new cd(e.rtx, e.rty)),
        LL: new ha(i9, jb),
      }
    },
    getZoomUnits: function (e) {
      return Math.pow(2, 18 - e)
    },
    setCoordType: function (e) {
      this.coordsType = e
    },
  })
  function da() {}
  es.extend(da, {
    RADIUS: 6378137,
    EXTENT4326: [-180, -90, 180, 90],
    WORLD_EXTENT: [-180, -85, 180, 85],
    HALF_SIZE: 20037508.342789244,
    METERS_PER_UNIT: 111319.49079327358,
    EXTENT3857: [
      -20037508.342789244, -20037508.342789244, 20037508.342789244,
      20037508.342789244,
    ],
    MAX_SAFE_Y: 238107693.26496765,
    origin: [-20037508.342789244, 20037508.342789244],
    size: 156543.03392804097,
    gridSize: [256, 256],
    resolutions: [
      156543.03392804097, 78271.51696402048, 39135.75848201024,
      19567.87924100512, 9783.93962050256, 4891.96981025128, 2445.98490512564,
      1222.99245256282, 611.49622628141, 305.748113140705, 152.8740565703525,
      76.43702828517625, 38.21851414258813, 19.109257071294063,
      9.554628535647032, 4.777314267823516, 2.388657133911758,
      1.194328566955879, 0.5971642834779395, 0.29858214173896974,
      0.14929107086948487, 0.07464553543474244, 0.03732276771737122,
    ],
    calcResolutions: function (i) {
      this.resolutions = []
      for (var e = 0; e < i; ++e) {
        this.resolutions.push(this.size / Math.pow(2, e))
      }
      return this.resolutions
    },
    forEachTileCoord: function (je, jd, T, jb) {
      var e = this.getTileRangeForExtentFactory(je, jd, T)
      for (var i9 = e.minX, jc = e.maxX; i9 <= jc; ++i9) {
        for (var i8 = e.minY, ja = e.maxY; i8 <= ja; ++i8) {
          jb([jd, i9, i8])
        }
      }
    },
    getTileRangeForExtentFactory: function (T, i9, i, i8) {
      var e
      switch (i.source) {
        case 'BD09MC':
          e = this.getBDTileRangeForExtentAndZ(T, i9, i8)
          break
        case 'EPSG3857':
          e = this.getTileRangeForExtentAndZ(T, i9, i8)
          break
        default:
          e = this.getTileRangeForExtentAndZ(T, i9, i8)
          break
      }
      return e
    },
    getBDTileRangeForExtentAndZ: function (T, i9, i8) {
      var i = [0, 0, 0]
      this.getBDTileCoordForXYAndZ_(T[0], T[1], i9, false, i)
      var e = i[1]
      var ja = i[2]
      this.getBDTileCoordForXYAndZ_(T[2], T[3], i9, true, i)
      return this.createOrUpdateTileRange(e, i[1], ja, i[2], i8)
    },
    getTileRangeForExtentAndZ: function (T, i9, i8) {
      var i = [0, 0, 0]
      this.getTileCoordForXYAndZ_(T[0], T[3], i9, false, i)
      var e = i[1]
      var ja = i[2]
      this.getTileCoordForXYAndZ_(T[2], T[1], i9, true, i)
      return this.createOrUpdateTileRange(e, i[1], ja, i[2], i8)
    },
    getBDTileCoordForXYAndZ_: function (e, jc, ja, i9, i8) {
      var jb = 256 * Math.pow(2, 18 - ja)
      var T = e / jb
      var i = jc / jb
      if (i9) {
        T = Math.ceil(T) - 1
        i = Math.ceil(i) - 1
      } else {
        T = Math.floor(T)
        i = Math.floor(i)
      }
      return this.createOrUpdateTileCoord(ja, T, i, i8)
    },
    getTileCoordForXYAndZ_: function (jf, je, jc, jd, e) {
      var jg = this.origin
      var i =
        this.resolutions.length === 0
          ? this.calcResolutions(21)[jc]
          : this.resolutions[jc]
      var ji = this.gridSize
      var i8 = jd ? 0.5 : 0
      var T = jd ? 0.5 : 0
      var jh = Math.floor((jf - jg[0]) / i + i8)
      var ja = Math.floor((jg[1] - je) / i + T)
      var jb = jh / ji[0]
      var i9 = ja / ji[1]
      if (jd) {
        jb = Math.ceil(jb) - 1
        i9 = Math.ceil(i9) - 1
      } else {
        jb = Math.floor(jb)
        i9 = Math.floor(i9)
      }
      return this.createOrUpdateTileCoord(jc, jb, i9, e)
    },
    getTileCoordForCoordAndZ: function (T, i, e) {
      return this.getTileCoordForXYAndZ_(T[0], T[1], i, false, e)
    },
    getTileRangeExtent: function (T, jb) {
      var jc = this.origin
      if (this.resolutions.length === 0) {
        this.calcResolutions(23)
      }
      var i9 = this.resolutions[T[0]]
      var jd = this.gridSize
      var ja = jc[0] + T[1] * jd[0] * i9
      var i8 = jc[1] - (T[2] + 1) * jd[1] * i9
      var i = ja + jd[0] * i9
      var e = i8 + jd[1] * i9
      return this.createOrUpdateTileRange(ja, i, i8, e, jb)
    },
    getRangeExtent: function (i, jg, jc, ji, i8) {
      var jd = this.calPiexlResolution(ji, i8)
      var jb = (jg / 2) * jd
      var je = (jc / 2) * jd
      var ja = i[0] - jb
      var T = i[0] + jb
      var i9 = i[1] - je
      var e = i[1] + je
      var jf = gcoord.transform([ja, i9], gcoord[i8.target], gcoord[i8.source])
      var jh = gcoord.transform([T, e], gcoord[i8.target], gcoord[i8.source])
      return this.createOrUpdateTileRange(jf[0], jh[0], jf[1], jh[1])
    },
    getMousePoint: function (jb, ja, i, i9, T) {
      var i8 = i4(jb, ja)
      return this.calLngLatByMapViewPixelInverse(
        i8.clientPos,
        i,
        ja.width,
        ja.height,
        i9,
        T
      )
    },
    calLngLatByMapViewPixelInverse: function (i8, e, i, jf, jg, T) {
      var jb = this.calPiexlResolution(jg, T)
      var ja = i8.x - i / 2
      var i9 = i8.y - jf / 2
      var jd = e[0] + ja * jb
      var jc = e[1] - i9 * jb
      var je = gcoord.transform([jd, jc], gcoord[T.target], gcoord[T.source])
      return je
    },
    calPiexlResolution: function (T, i) {
      var e
      switch (i.target) {
        case 'BD09MC':
          e = Math.pow(2, 18 - T)
          break
        case 'EPSG3857':
          e = this.resolutions[Math.floor(T)]
          break
        default:
          e = Math.pow(2, 18 - T)
          break
      }
      return e
    },
    getXYZCellPixelCoor: function (jb, i9, i8, i) {
      var jd = this.gridSize
      var jc
      var ja
      switch (i.source) {
        case 'EPSG3857':
          var T = Math.pow(2, i8 - 1) - (i9 + 1)
          var e = jb - Math.pow(2, i8 - 1)
          jc = e * jd[0]
          ja = T * jd[1]
          break
        case 'BD09MC':
          jc = jb * jd[0]
          ja = i9 * jd[1]
        default:
          break
      }
      return { x: jc, y: ja }
    },
    getBaiduCellPixelCoor: function (e, i8, T) {
      var i = 256
      return { x: e * i, y: i8 * i }
    },
    getPointPixelCoor: function (e, jd, i) {
      var jb
      var ja
      var T = Math.pow(2, 18 - jd)
      var i8 = this.resolutions[Math.floor(jd)]
      var i9 = ia.convertMC2LL(e)
      switch (i.source) {
        case 'EPSG3857':
          var jc = gcoord.transform(
            [i9.lng, i9.lat],
            gcoord.BD09LL,
            gcoord.EPSG3857
          )
          jb = jc[0] / i8
          ja = jc[1] / i8
          break
        case 'BD09MC':
          jb = e.lng / T
          ja = e.lat / T
        default:
          break
      }
      return [jb, ja]
    },
    getResolutionScale: function (i8, T) {
      var i9
      var i = this.resolutions[Math.floor(i8)]
      var e = Math.pow(2, 18 - i8)
      switch (T.target) {
        case 'BD09MC':
          i9 = i / e
          break
        case 'EPSG3857':
          i9 = e / i
          break
        default:
          i9 = i / e
          break
      }
      return i9
    },
    getBaiduResolutionScale: function (T) {
      var i = this.resolutions[Math.floor(T)]
      var e = Math.pow(2, 18 - T)
      var i8 = e / i
      return i8
    },
    getTileCoordCenter: function (T) {
      var e = this.origin
      if (this.resolutions.length === 0) {
        this.calcResolutions(23)
      }
      var i = this.resolutions[T[0]]
      var i8 = this.gridSize
      return [e[0] + (T[1] + 0.5) * i8[0] * i, e[1] - (T[2] + 0.5) * i8[1] * i]
    },
    transformBDmcPoint: function (i8, e) {
      e = e || 'EPSG3857'
      var i = ia.convertMC2LL(new cd(i8.lng, i8.lat))
      var T = gcoord.transform([i.lng, i.lat], gcoord.BD09LL, gcoord[e])
      return T
    },
    getTilesLoop: function (T, e) {
      var i = Math.pow(2, T)
      while (e > i - 1) {
        e = e - i
      }
      while (e < 0) {
        e = e + i
      }
      return e
    },
    getLoopBox: function (e, i8) {
      var i = this.HALF_SIZE * 2
      if (e[0] > 0 && i8[2] < 0) {
        i8[2] = i8[2] + i
      } else {
        if (e[0] < 0 && i8[0] > 0) {
          i8[0] = i8[0] - i
        }
      }
      return i8
    },
    createOrUpdateTileCoord: function (T, e, i8, i) {
      if (i !== undefined) {
        i[0] = T
        i[1] = e
        i[2] = i8
        return i
      } else {
        return [T, e, i8]
      }
    },
    createOrUpdateTileRange: function (e, i8, i9, T, i) {
      if (i !== undefined) {
        i.minX = e
        i.maxX = i8
        i.minY = i9
        i.maxY = T
        return i
      } else {
        return { minX: e, maxX: i8, minY: i9, maxY: T }
      }
    },
    fromEPSG4326: function (T, jd, jb) {
      var i9 = T.length
      var ja = jb > 1 ? jb : 2
      var e = jd
      if (e === undefined) {
        if (ja > 2) {
          e = T.slice()
        } else {
          e = new Array(i9)
        }
      }
      for (var i8 = 0; i8 < i9; i8 += ja) {
        e[i8] = (this.HALF_SIZE * T[i8]) / 180
        var jc =
          this.RADIUS * Math.log(Math.tan((Math.PI * (+T[i8 + 1] + 90)) / 360))
        if (jc > this.MAX_SAFE_Y) {
          jc = this.MAX_SAFE_Y
        } else {
          if (jc < -this.MAX_SAFE_Y) {
            jc = -this.MAX_SAFE_Y
          }
        }
        e[i8 + 1] = jc
      }
      return e
    },
    toEPSG4326: function (T, jc, jb) {
      var i9 = T.length
      var ja = jb > 1 ? jb : 2
      var e = jc
      if (e === undefined) {
        if (ja > 2) {
          e = T.slice()
        } else {
          e = new Array(i9)
        }
      }
      for (var i8 = 0; i8 < i9; i8 += ja) {
        e[i8] = (180 * T[i8]) / this.HALF_SIZE
        e[i8 + 1] =
          (360 * Math.atan(Math.exp(T[i8 + 1] / this.RADIUS))) / Math.PI - 90
      }
      return e
    },
    findParentGridAndPosition: function (i8, ji, jh, jc, jd, jf, jb) {
      if (jh - 1 < 0) {
        return false
      }
      var jj = i8
      var je = ji
      var T = jh
      for (var ja = 1; ja <= jb; ja++) {
        var e = this.findParent(jj, je, T, ja)
        if (!e) {
          return false
        }
        var jg = this.getTileKey(e)
        var i9 = jc.getData(jg)
        if (i9 && i9.status === 'ready') {
          if (jd[jg]) {
            continue
          }
          jf.setData(i9, this.drawIndex, 0)
          jd[jg] = true
          return true
        }
        jj = e.col
        je = e.row
        T = e.zoom
      }
    },
    findParent: function (i, i9, T, i8) {
      if (T - 1 < 0) {
        return null
      }
      var e = i % 2
      var ja = i9 % 2
      return {
        col: Math.floor(i / 2),
        row: Math.floor(i9 / 2),
        sonX: e,
        sonY: ja,
        thumbLB: [e * 0.5, 1 - ja * 0.5 - 0.5],
        thumbRT: [e * 0.5 + 0.5, 1 - ja * 0.5],
        radio: Math.pow(2, i8),
        zoom: T - 1,
        useZoom: T - 1,
      }
    },
    getTileKey: function (e, i8) {
      i8 = i8 || {}
      var i = typeof i8.useZoom === 'number' ? i8.useZoom : e.useZoom
      var T = e.style || this.mapStyleId || 'default'
      return (
        this.mapType +
        '_' +
        T +
        '_' +
        e.col +
        '_' +
        e.row +
        '_' +
        e.zoom +
        '_' +
        i
      )
    },
    lon2tile: function (i, e) {
      return Math.floor(((i + 180) / 360) * Math.pow(2, e))
    },
    lat2tile: function (T, i) {
      var e = Math.tan((T * Math.PI) / 180) + 1 / Math.cos((T * Math.PI) / 180)
      return Math.floor(((1 - Math.log(e) / Math.PI) / 2) * Math.pow(2, i))
    },
    tile2long: function (e, i) {
      return (e / Math.pow(2, i)) * 360 - 180
    },
    tile2lat: function (T, e) {
      var i = Math.PI - (2 * Math.PI * T) / Math.pow(2, e)
      return (180 / Math.PI) * Math.atan(0.5 * (Math.exp(i) - Math.exp(-i)))
    },
  })
  function b8(i, e) {
    if (i < -90) {
      i = -90
    } else {
      if (i > 90) {
        i = 90
      }
    }
    while (e < -180) {
      e += 360
    }
    while (e > 180) {
      e -= 360
    }
    e = e || 0
    i = i || 0
    cd.call(this, e, i)
  }
  b8.inherits(cd, 'LatLng')
  es.extend(b8.prototype, {
    equals: function (e) {
      return this.lat === e.lat && this.lng === e.lng
    },
    clone: function () {
      return new b8(this.lat, this.lng)
    },
    add: function (e) {
      return new b8(this.lng + e.lng, this.lat + e.lat)
    },
    sub: function (e) {
      return new b8(this.lat - e.lat, this.lng - e.lng)
    },
    mult: function (e) {
      return new b8(this.lng * e, this.lat * e)
    },
    div: function (e) {
      return new b8(this.lng / e, this.lat / e)
    },
    mag: function () {
      return Math.sqrt(this.lng * this.lng + this.lat * this.lat)
    },
    getLngSpan: function (e) {
      var i = this.lng
      var T = Math.abs(e - i)
      if (T > 180) {
        T = 360 - T
      }
      return T
    },
    toString: function () {
      return 'LatLng'
    },
  })
  function ck(e, i) {
    if (e && !i) {
      i = e
    }
    this._sw = this._ne = null
    this._swLng = this._swLat = null
    this._neLng = this._neLat = null
    if (e) {
      this._sw = new b8(e.lat, e.lng)
      this._ne = new b8(i.lat, i.lng)
      this._swLng = e.lng
      this._swLat = e.lat
      this._neLng = i.lng
      this._neLat = i.lat
    }
  }
  es.extend(ck.prototype, {
    isEmpty: function () {
      return !this._sw || !this._ne
    },
    equals: function (e) {
      if (this.isEmpty()) {
        return false
      }
      return (
        this.getSouthWest().equals(e.getSouthWest()) &&
        this.getNorthEast().equals(e.getNorthEast())
      )
    },
    getSouthWest: function () {
      return this._sw
    },
    getNorthEast: function () {
      return this._ne
    },
    containsBounds: function (e) {
      if (this.isEmpty() || e.isEmpty()) {
        return false
      }
      return (
        e._swLng > this._swLng &&
        e._neLng < this._neLng &&
        e._swLat > this._swLat &&
        e._neLat < this._neLat
      )
    },
    getCenter: function () {
      if (this.isEmpty()) {
        return null
      }
      return new b8(
        (this._swLat + this._neLat) / 2,
        (this._swLng + this._neLng) / 2
      )
    },
    intersects: function (T) {
      if (
        Math.max(T._swLng, T._neLng) < Math.min(this._swLng, this._neLng) ||
        Math.min(T._swLng, T._neLng) > Math.max(this._swLng, this._neLng) ||
        Math.max(T._swLat, T._neLat) < Math.min(this._swLat, this._neLat) ||
        Math.min(T._swLat, T._neLat) > Math.max(this._swLat, this._neLat)
      ) {
        return false
      }
      var i9 = Math.max(this._swLng, T._swLng)
      var i = Math.min(this._neLng, T._neLng)
      var i8 = Math.max(this._swLat, T._swLat)
      var e = Math.min(this._neLat, T._neLat)
      this._sw = new b8(i8, i9)
      this._ne = new b8(e, i)
      this._swLng = i9
      this._swLat = i8
      this._neLng = i
      this._neLat = e
      return true
    },
    containsPoint: function (e) {
      if (this.isEmpty()) {
        return false
      }
      return (
        e.lng >= this._swLng &&
        e.lng <= this._neLng &&
        e.lat >= this._swLat &&
        e.lat <= this._neLat
      )
    },
    extend: function (e) {
      var i = e.lng
      var T = e.lat
      if (!this._sw) {
        this._sw = new b8(0, 0)
      }
      if (!this._ne) {
        this._ne = new b8(0, 0)
      }
      if (!this._swLng || this._swLng > i) {
        this._sw.lng = this._swLng = i
      }
      if (!this._neLng || this._neLng < i) {
        this._ne.lng = this._neLng = i
      }
      if (!this._swLat || this._swLat > T) {
        this._sw.lat = this._swLat = T
      }
      if (!this._neLat || this._neLat < T) {
        this._ne.lat = this._neLat = T
      }
    },
    toSpan: function () {
      if (this.isEmpty()) {
        return new b8(0, 0)
      }
      return new b8(
        Math.abs(this._neLat - this._swLat),
        Math.abs(this._neLng - this._swLng)
      )
    },
    union: function (i) {
      if (i.isEmpty()) {
        return false
      }
      var e = i.getSouthWest()
      var T = i.getNorthEast()
      if (this._swLat > e.lat) {
        this._swLat = e.lat
      }
      if (this._swLng > e.lng) {
        this._swLng = e.lng
      }
      if (this._neLat < T.lat) {
        this._neLat = T.lat
      }
      if (this._neLng < T.lng) {
        this._neLng = T.lng
      }
      this._sw = new b8(this._swLat, this._swLng)
      this._ne = new b8(this._neLat, this._neLng)
      return true
    },
    toString: function () {
      return (
        this._swLat +
        ', ' +
        this._swLng +
        ', ' +
        this._neLat +
        ', ' +
        this._neLng
      )
    },
  })
  window.COORDINATES_WGS84 = 1
  window.COORDINATES_WGS84_MC = 2
  window.COORDINATES_GCJ02 = 3
  window.COORDINATES_GCJ02_MC = 4
  window.COORDINATES_BD09 = 5
  window.COORDINATES_BD09_MC = 6
  window.COORDINATES_MAPBAR = 7
  window.COORDINATES_51 = 8
  function fg() {}
  fg.inherits(cJ, 'Convertor')
  es.extend(fg.prototype, {
    translate: function (i, i9, i8, T) {
      i9 = i9 || 1
      i8 = i8 || 5
      if (i.length > 10) {
        T && T({ status: 25 })
        return
      }
      var e = w.apiHost + '/geoconv/v1/?coords='
      es.each(i, function (ja) {
        e += ja.lng + ',' + ja.lat + ';'
      })
      e = e.replace(/;$/gi, '')
      e = e + '&from=' + i9 + '&to=' + i8 + '&v=gl&type=webgl&ak=' + ei
      cS.request(e, function (jb) {
        if (jb.status === 0) {
          var ja = []
          es.each(jb.result, function (jc) {
            ja.push(new cd(jc.x, jc.y))
          })
          delete jb.result
          jb.points = ja
        }
        T && T(jb)
      })
    },
  })
  var dI = {
    idle: 0,
    freeze: 1,
    zooming: 2,
    dragging: 3,
    moving: 4,
    readyToDrag: 5,
    readyToPinch: 6,
    pinching: 7,
    stdMapCtrlDrag: 8,
    KEY_LEFT: 37,
    KEY_UP: 38,
    KEY_RIGHT: 39,
    KEY_DOWN: 40,
    arrowOpCodes: { 37: 1, 38: 2, 39: 4, 40: 8 },
  }
  var ae = {
    _map: null,
    _html: "<div class='BMap_opMask' unselectable='on'></div>",
    _maskElement: null,
    _cursor: 'default',
    inUse: false,
    show: function (e) {
      if (!this._map) {
        this._map = e
      }
      this.inUse = true
      if (!this._maskElement) {
        this._createMask(e)
      }
      this._maskElement.style.display = 'block'
    },
    _createMask: function (i) {
      if (!this._map) {
        this._map = i
      }
      if (!this._map) {
        return
      }
      var e = (this._maskElement = bA(this._map.container, this._html))
      es.on(e, 'mouseup', function (T) {
        if (T.button == 2) {
          gC(T)
        }
      })
      es.on(e, 'contextmenu', gC)
      e.style.display = 'none'
    },
    getDrawPoint: function (i8, jb, i9) {
      i8 = window.event || i8
      var i = i8.offsetX || i8.layerX || 0
      var ja = parseInt(i8.offsetY) || parseInt(i8.layerY) || 0
      var T = i8.target || i8.srcElement
      if (T != ae.getDom(this._map) && jb == true) {
        while (T && T != this._map.container) {
          if (
            !(
              T.clientWidth == 0 &&
              T.clientHeight == 0 &&
              T.offsetParent &&
              T.offsetParent.nodeName.toLowerCase() == 'td'
            )
          ) {
            i += T.offsetLeft
            ja += T.offsetTop
          }
          T = T.offsetParent
        }
      }
      if (T != ae.getDom(this._map) && T != this._map.container) {
        return
      }
      if (typeof i === 'undefined' || typeof ja === 'undefined') {
        return
      }
      if (isNaN(i) || isNaN(ja)) {
        return
      }
      if (i9) {
        i = i + i9.x
        ja = ja + i9.y
      }
      return this._map.pixelToPointIn(new eL(i, ja))
    },
    hide: function () {
      if (!this._map) {
        return
      }
      this.inUse = false
      if (this._maskElement) {
        this._maskElement.style.display = 'none'
      }
    },
    getDom: function (e) {
      if (!this._maskElement) {
        this._createMask(e)
      }
      return this._maskElement
    },
    setCursor: function (e) {
      this._cursor = e || 'default'
      if (this._maskElement) {
        this._maskElement.style.cursor = this._cursor
      }
    },
  }
  function aH() {
    this._type = 'overlay'
  }
  aH.inherits(es.BaseClass, 'Overlay')
  aH.getZIndex = function (i, e) {
    i = i * 1
    if (!i) {
      return 0
    }
    if (e) {
      i = ia.convertMC2LL(new cd(0, i)).lat
    }
    return (i * -100000) << 1
  }
  es.extend(aH.prototype, {
    _i: function (e) {
      this._map = e
      if (!this.domElement && bG(this.initialize)) {
        this.domElement = this.initialize(e)
        if (this.domElement) {
          this.domElement.style.WebkitUserSelect = 'none'
        }
      }
      this.draw()
    },
    initialize: function (e) {
      throw 'initialize方法未实现'
    },
    draw: function () {
      throw 'draw方法未实现'
    },
    remove: function () {
      if (this.domElement && this.domElement.parentNode) {
        this.domElement.parentNode.removeChild(this.domElement)
      }
      this.domElement = null
      this.dispatchEvent(new e7('onremove'))
    },
    hide: function () {
      this._visible = false
      es.hide(this.domElement)
    },
    show: function () {
      this._visible = true
      es.show(this.domElement)
    },
    getMap: function () {
      return this._map
    },
    dispose: function () {
      es.BaseClass.prototype.decontrol.call(this)
    },
  })
  function d6() {
    es.BaseClass.call(this)
    aH.call(this)
    this._visible = true
    this._visibleInternal = true
    this.infoWindow = null
    this._dblclickTime = 0
  }
  d6.inherits(aH, 'OverlayInternal')
  es.extend(d6.prototype, {
    initialize: function (e) {
      this.map = e
      es.BaseClass.call(this, this.hashCode)
      return null
    },
    draw: function () {},
    remove: function () {
      this.decontrol()
      aH.prototype.remove.call(this)
    },
    hide: function () {
      this._visible = false
    },
    show: function () {
      this._visible = true
    },
    getDom: function () {
      return this.domElement
    },
    getContainer: function () {
      return this.domElement
    },
    setClassName: function () {},
    setConfig: function (i) {
      if (!i) {
        return
      }
      for (var e in i) {
        if (i.hasOwnProperty(e)) {
          this._config[e] = i[e]
        }
      }
    },
    getPoint: function (T, i8) {
      if (!T) {
        return this.point
      } else {
        var e = i8 ? i8.width : 0
        var i9 = i8 ? i8.height : 0
        if (this.map) {
          var i = this.map.pointToPixelIn(this.point)
          if (this._config && this._config.offset) {
            i.x = i.x + this._config.offset.width + e
            i.y = i.y + this._config.offset.height + i9
          } else {
            i.x = i.x + e
            i.y = i.y + i9
          }
          return this.map.pixelToPointIn(i)
        }
      }
    },
    setZIndex: function (e) {
      this.zIndex = e
    },
    isVisible: function () {
      if (!this.domElement) {
        return false
      }
      return !!this._visible
    },
    enableMassClear: function () {
      this._config.enableMassClear = true
    },
    disableMassClear: function () {
      this._config.enableMassClear = false
    },
    showInternal: function () {
      this._visibleInternal = true
    },
    hideInternal: function (e) {
      this._visibleInternal = false
      this._hideInternalReason = e
    },
  })
  function aF(e) {
    this.map = e
    this._overlays = {}
    this._overlayArray = []
    this._customOverlays = []
    e._overlays = this._overlays
    e._overlayArray = this._overlayArray
    e._customOverlays = this._customOverlays
    this._zoomingOrMoving = false
    this._init()
  }
  aF.prototype._init = function () {
    if (this.map._renderType !== 'webgl') {
      this._createOverlayContainers()
    } else {
      this._createWebGLOverlayContainers()
    }
    this._bind()
  }
  aF.prototype._createOverlayContainers = function () {
    var e = this.map
    e.temp.overlayDiv = e.overlayDiv = this._createOverlayDiv(e.platform, 200)
    e.temp.overlayDivEx = e.overlayDivEx = this._createOverlayDiv(
      e.platform,
      50
    )
    e._panes.floatPane = this._createOverlayDiv(e.temp.overlayDiv, 800)
    e._panes.markerMouseTarget = this._createOverlayDiv(e.temp.overlayDiv, 700)
    e._panes.floatShadow = this._createOverlayDiv(e.temp.overlayDiv, 600)
    e._panes.labelPane = this._createOverlayDiv(e.temp.overlayDiv, 500)
    e._panes.markerPane = this._createOverlayDiv(e.temp.overlayDiv, 400)
    if (e.isCanvasMap()) {
      e._panes.mapPane = this._createOverlayDiv(e.temp.overlayDivEx, 50)
    } else {
      e._panes.mapPane = this._createOverlayDiv(e.temp.overlayDiv, 200)
    }
  }
  aF.prototype._createWebGLOverlayContainers = function () {
    var e = this.map
    e.temp.overlayDiv = e.overlayDiv = this._createOverlayDiv(e.platform, 200)
    e._panes.floatPane = this._createOverlayDiv(e.temp.overlayDiv, 800)
    e._panes.markerMouseTarget = this._createOverlayDiv(e.temp.overlayDiv, 700)
    e._panes.floatShadow = this._createOverlayDiv(e.temp.overlayDiv, 600)
    e._panes.labelPane = this._createOverlayDiv(e.temp.overlayDiv, 500)
    e._panes.markerPane = this._createOverlayDiv(e.temp.overlayDiv, 400)
  }
  aF.prototype._createOverlayDiv = function (e, i8) {
    var T = bK('div')
    var i = T.style
    i.position = 'absolute'
    i.top = i.left = i.width = i.height = '0'
    i.zIndex = i8
    e.appendChild(T)
    return T
  }
  aF.prototype._bind = function () {
    var i9 = this.map
    var i8 = this
    function i(jb) {
      i8.draw(jb)
    }
    if (i9._renderType !== 'webgl') {
      i9.addEventListener('load', i)
      i9.addEventListener('moveend', i)
      i9.addEventListener('resize', i)
      i9.addEventListener('zoomend', i)
      i9.addEventListener('zooming_inner', i)
    } else {
      i9.on('update', i)
    }
    i9.addEventListener('zoomend', function (jb) {
      if (this.mapType === 'B_EARTH_MAP') {
        if (this._earth.getZoom() < this._earth.zoomForNight + 1) {
          this.temp.overlayDiv.style.display = 'none'
          if (this.temp.overlayDivEx) {
            this.temp.overlayDivEx.style.display = 'none'
          }
        } else {
          if (this.temp.overlayDiv.style.display === 'none') {
            this.temp.overlayDiv.style.display = ''
            if (this.temp.overlayDivEx) {
              this.temp.overlayDivEx.style.display = ''
            }
            if (this.temp.infoWin && this.temp.infoWin.isOpen()) {
              this.temp.infoWin.redraw()
            }
          }
        }
      }
    })
    i9.addEventListener('oncenterandzoom', function (jb) {
      i8.draw(jb)
      if (this.mapType === 'B_EARTH_MAP') {
        if (this._earth.getZoom() < this._earth.zoomForNight + 1) {
          this.temp.overlayDiv.style.display = 'none'
          if (this.temp.overlayDivEx) {
            this.temp.overlayDivEx.style.display = 'none'
          }
        } else {
          if (this.temp.overlayDiv.style.display === 'none') {
            this.temp.overlayDiv.style.display = ''
            if (this.temp.overlayDivEx) {
              this.temp.overlayDivEx.style.display = ''
            }
            if (this.temp.infoWin && this.temp.infoWin.isOpen()) {
              this.temp.infoWin.redraw()
            }
          }
        }
      }
    })
    i9.addEventListener('maptypechange', function (jb) {
      if (this.mapType === 'B_EARTH_MAP') {
        if (this._panes.mapPane) {
          this._panes.mapPane.style.display = 'none'
        }
        if (this._earth.getZoom() < this._earth.zoomForNight + 1) {
          this.temp.overlayDiv.style.display = 'none'
          if (this.temp.overlayDivEx) {
            this.temp.overlayDivEx.style.display = 'none'
          }
        } else {
          if (this.temp.overlayDiv.style.display === 'none') {
            this.temp.overlayDiv.style.display = ''
            if (this.temp.overlayDivEx) {
              this.temp.overlayDivEx.style.display = ''
            }
            if (this.temp.infoWin && this.temp.infoWin.isOpen()) {
              this.temp.infoWin.redraw()
            }
          }
        }
        if (this._panes.markerPane) {
          this._panes.markerPane.style.display = 'none'
        }
      } else {
        if (this._panes.mapPane) {
          this._panes.mapPane.style.display = ''
        }
        if (this._panes.markerPane) {
          this._panes.markerPane.style.display = ''
        }
        if (this.temp.overlayDiv.style.display === 'none') {
          this.temp.overlayDiv.style.display = ''
          if (this.temp.overlayDivEx) {
            this.temp.overlayDivEx.style.display = ''
          }
          if (this.temp.infoWin && this.temp.infoWin.isOpen()) {
            this.temp.infoWin.redraw()
          }
        }
      }
      i8.draw(jb)
    })
    i9.on('earthstatuschange', function ja(jb) {
      i8.draw(jb)
    })
    i9.addEventListener('addoverlay', function (jf) {
      var jc = jf.target
      if (jc instanceof d6) {
        if (!i8._overlays[jc.hashCode]) {
          i8._overlays[jc.hashCode] = jc
          i8._overlayArray.push(jc)
        }
      } else {
        var je = false
        for (var jd = 0, jb = i8._customOverlays.length; jd < jb; jd++) {
          if (i8._customOverlays[jd] === jc) {
            je = true
            break
          }
        }
        if (!je) {
          i8._customOverlays.push(jc)
        }
      }
    })
    i9.addEventListener('removeoverlay', function (je) {
      var jc = je.target
      if (jc instanceof d6) {
        delete i8._overlays[jc.hashCode]
        for (var jd = 0; jd < i8._overlayArray.length; jd++) {
          if (i8._overlayArray[jd] === jc) {
            i8._overlayArray.splice(jd, 1)
            break
          }
        }
      } else {
        for (var jd = 0, jb = i8._customOverlays.length; jd < jb; jd++) {
          if (i8._customOverlays[jd] === jc) {
            i8._customOverlays.splice(jd, 1)
            break
          }
        }
      }
    })
    i9.addEventListener('clearoverlays', function (jd) {
      this.closeInfoWindow()
      this.closeSimpleInfoWindow()
      for (var jc in i8._overlays) {
        if (i8._overlays[jc]._config.enableMassClear) {
          this.removeOverlay(i8._overlays[jc])
        }
      }
      for (var jb = i8._customOverlays.length - 1; jb > 0; jb--) {
        if (i8._customOverlays[jb].enableMassClear !== false) {
          this.removeOverlay(i8._customOverlays[jb])
          i8._customOverlays.splice(jb, 1)
        }
      }
    })
    i9.addEventListener('infowindowopen', function (jc) {
      var jb = this.infoWindow
      if (jb) {
        es.hide(jb.popDom)
        es.hide(jb.shadowDom)
      }
    })
    function T() {
      if (this.getMapType() === 'B_EARTH_MAP' || this._renderType === 'webgl') {
        if (i8._zoomingOrMoving === false) {
          this._panes.markerMouseTarget.style.display = 'none'
          i8._zoomingOrMoving = true
        }
      }
    }
    function e(jd) {
      if (this.getMapType() === 'B_EARTH_MAP' || this._renderType === 'webgl') {
        if (i8._zoomingOrMoving === true) {
          this._panes.markerMouseTarget.style.display = ''
          i8._zoomingOrMoving = false
          for (var jc = 0; jc < i8._overlayArray.length; jc++) {
            var jb = i8._overlayArray[jc]
            if (jb instanceof iO === true) {
              jb.draw(jd)
            }
          }
        }
      }
    }
    i9.addEventListener('movestart', T)
    i9.addEventListener('moveend', e)
    i9.addEventListener('zoomstart', T)
    i9.addEventListener('zoomend', e)
    i9.addEventListener('animation_start', T)
    i9.addEventListener('animation_end', e)
    i9.addEventListener('displayoptions_changed', function (jb) {
      if (this._displayOptions.overlay === false) {
        this.temp.overlayDiv.style.display = 'none'
      } else {
        this.temp.overlayDiv.style.display = ''
      }
    })
  }
  aF.prototype.draw = function (jb) {
    jb = jb || {}
    if (this.map.getMapType() === 'B_EARTH_MAP') {
      for (var i9 = 0; i9 < this._overlayArray.length; i9++) {
        var T = this._overlayArray[i9]
        if (T instanceof hG === true) {
          continue
        }
        if (this._zoomingOrMoving) {
          if (T instanceof iO === true) {
            continue
          }
        }
        T.draw(jb)
      }
    } else {
      for (var i9 = 0, i8 = this._overlayArray.length; i9 < i8; i9++) {
        var T = this._overlayArray[i9]
        if (this._zoomingOrMoving && T instanceof iO === true) {
          continue
        }
        T.draw(jb)
      }
    }
    es.each(this._customOverlays, function (e) {
      e.draw(jb)
    })
    if (this.map.temp.infoWin) {
      this.map.temp.infoWin.setPosition(jb.center, jb.zoom)
    }
    if (
      this.map.getMapType() !== 'B_EARTH_MAP' &&
      this.map._renderType !== 'webgl'
    ) {
      if (bo.DrawerSelector) {
        var ja = bo.DrawerSelector.getDrawer(this.map)
        ja.setPalette()
      }
    }
  }
  bo.register(function (e) {
    e._overlayMgr = new aF(e)
  })
  function hG(e) {
    d6.call(this)
    this._config = {
      strokeColor: '#000',
      strokeWeight: 2,
      strokeOpacity: 1,
      strokeStyle: 'solid',
      dashArray: null,
      strokeLineCap: 'round',
      strokeLineJoin: 'round',
      enableMassClear: true,
      getParseTolerance: null,
      getParseCacheIndex: null,
      enableParse: true,
      enableEditing: false,
      mouseOverTolerance: 5,
      geodesic: false,
      clip: true,
      texture: null,
      textureSize: null,
      textureZoomWithMap: false,
      textureRepeat: true,
    }
    this.setConfig(e)
    if (this._config.strokeOpacity < 0 || this._config.strokeOpacity > 1) {
      this._config.strokeOpacity = 1
    }
    if (this._config.fillOpacity < 0 || this._config.fillOpacity > 1) {
      this._config.fillOpacity = 1
    }
    if (
      this._config.strokeStyle !== 'solid' &&
      this._config.strokeStyle !== 'dashed' &&
      this._config.strokeStyle !== 'dotted'
    ) {
      this._config.strokeStyle = 'solid'
    }
    this.domElement = null
    this._bounds = new ha()
    this.points = []
    this.greatCirclePoints = []
    this._parseCache = []
    this._holesCache = []
    this._parseCacheGL = []
    this._parseCacheGLRaw = []
    this._areaCacheGL = []
    this._strokeStyleInfoForGL = [[]]
    this._fillStyleInfoForGL = ''
    this.vertexMarkers = []
    this._temp = {}
  }
  hG.JOININDEX = { miter: 0, round: 1, bevel: 2 }
  hG.CAPINDEX = { round: 0, butt: 1, square: 2 }
  hG.inherits(d6, 'Graph')
  hG.getGraphPoints = function (i) {
    var e = []
    if (!i || i.length === 0) {
      return e
    }
    if (typeof i === 'string') {
      var T = i.split(';')
      es.each(T, function (i9) {
        var i8 = i9.split(',')
        e.push(new cd(i8[0], i8[1]))
      })
    }
    if (i.constructor === Array && i.length > 0) {
      e = i
    }
    return e
  }
  hG.parseTolerance = {
    0: [0.09, 0.005, 0.0001, 0.00001],
    1: [9000, 500, 20, 1],
  }
  es.extend(hG.prototype, {
    initialize: function (e) {
      this.map = e
      return null
    },
    draw: function () {},
    setPoints: function (e) {
      this._clearCache()
      this.points = hG.getGraphPoints(e).slice(0)
      this._calcBounds()
    },
    setPathIn: function (e) {
      this.setPoints(e)
    },
    _calcBounds: function () {
      if (!this.points) {
        return
      }
      var e = this
      e._bounds = new ha()
      if (!this.hasMultipleParts) {
        es.each(this.points, function (i) {
          e._bounds.extend(i)
        })
      } else {
        es.each(this.points, function (i) {
          es.each(i, function (T) {
            e._bounds.extend(T)
          })
        })
      }
    },
    getPoints: function () {
      return this.points
    },
    getPathIn: function () {
      return this.points
    },
    setPointAt: function (i, e) {
      if (!e || !this.points[i]) {
        return
      }
      this._clearCache()
      this.points[i] = new cd(e.lng, e.lat)
      this._calcBounds()
    },
    setPositionAt: function (i, e) {
      if (!e || !this.points[i]) {
        return
      }
      var T = ia.convertLL2MC(e)
      this.setPointAt(i, T)
    },
    setOptions: function (i) {
      i = i || {}
      for (var e in i) {
        if (i.hasOwnProperty(e)) {
          this._config[e] = i[e]
        }
      }
    },
    setStrokeColor: function (e) {
      this._config.strokeColor = e
    },
    getStrokeColor: function () {
      return this._config.strokeColor
    },
    setStrokeLineCap: function (e) {
      this._config.strokeLineCap = e
    },
    getStrokeLineCap: function () {
      return this._config.strokeLineCap
    },
    setStrokeLineJoin: function (e) {
      this._config.strokeLineJoin = e
    },
    getStrokeLineJoin: function () {
      return this._config.strokeLineJoin
    },
    setStrokeWeight: function (e) {
      if (e > 0) {
        this._config.strokeWeight = e
      }
    },
    getStrokeWeight: function () {
      return this._config.strokeWeight
    },
    setStrokeOpacity: function (e) {
      if (!e || e > 1 || e < 0) {
        return
      }
      this._config.strokeOpacity = e
    },
    getStrokeOpacity: function () {
      return this._config.strokeOpacity
    },
    setFillOpacity: function (e) {
      if (e > 1 || e < 0) {
        return
      }
      this._config.fillOpacity = e
    },
    getFillOpacity: function () {
      return this._config.fillOpacity
    },
    setStrokeStyle: function (e) {
      if (e !== 'solid' && e !== 'dashed' && e !== 'dotted') {
        return
      }
      this._config.strokeStyle = e
    },
    getStrokeStyle: function () {
      return this._config.strokeStyle
    },
    setFillColor: function (e) {
      this._config.fillColor = e || ''
    },
    getFillColor: function () {
      return this._config.fillColor
    },
    getBoundsIn: function () {
      this._bounds.setMinMax()
      return this._bounds
    },
    getBounds: function () {
      var e = this.getBoundsIn()
      var i = new ha(
        ia.convertMC2LL(e.getSouthWest()),
        ia.convertMC2LL(e.getNorthEast())
      )
      i.setMinMax()
      return i
    },
    remove: function () {
      if (this.map) {
        this.map.removeEventListener('onmousemove', this._graphMouseEvent)
        this.map.removeEventListener('onclick', this._graphClickEvent)
      }
      d6.prototype.remove.call(this)
      this._clearCache()
      var e = new e7('onlineupdate')
      e.action = 'remove'
      e.overlay = this
      this.fire(e)
    },
    enableEditing: function () {
      if (this.points.length < 2) {
        return
      }
      this._config.enableEditing = true
      var e = this
      gi.load(
        'poly',
        function () {
          e.addVertexs()
        },
        true
      )
    },
    disableEditing: function () {
      this._config.enableEditing = false
      var e = this
      gi.load(
        'poly',
        function () {
          e.clearVertexs()
        },
        true
      )
    },
    getLength: function () {
      if (typeof this._length === 'number') {
        return this._length
      }
      if (typeof this._config.totalLength === 'number') {
        this._length = this._config.totalLength
        return this._length
      }
      var T = 0
      if (this.points.length <= 1) {
        this._length = 0
        return T
      }
      for (var e = 0; e < this.points.length - 1; e++) {
        T += dW(this.points[e], this.points[e + 1])
      }
      this._length = T
      return T
    },
    getParsedPoints: function () {
      var e = this._simplification(this.points)
      if (this.hasMultipleParts) {
        return e
      }
      return [e]
    },
    _simplification: function (jd) {
      var e = this.map
      var jc = this.getParseCacheIndex(e.getZoom())
      var jf
      if (this._parseCache[jc]) {
        jf = this._parseCache[jc]
      } else {
        var ja = jd
        if (this.greatCirclePoints.length > 0) {
          ja = this.greatCirclePoints
        }
        var i9 = e.config.coordType === 2 ? 1 : e.config.coordType
        var jb = this.getParseTolerance(e.getZoom(), i9)
        if (!this.hasMultipleParts) {
          var je = dp(ja, jb)
        } else {
          var je = []
          for (var T = 0; T < ja.length; T++) {
            var i8 = dp(ja[T], jb)
            je.push(i8)
          }
        }
        jf = this._parseCache[jc] = je
      }
      return jf
    },
    _clearCache: function () {
      this._length = null
      this._parseCache.length = 0
      this._parseCacheGL.length = 0
      this._parseCacheGLRaw.length = 0
      this._areaCacheGL.length = 0
    },
    canRenderDataBeMerged: function () {
      var e = this._config
      if (e.texture) {
        return false
      }
      return true
    },
  })
  if (es.Browser.ie && document.namespaces && !document.namespaces.olv) {
    document.namespaces.add('olv', 'urn:schemas-microsoft-com:vml')
  }
  function ir(ja, i8, T) {
    if (!ja || !i8) {
      return
    }
    this.imageUrl = null
    this.imageDom = null
    if (typeof ja === 'string') {
      this.imageUrl = ja
    } else {
      this.imageDom = ja
      if (!this.imageDom.id) {
        this.imageDom.id = bo.getGUID('icon_dom_')
      }
    }
    this.size = i8
    var i9 = new h3(Math.floor(i8.width / 2), Math.floor(i8.height / 2))
    var i = { offset: i9, imageOffset: new h3(0, 0) }
    T = T || {}
    for (var e in T) {
      i[e] = T[e]
    }
    if (T.anchor) {
      i.offset = T.anchor
    }
    this.anchor = this.offset = i.offset
    this.imageOffset = i.imageOffset
    this.infoWindowOffset = T.infoWindowOffset || this.offset
    this.printImageUrl = T.printImageUrl || ''
    this.imageSize = T.imageSize || this.size
    this.srcSetObject = {}
    this.setImageSrcset(T.srcset || T.srcSet)
  }
  ir.prototype.setImageUrl = function (e) {
    if (!e) {
      return
    }
    this.imageUrl = e
    this._renderData = null
  }
  ir.prototype.getCurrentImageUrl = function () {
    if (window.devicePixelRatio > 1 && this.srcSetObject['2x']) {
      return this.srcSetObject['2x']
    }
    return this.imageUrl
  }
  ir.prototype.setPrintImageUrl = function (e) {
    if (!e) {
      return
    }
    this.printImageUrl = e
  }
  ir.prototype.setSize = function (e) {
    if (!e) {
      return
    }
    this.size = new h3(e.width, e.height)
    this._renderData = null
  }
  ir.prototype.setOffset = function (e) {
    if (!e) {
      return
    }
    this.anchor = this.offset = new h3(e.width, e.height)
    this._renderData = null
  }
  ir.prototype.setAnchor = function (e) {
    this.setOffset(e)
  }
  ir.prototype.setImageOffset = function (e) {
    if (!e) {
      return
    }
    this.imageOffset = new h3(e.width, e.height)
    this._renderData = null
  }
  ir.prototype.setInfoWindowOffset = function (e) {
    if (!e) {
      return
    }
    this.infoWindowOffset = new h3(e.width, e.height)
  }
  ir.prototype.setImageSize = function (e) {
    if (!e) {
      return
    }
    this.imageSize = new h3(e.width, e.height)
  }
  ir.prototype.setImageSrcset = function (T) {
    var e = ''
    if (!T) {
      return
    }
    for (var i in T) {
      if (T.hasOwnProperty(i)) {
        this.srcSetObject[i] = T[i]
        e = T[i] + ' ' + i + ','
      }
    }
    this.srcSet = e
  }
  ir.prototype.toString = function () {
    return 'Icon'
  }
  ir.prototype.generateRenderData = function (ja) {
    var T = this.offset
    var e = this.size
    var jc = this.imageOffset
    var jb = []
    jb.push(-T.width, T.height - e.height, 0)
    jb.push(e.width - T.width, T.height - e.height, 0)
    jb.push(e.width - T.width, T.height, 0)
    jb.push(-T.width, T.height - e.height, 0)
    jb.push(e.width - T.width, T.height, 0)
    jb.push(-T.width, T.height, 0)
    if (ja !== 0) {
      for (var i9 = 0; i9 < jb.length; i9 += 3) {
        var i8 = vec2.fromValues(jb[i9], jb[i9 + 1])
        vec2.rotate(i8, i8, [0, 0], hH(-ja))
        jb[i9] = i8[0]
        jb[i9 + 1] = i8[1]
      }
    }
    return { vertex: jb }
  }
  ir.prototype.getRenderData = function (e) {
    this._renderData = this.generateRenderData(e)
    return this._renderData
  }
  function dz(T, i) {
    es.BaseClass.call(this)
    this.content = T
    this.map = null
    this._config = {
      width: 0,
      height: 0,
      maxWidth: 600,
      offset: new h3(0, 0),
      title: '',
      maxContent: '',
      enableMaximize: false,
      enableAutoPan: true,
      enableCloseOnClick: true,
      margin: [10, 10, 40, 10],
      collisions: [
        [10, 10],
        [10, 10],
        [10, 10],
        [10, 10],
      ],
      ifMaxScene: false,
      onClosing: function () {
        return true
      },
    }
    this.setConfig(i)
    if (this._config.width !== 0) {
      if (this._config.width < 220) {
        this._config.width = 220
      }
      if (this._config.width > 730) {
        this._config.width = 730
      }
    }
    if (this._config.height !== 0) {
      if (this._config.height < 60) {
        this._config.height = 60
      }
      if (this._config.height > 650) {
        this._config.height = 650
      }
    }
    if (this._config.maxWidth !== 0) {
      if (this._config.maxWidth < 220) {
        this._config.maxWidth = 220
      }
      if (this._config.maxWidth > 730) {
        this._config.maxWidth = 730
      }
    }
    this.isWinMax = false
    this.IMG_PATH = w.imgPath
    this.overlay = null
    var e = this
    gi.load('infowindow', function () {
      e._draw()
    })
  }
  dz.inherits(es.BaseClass, 'InfoWindow')
  es.extend(dz.prototype, {
    setWidth: function (e) {
      e = e * 1
      if ((!e && e !== 0) || isNaN(e) || e < 0) {
        return
      }
      if (e !== 0) {
        if (e < 220) {
          e = 220
        }
        if (e > 730) {
          e = 730
        }
      }
      this._config.width = e
    },
    setHeight: function (e) {
      e = e * 1
      if ((!e && e !== 0) || isNaN(e) || e < 0) {
        return
      }
      if (e !== 0) {
        if (e < 60) {
          e = 60
        }
        if (e > 650) {
          e = 650
        }
      }
      this._config.height = e
    },
    setMaxWidth: function (e) {
      e = e * 1
      if ((!e && e !== 0) || isNaN(e) || e < 0) {
        return
      }
      if (e !== 0) {
        if (e < 220) {
          e = 220
        }
        if (e > 730) {
          e = 730
        }
      }
      this._config.maxWidth = e
    },
    setTitle: function (e) {
      this._config.title = e || ''
    },
    setContent: function (e) {
      this.content = e || ''
    },
    getContent: function () {
      return this.content
    },
    setMaxContent: function (e) {
      this._config.maxContent = e || ''
    },
    redraw: function () {},
    enableAutoPan: function () {
      this._config.enableAutoPan = true
    },
    disableAutoPan: function () {
      this._config.enableAutoPan = false
    },
    enableCloseOnClick: function () {
      this._config.enableCloseOnClick = true
    },
    disableCloseOnClick: function () {
      this._config.enableCloseOnClick = false
    },
    enableMaximize: function () {
      this._config.enableMaximize = true
    },
    disableMaximize: function () {
      this._config.enableMaximize = false
    },
    show: function () {
      this._visible = true
    },
    hide: function () {
      this._visible = false
    },
    close: function () {
      this.hide()
    },
    dispose: function () {
      es.BaseClass.prototype.decontrol.call(this)
    },
    maximize: function () {
      this.isWinMax = true
    },
    restore: function () {
      this.isWinMax = false
    },
    setConfig: function (i) {
      if (!i) {
        return
      }
      for (var e in i) {
        if (typeof this._config[e] === typeof i[e]) {
          this._config[e] = i[e]
        }
      }
    },
    isVisible: function () {
      return this.isOpen()
    },
    isOpen: function () {
      return false
    },
    getPointIn: function () {
      if (this.overlay && this.overlay.getPoint) {
        return this.overlay.getPoint()
      }
    },
    getTitle: function () {
      return this._config.title || ''
    },
    getPosition: function () {
      return this.latLng
    },
    getPoint: function () {
      var e = this.getPointIn()
      if (this.map.config.coordType === BMAP_COORD_GCJ02) {
        var i = ia.convertMC2LL(e)
        return ec(i)
      }
      return ia.convertMC2LL(e)
    },
    getOffset: function () {
      return this._config.offset
    },
    dispose: function () {
      es.BaseClass.prototype.decontrol.call(this)
    },
    toString: function () {
      return 'InfoWindow'
    },
  })
  gV.prototype.openInfoWindow = function (T, e) {
    console.log('gV openInfoWindow')
    T.latLng = new b8(e.lat, e.lng)
    var i = ia.convertLL2MC(e)
    this.openInfoWindowIn(T, i)
  }
  gV.prototype.closeInfoWindow = function () {
    console.log('gV closeInfoWindow')
    var e = this.temp.infoWin || this.temp._infoWin
    if (e && e.overlay) {
      e.overlay.closeInfoWindow()
    }
  }
  gV.prototype.openInfoWindowIn = function (i8, e) {
    console.log('gV openInfoWindowIn')
    if (
      !i8 ||
      i8.toString() !== 'InfoWindow' ||
      !e ||
      e.toString() !== 'Point'
    ) {
      console.log('whatever')
      return
    }
    var i = this.temp
    if (!i.marker) {
      var T = new ir(w.imgPath + 'blank.gif', { width: 1, height: 1 })
      i.marker = new iO(e, {
        icon: T,
        width: 1,
        height: 1,
        offset: new h3(0, 0),
        infoWindowOffset: new h3(0, 0),
        clickable: false,
      })
      i.marker._fromMap = 1
    } else {
      i.marker.setPoint(e)
    }
    this.addOverlay(i.marker)
    i.marker.show()
    i.marker.openInfoWindow(i8)
  }
  d6.prototype.openInfoWindow = function (e) {
    console.log('d6 openInfoWindow')
    if (this.map) {
      this.map.closeInfoWindow()
      e._visible = true
      this.map.temp._infoWin = e
      e.overlay = this
      es.BaseClass.call(e, e.hashCode)
    }
  }
  d6.prototype.closeInfoWindow = function () {
    console.log('d6 closeInfoWindow')
    if (this.map && this.map.temp._infoWin) {
      this.map.temp._infoWin._visible = false
      this.map.temp._infoWin.decontrol()
      this.map.temp._infoWin = null
    }
  }
  function a4(T, i) {
    d6.call(this)
    this.content = T
    this.map = null
    this.domElement = null
    this._config = {
      width: 0,
      offset: new h3(0, 0),
      styles: {
        backgroundColor: '#fff',
        border: '1px solid #f00',
        padding: '1px',
        whiteSpace: 'nowrap',
        fontSize: '12px',
        zIndex: '80',
        MozUserSelect: 'none',
      },
      point: null,
      enableMassClear: true,
    }
    i = i || {}
    this.setConfig(i)
    if (this._config.width < 0) {
      this._config.width = 0
    }
    this.point = this._config.point
    var e = this
    gi.load('marker', function () {
      e._draw()
    })
  }
  a4.inherits(d6, 'Label')
  es.extend(a4.prototype, {
    setPoint: function (e) {
      if (e && e.toString() === 'Point' && !this.getMarker()) {
        if (this.coordType === BMAP_COORD_GCJ02) {
          var i = hA(e, 3)
          this.point = this._config.point = new cd(i.lng, i.lat)
        } else {
          this.point = this._config.point = new cd(e.lng, e.lat)
        }
      }
    },
    setContent: function (e) {
      this.content = e
    },
    getContent: function (e) {
      return this.content
    },
    setOpacity: function (e) {
      if (e >= 0 && e <= 1) {
        this._config.opacity = e
      }
    },
    setOffset: function (e) {
      if (!e || e.toString() !== 'Size') {
        return
      }
      this._config.offset = new h3(e.width, e.height)
    },
    getOffset: function () {
      return this._config.offset
    },
    setStyle: function (e) {
      e = e || {}
      this._config.styles = es.extend(this._config.styles, e)
    },
    setStyles: function (e) {
      this.setStyle(e)
    },
    setTitle: function (e) {
      this._config.title = e || ''
    },
    getTitle: function () {
      return this._config.title
    },
    setMarker: function (e) {
      if (this._marker && this._marker !== e) {
        this._marker._config.label = null
      }
      this._marker = e
      if (e) {
        this.point = this._config.point = e.getPoint()
      } else {
        this.point = this._config.point = null
      }
    },
    getMarker: function () {
      return this._marker || null
    },
    getPositionIn: function () {
      return this.getPoint()
    },
  })
  function g3(T, i) {
    var i8 = {}
    for (var e in i) {
      if (i.hasOwnProperty(e)) {
        if (e === 'position') {
          i8.point = ia.convertLL2MC(i[e])
          this.latLng = new b8(i[e]['lat'], i[e]['lng'])
        } else {
          i8[e] = i[e]
        }
      }
    }
    a4.call(this, T, i8)
  }
  g3.inherits(a4, 'LabelOut')
  es.extend(g3.prototype, {
    toString: function () {
      return 'Label'
    },
    setPosition: function (e) {
      this.latLng = new b8(e.lat, e.lng)
      var i = ia.convertLL2MC(e)
      this.setPoint(i)
    },
    getPosition: function () {
      return this.latLng
    },
  })
  window.BMAP_ANIMATION_DROP = 1
  window.BMAP_ANIMATION_BOUNCE = 2
  function iO(e, i) {
    d6.call(this)
    i = i || {}
    this.point = e
    this._rotation = 0
    this.map = null
    this._animation = null
    this.domElement = null
    this.iconDom = null
    this.infoWindowDom = null
    this.siblingElement = null
    this.textureCoord = null
    this.textureCoordGLMap = null
    this.collisionDetectionFailed = false
    this._config = {
      offset: new h3(0, 0),
      opacity: 1,
      icon: null,
      title: '',
      infoWindow: null,
      label: null,
      baseZIndex: 0,
      clickable: true,
      zIndexFixed: false,
      isTop: false,
      enableMassClear: true,
      enableDragging: false,
      raiseOnDrag: false,
      restrictDraggingArea: false,
      startAnimation: '',
      enableCollisionDetection: false,
      rank: 0,
      enableDraggingMap: false,
    }
    this.setConfig(i)
    if (!i.icon) {
      this._config.icon = new ir(w.imgPath + 'marker_red.png', new h3(23, 25), {
        offset: new h3(10, 25),
        infoWindowOffset: new h3(10, 0),
      })
    }
    this._isDragging = false
    var T = this
    gi.load('marker', function () {
      T._draw()
    })
  }
  iO.TOP_ZINDEX = aH.getZIndex(-90) + 1000000
  iO.DRAG_ZINDEX = iO.TOP_ZINDEX + 1000000
  iO._injectMethond = function (e) {
    es.extend(iO.prototype, e)
  }
  iO.inherits(d6, 'Marker')
  es.extend(iO.prototype, {
    toString: function () {
      return 'Marker'
    },
    setIcon: function (e) {
      if (e) {
        this._config.icon = e
        this.textureCoord = this.textureCoordGLMap = null
      }
    },
    getIcon: function () {
      return this._config.icon
    },
    setLabel: function (e) {
      if (!(e instanceof a4)) {
        return
      }
      this._config.label = e
      e._config.enableMassClear = this._config.enableMassClear
      e.setPoint(this.point)
    },
    getLabel: function () {
      return this._config.label
    },
    enableDragging: function () {
      this._config.enableDragging = true
    },
    disableDragging: function () {
      this._config.enableDragging = false
    },
    setPoint: function (e) {
      if (e) {
        if (this.map.config.coordType === BMAP_COORD_GCJ02) {
          var i = hA(e, 3)
          this.point = this._config.point = new cd(i.lng, i.lat)
          this.latLng = ia.convertMC2LL(i)
        } else {
          this.point = this._config.point = new cd(e.lng, e.lat)
          this.latLng = ia.convertMC2LL(e)
        }
      }
    },
    setPositionIn: function (e) {
      this.setPoint(e)
    },
    getPositionIn: function () {
      return this.getPoint()
    },
    setTop: function (i, e) {
      this._config.isTop = !!i
      if (i) {
        this._addi = e || 0
      }
    },
    setTitle: function (e) {
      this._config.title = e || ''
    },
    getTitle: function () {
      return this._config.title
    },
    setOffset: function (e) {
      if (e) {
        this._config.offset = e
      }
    },
    getOffset: function () {
      return this._config.offset
    },
    setAnimation: function (e) {
      this._animation = e
    },
    setRank: function (e) {
      this._config.rank = e
    },
    getRank: function () {
      return this._config.rank
    },
    setRotation: function (e) {
      while (e < 0) {
        e += 360
      }
      this._rotation = e % 360
    },
    getRotation: function () {
      return this._rotation
    },
  })
  function r(e, T) {
    this.latLng = new b8(e.lat, e.lng)
    var i = ia.convertLL2MC(e)
    iO.call(this, i, T)
  }
  r.inherits(iO, 'MarkerOut')
  es.extend(r.prototype, {
    toString: function () {
      return 'Marker'
    },
    setPosition: function (e) {
      this.latLng = new b8(e.lat, e.lng)
      var i = ia.convertLL2MC(e)
      this.setPositionIn(i)
    },
    getPosition: function () {
      return this.latLng
    },
  })
  window.BMAP_SHAPE_CIRCLE = 1
  window.BMAP_SHAPE_RECT = 2
  function dK(i, e, T) {
    d6.call(this, e, T)
    this.domElement = null
    this.point = i
    T = T || {}
    this._config = {}
    this._config.height = e || 0
    this._config.size = typeof T.size === 'number' ? T.size : 50
    this._config.fillOpacity =
      typeof T.fillOpacity === 'number' ? T.fillOpacity : 0.8
    this._config.shape = typeof T.shape === 'number' ? T.shape : 1
    bV(this._config.fillOpacity, 0, 1)
    if (T.fillColor === '') {
      this._config.fillColor = ''
    } else {
      this._config.fillColor = T.fillColor ? T.fillColor : '#f00'
    }
    this._config.icon = T.icon instanceof ir ? T.icon : ''
    this._config.enableMassClear = T.enableMassClear || true
    var i8 = this
    gi.load('marker', function () {
      i8._draw()
    })
  }
  dK.inherits(d6, 'Marker3D')
  es.extend(dK.prototype, {
    setPoint: function (e) {
      if (this.map.config.coordType === BMAP_COORD_GCJ02) {
        var T = hA(e, 3)
        this.point = this._config.point = new cd(T.lng, T.lat)
        this.latLng = ia.convertMC2LL(T)
      } else {
        this.point = this._config.point = new cd(e.lng, e.lat)
        this.latLng = ia.convertMC2LL(e)
      }
      var i = new e7('onstatus_change')
      i.overlay = this
      i.action = 'setPoint'
      this.fire(i)
    },
    setPositionIn: function (e) {
      this.setPoint(e)
    },
    getPositionIn: function () {
      return this.getPoint()
    },
    setDomAttribute: function (i, T) {
      var e = new e7('onlineupdate')
      e.overlay = this
      this.dispatchEvent(e)
    },
  })
  function dH(i, e, i8) {
    this.latLng = new b8(i.lat, i.lng)
    var T = ia.convertLL2MC(i)
    dK.call(this, T, e, i8)
  }
  dH.inherits(dK, 'Marker3d')
  es.extend(dH.prototype, {
    toString: function () {
      return 'Marker3D'
    },
    setHeight: function (e) {
      this._config.height = Number(e)
      this.draw()
      var i = new e7('onlineupdate')
      i.overlay = this
      this.dispatchEvent(i)
    },
    getHeight: function () {
      return this._config.height
    },
    setFillOpacity: function (e) {
      if (e > 1 || e < 0) {
        return
      }
      this._config.fillOpacity = e
      this.setDomAttribute('fillopacity', e)
    },
    getFillOpacity: function () {
      return this._config.fillOpacity
    },
    setFillColor: function (e) {
      this._config.fillColor = e || ''
      this.setDomAttribute('fillcolor', e)
    },
    getFillColor: function () {
      return this._config.fillColor
    },
    setIcon: function (i) {
      if (!i || !this.map) {
        return
      }
      this._config.icon = i
      if (this._config.icon) {
        var e = this._config.icon.getCurrentImageUrl()
        var i8 = i.getCurrentImageUrl() !== e
        this._config.icon = i
        this.textureCoord = this.textureCoordGLMap = null
        this.draw()
        var T = new e7('onstatus_change')
        T.overlay = this
        T.action = 'setIcon'
        T.imageUrlChanged = i8
        this.fire(T)
      }
    },
    getIcon: function () {
      return this._config.icon
    },
    setPosition: function (e) {
      this.latLng = new b8(e.lat, e.lng)
      var i = ia.convertLL2MC(e)
      this.setPositionIn(i)
    },
    getPosition: function () {
      var e = this.getPositionIn()
      return ia.convertMC2LL(e)
    },
  })
  function fh(T, e) {
    hG.call(this, e)
    this._normalizedBounds = new ha()
    this.setPoints(T)
    var i = this
    gi.load('poly', function () {
      i._draw()
    })
  }
  fh.inherits(hG, 'Polyline')
  es.extend(fh.prototype, {
    getBoundsIn: function (e) {
      if (!e) {
        this._bounds.setMinMax()
        return this._bounds
      }
      this._normalizedBounds.setMinMax()
      return this._normalizedBounds
    },
    setPoints: function (T) {
      this._clearCache()
      this.points = hG.getGraphPoints(T).slice(0)
      if (this._config.geodesic === true) {
        this.greatCirclePoints.length = 0
        for (var e = 0; e < this.points.length - 1; e++) {
          this.calcGreatCirclePoints(this.points[e], this.points[e + 1])
        }
      }
      this._calcBounds()
    },
    _calcBounds: function () {
      if (!this.points) {
        return
      }
      var e = this
      e._bounds.setNorthEast(null)
      e._bounds.setSouthWest(null)
      if (e.greatCirclePoints && e.greatCirclePoints.length > 0) {
        es.each(e.greatCirclePoints, function (i) {
          e._bounds.extend(i)
        })
      } else {
        es.each(e.points, function (i) {
          e._bounds.extend(i)
        })
      }
      e._normalizedBounds.setSouthWest(e._bounds.getSouthWest())
      e._normalizedBounds.setNorthEast(e._bounds.getNorthEast())
      if (
        e._normalizedBounds.sw.lng < -gV.WORLD_SIZE_MC_HALF ||
        e._normalizedBounds.ne.lng > gV.WORLD_SIZE_MC_HALF
      ) {
        e._normalizedBounds.sw.lng = -gV.WORLD_SIZE_MC_HALF
        e._normalizedBounds.ne.lng = gV.WORLD_SIZE_MC_HALF
      }
    },
    calcGreatCirclePoints: function (i8, T) {
      var ja = i8.latLng
      var i9 = T.latLng
      if (ja.equals(i9)) {
        return
      }
      var e = ia.getDistance(hH(ja.lng), hH(ja.lat), hH(i9.lng), hH(i9.lat))
      if (e < 250000) {
        return
      }
      var je = Math.round(e / 150000)
      var ji = this.calcAngularDistance(ja, i9)
      this.greatCirclePoints.push(i8)
      var jh = ja.lng
      var jg = i8
      for (var jb = 0; jb < je; jb++) {
        var jd = this.calcMiddlePoint(ja, i9, jb / je, ji)
        var jf = ia.convertLL2MC(jd)
        var jc = jf.lng
        var jj = dW(jf, jg)
        if (jj > 30037726) {
          if (jf.lng < jg.lng) {
            jf.lng += gV.WORLD_SIZE_MC
          } else {
            jf.lng -= gV.WORLD_SIZE_MC
          }
        }
        this.greatCirclePoints.push(jf)
        jg = jf
      }
      var jj = dW(T, jg)
      if (jj > 30037726) {
        if (T.lng < jg.lng) {
          T.lng += gV.WORLD_SIZE_MC
        } else {
          T.lng -= gV.WORLD_SIZE_MC
        }
      }
      this.greatCirclePoints.push(T)
    },
    calcMiddlePoint: function (jf, je, jg, jk) {
      var i9 = jf.lat
      var i8 = je.lat
      var jj = jf.lng
      var jh = je.lng
      var jl = hH(i9)
      var ji = hH(i8)
      var i = hH(jj)
      var e = hH(jh)
      var jn = Math.sin((1 - jg) * jk) / Math.sin(jk)
      var jm = Math.sin(jg * jk) / Math.sin(jk)
      var jc = jn * Math.cos(jl) * Math.cos(i) + jm * Math.cos(ji) * Math.cos(e)
      var jb = jn * Math.cos(jl) * Math.sin(i) + jm * Math.cos(ji) * Math.sin(e)
      var ja = jn * Math.sin(jl) + jm * Math.sin(ji)
      var T = Math.atan2(ja, Math.sqrt(Math.pow(jc, 2) + Math.pow(jb, 2)))
      var jd = Math.atan2(jb, jc)
      return new cd(eD(jd), eD(T))
    },
    calcAngularDistance: function (i9, i) {
      var ja = hH(i9.lat)
      var i8 = hH(i.lat)
      var T = hH(i9.lng)
      var e = hH(i.lng)
      return Math.acos(
        Math.sin(ja) * Math.sin(i8) +
          Math.cos(ja) * Math.cos(i8) * Math.cos(Math.abs(e - T))
      )
    },
  })
  function bc(i9, e) {
    if (!i9 || i9.length === 0) {
      return
    }
    var i8 = []
    for (var T = 0; T < i9.length; T++) {
      i8[T] = ia.convertLL2MC(i9[T])
    }
    fh.call(this, i8, e)
  }
  bc.inherits(fh, 'PolylineOut')
  es.extend(bc.prototype, {
    toString: function () {
      return 'Polyline'
    },
    setPath: function (i8) {
      if (!i8 || i8.length === 0) {
        return
      }
      var T = []
      for (var e = 0; e < i8.length; e++) {
        T[e] = ia.convertLL2MC(i8[e])
      }
      this.setPathIn(T)
    },
    getPath: function () {
      var e = this.getPathIn()
      if (!e || e.length === 0) {
        return []
      }
      var i8 = []
      for (var T = 0; T < e.length; T++) {
        i8[T] = ia.convertMC2LL(e[T])
      }
      return i8
    },
    getBounds: function (i) {
      var e = this.getBoundsIn(i)
      var T = new ha(
        ia.convertMC2LL(e.getSouthWest()),
        ia.convertMC2LL(e.getNorthEast())
      )
      return T
    },
  })
  function f6(T, i8, e) {
    hG.call(this, e)
    this._normalizedBounds = new ha()
    this._cps = i8
    this._path = T
    this.setPoints(T)
    var i = this
    gi.load('poly', function () {
      i._draw()
    })
  }
  f6.inherits(fh, 'BezierCurve')
  es.extend(f6.prototype, {
    getBoundsIn: function (e) {
      if (!e) {
        this._bounds.setMinMax()
        return this._bounds
      }
      this._normalizedBounds.setMinMax()
      return this._normalizedBounds
    },
    setPoints: function (e) {
      this._clearCache()
      this.points = hG.getGraphPoints(e).slice(0)
      this.points = this.calcBezierPoints(this.points, this._cps)
      this._calcBounds()
    },
    _calcBounds: function () {
      if (!this.points) {
        return
      }
      var e = this
      e._bounds.setNorthEast(null)
      e._bounds.setSouthWest(null)
      if (e.greatCirclePoints && e.greatCirclePoints.length > 0) {
        es.each(e.greatCirclePoints, function (i) {
          e._bounds.extend(i)
        })
      } else {
        es.each(e.points, function (i) {
          e._bounds.extend(i)
        })
      }
      e._normalizedBounds.setSouthWest(e._bounds.getSouthWest())
      e._normalizedBounds.setNorthEast(e._bounds.getNorthEast())
      if (
        e._normalizedBounds.sw.lng < -gV.WORLD_SIZE_MC_HALF ||
        e._normalizedBounds.ne.lng > gV.WORLD_SIZE_MC_HALF
      ) {
        e._normalizedBounds.sw.lng = -gV.WORLD_SIZE_MC_HALF
        e._normalizedBounds.ne.lng = gV.WORLD_SIZE_MC_HALF
      }
    },
    getPathIn: function () {
      return this._path
    },
    setPathIn: function (e) {
      this._path = e
      this.setPoints(e)
    },
    getCpsIn: function () {
      return this._cps
    },
    setCpsIn: function (e) {
      this._cps = e
      this.setPoints(this._path)
    },
    calcBezierPoints: function (i8, ja) {
      var T = []
      for (var e = 0; e < i8.length - 1; e++) {
        var i9 = [i8[e], ja[e][0], ja[e][1], i8[e + 1]]
        T = T.concat(this.bezierbetweenTwoP(i9))
      }
      return T
    },
    bezierbetweenTwoP: function (ja) {
      var T = 100
      var i9 = 1 / T
      var e = []
      for (var i8 = 0; i8 < T; i8++) {
        e.push(this.getPointOnCubicBezier(ja, i8 * i9))
      }
      return e
    },
    getPointOnCubicBezier: function (jb, jf) {
      var i
      var ja
      var i8
      var jg
      var i9
      var T
      var je
      var e
      var jd
      var jc
      i8 = 3 * (jb[1].lng - jb[0].lng)
      ja = 3 * (jb[2].lng - jb[1].lng) - i8
      i = jb[3].lng - jb[0].lng - i8 - ja
      T = 3 * (jb[1].lat - jb[0].lat)
      i9 = 3 * (jb[2].lat - jb[1].lat) - T
      jg = jb[3].lat - jb[0].lat - T - i9
      je = jf * jf
      e = je * jf
      jd = i * e + ja * je + i8 * jf + jb[0].lng
      jc = jg * e + i9 * je + T * jf + jb[0].lat
      return new cd(jd, jc)
    },
  })
  function cl(i9, jb, e) {
    if (!i9 || i9.length === 0) {
      return
    }
    this.userPath = i9
    this.userCps = jb
    var i8 = []
    for (var T = 0; T < i9.length; T++) {
      i8[T] = ia.convertLL2MC(i9[T])
    }
    if (!jb || jb.length === 0) {
      return
    }
    var ja = []
    for (var T = 0; T < jb.length; T++) {
      ja[T] = []
      ja[T][0] = ia.convertLL2MC(jb[T][0])
      if (jb[T][1]) {
        ja[T][1] = ia.convertLL2MC(jb[T][1])
      } else {
        ja[T][1] = ia.convertLL2MC(jb[T][0])
      }
    }
    f6.call(this, i8, ja, e)
  }
  cl.inherits(f6, 'BezierCurveOut')
  es.extend(cl.prototype, {
    toString: function () {
      return 'BezierCurve'
    },
    setPath: function (i8) {
      if (!i8 || i8.length === 0) {
        return
      }
      this.userPath = i8
      var T = []
      for (var e = 0; e < i8.length; e++) {
        T[e] = ia.convertLL2MC(i8[e])
      }
      this.setPathIn(T)
    },
    getPath: function () {
      return this.userPath
      var e = this.getPathIn()
      if (!e || e.length === 0) {
        return []
      }
      var i8 = []
      for (var T = 0; T < e.length; T++) {
        i8[T] = ia.convertMC2LL(e[T])
      }
      return i8
    },
    getControlPoints: function () {
      return this.userCps
      var e = this.getCpsIn()
      if (!e || e.length === 0) {
        return []
      }
      var i8 = []
      for (var T = 0; T < e.length; T++) {
        i8[T] = []
        i8[T][0] = ia.convertMC2LL(e[T][0])
        i8[T][1] = ia.convertMC2LL(e[T][1])
      }
      return i8
    },
    setControlPoints: function (i8) {
      if (!i8 || i8.length === 0) {
        return
      }
      this.userCps = i8
      var T = []
      for (var e = 0; e < i8.length; e++) {
        T[e] = []
        T[e][0] = ia.convertLL2MC(i8[e][0])
        if (i8[e][1]) {
          T[e][1] = ia.convertLL2MC(i8[e][1])
        } else {
          T[e][1] = ia.convertLL2MC(i8[e][0])
        }
      }
      this.setCpsIn(T)
    },
    getBounds: function (i) {
      var e = this.getBoundsIn(i)
      var T = new ha(
        ia.convertMC2LL(e.getSouthWest()),
        ia.convertMC2LL(e.getNorthEast())
      )
      return T
    },
  })
  function dQ(e, T) {
    hG.call(this, T)
    this._normalizedBounds = new ha()
    this.setPoints(e)
    var i = this
    gi.load('poly', function () {
      i._draw()
    })
  }
  dQ.inherits(fh, 'PolylineMultipart')
  es.extend(dQ.prototype, {
    setPoints: function (e) {
      if (!e) {
        return
      }
      this._clearCache()
      this.points = this._unifyArgs(e)
      this._calcBounds()
    },
    _unifyArgs: function (T) {
      var e = []
      var i = []
      if (T.constructor === Array) {
        if (T[0].constructor === cd) {
          i.push(T)
        } else {
          i = T
        }
      } else {
        if (typeof T === 'string') {
          i.push(T)
        }
      }
      es.each(i, function (i8) {
        e.push(hG.getGraphPoints(i8))
      })
      return e
    },
    setPointAt: function (i, e, T) {
      T = T || 0
      if (!e || !this.points[T] || !this.points[T][i]) {
        return
      }
      this._clearCache()
      this.points[T][i] = new cd(e.lng, e.lat)
      this._calcBounds()
    },
    getBoundsIn: function (e) {
      if (!e) {
        this._bounds.setMinMax()
        return this._bounds
      }
      this._normalizedBounds.setMinMax()
      return this._normalizedBounds
    },
    _calcBounds: function () {
      if (!this.points) {
        return
      }
      var e = this
      e._bounds.setNorthEast(null)
      e._bounds.setSouthWest(null)
      if (e.greatCirclePoints && e.greatCirclePoints.length > 0) {
        es.each(e.greatCirclePoints, function (i) {
          e._bounds.extend(i)
        })
      } else {
        es.each(e.points, function (i) {
          es.each(i, function (T) {
            e._bounds.extend(T)
          })
        })
      }
      e._normalizedBounds.setSouthWest(e._bounds.getSouthWest())
      e._normalizedBounds.setNorthEast(e._bounds.getNorthEast())
      if (
        e._normalizedBounds.sw.lng < -gV.WORLD_SIZE_MC_HALF ||
        e._normalizedBounds.ne.lng > gV.WORLD_SIZE_MC_HALF
      ) {
        e._normalizedBounds.sw.lng = -gV.WORLD_SIZE_MC_HALF
        e._normalizedBounds.ne.lng = gV.WORLD_SIZE_MC_HALF
      }
    },
  })
  function gw(T, e) {
    hG.call(this, e)
    e = e || {}
    if (typeof e.fillOpacity === 'number') {
      this._config.fillOpacity = e.fillOpacity
    } else {
      this._config.fillOpacity = 0.6
    }
    bV(this._config.fillOpacity, 0, 1)
    if (e.fillColor === '') {
      this._config.fillColor = ''
    } else {
      this._config.fillColor = e.fillColor ? e.fillColor : '#fff'
    }
    this._parseFillCacheWebGL = []
    this.setPoints(T, e)
    var i = this
    gi.load('poly', function () {
      i._draw()
    })
  }
  gw.inherits(hG, 'Polygon')
  es.extend(gw.prototype, {
    setPoints: function (ja) {
      var i8 = []
      if (
        typeof ja === 'string' ||
        ja.length === 1 ||
        ja[0] instanceof cd ||
        ja[0] instanceof b8 ||
        this instanceof gd ||
        ja.length === 0
      ) {
        if (ja.length === 1) {
          ja = ja[0]
        }
        var e = this._processSinglePointArray(ja)
        this._userPoints = e.userPoints
        i8 = e.innerPoints
        this.hasMultipleParts = false
      } else {
        this._userPoints = []
        for (var i9 = 0; i9 < ja.length; i9++) {
          var T = this._processSinglePointArray(ja[i9])
          this._userPoints.push(T.userPoints)
          i8.push(T.innerPoints)
        }
        this.hasMultipleParts = true
      }
      hG.prototype.setPoints.call(this, i8)
    },
    setPathIn: function (e) {
      this.setPoints(e)
    },
    _processSinglePointArray: function (e) {
      var i = hG.getGraphPoints(e).slice(0)
      innerPoints = i.slice(0)
      if (
        innerPoints.length > 1 &&
        !innerPoints[0].equals(innerPoints[innerPoints.length - 1])
      ) {
        innerPoints.push(new cd(innerPoints[0].lng, innerPoints[0].lat))
      }
      return { userPoints: i, innerPoints: innerPoints }
    },
    setPointAt: function (i, e) {
      if (!this._userPoints[i]) {
        return
      }
      this._clearCache()
      this._userPoints[i] = new cd(e.lng, e.lat)
      this.points[i] = new cd(e.lng, e.lat)
      if (
        i === 0 &&
        !this.points[0].equals(this.points[this.points.length - 1])
      ) {
        this.points[this.points.length - 1] = new cd(e.lng, e.lat)
      }
      this._calcBounds()
    },
    setPositionAt: function (i, e) {
      if (!this._userPoints[i]) {
        return
      }
      var T = ia.convertLL2MC(e)
      this.setPointAt(i, T)
    },
    getPoints: function () {
      var e = this._userPoints
      if (e.length === 0) {
        e = this.points
      }
      return e
    },
    getPathIn: function () {
      return this.getPoints()
    },
  })
  function hM(jd, ja) {
    if (!jd || jd.length === 0) {
      return
    }
    var jc = []
    if (typeof jd === 'string' || jd[0] instanceof cd || jd[0] instanceof b8) {
      var e = this._processSinglePointArray(jd)
      for (var jb = 0; jb < e.innerPoints.length; jb++) {
        jc[jb] = ia.convertLL2MC(e.innerPoints[jb])
      }
    } else {
      for (var jb = 0; jb < jd.length; jb++) {
        var T = this._processSinglePointArray(jd[jb])
        var i9 = []
        for (var i8 = 0; i8 < T.innerPoints.length; i8++) {
          i9[i8] = ia.convertLL2MC(T.innerPoints[i8])
        }
        jc.push(i9)
      }
    }
    gw.call(this, jc, ja)
  }
  hM.inherits(gw, 'PolygonOut')
  es.extend(hM.prototype, {
    toString: function () {
      return 'Polygon'
    },
    setPath: function (i8) {
      if (!i8 || i8.length === 0) {
        return
      }
      i8 = hG.getGraphPoints(i8)
      var T = []
      for (var e = 0; e < i8.length; e++) {
        T[e] = ia.convertLL2MC(i8[e])
      }
      this.setPathIn(T)
    },
    getPath: function () {
      var e = this.getPathIn()
      if (!e || e.length === 0) {
        return []
      }
      var i8 = []
      for (var T = 0; T < e.length; T++) {
        i8[T] = ia.convertMC2LL(e[T])
      }
      return i8
    },
  })
  function gd(i, e, T) {
    this.point = i
    this.radius = Math.abs(e)
    gw.call(this, [], T)
  }
  gd.parseTolerance = {
    0: [0.01, 0.0001, 0.00001, 0.000004],
    1: [1000, 10, 1, 0.4],
  }
  gd.inherits(gw, 'Circle')
  es.extend(gd.prototype, {
    initialize: function (e) {
      this.map = e
      this.points = this._getPerimeterPoints(this.point, this.radius)
      this._calcBounds()
      return null
    },
    getPoint: function () {
      return this.point
    },
    setPoint: function (e) {
      if (!e) {
        return
      }
      this.point = e
      this.latLng = ia.convertMC2LL(e)
    },
    setCenterIn: function (e) {
      var i = arguments[1]
      this.setPoint(e, i)
    },
    setRadius: function (e) {
      this.radius = Math.abs(e)
    },
    getCenterIn: function () {
      return this.point
    },
    getRadius: function () {
      return this.radius
    },
    _getPerimeterPoints: function (e, jf) {
      if (!e || !jf || !this.map) {
        return []
      }
      var T = this.map
      var jc = e.lng
      var ja = e.lat
      var jl = ia.convertMC2LL(e)
      jc = jl.lng
      ja = jl.lat
      var jm = []
      var jh = jf / ia.EARTHRADIUS
      var je = (Math.PI / 180) * ja
      var jk = (Math.PI / 180) * jc
      for (var jd = 0; jd < 360; jd += 9) {
        var jb = (Math.PI / 180) * jd
        var ji = Math.asin(
          Math.sin(je) * Math.cos(jh) +
            Math.cos(je) * Math.sin(jh) * Math.cos(jb)
        )
        var jg = Math.atan2(
          Math.sin(jb) * Math.sin(jh) * Math.cos(je),
          Math.cos(jh) - Math.sin(je) * Math.sin(ji)
        )
        var jj = ((jk - jg + Math.PI) % (2 * Math.PI)) - Math.PI
        var i9 = new b8(ji * (180 / Math.PI), jj * (180 / Math.PI))
        jm.push(ia.convertLL2MC(i9))
      }
      var i8 = jm[0]
      jm.push(new cd(i8.lng, i8.lat))
      if (i8) {
        this._radiusMercator = Math.sqrt(
          Math.pow(i8.lng - this.point.lng, 2) +
            Math.pow(i8.lat - this.point.lat, 2)
        )
      } else {
        this._radiusMercator = this.radius
      }
      return jm
    },
  })
  function aK(i, e, i8) {
    this.latLng = new b8(i.lat, i.lng)
    var T = ia.convertLL2MC(i)
    gd.call(this, T, e, i8)
  }
  aK.inherits(gd, 'CircleOut')
  es.extend(aK.prototype, {
    toString: function () {
      return 'Circle'
    },
    setCenter: function (e) {
      this.latLng = new b8(e.lat, e.lng)
      var i = ia.convertLL2MC(e)
      this.setCenterIn(i)
    },
    getCenter: function () {
      return this.latLng
    },
    getPath: function () {
      var e = this.getPathIn()
      if (!e || e.length === 0) {
        return []
      }
      var i8 = []
      for (var T = 0; T < e.length; T++) {
        i8[T] = ia.convertMC2LL(e[T])
      }
      return i8
    },
  })
  function iZ(i8, e, i) {
    hG.call(this, i)
    i = i || {}
    if (typeof i.topFillOpacity === 'number') {
      this._config.topFillOpacity = i.topFillOpacity
    } else {
      this._config.topFillOpacity = 0.6
    }
    if (typeof i.sideFillOpacity === 'number') {
      this._config.sideFillOpacity = i.sideFillOpacity
    } else {
      this._config.sideFillOpacity = 0.8
    }
    bV(this._config.sideFillOpacity, 0, 1)
    if (i.topFillColor === '') {
      this._config.topFillColor = ''
    } else {
      this._config.topFillColor = i.topFillColor ? i.topFillColor : '#fff'
    }
    if (i.sideFillColor === '') {
      this._config.sideFillColor = ''
    } else {
      this._config.sideFillColor = i.sideFillColor ? i.sideFillColor : '#fff'
    }
    this._parseFillCacheWebGL = []
    this.setPoints(i8, i)
    this._config.altitude = e || 0
    var T = this
    gi.load('poly', function () {
      T._draw()
    })
  }
  iZ.inherits(hG, 'Prism')
  es.extend(iZ.prototype, {
    setPoints: function (ja) {
      var i8 = []
      if (
        typeof ja === 'string' ||
        ja[0] instanceof cd ||
        ja[0] instanceof b8 ||
        this instanceof gd ||
        ja.length === 0
      ) {
        var e = this._processSinglePointArray(ja)
        this._userPoints = e.userPoints
        i8 = e.innerPoints
        this.hasMultipleParts = false
      } else {
        this._userPoints = []
        for (var i9 = 0; i9 < ja.length; i9++) {
          var T = this._processSinglePointArray(ja[i9])
          this._userPoints.push(T.userPoints)
          i8.push(T.innerPoints)
        }
        this.hasMultipleParts = true
      }
      hG.prototype.setPoints.call(this, i8)
    },
    setPathIn: function (e) {
      this.setPoints(e)
    },
    _processSinglePointArray: function (e) {
      var i = hG.getGraphPoints(e).slice(0)
      innerPoints = i.slice(0)
      if (
        innerPoints.length > 1 &&
        !innerPoints[0].equals(innerPoints[innerPoints.length - 1])
      ) {
        innerPoints.push(new cd(innerPoints[0].lng, innerPoints[0].lat))
      }
      return { userPoints: i, innerPoints: innerPoints }
    },
    setPointAt: function (i, e) {
      if (!this._userPoints[i]) {
        return
      }
      this._clearCache()
      this._userPoints[i] = new cd(e.lng, e.lat)
      this.points[i] = new cd(e.lng, e.lat)
      if (
        i === 0 &&
        !this.points[0].equals(this.points[this.points.length - 1])
      ) {
        this.points[this.points.length - 1] = new cd(e.lng, e.lat)
      }
      this._calcBounds()
    },
    getPoints: function () {
      var e = this._userPoints
      if (e.length === 0) {
        e = this.points
      }
      return e
    },
    getPathIn: function () {
      return this.getPoints()
    },
    setTopFillOpacity: function (e) {
      if (e > 1 || e < 0) {
        return
      }
      this._config.topFillOpacity = e
      this._setDomAttribute('topfillopacity', e)
    },
    getTopFillOpacity: function () {
      return this._config.topFillOpacity
    },
    setSideFillOpacity: function (e) {
      if (e > 1 || e < 0) {
        return
      }
      this._config.sideFillOpacity = e
      this._setDomAttribute('sidefillopacity', e)
    },
    getSideFillOpacity: function () {
      return this._config.sideFillOpacity
    },
    setTopFillColor: function (e) {
      this._config.topFillColor = e || ''
      this._setDomAttribute('topfillcolor', e)
    },
    getTopFillColor: function () {
      return this._config.topFillColor
    },
    setSideFillColor: function (e) {
      this._config.sideFillColor = e || ''
      this._setDomAttribute('sidefillcolor', e)
    },
    getSideFillColor: function () {
      return this._config.sideFillColor
    },
    setAltitude: function (e) {
      this._config.altitude = Number(e)
      this.draw()
      var i = new e7('onlineupdate')
      i.overlay = this
      this.dispatchEvent(i)
    },
    getAltitude: function () {
      return this._config.altitude
    },
  })
  function bi(jc, ja, jd) {
    if (!jc || jc.length === 0) {
      return
    }
    this.userPath = jc
    var e = []
    if (typeof jc === 'string' || jc[0] instanceof cd || jc[0] instanceof b8) {
      var je = this._processSinglePointArray(jc)
      for (var i9 = 0; i9 < je.innerPoints.length; i9++) {
        e[i9] = ia.convertLL2MC(je.innerPoints[i9])
      }
    } else {
      for (var i9 = 0; i9 < jc.length; i9++) {
        var jb = this._processSinglePointArray(jc[i9])
        var T = []
        for (var i8 = 0; i8 < jb.innerPoints.length; i8++) {
          T[i8] = ia.convertLL2MC(jb.innerPoints[i8])
        }
        e.push(T)
      }
    }
    iZ.call(this, e, ja, jd)
  }
  bi.inherits(iZ, 'PrismOut')
  es.extend(bi.prototype, {
    toString: function () {
      return 'Prism'
    },
    setPath: function (i8) {
      if (!i8 || i8.length === 0) {
        return
      }
      this.userPath = i8
      var T = []
      for (var e = 0; e < i8.length; e++) {
        T[e] = ia.convertLL2MC(i8[e])
      }
      this.setPathIn(T)
    },
    getPath: function () {
      return this.userPath
      var e = this.getPathIn()
      if (!e || e.length === 0) {
        return []
      }
      var i8 = []
      for (var T = 0; T < e.length; T++) {
        i8[T] = ia.convertMC2LL(e[T])
      }
      return i8
    },
  })
  function bL(i9, i) {
    hG.call(this, i)
    i = i || {}
    this._config.type = i.type || 'image'
    this._config.url = i.url || ''
    this._config.opacity = typeof i.opacity === 'number' ? i.opacity : 1
    bV(this._config.opacity, 0, 1)
    if (i.type === 'image' && i.isPixelMap) {
      this._config.isPixelMap = i.isPixelMap || false
      var T = i.pixelMap || {}
      this._config.colors = T.colors || [
        '#F9F871',
        '#FFC75F',
        '#FF9671',
        '#FF6F91',
        '#D65DB1',
        '#845EC2',
      ]
      this._config.positions = T.positions || [0, 0.2, 0.4, 0.6, 0.8, 1]
      this._config.domain = T.domain || [0, 255]
      this._config.clamp = T.clamp || this._config.domain
      this._config.noData = T.noData !== undefined ? T.noData : -99999
      this._config.fomularC =
        T.fomularC || 'float generateValue(vec4 pixel){return pixel.r * 255.;}'
      this._config.fomularJS =
        T.fomularJS ||
        function (ja) {
          return ja.r
        }
      this._config.maskPng = T.maskPng || null
      this._config.maskData = T.maskData || -1
      this._config.maskCoord = T.maskCoord || null
      this.fHashcode = l({ str: this._config.fomularC })
      var e = this.canPixelMap()
      if (e) {
        this.isPixelMap = true
        this.setPixelMap()
      }
    }
    this._parseFillCacheWebGL = []
    this.setPoints(i9, i)
    var i8 = this
    gi.load('poly', function () {
      i8._draw()
    })
  }
  bL.inherits(hG, 'GroundOverlay')
  es.extend(bL.prototype, {
    setPoints: function (i) {
      var e = hG.getGraphPoints(i).slice(0)
      this.hasMultipleParts = false
      hG.prototype.setPoints.call(this, e)
    },
    setPathIn: function (e) {
      this.setPoints(e)
    },
    getPoints: function () {
      return this.points
    },
    getPathIn: function () {
      return this.getPoints()
    },
    canPixelMap: function () {
      if (this._config.colors && this._config.positions) {
        return true
      }
      return false
    },
    setPixelMap: function () {
      if (!this._config.isPixelMap || !this.canPixelMap()) {
        return
      }
      var i = this._config.colors
      var e = this._config.positions
      this.pHashcode = l({ colors: i, positions: e })
      this.pixelColorMap = gM.generateColorRamp(i, e)
    },
    setDomain: function (e) {
      if (e instanceof Array && e.length === 2) {
        this._config.domain = e
        this.doOnceDraw()
      }
    },
    setClamp: function (e) {
      if (e instanceof Array && e.length === 2) {
        this._config.clamp = e
        this.doOnceDraw()
      }
    },
    setMaskPng: function (i) {
      this._config.maskPng = i
      if (this.map) {
        var e = new e7('hide')
        e.overlay = this
        this.dispatchEvent(e)
        var e = new e7('show')
        e.overlay = this
        this.dispatchEvent(e)
      }
      this.doOnceDraw()
    },
    setMaskData: function (e) {
      this._config.maskData = e
      this.doOnceDraw()
    },
    setMaskCoord: function (e) {
      this._config.maskCoord = e
      this.maskUV = null
      this.doOnceDraw()
    },
    setNoData: function (e) {
      this._config.noData = e
      this.doOnceDraw()
    },
    setPositions: function (e) {
      this._config.positions = e
      this.setPixelMap()
      this.doOnceDraw()
    },
    setColors: function (e) {
      this._config.colors = e
      this.setPixelMap()
      this.doOnceDraw()
    },
    setFomular: function (e, i) {
      if (e && i) {
        this._config.fomularJS = e
        this._config.fomularC = i
        this.fHashcode = l({ str: this._config.fomularC })
        this.doOnceDraw()
      }
    },
    setIsPixelMap: function (e) {
      this.isPixelMap = e
      this.doOnceDraw()
    },
    getImagePixel: function (i8) {
      if (!this._config.isPixelMap || !this.canPixelMap()) {
        return null
      }
      if (!this.getImageMaskPixel(i8)) {
        return null
      }
      if (this.imageObject) {
        var T = Math.floor((i8.lng - this.points[3].lng) / this.lngMC)
        var e = Math.floor((-i8.lat + this.points[3].lat) / this.latMC)
        var i = Math.floor((e * this.imageObject.width + T) * 4)
        if (T > this.imageObject.width || T < 0) {
          return null
        }
        if (e > this.imageObject.height || e < 0) {
          return null
        }
        if (i + 3 > this.imageObject.data.data.length) {
          return null
        }
        return [
          this.imageObject.data.data[i],
          this.imageObject.data.data[i + 1],
          this.imageObject.data.data[i + 2],
          this.imageObject.data.data[i + 3],
        ]
      }
      return null
    },
    getValue: function (i) {
      if (this._config.isPixelMap && i && this._config.fomularJS) {
        if (!(i instanceof Array)) {
          i = this.getImagePixel(i.point)
        }
        var e = this._config.fomularJS({ r: i[0], g: i[1], b: i[2], a: i[3] })
        if (e >= this._config.clamp[0] && e <= this._config.clamp[1]) {
          return e
        }
      }
      return null
    },
    setImageObject: function (T) {
      var e = document.createElement('canvas')
      e.width = T.width
      e.height = T.height
      var i = e.getContext('2d')
      i.drawImage(T, 0, 0, T.width, T.height)
      this.imageObject = {
        width: T.width,
        height: T.height,
        data: i.getImageData(0, 0, T.width, T.height),
      }
      this.updatePixelMc()
      i = null
      e = null
    },
    updatePixelMc: function () {
      if (this.imageObject) {
        var e = Math.abs(this.points[2].lng - this.points[0].lng)
        var i = Math.abs(this.points[2].lat - this.points[0].lat)
        this.lngMC = e / this.imageObject.width
        this.latMC = i / this.imageObject.height
      }
    },
    setMaskImageObject: function (T) {
      var e = document.createElement('canvas')
      e.width = T.width
      e.height = T.height
      var i = e.getContext('2d')
      i.drawImage(T, 0, 0, T.width, T.height)
      this.imageMaskObject = {
        width: T.width,
        height: T.height,
        data: i.getImageData(0, 0, T.width, T.height),
      }
      i = null
      e = null
    },
    getImageMaskPixel: function (e) {
      if (!this.imageMaskObject) {
        return true
      }
      var i8 = this._toOverlayPixelsGL([e])
      var jd = this.maskOverlayPixels
      var ja = jd[1][0] - jd[0][0]
      var i9 = jd[1][1] - jd[0][1]
      var T = Math.floor(
        ((i8[0][0] - jd[0][0]) / ja) * this.imageMaskObject.width
      )
      var i = Math.floor(
        ((-i8[0][1] + jd[1][1]) / i9) * this.imageMaskObject.height
      )
      var jc = Math.floor((i * this.imageMaskObject.width + T) * 4)
      if (T > this.imageMaskObject.width || T < 0) {
        return null
      }
      if (i > this.imageMaskObject.height || i < 0) {
        return null
      }
      var jb = this.imageMaskObject.data.data
      if (jc + 3 > jb.length) {
        return false
      }
      if (jb[jc + 3] > 0) {
        if (this._config.maskData > -1 && this._config.maskData !== jb[jc]) {
          return false
        }
        return true
      }
      return false
    },
    doOnceDraw: function () {
      var e = new e7('onlineupdate')
      e.overlay = this
      this.dispatchEvent(e)
    },
  })
  function fm(i9, T) {
    if (!i9) {
      return
    }
    T = T || {}
    var jb = [
      new cd(i9.sw.lng, i9.ne.lat),
      new cd(i9.ne.lng, i9.ne.lat),
      new cd(i9.ne.lng, i9.sw.lat),
      new cd(i9.sw.lng, i9.sw.lat),
    ]
    var e = hG.getGraphPoints(jb).slice(0)
    var ja = []
    for (var i8 = 0; i8 < e.length; i8++) {
      ja[i8] = ia.convertLL2MC(e[i8])
    }
    bL.call(this, ja, T)
  }
  fm.inherits(bL, 'GroundOverlayOut')
  es.extend(fm.prototype, {
    toString: function () {
      return 'GroundOverlay'
    },
  })
  var ao = {}
  function hd(T, i) {
    es.BaseClass.call(this)
    this.content = T
    this.map = null
    this._config = {
      width: 0,
      height: 0,
      maxWidth: 600,
      offset: new h3(0, 0),
      title: '',
      maxContent: '',
      enableMaximize: false,
      enableAutoPan: true,
      enableCloseOnClick: true,
      margin: [10, 10, 40, 10],
      collisions: [
        [10, 10],
        [10, 10],
        [10, 10],
        [10, 10],
      ],
      ifMaxScene: false,
      onClosing: function () {
        return true
      },
    }
    this.setConfig(i)
    if (this._config.width < 50) {
      this._config.width = 50
    }
    if (this._config.width > 730) {
      this._config.width = 730
    }
    if (this._config.height != 0) {
      if (this._config.height < 50) {
        this._config.height = 50
      }
      if (this._config.height > 650) {
        this._config.height = 650
      }
    }
    if (this._config.maxWidth !== 0) {
      if (this._config.maxWidth < 50) {
        this._config.maxWidth = 50
      }
      if (this._config.maxWidth > 730) {
        this._config.maxWidth = 730
      }
    }
    this.isWinMax = false
    this.IMG_PATH = w.imgPath
    this.overlay = null
    var e = this
    gi.load('simpleInfowindow', function () {
      e._draw()
    })
  }
  hd.inherits(es.BaseClass, 'SimpleInfoWindow')
  es.extend(hd.prototype, {
    setWidth: function (e) {
      e = e * 1
      if ((!e && e != 0) || isNaN(e) || e < 0) {
        return
      }
      if (e != 0) {
        if (e < 50) {
          e = 50
        }
        if (e > 730) {
          e = 730
        }
      }
      this._config.width = e
    },
    setHeight: function (e) {
      e = e * 1
      e -= 10
      if ((!e && e != 0) || isNaN(e) || e < 0) {
        return
      }
      if (e != 0) {
        if (e < 50) {
          e = 50
        }
        if (e > 650) {
          e = 650
        }
      }
      this._config.height = e
    },
    setMaxWidth: function (e) {
      e = e * 1
      if ((!e && e != 0) || isNaN(e) || e < 0) {
        return
      }
      if (e != 0) {
        if (e < 50) {
          e = 50
        }
        if (e > 730) {
          e = 730
        }
      }
      this._config.maxWidth = e
    },
    setTitle: function (e) {
      this._config.title = e || ''
    },
    setContent: function (e) {
      this.content = e || ''
    },
    setMaxContent: function (e) {
      this._config.maxContent = e || ''
    },
    redraw: function () {},
    enableAutoPan: function () {
      this._config.enableAutoPan = true
    },
    disableAutoPan: function () {
      this._config.enableAutoPan = false
    },
    enableCloseOnClick: function () {
      this._config.enableCloseOnClick = true
    },
    disableCloseOnClick: function () {
      this._config.enableCloseOnClick = false
    },
    enableMaximize: function () {
      this._config.enableMaximize = true
    },
    disableMaximize: function () {
      this._config.enableMaximize = false
    },
    show: function () {
      this._visible = true
    },
    hide: function () {
      this._visible = false
    },
    close: function () {
      this.hide()
    },
    dispose: function () {
      es.BaseClass.prototype.decontrol.call(this)
    },
    maximize: function () {
      this.isWinMax = true
    },
    restore: function () {
      this.isWinMax = false
    },
    setConfig: function (i) {
      if (!i) {
        return
      }
      for (var e in i) {
        if (typeof this._config[e] == typeof i[e]) {
          this._config[e] = i[e]
        }
      }
    },
    isVisible: function () {
      return this.isOpen()
    },
    isOpen: function () {
      return false
    },
    getPoint: function () {
      if (this.overlay && this.overlay.getPoint) {
        return this.overlay.getPoint()
      }
    },
    getOffset: function () {
      return this._config.offset
    },
    dispose: function () {
      es.BaseClass.prototype.decontrol.call(this)
    },
    toString: function () {
      return 'SimpleInfoWindow'
    },
  })
  gV.prototype.openSimpleInfoWindow = function (i8, e) {
    if (
      !i8 ||
      i8.toString() != 'SimpleInfoWindow' ||
      !e ||
      e.toString() != 'Point'
    ) {
      return
    }
    var i = this.temp
    if (!i.marker) {
      var T = new ir(w.imgPath + 'blank.gif', { width: 1, height: 1 })
      i.marker = new iO(e, {
        icon: T,
        width: 1,
        height: 1,
        offset: new h3(0, 0),
        infoWindowOffset: new h3(0, 0),
        clickable: false,
      })
      i.marker._fromMap = 1
    } else {
      i.marker.setPoint(e)
    }
    this.addOverlay(i.marker)
    i.marker.show()
    i.marker.openSimpleInfoWindow(i8)
  }
  gV.prototype.closeSimpleInfoWindow = function () {
    var e = this.temp.infoWin || this.temp._infoWin
    if (e && e.overlay) {
      e.overlay.closeSimpleInfoWindow()
    }
  }
  d6.prototype.openSimpleInfoWindow = function (e) {
    if (this.map) {
      this.map.closeSimpleInfoWindow()
      e._visible = true
      this.map.temp._infoWin = e
      e.overlay = this
      es.BaseClass.call(e, e.hashCode)
    }
  }
  d6.prototype.closeSimpleInfoWindow = function () {
    if (this.map && this.map.temp._infoWin) {
      this.map.temp._infoWin._visible = false
      this.map.temp._infoWin.decontrol()
      this.map.temp._infoWin = null
    }
  }
  function b2(T, e) {
    hG.call(this, e)
    e = e || {}
    this._config.showRegion = e.showRegion || 'inside'
    this._config.isBuildingMask = e.isBuildingMask && true
    this._config.isPoiMask = e.isPoiMask && true
    this._config.isMapMask = e.isMapMask && true
    this._config.path = T
    this._parseFillCacheWebGL = []
    this.setPoints(T, e)
    var i = this
    gi.load('poly', function () {
      i._draw()
    })
  }
  b2.inherits(hG, 'MapMask')
  es.extend(b2.prototype, {
    setPoints: function (i) {
      var e = hG.getGraphPoints(i).slice(0)
      this.hasMultipleParts = false
      hG.prototype.setPoints.call(this, e)
    },
    setPathIn: function (e) {
      this.setPoints(e)
    },
    _processSinglePointArray: function (e) {
      var i = hG.getGraphPoints(e).slice(0)
      innerPoints = i.slice(0)
      if (
        innerPoints.length > 1 &&
        !innerPoints[0].equals(innerPoints[innerPoints.length - 1])
      ) {
        innerPoints.push(new cd(innerPoints[0].lng, innerPoints[0].lat))
      }
      return { userPoints: i, innerPoints: innerPoints }
    },
    getPoints: function () {
      var e = this._userPoints
      if (e.length === 0) {
        e = this.points
      }
      return e
    },
    getPathIn: function () {
      return this.getPoints()
    },
  })
  function iW(ja, T) {
    if (!ja || ja.length === 0) {
      return
    }
    var i9 = []
    if (ja[0] instanceof cd) {
      var e = this._processSinglePointArray(ja)
      for (var i8 = 0; i8 < e.innerPoints.length; i8++) {
        i9[i8] = ia.convertLL2MC(e.innerPoints[i8])
      }
    }
    b2.call(this, i9, T)
  }
  iW.inherits(b2, 'MapMaskOut')
  es.extend(iW.prototype, {
    toString: function () {
      return 'MapMask'
    },
  })
  function eL(e, i) {
    e = isNaN(e) ? 0 : e
    i = isNaN(i) ? 0 : i
    this.x = e
    this.y = i
  }
  eL.prototype.equals = function (e) {
    if (!e) {
      return false
    }
    return e.x === this.x && e.y === this.y
  }
  eL.prototype.clone = function () {
    return new eL(this.x, this.y)
  }
  eL.prototype.toString = function () {
    return 'Pixel'
  }
  function h3(i, e) {
    if (typeof i !== 'number') {
      this.width = parseFloat(i)
    } else {
      this.width = i
    }
    if (typeof e !== 'number') {
      this.height = parseFloat(e)
    } else {
      this.height = e
    }
  }
  h3.prototype.equals = function (e) {
    return !!(e && this.width === e.width && this.height === e.height)
  }
  h3.prototype.toString = function () {
    return 'Size'
  }
  var i1 = {
    B_NORMAL_MAP: {
      tileUrls: c8(w.tileDomain, w.rasterTilePath),
      vectorTileUrls: c8(w.tileDomain, w.vectorTilePath),
      tileSize: 256,
      baseUnits: 256,
      zoomLevelMin: 3,
      zoomLevelMax: 19,
      minDataZoom: 3,
      maxDataZoom: 19,
      minZoom: 3,
      maxZoom: 19,
      webgl: { minZoom: 3, maxZoom: 25 },
      zoomLevelBase: 18,
      errorUrl: w.imgPath + 'bg.png',
      bounds: new ha(
        new cd(-21364736, -11708041.66),
        new cd(23855104, 12474104.17)
      ),
      imgExtend: 'png',
    },
    B_SATELLITE_MAP: {
      tileUrls: [
        '//maponline0.bdimg.com/starpic/?qt=satepc&',
        '//maponline1.bdimg.com/starpic/?qt=satepc&',
        '//maponline2.bdimg.com/starpic/?qt=satepc&',
        '//maponline3.bdimg.com/starpic/?qt=satepc&',
      ],
      tileSize: 256,
      baseUnits: 256,
      zoomLevelMin: 3,
      zoomLevelMax: 19,
      minDataZoom: 3,
      maxDataZoom: 19,
      minZoom: 3,
      maxZoom: 19,
      zoomLevelBase: 18,
      errorUrl: w.imgPath + 'bg.png',
      bounds: new ha(new cd(-21364736, -10616832), new cd(23855104, 15859712)),
      imgExtend: 'png',
    },
    B_STREET_MAP: {
      tileUrls: c8(w.tileDomain, w.rasterTilePath),
      tileSize: 256,
      baseUnits: 256,
      zoomLevelMin: 3,
      zoomLevelMax: 19,
      minDataZoom: 3,
      maxDataZoom: 19,
      minZoom: 3,
      maxZoom: 19,
      zoomLevelBase: 18,
      errorUrl: w.imgPath + 'bg.png',
      bounds: new ha(new cd(-21364736, -10616832), new cd(23855104, 15859712)),
      imgExtend: 'png',
    },
    BMAP_CUSTOM_LAYER: {
      tileUrls: [''],
      tileSize: 256,
      baseUnits: 256,
      zoomLevelMin: 1,
      zoomLevelMax: 19,
      minDataZoom: 3,
      maxDataZoom: 19,
      minZoom: 3,
      maxZoom: 19,
      zoomLevelBase: 18,
      errorUrl: w.imgPath + 'blank.gif',
      bounds: new ha(new cd(-21364736, -10616832), new cd(23855104, 15859712)),
      imgExtend: 'png',
    },
    B_EARTH_MAP: {
      tileUrls: [''],
      tileSize: 256,
      baseUnits: 256,
      zoomLevelMin: 3,
      zoomLevelMax: 19,
      minDataZoom: 3,
      maxDataZoom: 19,
      minZoom: 3,
      maxZoom: 19,
      webgl: { minZoom: 3, maxZoom: 21 },
      zoomLevelBase: 18,
      errorUrl: w.imgPath + 'blank.gif',
      bounds: new ha(new cd(-21364736, -10616832), new cd(23855104, 15859712)),
      imgExtend: 'png',
    },
    B_NONE_MAP: {
      tileUrls: '',
      tileSize: 256,
      baseUnits: 256,
      zoomLevelMin: 3,
      zoomLevelMax: 19,
      minDataZoom: 3,
      maxDataZoom: 19,
      minZoom: 3,
      maxZoom: 19,
      zoomLevelBase: 18,
      errorUrl: w.imgPath + 'bg.png',
      bounds: new ha(
        new cd(-21364736, -11708041.66),
        new cd(23855104, 12474104.17)
      ),
      imgExtend: 'png',
    },
  }
  var dO = i1
  function cp(jb, jc, T, e, ja) {
    if (ja && dO[ja]) {
      this.mapTypeName = ja
    } else {
      this.mapTypeName = BMAP_NORMAL_MAP
    }
    if (jb && jb instanceof Array) {
      var i9 = true
      for (var i8 = 0; i8 < jb.length; i8++) {
        if (jb[i8] instanceof ha) {
          continue
        } else {
          i9 = false
          break
        }
      }
      i9 && (this.bounds = jb)
    }
    if (typeof jc === 'number' && jc >= dO[this.mapTypeName].webgl.minZoom) {
      if (dO[this.mapTypeName].webgl) {
        if (jc >= dO[this.mapTypeName].webgl.minZoom) {
          this.minZoom = jc
        } else {
          this.minZoom = dO[this.mapTypeName].webgl.minZoom
        }
      } else {
        if (jc >= dO[this.mapTypeName].minZoom) {
          this.minZoom = jc
        } else {
          this.minZoom = dO[this.mapTypeName].minZoom
        }
      }
    }
    if (typeof T === 'number') {
      if (dO[this.mapTypeName].webgl) {
        if (T <= dO[this.mapTypeName].webgl.maxZoom) {
          this.maxZoom = T
        } else {
          this.maxZoom = dO[this.mapTypeName].webgl.maxZoom
        }
      } else {
        if (T <= dO[this.mapTypeName].maxZoom) {
          this.maxZoom = T
        } else {
          this.maxZoom = dO[this.mapTypeName].maxZoom
        }
      }
    }
    if (this.maxZoom < this.minZoom) {
      this.maxZoom = null
    }
    if (e && typeof e === 'function') {
      this.tileUrlFunction = e
    }
  }
  es.extend(cp.prototype, {
    addBoundary: function (e) {
      if (e instanceof ha) {
        if (this.bounds) {
          this.bounds.push(e)
        } else {
          this.bounds = [e]
        }
      }
    },
    setTileUrlFunction: function (e) {
      if (e && typeof e === 'function') {
        this.tileUrlFunction = e
      }
    },
    crossPoint: function (e, i8, i9) {
      if (i9 < this.minZoom || i9 > this.maxZoom) {
        return false
      }
      var ja = this.containsPoint(e, i9)
      if (ja) {
        return ja
      }
      for (var T = 0; T < this.bounds.length; T++) {
        if (this.bounds[T].intersects(i8)) {
          ja = true
          break
        }
      }
      return ja
    },
    containsPoint: function (e, i8) {
      if (!e || !(e instanceof cd) || !this.isValid()) {
        return false
      }
      var i9 = false
      if (i8 < this.minZoom || i8 > this.maxZoom) {
        return i9
      }
      for (var T = 0; T < this.bounds.length; T++) {
        if (this.bounds[T].containsPoint(e)) {
          i9 = true
          break
        }
      }
      return i9
    },
    isValid: function () {
      return this.bounds && this.minZoom && this.maxZoom && this.tileUrlFunction
    },
    toString: function () {
      return 'PrivateRegionDataModel'
    },
  })
  function gU(jd, i, i9, T, i8) {
    this.mgr = jd
    this.position = i9
    this._cbks = []
    this.name = jd.getTileName(T, i8, jd.map.config.style)
    this.info = T
    this._transparentPng = i8.isTransparentPng()
    var je = bK('img')
    hc(je)
    je.galleryImg = false
    var jc = je.style
    jc.position = 'absolute'
    jc.width = jd.tileSize + 'px'
    jc.height = jd.tileSize + 'px'
    jc.left = i9[0] + 'px'
    jc.top = i9[1] + 'px'
    this.img = je
    this.src = i
    if (d7 && i9._offsetX === 0) {
      jc.opacity = 0
      jc.willChange = 'opacity'
    }
    var jb = this
    this.img.onload = function (jm) {
      if (!jb.mgr) {
        return
      }
      var jh = jb.mgr
      var jf = jh.bufferTiles
      if (jh.bufferNumber > 0) {
        jf[jb.name] = jb
        jf.push(jb.name)
      }
      var jj = jf.length - jh.bufferNumber
      for (var jk = 0; jj > 0 && jk < jf.length; jk++) {
        var jl = jf[jk]
        if (!jh.mapTiles[jl]) {
          if (jf[jl]) {
            jf[jl].mgr = null
            var ji = jf[jl].img
            if (ji.parentNode) {
              hu(ji)
              ji.parentNode.removeChild(ji)
            }
            ji = null
            jf[jl].img = null
            jf[jl] = null
            delete jf[jl]
          }
          jf.splice(jk, 1)
          jk--
          jj--
        }
      }
      jb.loaded = true
      jh.imgNumber++
      if (!aI(jb.img)) {
        if (i8.tilesDiv) {
          i8.tilesDiv.appendChild(jb.img)
        }
      }
      var jm = new e7('onimagechange')
      jm.action = 'show'
      jm.tile = jb.name
      jh.map.dispatchEvent(jm)
      if (d7 && i9._offsetX === 0) {
        var jg = new e0({
          fps: 10,
          duration: 300,
          render: function (e) {
            if (jb.img && jb.img.style) {
              jb.img.style.opacity = e * 1
            }
          },
          finish: function () {
            if (jb.img && jb.img.style) {
              delete jb.img.style.opacity
              jb.img.style.willChange = 'auto'
            }
          },
        })
      }
      jb._callCbks()
    }
    this.img.onerror = function (jh) {
      jb.error = true
      jb._callCbks()
      if (!jb.mgr) {
        return
      }
      var jf = jb.mgr
      var jg = dO[i8.mapType]
      if (jg.errorUrl) {
        jb.img.src = jg.errorUrl
      }
      if (!aI(jb.img)) {
        if (i8.tilesDiv) {
          i8.tilesDiv.appendChild(jb.img)
        }
      }
    }
    je = null
    var ja = new e7('onimagebefore')
    ja.tile = jb.name
    jd.map.dispatchEvent(ja)
  }
  gU.prototype._addLoadCbk = function (e) {
    this._cbks.push(e)
  }
  gU.prototype._load = function () {
    if (FeBrowser.ie <= 6 && FeBrowser.ie > 0 && this._transparentPng) {
      this.img.src = w.imgPath + 'blank.gif'
    } else {
      this.img.src = this.src
    }
  }
  gU.prototype._callCbks = function () {
    var T = this
    for (var e = 0; e < T._cbks.length; e++) {
      T._cbks[e]()
    }
    T._cbks.length = 0
  }
  var d7 = !es.Browser.ie || es.Browser.ie > 8
  function ij(e) {
    this.tileLayers = []
    this.map = e
    this.bufferNumber = 300
    this.mapTiles = []
    this.bufferTiles = []
    this.config = dO[this.map.mapType]
    this.errorUrl = this.config.errorUrl
    this.tileSize = this.config.tileSize
    this.baseUnits = this.config.baseUnits
    this.baseZoomLevel = this.config.zoomLevelBase
    this.tileURLs = this.config.tileUrls
    this.imgNumber = 0
    this.numLoading = 0
    this.temp = {}
  }
  bo.register(function (i) {
    if (i._renderType === 'webgl') {
      return
    }
    var e = (i.tileMgr = new ij(i))
    i.addEventListener('mousewheel', function (T) {
      e.mouseWheel(T)
    })
    i.addEventListener('dblclick', function (T) {
      e.dblClick(T)
    })
    i.addEventListener('rightdblclick', function (T) {
      e.dblClick(T)
    })
    i.addEventListener('minuspress', function (T) {
      e.keypress(T)
    })
    i.addEventListener('pluspress', function (T) {
      e.keypress(T)
    })
    i.addEventListener('load', function (T) {
      if (this.mapType === BMAP_EARTH_MAP) {
        return
      }
      e.loadTiles()
    })
    i.addEventListener('zoomstartcode', function (T) {
      if (this.mapType === BMAP_EARTH_MAP) {
        return
      }
      e._zoom(T)
    })
    i.addEventListener('moving', function (T) {
      if (this.mapType === BMAP_EARTH_MAP) {
        return
      }
      e.moveGridTiles()
    })
    i.addEventListener('resize', function (T) {
      if (this.mapType === BMAP_EARTH_MAP) {
        return
      }
      e.resizeMap(T)
    })
    i.addEventListener('addtilelayer', function (T) {
      e.addTileLayer(T)
    })
    i.addEventListener('removetilelayer', function (T) {
      e.removeTileLayer(T)
    })
  })
  es.extend(ij.prototype, {
    addTileLayer: function (i8) {
      var T = this
      var i = i8.target
      T.tileLayers.push(i)
      if (T.map.loaded) {
        T.moveGridTiles()
      }
    },
    removeTileLayer: function (jf) {
      var jg = this
      var jd = jf.target
      var jb = jd.mapType
      var ja = jg.mapTiles
      var ji = jg.bufferTiles
      for (var T in ji) {
        var i8 = T.split('-')[1]
        if (i8 == jb) {
          delete ji[T]
        }
      }
      for (var T in ja) {
        var i8 = T.split('-')[1]
        if (i8 == jb) {
          delete ja[T]
        }
      }
      if (jg.zoomsDiv && jg.zoomsDiv.parentNode) {
        jg.zoomsDiv.parentNode.removeChild(jg.zoomsDiv)
        jg.zoomsDiv.innerHTML = ''
      }
      var i9 = jg.map
      if (i9.deepZoom) {
        var jh = i9.deepZoom.preDeepZoomDiv
        if (jh && jh.parentNode) {
          jh.parentNode.removeChild(jh)
        }
      }
      for (var je = 0, jc = jg.tileLayers.length; je < jc; je++) {
        if (jd == jg.tileLayers[je]) {
          jg.tileLayers.splice(je, 1)
        }
      }
      jg.moveGridTiles()
    },
    hideDeepZoomDiv: function () {
      var i = this,
        T = i.map
      if (T.deepZoom) {
        var e = T.deepZoom.preDeepZoomDiv
        if (e && e.style.display != 'none') {
          e.style.display = 'none'
        }
      }
    },
    getTileLayer: function (i9) {
      var i8 = this
      for (var T = 0, e = i8.tileLayers.length; T < e; T++) {
        tilelayer = i8.tileLayers[T]
        if (tilelayer.mapType == i9) {
          return tilelayer
        }
      }
      return null
    },
    _zoom: function (T) {
      var i = this
      if (i.zoomsDiv && i.zoomsDiv.style.display != 'none') {
        i.zoomsDiv.style.display = 'none'
      }
      i.hideDeepZoomDiv()
      i.moveGridTiles()
    },
    resizeMap: function (i) {
      this.loaded = false
      this.moveGridTiles()
    },
    _checkTilesLoaded: function () {
      this.numLoading--
      var e = this
      if (this.numLoading == 0) {
        if (this._checkLoadedTimer) {
          clearTimeout(this._checkLoadedTimer)
          this._checkLoadedTimer = null
        }
        this._checkLoadedTimer = setTimeout(function () {
          if (e.numLoading == 0) {
            e.map.dispatchEvent(new e7('ontilesloaded'))
          }
          e._checkLoadedTimer = null
        }, 80)
      }
    },
    getTileName: function (e, T, i) {
      var i9 = T.mapType
      var i8 = 'TILE-' + i9 + '-' + i + '-' + e[0] + '-' + e[1] + '-' + e[2]
      return i8
    },
    hideTile: function (i8, T) {
      var i = i8.img
      if (aI(i)) {
        if (i8.loaded) {
          this.imgNumber--
        }
        if (i.parentNode) {
          hu(i)
          i.parentNode.removeChild(i)
        }
      }
      var i9 = new e7('onimagechange')
      i9.tile = this.getTileName(i8.info, T, this.map.config.style)
      i9.action = 'hide'
      delete this.mapTiles[i8.name]
      if (!i8.loaded) {
        hu(i)
        i8._callCbks()
        i = null
        i8.img = null
        i8.mgr = null
      }
      this.map.dispatchEvent(i9)
    },
    loadTiles: function () {
      var i = this
      if (es.Browser.ie) {
        try {
          document.execCommand('BackgroundImageCache', false, true)
        } catch (T) {}
      }
      if (this.zoomsDiv && this.zoomsDiv.style.display != 'none') {
        this.zoomsDiv.style.display = 'none'
      }
      i.hideDeepZoomDiv()
      i.moveGridTiles()
    },
    getCell: function (i9, i8) {
      var e = this.baseUnits * Math.pow(2, this.baseZoomLevel - i8)
      var T = parseInt(i9.lng / e)
      var i = parseInt(i9.lat / e)
      return [T, i, e * (T + 0.5), e * (i + 0.5)]
    },
    moveGridTiles: function () {
      var jm = this.map,
        jv = jm.getMapType(),
        jt = this.tileLayers.length
      var jr = jm.centerPoint
      if (jv !== BMAP_SATELLITE_MAP) {
        jr = ev.calcLoopCenterPoint(jr)
      }
      var jd = jm.width
      var jH = jm.getZoomUnits()
      var js = jH * jd
      var jx = jr.lng - js / 2
      var ji = jr.lng + js / 2
      var jl = ev.isAddWidth(jx, ji)
      for (var jz = 0; jz < jt; jz++) {
        var i9 = this.tileLayers[jz]
        if (i9.baseLayer || jt == 1) {
          this.tilesDiv = i9.tilesDiv
        }
        var jn = dO[i9.mapType]
        var i8 = jm.zoomLevel
        var jC = jm.getZoomUnits(jm.zoomLevel)
        var jh = jn.baseUnits * Math.pow(2, jn.zoomLevelBase - i8)
        var jf = Math.floor(jr.lng / jh)
        var jy = Math.floor(jr.lat / jh)
        var jk = jn.tileSize
        var jo = [
          jf,
          jy,
          ((jr.lng - jf * jh) / jh) * jk,
          ((jr.lat - jy * jh) / jh) * jk,
        ]
        var jg = jl ? (jm.width / 2) * 1.5 : jm.width / 2
        var jj = jo[0] - Math.ceil((jg - jo[2]) / jk)
        var jG = jo[1] - Math.ceil((jm.height / 2 - jo[3]) / jk)
        var jA = jo[0] + Math.ceil((jg + jo[2]) / jk)
        var jp = jo[1] + Math.ceil((jm.height / 2 + jo[3]) / jk)
        var je = []
        for (var jE = jj; jE < jA; jE++) {
          for (var jD = jG; jD < jp; jD++) {
            je.push([jE, jD])
            var ju = 'id_' + jE + '_' + jD + '_' + i8
            je[ju] = true
          }
        }
        if (i9.mapType !== BMAP_SATELLITE_MAP) {
          je = ev.calcLoopTiles(je, i8)
        }
        je.sort(
          (function (i) {
            return function (jJ, jK) {
              return (
                0.4 * Math.abs(jJ[0] - i[0]) +
                0.6 * Math.abs(jJ[1] - i[1]) -
                (0.4 * Math.abs(jK[0] - i[0]) + 0.6 * Math.abs(jK[1] - i[1]))
              )
            }
          })([jo[0], jo[1]])
        )
        var T = this.mapTiles
        var e = -jr.lng / jC
        var jI = jr.lat / jC
        var jw = [e, jI]
        for (var jq in T) {
          var jb = T[jq]
          var jF = jb.info
          if (!jF) {
            continue
          }
          var ju = 'id_' + jF[0] + '_' + jF[1] + '_' + jF[2]
          if (!je[ju]) {
            this.hideTile(jb, i9)
          }
        }
        var ja = -jm.offsetX + jm.width / 2
        var jc = -jm.offsetY + jm.height / 2
        i9.tilesDiv.style.left = Math.round(e + ja) - jw[0] + 'px'
        i9.tilesDiv.style.top = Math.round(jI + jc) - jw[1] + 'px'
        this.numLoading += je.length
        for (var jE = 0, jB = je.length; jE < jB; jE++) {
          this.showTile(
            [je[jE][0], je[jE][1], jm.zoomLevel],
            jw,
            i9,
            jE,
            jm.config.style
          )
        }
      }
    },
    showTile: function (jb, ja, je, jj) {
      this.centerPos = ja
      var jc = dO[je.mapType]
      var jf = this.map.config.style
      var i8 = this.getTileName(jb, je, jf)
      var i9 = jb[0] * jc.tileSize + ja[0]
      var T = (-1 - jb[1]) * jc.tileSize + ja[1]
      var ji = [i9, T]
      var jd = null
      if (je.mapType !== BMAP_SATELLITE_MAP) {
        jd = ev.calcLoopParam(jb[0], jb[2])
        var jh = jd.offsetX
        ji[0] += jh
        ji._offsetX = jh
      }
      var jm = this
      var jl = this.mapTiles[i8]
      if (jl) {
        jl.img.style.left = ji[0] + 'px'
        jl.img.style.top = ji[1] + 'px'
        if (jl.loaded) {
          this._checkTilesLoaded()
        } else {
          jl._addLoadCbk(function () {
            jm._checkTilesLoaded()
          })
        }
        return
      }
      jl = this.bufferTiles[i8]
      if (jl) {
        this.imgNumber++
        je.tilesDiv.insertBefore(jl.img, je.tilesDiv.lastChild)
        this.mapTiles[i8] = jl
        jl.img.style.left = ji[0] + 'px'
        jl.img.style.top = ji[1] + 'px'
        if (jl.loaded) {
          this._checkTilesLoaded()
        } else {
          jl._addLoadCbk(function () {
            jm._checkTilesLoaded()
          })
        }
        var jk = new e7('onimagechange')
        jk.action = 'cache'
        jk.tile = this.getTileName(jb, je, jf)
        this.map.dispatchEvent(jk)
      } else {
        var jg = new eL(jb[0], jb[1])
        if (jd) {
          jg.x = jd.col
        }
        var i = je.getTilesUrl(jg, jb[2])
        jl = new gU(this, i, ji, jb, je)
        jl._addLoadCbk(function () {
          jm._checkTilesLoaded()
        })
        jl._load()
        this.mapTiles[i8] = jl
        gv(this.map)
      }
    },
    mouseWheel: function (jc) {
      var jb = this.map
      if (!jb.config.enableWheelZoom) {
        return
      }
      var jd = jb.zoomLevel + (jc.trend === true ? 1 : -1)
      var i9 = jb._getProperZoom(jd)
      if (i9.exceeded) {
        var T = new e7('onzoomexceeded')
        T.targetZoom = jd
        jb.dispatchEvent(T)
        return
      }
      jb.dispatchEvent(new e7('onzoomstart'))
      jb.lastLevel = jb.zoomLevel
      jb.zoomLevel = i9.zoom
      var i = jc.pixel
      var i8 = jb.pixelToPointIn(i, { zoom: jb.lastLevel })
      var ja = jb.getZoomUnits(jb.zoomLevel)
      jb.centerPoint = new cd(
        i8.lng + ja * (jb.width / 2 - i.x),
        i8.lat - ja * (jb.height / 2 - i.y)
      )
      this.zoom(i)
    },
    dblClick: function (T) {
      var i = this.map
      if (!i.config.enableDblclickZoom) {
        return
      }
      if (i.mapType === 'B_EARTH_MAP') {
        return
      }
      if (i.currentOperation === dI.dragging) {
        return
      }
      if (T.type == 'onrightdblclick') {
        i.zoomOut(T.point)
      } else {
        i.zoomIn(T.point)
      }
    },
    keypress: function (T) {
      var i = this.map
      if (i.getMapType() === BMAP_EARTH_MAP) {
        return
      }
      T.type == 'onpluspress' ? i.zoomIn() : i.zoomOut()
    },
  })
  function gI(i8) {
    this.opts = i8 || {}
    this.copyright = this.opts.copyright || {}
    this.transparentPng = this.opts.transparentPng || false
    this.png8 = this.opts.png8 || false
    this.baseLayer = this.opts.baseLayer || false
    this.dataType = this.opts.dataType || 1
    this.transform = this.opts.transform || 0
    this.isFlat = !this.opts.isFlat ? false : true
    this.showLabel = this.opts.showLabel === false ? false : true
    var e = this.opts.tileTypeName || 'web'
    this.tileType = hb.getInstance(e)
    this.clipTile = this.opts.clipTile || false
    this._type = 'tilelayer'
    var i = bJ() ? 128 : 256
    this.cacheSize = this.opts.cacheSize || i
    var T = this
    this.tileCache = new at(this.cacheSize, {
      clearCallback: function (i9) {
        if (i9.label) {
          if (i9.label.textImageBitmap) {
            i9.label.textImageBitmap.close()
          }
          if (i9.label.indoorTextImageBitmap) {
            i9.label.indoorTextImageBitmap.close()
          }
        }
        T._removeIndoorData(i9)
      },
    })
    this.scaler = fz() >= 1.5 ? 2 : 1
    this.normalUdt = iN('ditu', 'normal').udt
    this.numLoading = 0
    this.useThumbData = false
    this.useThumbData = this.opts.useThumbData || false
    if (this.baseLayer) {
      this.useThumbData = true
    }
    if (typeof this.opts.customLayer === 'boolean') {
      this.customLayer = this.opts.customLayer
    } else {
      this.customLayer = true
    }
  }
  gI.inherits(cJ, 'TileLayer')
  es.extend(gI.prototype, {
    isTransparentPng: function () {
      return this.transparentPng
    },
    getTilesUrl: function (jf, e) {
      var T = dO[this.mapType]
      if (typeof T !== 'object') {
        return null
      }
      var i8 = jf.x
      var jg = jf.y
      if (this.mapType !== BMAP_SATELLITE_MAP) {
        var jg = ev.calcLoopParam(jg, e).col
      }
      var i = ''
      if (this.opts.tileUrlTemplate) {
        i = this.opts.tileUrlTemplate
        i = i.replace(/\{X\}/, jg)
        i = i.replace(/\{Y\}/, i8)
        i = i.replace(/\{Z\}/, e)
      } else {
        if (this.mapType === BMAPGL_NORMAL_MAP) {
          var je = this.isCanvasMap ? 0 : 1
          var ja = T.tileUrls[Math.abs(jg + i8) % T.tileUrls.length]
          if (window.offLineIPAddress) {
            ja = window.offLineIPAddress + 'tile5/'
          }
          var i9 = this.map.config.style
          i =
            ja +
            '?qt=vtile&x=' +
            i8 +
            '&y=' +
            jg +
            '&z=' +
            e +
            (i9 === 'default' ? '' : '&styleId=1') +
            '&styles=pl&udt=' +
            this.normalUdt +
            '&scaler=' +
            this.scaler +
            '&showtext=' +
            je
          i = i.replace(/-(\d+)/gi, 'M$1')
        }
        if (this.mapType === BMAP_SATELLITE_MAP) {
          var jb = iN('ditu', 'satellite')
          var jd = jb.ver
          var jc = jb.udt
          i =
            T.tileUrls[Math.abs(jg + i8) % T.tileUrls.length] +
            'u=x=' +
            i8 +
            ';y=' +
            jg +
            ';z=' +
            e +
            ';v=' +
            jd +
            ';type=sate&fm=46&udt=' +
            jc
          i = i.replace(/-(\d+)/gi, 'M$1')
        }
      }
      return i
    },
    initialize: function (ja) {
      this.map = ja
      if (ja._renderType === 'webgl') {
        var i9 = null
        if (this.customLayer !== false) {
          i9 = this.getTilesUrl
        }
        es.extend(this, eH)
        this.labelProcessor = new ic(this)
        this.callbackDataQueue = []
        if (i9) {
          this.getTilesUrl = i9
        }
        var i = this
        ja.on('indoor_data_refresh', function (jb) {
          if (!i.baseLayer) {
            return
          }
          i._refreshIndoorData(jb.uid, jb.floor)
        })
        ja.on('custom_labels_ready', function (jb) {
          if (!i.baseLayer) {
            return
          }
          i._doWorkAfterLabelImageLoad(
            jb.virtualTile,
            jb.labelCanvas,
            null,
            jb.imgKey
          )
        })
        ja.on('glmoduleloaded', function () {
          if (!i.baseLayer) {
            return
          }
          i.updateAllIconsTextureCoords()
        })
        ja.on('layer_update', function (jc) {
          if (jc.name === i.tileType.getName() && ja.customLoaded) {
            i.tileCache.clear()
            ja._featureMgr.clearData(i.drawIndex)
            ja._featureMgr.setLabelData([])
            ja._featureMgr.clearLabelOverlayData()
            i.labelProcessor.iconCache = {}
            var jb = new e7('onlayer_clear')
            ja.fire(jb)
          }
        })
        if (this.ontology && this.ontology._initEvent) {
          this.ontology._initEvent(ja)
        }
      }
      if (!ja.temp.layerZIndex) {
        ja.temp.layerZIndex = 0
      }
      this.zIndex = this.zIndex || 0
      if (this.baseLayer) {
        this.zIndex = 0
      }
      this.adjustZIndex()
      if (!ja.temp.layid) {
        ja.temp.layid = 0
      }
      if (!this.opts.mapType) {
        this.mapType = 'BMAP_CUSTOM_LAYER_' + ja.temp.layid
        ja.temp.layid++
      } else {
        this.mapType = this.opts.mapType
      }
      var T = dO[this.mapType]
      if (!T) {
        dO[this.mapType] = {
          tileUrls: [],
          tileSize: 256,
          baseUnits: 256,
          zoomLevelMin: 1,
          zoomLevelMax: 19,
          minZoom: 3,
          maxZoom: 19,
          minDataZoom: 3,
          maxDataZoom: 19,
          zoomLevelBase: 18,
          errorUrl: w.imgPath + '/blank.gif',
          bounds: new ha(
            new cd(-21364736, -10616832),
            new cd(23855104, 15859712)
          ),
          imgExtend: 'png',
        }
      }
      if (ja._renderType !== 'webgl') {
        var i8 = bA(
          ja.platform,
          '<div style="position:absolute;z-index:' + this.zIndex + '"></div>'
        )
        i8.style.display = ''
        i8.style.left = Math.ceil(-ja.offsetX + ja.width / 2) + 'px'
        i8.style.top = Math.ceil(-ja.offsetY + ja.height / 2) + 'px'
        this.tilesDiv = i8
      }
      this.isCanvasMap = ja.isCanvasMap()
      this.lastZoom = ja.getZoom()
      var e = this
      this.addEventListener('initDrawData', function (jb) {
        if (e.opts.boundary) {
          e.addBoundary(e.opts.boundary)
        }
      })
    },
    remove: function () {
      if (this.tilesDiv && this.tilesDiv.parentNode) {
        this.tilesDiv.innerHTML = ''
        this.tilesDiv.parentNode.removeChild(this.tilesDiv)
      }
      delete this.tilesDiv
    },
    getCopyright: function () {
      return this.copyright
    },
    getMapType: function () {
      return this.mapType
    },
    adjustZIndex: function () {
      if (this.map && this.map._featureMgr) {
        var e = this.map._featureMgr.result.bkData
        while (e[this.zIndex]) {
          this.zIndex += 1
        }
      }
    },
    setZIndex: function (e) {
      this.setTargetZIndex(e)
    },
    setTargetZIndex: function (e) {
      this.zIndex = e
      this.drawIndex = e
      if (this.tilesDiv) {
        this.tilesDiv.style.zIndex = e
      }
    },
    calcLoopParam: function (e, i) {
      return ev.calcLoopParam(e, i)
    },
    addBoundary: function (ja) {
      if (!ja || !this.map) {
        return
      }
      if (typeof ja === 'string') {
        ja = [ja]
      }
      for (var i8 = 0; i8 < ja.length; i8++) {
        var T = new BMapGL.Polygon(ja[i8])
        if (T && bG(T._i)) {
          var i9 = new e7('onbeforeaddoverlay', T)
          i9.overlay = T
          i9.isLayerMask = true
          this.map.dispatchEvent(i9)
          T._i(this.map)
          if (this.boundary) {
            this.boundary.push(T)
          } else {
            this.boundary = [T]
          }
        }
      }
      this.updateBoundary()
    },
    clearBoundary: function () {
      this.boundary = false
      this.updateBoundary()
    },
    updateBoundary: function () {
      if (this.boundary === undefined || !this.map) {
        return
      }
      var i = this.map._featureMgr.result.bkData
      if (i[this.zIndex]) {
        i[this.zIndex].boundary = this.boundary
        this.map.dispatchEvent(new e7('onrefresh'))
        if (this.boundary === false) {
          var T = new e7('onremoveLayerMask')
          T.hasLayerBoundary = this.map._featureMgr.hasLayerBoundary()
          this.map.dispatchEvent(T)
        }
      }
    },
  })
  function h(i, e, T) {
    this.bounds = i
    this.content = e
    this.mapType = T
  }
  h.inherits(cJ, 'Copyright')
  var dT = {
    get: function (e) {
      if (!dT.singleton) {
        dT.singleton = new fr(e)
      }
      return dT.singleton
    },
  }
  function fr(i) {
    this._map = i
    this._tileMgr = i.tileMgr
    this._animationDiv = null
    this._preAnimationDiv = null
    this._animation = null
    this._baseLayerDiv = null
    this._transformStyleName = cH.ifSupportCSS3('transform', true)
    this._transformOriginStyleName = cH.ifSupportCSS3('transformOrigin', true)
    this._preZoomTimes = 1
    this._preRenderTick = 1
    this._enableCanvas2dMap = !!(i.getRenderType() === 'canvas')
    this._isIE9 = !!(es.Browser.ie === 9)
    var e = this
    i.addEventListener('maptypechange', function () {
      e.hide()
    })
    i.addEventListener('load', function () {
      e.hide()
    })
  }
  es.extend(fr.prototype, {
    prepareLayer: function () {
      var i8 = this._map
      var e = this._tileMgr
      this._canvas2dMapMgr = i8.canvas2dMapMgr
      var T = (this._baseLayerDiv = e.tilesDiv)
      if (!this._animationDiv) {
        var i = this._preAnimationDiv
        if (i) {
          i.parentNode && i.parentNode.removeChild(i)
          this._preAnimationDiv = null
        }
        this._preAnimationDiv = this._animationDiv = T.cloneNode(true)
        i8.platform.insertBefore(this._animationDiv, i8.platform.firstChild)
      }
      this.show()
    },
    prepareAniParam: function () {
      var i8 = this._animationDiv
      if (!i8) {
        return
      }
      var e = i8.children.length
      var T
      this._zoomAniInfo = []
      for (var i9 = e - 1; i9 > -1; i9--) {
        var ja = {}
        T = i8.children[i9].style
        ja.top = parseInt(T.top, 10)
        ja.left = parseInt(T.left, 10)
        this._zoomAniInfo[i9] = ja
      }
    },
    prepareLabelLayer: function () {
      var i9 = this._map
      if (this._enableCanvas2dMap && i9.canvas2dMapMgr) {
        if (this.touchZoomLabelCanvas) {
          this.touchZoomLabelCanvas.parentNode.removeChild(
            this.touchZoomLabelCanvas
          )
        }
        var i = i9.canvas2dMapMgr._labelCanvas
        this.touchZoomLabelCanvas = i.cloneNode(false)
        var e = this.touchZoomLabelCanvas.getContext('2d')
        e.drawImage(i, 0, 0)
        i9.platform.insertBefore(
          this.touchZoomLabelCanvas,
          i9.platform.firstChild
        )
        var i8 = parseInt(i.style.left, 10)
        var T = parseInt(i.style.top, 10)
        this.touchZoomLabelCanvas.style.zIndex = 9
        this.touchZoomLabelCanvas.style[this._transformOriginStyleName] =
          this._fixPosition.x -
          (i9.offsetX + i8) +
          'px ' +
          (this._fixPosition.y - (i9.offsetY + T)) +
          'px'
        i.style.visibility = 'hidden'
      }
    },
    show: function () {
      if (this._animationDiv) {
        this._animationDiv.style.visibility = ''
      }
    },
    showLabel: function () {
      var i = this._map
      if (this._enableCanvas2dMap && i.canvas2dMapMgr) {
        var e = i.canvas2dMapMgr._labelCanvas
        if (e) {
          e.style.visibility = ''
        }
        if (this.touchZoomLabelCanvas) {
          this.touchZoomLabelCanvas.style.zIndex = -2
          this.touchZoomLabelCanvas.style.visibility = 'hidden'
        }
      }
    },
    hide: function () {
      if (this._animationDiv) {
        this._animationDiv.style.visibility = 'hidden'
      }
      if (this._preAnimationDiv) {
        this._preAnimationDiv.style.visibility = 'hidden'
      }
    },
    hideNonAnimationLayers: function () {
      var i8 = this._map
      if (i8.getRenderType() === 'dom') {
        if (i8.overlayDiv) {
          i8.overlayDiv.style.visibility = 'hidden'
        }
        if (i8.overlayDivEx) {
          i8.overlayDivEx.style.visibility = 'hidden'
        }
      }
      var ja = i8.tileMgr.tileLayers
      var i9
      for (var T = 0, e = ja.length; T < e; T++) {
        i9 = ja[T]
        i9.tilesDiv.style.visibility = 'hidden'
      }
    },
    showNonAnimationLayers: function () {
      var i8 = this._map
      if (i8.getRenderType() === 'dom') {
        if (i8.overlayDiv) {
          i8.overlayDiv.style.visibility = ''
        }
        if (i8.overlayDivEx) {
          i8.overlayDivEx.style.visibility = ''
        }
      }
      var ja = i8.tileMgr.tileLayers
      var i9
      for (var T = 0, e = ja.length; T < e; T++) {
        i9 = ja[T]
        i9.tilesDiv.style.visibility = ''
      }
    },
    setFixPosition: function (e) {
      this._fixPosition = e
    },
    setZoom: function (e, je) {
      var jb = this._fixPosition
      var jk = this._map
      var jl = this._baseLayerDiv
      var jc = {
        x: jb.x - parseInt(jl.style.left, 10) - jk.offsetX,
        y: jb.y - parseInt(jl.style.top, 10) - jk.offsetY,
      }
      var i8 = this._animationDiv
      if (!i8) {
        return
      }
      var ji = i8.children.length
      var jg
      var jj = this._transformStyleName
      var ja = this._transformOriginStyleName
      var jm = this
      var jo
      var jd
      for (var jh = ji - 1; jh > -1; jh--) {
        var jf = this._zoomAniInfo[jh]
        jg = i8.children[jh].style
        var i9 = jf.left - jc.x
        var T = jf.top - jc.y
        jf.dx = i9 * e - i9
        jf.dy = T * e - T
        jf.preDx = i9 - i9
        jf.preDy = T - T
        jo = jf.preDx + (jf.dx - jf.preDx)
        jd = jf.preDy + (jf.dy - jf.preDy) + je
        jg.left = jf.left + jo + 'px'
        jg.top = jf.top + jd + 'px'
        jg.width = jg.height = 256 * e + 'px'
      }
      if (this._enableCanvas2dMap) {
        var jn = !jm._isIE9
          ? 'translate3d(0px, ' + je + 'px, 0) scale(' + e + ')'
          : 'translate(0px, ' + je + 'px) scale(' + e + ')'
        this.touchZoomLabelCanvas.style[jj] = jn
      }
    },
    setZoomFinish: function () {
      this._animationDiv = null
    },
    startAnimation: function (jb) {
      this.prepareLayer()
      this.hideNonAnimationLayers()
      var ju = this._map
      if (this.touchZoomLabelCanvas) {
        this.touchZoomLabelCanvas.style.display = 'none'
      }
      jb = jb || {}
      var js = jb.zoomCount || 0
      var jg = jb.fixPosition
      var jq = jb.fixMCPosition
      var je = jb.pixOffset
      this._zoomCount = js
      var i8 = ju.getZoom()
      var jt = i8 + js
      var e = ju.config.enableContinuousZoom
      var jk = 0.5
      var jf = 5
      var T = Math.pow(2, js)
      var jw = this._baseLayerDiv
      var jh = {
        x: jg.x - parseInt(jw.style.left, 10) - ju.offsetX,
        y: jg.y - parseInt(jw.style.top, 10) - ju.offsetY,
      }
      var jc = this._animationDiv
      var jo = jc.children.length
      var jy = this._preZoomTimes
      var jr = []
      var jp = this._transformStyleName
      var jd = this._transformOriginStyleName
      for (var jn = jo - 1; jn > -1; jn--) {
        var jl = {}
        var jm = jc.children[jn].style
        jl.top = parseInt(jm.top, 10)
        jl.left = parseInt(jm.left, 10)
        var ja = jl.left - jh.x
        var i9 = jl.top - jh.y
        jl.dx = ja * T - ja
        jl.dy = i9 * T - i9
        jl.preDx = ja * jy - ja
        jl.preDy = i9 * jy - i9
        jr[jn] = jl
      }
      var jv = this
      var jj
      var jx
      var ji
      this._zoomAni = new e0({
        fps: 60,
        duration: e ? 500 : 1,
        transition: function (i) {
          i = (i * jf) / (2 * jk)
          return jf * i - jk * i * i
        },
        render: function (jH) {
          jH = (jH * (4 * jk)) / (jf * jf)
          jj = jy + jH * (T - jy)
          var jA = i8 + m(jj)
          var jF = null
          var jE = 0
          var jI = 0
          if (jb.onAnimationBeforeLooping) {
            var jJ = jb.onAnimationBeforeLooping(jH, jA)
            jF = jJ.loopingCenter
            jE = jJ.yDiff
            jI = jJ.totalYDiff
          }
          for (var jB = jr.length - 1; jB > -1; jB--) {
            var jC = jr[jB]
            if (jc.children[jB]) {
              var jG = jc.children[jB].style
              jx = jC.preDx + (jC.dx - jC.preDx) * jH - je.width * jH
              ji = jC.preDy + (jC.dy - jC.preDy) * jH - je.height * jH + jE
              jG.left = jC.left + jx + 'px'
              jG.top = jC.top + ji + 'px'
              jG.height = jG.width = 256 * jj + 'px'
            }
          }
          var jz = je.width * jH
          var jD = je.height * jH
          if (ju.isRestrict) {
            jv._enableCanvas2dMap && jv._canvas2dMapMgr.clearLabel()
          } else {
            jv._enableCanvas2dMap &&
              jv._canvas2dMapMgr.drawLabel(
                jj,
                jg,
                i8,
                jt,
                js,
                jH,
                jz,
                jD,
                jI,
                jE
              )
          }
          jv._preZoomTimes = jj
          jv._preRenderTick = jH
          jb.onAnimationLooping && jb.onAnimationLooping(jH, jA, jF)
        },
        finish: function () {
          jv._preZoomTimes = 1
          jv._zoomAni = null
          jv._animationDiv = null
          jb.onAnimationFinish && jb.onAnimationFinish()
          jv.showNonAnimationLayers()
        },
      })
      return this._zoomAni
    },
    stopAnimation: function () {
      if (this._zoomAni) {
        this._zoomAni.stop()
        this._zoomAni = null
      }
    },
  })
  function i5(e) {
    this._initVars(e)
    this._initColorCanvas()
    this._bindEvent(e)
  }
  es.extend(i5.prototype, {
    _initVars: function (e) {
      this._map = e._map
      this._canvas2dMapMgr = e
      this._labelCtx = e._labelCtx
      this.ratio = this._map.config.ratio
      this.sizeRatio = this.ratio > 1 ? 2 : 1
      this.RANK1 = 1000000
      this.RANK2 = 2000000
      this.RANK3 = 3000000
      this.RANK4 = 4000000
      this.RANK5 = 5000000
    },
    _initColorCanvas: function () {
      var i = 256,
        T = bK('canvas'),
        e = T.style
      e.width = i + 'px'
      e.height = i + 'px'
      T.width = i
      T.height = i
      this._colorCvsSize = i
      this._colorCvs = T
      this._colorCtx = T.getContext('2d')
    },
    getLabelImageData: function (jl) {
      var jk = jl.textImg
      var T = jl.textPos
      var ji = this.ratio
      var jg = this.sizeRatio / ji
      var i9 = this._colorCtx
      var jd = this._colorCvsSize
      i9.clearRect(0, 0, jd, jd)
      var jf = 0
      var e = 0
      var jc = 0
      for (var je = 0; je < T.length; je++) {
        if (T[je].width > jf) {
          jf = T[je].width
          e = je
          jc = T[je].drawX
        }
      }
      jf /= jg
      var jh = 0
      for (var je = 0, jb = T.length; je < jb; je++) {
        var jj = T[je]
        var jm
        if (je === e) {
          jm = 0
        } else {
          jm = jj.drawX - jc
        }
        i9.drawImage(
          jk,
          jj.srcX,
          jj.srcY,
          jj.width,
          jj.height,
          jm,
          jh,
          jj.width / jg,
          jj.height / jg
        )
        if (jj.width / jg > jf) {
          jf = jj.width / jg
        }
        jh += jj.height / jg + 2 * ji
      }
      var i8 = i9.getImageData(0, 0, jf, jh)
      var ja = i9.getImageData(0, 0, jf, jh)
      return [i8, ja]
    },
    _bindEvent: function (i) {
      var e = this,
        T = i._map
      T.addEventListener('onspotmouseover', function (jb) {
        if (!this.isCanvasMap() || !this.temp.isPermitSpotOver) {
          return
        }
        if (jb.spots.length > 0) {
          var ja = jb.spots[0].userdata.uid
          var i9 = jb.spots[0].userdata.name
          var i8 = e.findLabelByUid(ja, i9)
          i8 && e._toHighLightColor(i8)
        }
      })
      T.addEventListener('onspotmouseout', function (jb) {
        if (!this.isCanvasMap() || !this.temp.isPermitSpotOver) {
          return
        }
        if (jb.spots.length > 0) {
          var ja = jb.spots[0].userdata.uid
          var i9 = jb.spots[0].userdata.name
          var i8 = e.findLabelByUid(ja, i9)
          i8 && e._toDefaultColor(i8)
        }
      })
      T.addEventListener('onspotclick', function (jb) {
        if (!this.isCanvasMap() || !this.temp.isPermitSpotOver) {
          return
        }
        if (jb.spots && jb.spots.length > 0) {
          var ja = jb.spots[0].userdata.uid
          var i9 = jb.spots[0].userdata.name
          var i8 = e.findLabelByUid(ja, i9)
          i8 && e._changeBaseMapState(i8)
        } else {
          e._recoverNormalState()
        }
      })
      T.on('spot_status_reset', function () {
        e._recoverNormalState()
      })
      T.on('spot_highlight', function (i9) {
        var i8 = e.findLabelByUid(i9.uid)
        i8 && e._changeBaseMapState(i8)
      })
    },
    _getTextBound: function (jj) {
      if (!jj.textPos) {
        return null
      }
      var jh = this.ratio
      var jf = this.sizeRatio / jh
      var T = jj.textPos
      var ji = jj.baseDrawX
      var jg = jj.baseDrawY
      var jd = ji * jh + (T[0].drawX - ji) / jf
      var jb = jg * jh + (T[0].drawY - jg) / jf
      var i9 = jd + T[0].width / jf
      var e = jb + T[0].height / jf
      for (var je = 0, jc = T.length; je < jc; je++) {
        var jk = T[je]
        var ja = ji * jh + (jk.drawX - ji) / jf
        if (ja < jd) {
          jd = ja
        }
        var i8 = jg * jh + (jk.drawY - jg) / jf
        if (i8 < jb) {
          jb = i8
        }
        if (ja + jk.width > i9) {
          i9 = ja + jk.width
        }
        if (i8 + jk.height > e) {
          e = i8 + jk.height
        }
      }
      return [jd, jb, i9, e]
    },
    _toHighLightColor: function (T) {
      if (T._tempRank && T._tempRank == this.RANK5) {
        return
      }
      var jc = this._getTextBound(T)
      if (!jc) {
        return
      }
      var i8 = Math.round(jc[0])
      var i = Math.round(jc[1])
      var e = this.getLabelImageData(T)
      var ja = e[0]
      var i9 = e[1]
      var jb = this._canvas2dMapMgr.getFilterImageData(ja, this.RANK5)
      T._oldImgData = i9
      this._labelCtx.putImageData(jb, i8, i)
    },
    _toDefaultColor: function (e) {
      if (e._tempRank && e._tempRank == this.RANK5) {
        return
      }
      if (e._oldImgData) {
        var i = this.sizeRatio
        var T = this._getTextBound(e)
        if (!T) {
          return
        }
        this._labelCtx.putImageData(
          e._oldImgData,
          Math.round(T[0]),
          Math.round(T[1])
        )
        e._oldImgData = null
      }
    },
    _changeBaseMapState: function (i8) {
      var T = this._canvas2dMapMgr
      var i = i8.guid
      var e = i8.guidExt
      var i9 = { guid: i, name: i8.name, guidExt: e }
      T._labelStrategy.setStrategyInfo(i9)
      T._loadData()
    },
    _recoverNormalState: function () {
      var e = this._canvas2dMapMgr
      e._labelStrategy.setStrategyInfo(null)
      e._loadData()
    },
    findLabelByUid: function (ja, i8) {
      var jc = this._canvas2dMapMgr,
        e = jc._computedLabel
      for (var i9 = 0, T = e.length; i9 < T; i9++) {
        var jb = e[i9]
        if (!jc.isClickableLabel(jb)) {
          continue
        }
        if (ja && jb.guid === ja) {
          return jb
        }
        if (i8 && jb.name === i8) {
          return jb
        }
      }
      return null
    },
  })
  function z(e) {
    this._initVars(e)
  }
  es.extend(z.prototype, {
    _initVars: function (e) {
      this._map = e._map
      this._canvas2dMapMgr = e
      this.ratio = this._map.config.ratio
      this._strategyInfo = null
      this.RANK1 = 1000000
      this.RANK2 = 2000000
      this.RANK3 = 3000000
      this.RANK4 = 4000000
      this.RANK5 = 5000000
    },
    setStrategyInfo: function (e) {
      this._strategyInfo = e
    },
    preComputeLabel: function (je, j5, jO, jq, jZ, kj) {
      var jI = [],
        jm = je._centerX,
        jk = je._centerY,
        kk = jq * jZ
      var jU = this.ratio
      var jd = this._map.getZoom()
      var jD = 0
      if (jd === 5) {
        jD = 4
      }
      if (jd === 8) {
        jD = -6
      }
      je.sort(function (kl, i) {
        if (kl.x * kl.y < i.x * i.y) {
          return -1
        } else {
          return 1
        }
      })
      for (var jF = 0, jB = je.length; jF < jB; jF++) {
        var ka = je[jF],
          jw = ka.x,
          jt = ka.y,
          jr = ka.z
        var jy = ev.calcLoopParam(jw, jr).offsetX
        var jS = jw * kk,
          jR = (jt + 1) * kk,
          i8 = (jS - jm) / jq + j5 / 2 + jy,
          T = (jk - jR) / jq + jO / 2
        for (var jC = 0, ke = ka.length; jC < ke; jC++) {
          var jg = ka[jC],
            jn = undefined,
            jl = undefined,
            kc = undefined,
            kb = undefined
          var j1 = (jg.baseDrawX = i8 + jg.baseX)
          var j0 = (jg.baseDrawY = T + jg.baseY)
          if (jg.type == 'fixed') {
            var jM = jg.iconPos,
              jp = jg.textPos,
              kg = jg.textImg
            if (jM) {
              jM.drawX = i8 + jM.destX
              jM.drawY = T + jM.destY
              jn = jM.drawX
              jl = jM.drawY
              kc = jM.drawX + jM.width
              kb = jM.drawY + jM.height
            }
            if (jp && kg) {
              for (var j2 = 0; j2 < jp.length; j2++) {
                var kf = jp[j2]
                kf.drawX = i8 + kf.destX
                kf.drawY = T + kf.destY
                if (!jn) {
                  jn = kf.drawX
                  jl = kf.drawY
                  kc = kf.drawX + kf.width
                  kb = kf.drawY + kf.height
                } else {
                  if (kf.drawX < jn) {
                    jn = kf.drawX
                  }
                  if (kf.drawY < jl) {
                    jl = kf.drawY
                  }
                  if (kf.drawX + kf.width > kc) {
                    kc = kf.drawX + kf.width
                  }
                  if (kf.drawY + kf.height > kb) {
                    kb = kf.drawY + kf.height
                  }
                }
              }
            }
          } else {
            jg.tileX = i8
            jg.tileY = T
            jn = i8 + jg.minXOriginal
            jl = T + jg.minYOriginal
            kc = i8 + jg.maxXOriginal
            kb = T + jg.maxYOriginal
          }
          if (jn != undefined) {
            var j4 = j1 + (jn - j1) / jU
            var j3 = j0 + (jl - j0) / jU
            var jG = j1 + (kc - j1) / jU
            var jE = j0 + (kb - j0) / jU
            jg.minX = j4
            jg.minY = j3
            jg.maxX = jG
            jg.maxY = jE
            var j8 = (j4 + jG) / 2,
              j7 = (j3 + jE) / 2,
              jP = jm + (j8 - j5 / 2) * jq,
              jN = jk + (jO / 2 - j7) * jq
            jg.geoX = jP
            jg.geoY = jN
            jI.push(jg)
          }
        }
      }
      if (kj) {
        for (var jF = 0, jB = kj.length; jF < jB; jF++) {
          var jA = kj[jF]
          var jX = jA[0]
          var jh = jA[1]
          var jM = jX.iconPos
          var jb = jM.geoX
          var i9 = jM.geoY
          var j1 = (jb - jm) / jq + j5 / 2
          var j0 = (jk - i9) / jq + jO / 2
          var jn = j1 + jM.destX
          var jl = j0 + jM.destY
          var kc = jn + jM.width
          var kb = jl + jM.height
          jX.textPos = jX.textPos || jX._textPos
          var jp = jX.textPos
          var j6 = jp[0]
          var jv = j1 + j6.destX
          var jj = j0 + j6.destY
          if (jj < jl) {
            jl = jj
          }
          if (jv + j6.width > kc) {
            kc = jv + j6.width
          }
          if (jj + j6.height > kb) {
            kb = jj + j6.height
          }
          if (jp.length === 2) {
            var ju = jp[1]
            var js = j1 + ju.destX
            var ji = j0 + ju.destY
            if (ji < jl) {
              jl = ji
            }
            if (js + ju.width > kc) {
              kc = js + ju.width
            }
            if (ji + ju.height > kb) {
              kb = ji + ju.height
            }
          }
          jX._tempBounds = [jn, jl, kc, kb]
          var jM = jh.iconPos
          var jb = jM.geoX
          var i9 = jM.geoY
          var j1 = (jb - jm) / jq + j5 / 2
          var j0 = (jk - i9) / jq + jO / 2
          var jn = j1 + jM.destX
          var jl = j0 + jM.destY
          var kc = jn + jM.width
          var kb = jl + jM.height
          jh.textPos = jh.textPos || jh._textPos
          var jp = jh.textPos
          var j6 = jp[0]
          var jv = j1 + j6.destX
          var jj = j0 + j6.destY
          if (jv < jn) {
            jn = jv
          }
          if (jj < jl) {
            jl = jj
          }
          if (jj + j6.height > kb) {
            kb = jj + j6.height
          }
          if (jp.length === 2) {
            var ju = jp[1]
            var js = j1 + ju.destX
            var ji = j0 + ju.destY
            if (js < jn) {
              jn = js
            }
            if (ji < jl) {
              jl = ji
            }
            if (ji + ju.height > kb) {
              kb = ji + ju.height
            }
          }
          jh._tempBounds = [jn, jl, kc, kb]
        }
        for (var jF = 0, jB = kj.length; jF < jB; jF++) {
          var jA = kj[jF]
          var jX = jA[0]
          var jh = jA[1]
          if (jF === 0 && jh.textPos) {
            jh._textPos = jh.textPos
            delete jh.textPos
          }
          var j9 = jX
          if (!jX.textPos && jh.textPos) {
            j9 = jh
          }
          var kd = j9._tempBounds
          for (jC = jF + 1; jC < jB; jC++) {
            var jz = kj[jC]
            var jJ = jz[0]
            var ki = jz[1]
            var jo = 0
            var kh = jJ._tempBounds
            if (
              !(
                kd[2] < kh[0] ||
                kd[0] > kh[2] ||
                kd[3] < kh[1] ||
                kd[1] > kh[3]
              )
            ) {
              jo++
              if (jJ.textPos) {
                jJ._textPos = jJ.textPos
                delete jJ.textPos
              }
            }
            var kh = ki._tempBounds
            if (
              !(
                kd[2] < kh[0] ||
                kd[0] > kh[2] ||
                kd[3] < kh[1] ||
                kd[1] > kh[3]
              )
            ) {
              jo++
              if (ki.textPos) {
                ki._textPos = ki.textPos
                delete ki.textPos
              }
            }
            if (jo >= 2) {
              if (j9.textPos) {
                j9._textPos = j9.textPos
                delete j9.textPos
              }
            }
          }
        }
        for (var jF = 0, jB = kj.length; jF < jB; jF++) {
          var jA = kj[jF]
          var jX = jA[0]
          var jh = jA[1]
          var jK = jX
          if (!jX.textPos && jh.textPos) {
            jK = jh
          }
          var jM = jK.iconPos
          var jb = jM.geoX
          var i9 = jM.geoY
          var j1 = (jK.baseDrawX = (jb - jm) / jq + j5 / 2)
          var j0 = (jK.baseDrawY = (jk - i9) / jq + jO / 2)
          jM.drawX = j1 + jM.destX
          jM.drawY = j0 + jM.destY
          var jn = jM.drawX
          var jl = jM.drawY
          var kc = jM.drawX + jM.width
          var kb = jM.drawY + jM.height
          var jp = jK.textPos
          if (jp) {
            var j6 = jp[0]
            j6.drawX = j1 + j6.destX
            j6.drawY = j0 + j6.destY
            if (j6.drawX < jn) {
              jn = j6.drawX
            }
            if (j6.drawY < jl) {
              jl = j6.drawY
            }
            if (j6.drawX + j6.width > kc) {
              kc = j6.drawX + j6.width
            }
            if (j6.drawY + j6.height > kb) {
              kb = j6.drawY + j6.height
            }
            if (jp.length === 2) {
              var ju = jp[1]
              ju.drawX = j1 + ju.destX
              ju.drawY = j0 + ju.destY
              if (ju.drawX < jn) {
                jn = ju.drawX
              }
              if (ju.drawY < jl) {
                jl = ju.drawY
              }
              if (ju.drawX + ju.width > kc) {
                kc = ju.drawX + ju.width
              }
              if (ju.drawY + ju.height > kb) {
                kb = ju.drawY + ju.height
              }
            }
          }
          var j4 = j1 + (jn - j1) / jU
          var j3 = j0 + (jl - j0) / jU
          var jG = j1 + (kc - j1) / jU
          var jE = j0 + (kb - j0) / jU
          jK.minX = j4
          jK.minY = j3
          jK.maxX = jG
          jK.maxY = jE
          var jW = (j4 + jG) / 2
          var jV = (j3 + jE) / 2
          var jc = jm + (jW - j5 / 2) * jq
          var ja = jk + (jO / 2 - jV) * jq
          jK.geoX = jc
          jK.geoY = ja
          jI.push(jK)
        }
      }
      var jY = this._strategyInfo
      if (jY) {
        var jH = jY.guid
        var jQ = jY.name
        var jx = jY.guidExt
        for (var jF = 0, jB = jI.length; jF < jB; jF++) {
          var jf = jI[jF]
          delete jf._tempRank
          if (
            !this._canvas2dMapMgr.isClickableLabel(jf) ||
            (jx === 1 && !jf.guidExt)
          ) {
            continue
          }
          if ((jH && jH === jf.guid) || (jQ && jQ === jf.name)) {
            jf._tempRank = this.RANK5
          }
        }
      } else {
        for (var jF = 0, jB = jI.length; jF < jB; jF++) {
          var jf = jI[jF]
          if (jf.type == 'line' || !jf.iconPos) {
            continue
          }
          delete jf._tempRank
        }
      }
      jI.sort(function (km, kl) {
        var kn = km._tempRank ? km._tempRank : km.rank,
          i = kl._tempRank ? kl._tempRank : kl.rank
        if (kn === i) {
          return km.baseX - kl.baseX
        }
        return i - kn
      })
      for (var jF = 0, jB = jI.length; jF < jB; jF++) {
        var j9 = jI[jF]
        j9.isDel = false
        j9.isFadeout = false
        j9._schedule = 0
        j9._isIgnore = false
        j9.arrIntersectIndex = []
        for (jC = jF + 1; jC < jB; jC++) {
          var jL = jI[jC]
          if (
            !(
              j9.maxX - jD < jL.minX ||
              j9.minX > jL.maxX - jD ||
              j9.maxY - jD < jL.minY ||
              j9.minY > jL.maxY - jD
            )
          ) {
            j9.arrIntersectIndex.push(jC)
          }
        }
      }
      for (var jF = 0, jB = jI.length; jF < jB; jF++) {
        var jf = jI[jF]
        if (jf.isDel == false) {
          var e = jf.arrIntersectIndex
          for (var jC = 0, ke = e.length; jC < ke; jC++) {
            var jT = jI[e[jC]]
            jT.isDel = true
            if (jT.guidExt === 1) {
              jT.isDel = false
            }
          }
        }
      }
      return jI
    },
  })
  function S(e) {
    this._map = e
    this._initCanvas()
    this._initVars()
    this._bindEvent()
    this._tileType = hb.getInstance('na')
  }
  bo.register(function (i) {
    if (i.getRenderType() === 'canvas') {
      var e = i.config.style
      if (bo['FeatureStyle' + e]) {
        i.canvas2dMapMgr = new S(i)
      } else {
        i.loadMapStyleFiles(function () {
          i.canvas2dMapMgr = new S(i)
          i.canvas2dMapMgr._loadData()
        })
      }
    }
  })
  es.extend(S.prototype, {
    _initCanvas: function () {
      var jb = this._map,
        i9 = jb.getSize(),
        i8 = i9.width,
        i = i9.height,
        e = jb.platform,
        jc = bK('canvas'),
        ja = jc.style
      var T = (this.ratio = jb.config.ratio)
      this._width = i8
      this._height = i
      ja.cssText =
        'position: absolute;left:0;top:0;width:' +
        i8 +
        'px;height:' +
        i +
        'px;z-index:100;'
      jc.width = i8 * T
      jc.height = i * T
      this._labelCanvas = jc
      this._labelCtx = jc.getContext('2d')
      e.appendChild(jc)
    },
    _initVars: function () {
      var e = iN('ditu', 'normal')
      this._udt = e.udt
      this._version = e.ver
      this._labelDataUrls = dO.B_NORMAL_MAP.vectorTileUrls
      this._style = bo['FeatureStyle' + this._map.config.style]
      this._labelCount = 0
      this._vectorDrawLib = new gh(this)
      this._cache = { maxNum: 500, delNum: 50, arrCache: [] }
      this._computedLabel = null
      this._spotData = null
      this._labelStrategy = new z(this)
      this._labelClick = new i5(this)
      this._biz = new dV(this)
      this._map.temp.isPermitSpotOver = true
      this.labelStyleParam = 'pl'
      if (this._map.getMapType() === BMAP_SATELLITE_MAP) {
        this.labelStyleParam = 'sl'
      }
      this.statRequestCount = 0
      this.statResponseCount = 0
    },
    _resizeHandler: function (ja) {
      var jc = this,
        i = jc._map,
        i9 = i.getSize(),
        T = i9.width,
        je = i9.height
      var jb = this.ratio
      var jf = this._labelCanvas,
        i8 = jf.style
      i8.width = T + 'px'
      i8.height = je + 'px'
      jf.width = T * jb
      jf.height = je * jb
      jc._width = T
      jc._height = je
      var jd = true
      jc._loadData(jd)
    },
    _bindEvent: function () {
      var e = this,
        i = e._map
      i.addEventListener('load', function (T) {
        e.clearLabel()
        e._loadData()
      })
      i.addEventListener('zoomend', function (T) {
        if (!T.notClearLabel) {
          e.clearLabel()
        }
        e._loadData()
      })
      i.addEventListener('moveend', function (T) {
        e._loadData()
      })
      i.addEventListener('resize', function (T) {
        e._resizeHandler(T)
      })
      i.addEventListener('maptypechange', function (T) {
        if (T.mapType === BMAP_EARTH_MAP) {
          e.hideLabelCanvas()
        } else {
          e.showLabelCanvas()
          if (T.mapType === BMAPGL_NORMAL_MAP) {
            e.labelStyleParam = 'pl'
          } else {
            if (T.mapType === BMAP_SATELLITE_MAP) {
              e.labelStyleParam = 'sl'
            }
          }
          e._loadData()
        }
      })
      i.addEventListener('streetlayer_show', function (T) {
        if (this.isCanvasMap()) {
          e.showLabelCanvas()
        }
      })
      i.addEventListener('streetlayer_hide', function (T) {
        if (this.isCanvasMap()) {
          e.hideLabelCanvas()
        }
      })
      i.addEventListener('loadbizdata', function (i8) {
        var T = i8.data
        e._biz.proecessBizData(T, function () {
          e.updateLabel()
        })
      })
      i.addEventListener('unloadbizdata', function (T) {
        e._biz.clearBizData()
        e.updateLabel()
      })
      e.isDrawText = false
      setTimeout(function () {
        if (!e.isDrawText) {
          i.dispatchEvent(new e7('onmapwhitescreen'))
        }
      }, 10000)
    },
    getStyle: function () {
      return this._style
    },
    _getZoomUnits: function (e) {
      return Math.pow(2, 18 - e)
    },
    _createCacheForm: function (T, jc, jb, i) {
      var ja = this
      var e = ja._cache
      var i8 = e.arrCache
      var jd = this._getLabelId(T, jc, jb, i)
      var i9 = { id: jd, updateLabelCounter: 0 }
      i8.push(i9)
      i8[jd] = i9
      return i9
    },
    _getLabelId: function (i, i8, T, e) {
      return '_' + i + '_' + i8 + '_' + T + '_' + e + '_' + this.labelStyleParam
    },
    _getCache: function (i, i8, T, e) {
      return this._cache.arrCache[this._getLabelId(i, i8, T, e)]
    },
    _setCacheValue: function (i9, jm, jk, i8, jf) {
      var jh = this
      var e = jh._cache
      var jb = e.arrCache
      var jd = e.maxNum
      var ja = e.delNum
      var jl = this._getLabelId(i9, jm, jk, i8)
      var jg = jb[jl]
      if (jf) {
        jg.lb = jf
      }
      if (jb.length > jd) {
        var T = jb.splice(0, ja)
        for (var je = 0, jc = T.length; je < jc; je++) {
          var ji = T[je],
            jj = ji.id
          if (jb[jj].lb) {
            jb[jj].lb = null
          }
          jb[jj] = null
          delete jb[jj]
        }
        T = null
      }
    },
    _loadData: function (jk) {
      var jD = this._map
      if (!jD.isCanvasMap()) {
        return
      }
      var jd = jD.getCenterIn()
      var jC = ev.calcLoopCenterPoint(jd)
      var jc = this._tileType
      var jf = this._width / 2
      var jr = this._height
      var js = jD.getZoom()
      var jo = jc.getDataZoom(js)
      var jh = jD.getZoomUnits(js)
      var jn = jh * jf
      var jB = jC.lng - jn
      var jA = jC.lng + jn
      var jl = ev.isAddWidth(jB, jA)
      jf = jl ? jf * 1.5 : jf
      var jm = jc.getTileSize(js)
      var i9 = jc.getMercatorSize(js, jo)
      var jg = Math.floor(jC.lng / i9)
      var ji = Math.floor(jC.lat / i9)
      var ja = [
        jg,
        ji,
        ((jC.lng - jg * i9) / i9) * jm,
        ((jC.lat - ji * i9) / i9) * jm,
      ]
      var ju = ja[0] - Math.ceil((jf - ja[2]) / jm)
      var jy = ja[1] - Math.ceil((jr / 2 - ja[3]) / jm)
      var jq = ja[0] + Math.ceil((jf + ja[2]) / jm)
      var jv = ja[1] + Math.ceil((jr / 2 + ja[3]) / jm)
      jD.temp.isPermitSpotOver = false
      var e = []
      for (var jx = ju; jx < jq; jx++) {
        for (var jw = jy; jw < jv; jw++) {
          e.push([jx, jw, jo])
          var jp = 'id_' + jx + '_' + jw + '_' + js
          e[jp] = true
        }
      }
      e._zoom = jo
      e = ev.calcLoopTiles(e, js)
      e.sort(
        (function (i) {
          return function (jF, jG) {
            return (
              0.4 * Math.abs(jF[0] - i[0]) +
              0.6 * Math.abs(jF[1] - i[1]) -
              (0.4 * Math.abs(jG[0] - i[0]) + 0.6 * Math.abs(jG[1] - i[1]))
            )
          }
        })([ja[0], ja[1]])
      )
      var jj = this._cache.arrCache
      this._curViewLabels = []
      var i8 =
        'viewKey_' + Math.floor(jd.lng) + '_' + Math.floor(jd.lat) + '_' + js
      this.statRequestCount = 0
      this.statResponseCount = 0
      this._labelCount += e.length
      var je = js
      for (var jx = 0, jt = e.length; jx < jt; jx++) {
        var jg = e[jx][0]
        var ji = e[jx][1]
        var T = e[jx][2]
        var jb = this._getLabelId(jg, ji, T, je)
        var jz = jj[jb]
        if (!jz) {
          jz = this._createCacheForm(jg, ji, T, je)
        }
        if (typeof jz.lb === 'undefined') {
          jz.lb = null
          this._loadLabelData(jg, ji, T, je, jm, i8)
          this.statRequestCount++
        } else {
          if (jz.lb) {
            this._curViewLabels.push(jz.lb)
            this._labelCount--
          } else {
            if (jk) {
              this._loadLabelData(jg, ji, T, je, jm, i8)
            }
            jz.updateLabelCounter++
          }
        }
      }
      if (this._labelCount === 0) {
        this.updateLabel()
      }
      var jE = this
      if (jE.errorTimer) {
        clearTimeout(jE.errorTimer)
      }
      jE.errorTimer = setTimeout(function () {
        if (jE._labelCount !== 0) {
          jE._labelCount = 0
          jE.updateLabel()
        }
        var jG = new e7('onloaddatatimeout')
        var jH = 0
        var jF = 0
        var jI = 0
        var i = 0
        if (jE.statRequestCount === jE.statResponseCount) {
          jH = 1
        } else {
          jF = 1
        }
        if (jF === 1) {
          i = jE.statRequestCount - jE.statResponseCount
          jI = jE.statResponseCount
        }
        jG.noTimeoutCount = jH
        jG.timeoutCount = jF
        jG.timeoutNoLoaded = i
        jG.timeoutLoaded = jI
        jE._map.dispatchEvent(jG)
      }, 500)
    },
    clearLabel: function () {
      var e = this._width
      var T = this._height
      var i = this.ratio
      this._labelCtx.clearRect(0, 0, e * i, T * i)
    },
    updateLabel: function () {
      var i = this._map
      var e = i.getCenterIn()
      var i8 = this._width
      var jb = this._height
      var je = i.getZoom()
      var jd = this._tileType.getTileSize(je)
      var jc = this._getZoomUnits(je)
      var T = this._labelCtx
      this._labelCanvas.style.left = -i.offsetX + 'px'
      this._labelCanvas.style.top = -i.offsetY + 'px'
      var ja = this._curViewLabels
      ja._centerX = e.lng
      ja._centerY = e.lat
      var i9 = this._biz.bizLabels
      this._computedLabel = this._labelStrategy.preComputeLabel(
        ja,
        i8,
        jb,
        jc,
        jd,
        i9
      )
      this._computedLabel._zoom = je
      this.clearLabel()
      this._vectorDrawLib.drawIconAndText(T, this._computedLabel, je)
      this._addSpotData()
      i.temp.isPermitSpotOver = true
      if (ja.length > 0) {
        this.isDrawText = true
      }
    },
    _loadLabelData: function (jh, jg, jf, T, ji, e) {
      var ja = jh.toString()
      var i8 = jg.toString()
      var jc =
        'cbk_' +
        ja.replace('-', '_') +
        '_' +
        i8.replace('-', '__') +
        '_' +
        Math.floor(jf)
      var jm = eV + '.' + jc
      var jl = this._labelDataUrls
      var je = Math.abs(jh + jg) % jl.length
      var jr = jl[je]
      if (window.offLineIPAddress) {
        jr = window.offLineIPAddress + 'pvd/'
      }
      var i = this.labelStyleParam
      var jk = '?qt=vtile'
      var jn = ''
      if (this._map.config.style !== 'default') {
        jn = '&styleId=1'
      }
      var jj =
        'x={x}&y={y}&z={z}&udt={udt}&v={v}&styles={styles}' +
        jn +
        '&textonly=1&textimg=1&scaler={scaler}&fn=' +
        encodeURIComponent(jm)
      var jo = ev.calcLoopParam(jh, jf).col
      var jd = this.ratio > 1 ? 2 : 1
      var jb = jj
        .replace(/{x}/, jo)
        .replace(/{y}/, jg)
        .replace(/{z}/, Math.floor(jf))
        .replace(/{styles}/, i)
        .replace(/{udt}/, this._udt)
        .replace(/{v}/, this._version)
        .replace(/{scaler}/, jd)
      var i9 = jr + jk + '&param=' + window.encodeURIComponent(eo(jb))
      var jq = this
      var jp = jq._map
      bo[jc] = function (js) {
        jq._vectorDrawLib.parseLabelData(js, jh, jg, jf, T, ji, function (jx) {
          var ju = jp.getCenterIn()
          var jy = jp.getZoom()
          var jA =
            'viewKey_' +
            Math.floor(ju.lng) +
            '_' +
            Math.floor(ju.lat) +
            '_' +
            jy
          jq._labelCount--
          var jB = jq._getCache(jh, jg, jf, T).updateLabelCounter
          jq._labelCount -= jB
          var jv = jq._curViewLabels
          if (jA === e || (jq._labelCount < 0 && jy === jf)) {
            jv.push(jx)
          }
          if (jA === e) {
            jq.statResponseCount++
          }
          if (jq._labelCount <= 0) {
            var jt = new Date().getTime()
            jq.updateLabel()
            var jw = new Date().getTime()
            var jz = new e7('oncanvasmaploaded')
            jz.drawTime = jw - jt
            if (jq.statResponseCount === jq.statRequestCount) {
              jz.isAllLoadedDrawing = true
            }
            jp.dispatchEvent(jz)
          }
          jq._setCacheValue(jh, jg, jf, T, jx)
          delete bo[jc]
        })
      }
      f5.load(i9)
    },
    drawLabel: function (T, i8, jf, i, jd, i9, e, ja, je, jb) {
      var jc = this
      if (!jc._computedLabel) {
        return
      }
      if (jc._computedLabel._zoom !== jf) {
        jc.clearLabel()
        return
      }
      jc._map.temp.isPermitSpotOver = false
      jc.clearLabel()
      jc._vectorDrawLib.zoomingIconAndText(
        this._labelCtx,
        jc._computedLabel,
        T,
        i8,
        i,
        jd,
        i9,
        e,
        ja,
        je,
        jb
      )
    },
    _addSpotData: function () {
      this._spotData = []
      var jf = this._map.getZoom()
      for (var ja = 0, i9 = this._computedLabel.length; ja < i9; ja++) {
        var jc = this._computedLabel[ja]
        if (
          !this.isClickableLabel(jc) ||
          (jc.guidExt === 1 && jc.startScale > jf)
        ) {
          continue
        }
        var jb = []
        jb[0] = (jc.minX - jc.maxX) / 2
        jb[1] = (jc.minY - jc.maxY) / 2
        jb[2] = (jc.maxX - jc.minX) / 2
        jb[3] = (jc.maxY - jc.minY) / 2
        var i8 = null
        if (jc.iconPos) {
          i8 = new cd(jc.iconPos.geoX, jc.iconPos.geoY)
        }
        var T = jc.name ? jc.name.replace('\\\\', '<br>') : ''
        if (
          jc.iconPos &&
          jc.iconPos.iconType.indexOf('ditie') > -1 &&
          this._map.getZoom() > 14
        ) {
          T = ''
        }
        var je = {
          n: T,
          pt: new cd(jc.geoX, jc.geoY),
          userdata: {
            iconPoint: i8,
            uid: jc.guid,
            name: T,
            type: jc.iconPos ? jc.iconPos.iconType : '',
            iconImg: jc.iconImg,
            mapPoi: true,
            adver_log: jc.adver_log || '',
          },
          bd: jb,
          tag: 'MAP_SPOT_INFO',
        }
        this._spotData.push(je)
      }
      var jd = new e7('onspotsdataready')
      jd.spots = this._spotData
      this._map._spotDataOnCanvas = this._spotData
      this._map.dispatchEvent(jd)
    },
    isClickableLabel: function (e) {
      if (e.isDel || (!e.guid && !e.name)) {
        return false
      }
      return true
    },
    getFilterImageData: function (T, jb) {
      var jc = T.data,
        ja = this._labelStrategy,
        jb = parseInt(jb)
      for (var jd = 0, i9 = jc.length; jd < i9; jd += 4) {
        var e = jc[jd],
          je = jc[jd + 1],
          jf = jc[jd + 2],
          jg = jc[jd + 3]
        if (jg === 0) {
          continue
        }
        var i8 = Math.round((e + je + jf) / 3)
        var jh = i8 - 90
        jh = jh < 0 ? 0 : jh
        if (jb === ja.RANK5) {
          jc[jd] = 51 + jh * 1.3
          jc[jd + 1] = 133 + jh * 0.8
          jc[jd + 2] = 255
        }
      }
      return T
    },
    showLabelCanvas: function () {
      this._labelCanvas.style.visibility = ''
    },
    hideLabelCanvas: function () {
      this._labelCanvas.style.visibility = 'hidden'
    },
  })
  var aJ = 5
  var h7 = 4
  var fR = 3
  var H = 2
  var dU = 1
  var gH = 0
  var i6 = 3
  var hv = 5
  var eK = {
    3: { start: 3, base: 3 },
    4: { start: 4, base: 5 },
    5: { start: 4, base: 5 },
    6: { start: 6, base: 7 },
    7: { start: 6, base: 7 },
    8: { start: 8, base: 9 },
    9: { start: 8, base: 9 },
    10: { start: 10, base: 10 },
    11: { start: 11, base: 12 },
    12: { start: 11, base: 12 },
    13: { start: 11, base: 12 },
    14: { start: 14, base: 15 },
    15: { start: 14, base: 15 },
    16: { start: 16, base: 17 },
    17: { start: 16, base: 17 },
    18: { start: 18, base: 19 },
    19: { start: 18, base: 19 },
    20: { start: 18, base: 19 },
    21: { start: 18, base: 19 },
  }
  function gh(i8) {
    this._canvas2dMapMgr = i8
    var i = (this.ratio = i8._map.config.ratio)
    this._featureStyle = null
    this._map = i8._map
    var T = bp()
    var e = 'udt=' + T.udt + '&v=' + T.ver
    this.sizeRatio = this.ratio > 1 ? 2 : 1
    this._binaryCache = {}
    this._iconCache = {}
    this._initColorCanvas()
  }
  es.extend(gh.prototype, {
    _initColorCanvas: function () {
      var i = 256,
        T = bK('canvas'),
        e = T.style
      e.width = i + 'px'
      e.height = i + 'px'
      T.width = i
      T.height = i
      this._colorCvs = T
      this._colorCtx = T.getContext('2d')
    },
    parseLabelData: function (i, ja, i9, i8, e, jd, jc) {
      if (!this._featureStyle) {
        this._featureStyle = this._canvas2dMapMgr.getStyle()
      }
      if (!i || !i[0]) {
        jc([])
        return
      }
      var jb = this._map.getZoomUnits()
      var T = this
      this.loadTextPng(i, jd, ja, i9, i8, e, jb, jc)
    },
    loadTextPng: function (jp, jg, je, jd, jb, i, i9, i8) {
      var jo = this
      var e = jp[5]
      var jn = this._map
      var jk = jn.getZoom()
      var T = jn.getSize()
      var jl = T.width
      var jj = T.height
      var jm = jn.getCenterIn()
      var jc = jm.lng
      var ja = jm.lat
      var ji = je * jg * i9
      var jh = (jd + 1) * jg * i9
      if (e) {
        var jf = new Image()
        jf.onload = function () {
          jo.calcIconAndTextInfo(jp, jf, jg, je, jd, jb, i, i9, ji, jh, i8)
          delete this.onload
        }
        jf.src = e
      } else {
        setTimeout(function () {
          jo.calcIconAndTextInfo(jp, null, jg, je, jd, jb, i, i9, ji, jh, i8)
        }, 1)
      }
    },
    calcIconAndTextInfo: function (jr, ji, jj, jh, je, jc, i8, ja, jl, jk, i9) {
      var jq = this
      var jp = jq._featureStyle
      var jf = []
      jf.x = jh
      jf.y = je
      jf.z = jc
      var jg = jq._canvas2dMapMgr,
        T = jh * ja * jj,
        jo = (je + 1) * ja * jj,
        jb = { tileLeft: T, tileTop: jo, zoomUnits: ja }
      var e = []
      if (jr[0]) {
        for (var jm = 0; jm < jr[0].length; jm++) {
          if (jr[0][jm][0] === i6) {
            e.push(jr[0][jm])
          }
        }
      }
      var jd = jr[2] || []
      for (var jm = 0; jm < e.length; jm++) {
        this._getFixedLabelInfo(e[jm], ji, i8, ja, jj, jl, jk, jf)
      }
      var jn = Math.pow(2, i8 - jc)
      for (jm = 0; jm < jd.length; jm++) {
        this._getLineLabelInfo(jd[jm], ji, jc, i8, ja, jj, jl, jk, jn, jf)
      }
      i9(jf)
    },
    _getFixedLabelInfo: function (ji, jm, i9, jd, jn, jq, jp, js) {
      var jh = ji[1]
      if (!jh) {
        return
      }
      var ju = this._map.getZoom()
      var jC = this._map.config.style
      var jD = this._featureStyle
      var je = i9
      if (je === 9) {
        je = 8
      }
      for (var jz = 0; jz < jh.length; jz++) {
        var jE = jh[jz]
        var e = jE[0]
        var i8 = aO.getStyleFromCache(jC, e, 'point', je, jD)
        var jy = aO.getStyleFromCache(jC, e, 'pointText', je, jD)
        if ((!jy || jy.length === 0) && (!i8 || i8.length === 0)) {
          if (je === 5) {
            var jc = jE[1]
            if (!jc) {
              continue
            }
            for (var jv = 0; jv < jc.length; jv++) {
              var jt = jc[jv][4]
              if (jt && jt[7] === '北京') {
                i8 = aO.getStyleFromCache(jC, e, 'point', 6, jD)
                jy = aO.getStyleFromCache(jC, e, 'pointText', 6, jD)
                break
              } else {
                continue
              }
            }
          } else {
            continue
          }
        }
        var jc = jE[1]
        if (!jc) {
          continue
        }
        var jA = null
        var jf = 1
        var T = 0
        var jl = 0
        if (i8 && i8[0]) {
          i8 = i8[0]
          jA = i8.icon
          jf = i8.zoom ? i8.zoom / 100 : 1
        } else {
          i8 = null
        }
        for (var jv = 0; jv < jc.length; jv++) {
          var jt = jc[jv][4]
          if (!jt) {
            continue
          }
          var jx = jt[2]
          if (!this._isVisible(jx, ju)) {
            continue
          }
          var jg = jt[12]
          if (jy && jy.length > 0 && !jg) {
            continue
          }
          var jk = Math.round(jt[0] / 100)
          var jj = Math.round(jt[1] / 100)
          var jw = { lng: jq + jk, lat: jp - (jn * jd - jj) }
          var jb = jk / jd
          var ja = jn - jj / jd
          var jo = jt[7] || ''
          var jB = jt[5]
          var jr = {
            type: 'fixed',
            name: jo,
            textImg: jm,
            rank: jt[4],
            baseX: jb,
            baseY: ja,
            iconPos: null,
            textPos: null,
            guid: jt[3] || '',
            tracer: jx,
            direction: jB,
            startScale: 3,
          }
          if (((jB !== h7 && jg) || !jg) && jA !== null) {
            jr.iconPos = this._getIconPosition(jA, jf, jb, ja, jw)
            if (jr.iconPos) {
              T = jr.iconPos.width
              jl = jr.iconPos.height
            }
          }
          if (T === 0) {
            jr.direction = h7
          }
          if (jg) {
            jr.textPos = this._getTextDrawData(jt, jb, ja, T, jl)
          }
          if (jr.textPos || jr.iconPos) {
            js.push(jr)
          }
        }
      }
    },
    _isVisible: function (e, i) {
      var i8
      if (!this._binaryCache[e]) {
        i8 = e.toString(2)
        if (i8.length < 8) {
          i8 = new Array(8 - i8.length + 1).join('0') + i8
        }
        this._binaryCache[e] = i8
      }
      i8 = this._binaryCache[e]
      var T = eK[i].start
      return i8[i - T] === '1'
    },
    _getIconPosition: function (jc, ja, T, i, e) {
      var i8 = this._map.config.style
      var jd = bo['iconSetInfo' + i8][jc]
      if (!jd) {
        if (jc.charCodeAt(0) >= 48 && jc.charCodeAt(0) <= 57) {
          jd = bo['iconSetInfo' + i8]['_' + jc]
        }
      }
      if (!jd) {
        return null
      }
      var i9 = jd[0]
      var jb = jd[1]
      i9 = i9 * ja
      jb = jb * ja
      return {
        srcX: 0,
        srcY: 0,
        destX: T - i9 / 2,
        destY: i - jb / 2,
        width: i9,
        height: jb,
        geoX: e.lng,
        geoY: e.lat,
        mcPt: e,
        iconType: jc,
      }
    },
    _getTextDrawData: function (jj, ji, jh, i8, jf) {
      var jo = jj[5]
      if (typeof jo !== 'number') {
        jo = 0
      }
      var jd = this.ratio
      var jc = jd / 2
      i8 *= jc
      jf *= jc
      var je = jj[12]
      var i9 = je.length
      var jr = 0
      var jq = 0
      var jn = []
      var jm = 0
      var jp = 0
      for (var jl = 0; jl < i9; jl++) {
        jp += Math.round(je[jl][3])
      }
      for (var jl = 0; jl < i9; jl++) {
        var jb = je[jl]
        var ja = jb[0]
        var i = jb[1]
        var T = jb[2]
        var e = jb[3]
        var js = 2 * jd
        var jk = 0
        if (i8 !== 0) {
          jk = 2 * jd
        }
        if (i8 === 0) {
          jo = h7
        }
        switch (jo) {
          case fR:
            var jg = jh - jp / 2 - (js * (i9 - 1)) / 2
            jr = ji - T - i8 / 2 - jk
            jq = jg + jm + js * jl
            break
          case dU:
            var jg = jh - jp / 2 - (js * (i9 - 1)) / 2
            jr = ji + i8 / 2 + jk
            jq = jg + jm + js * jl
            break
          case H:
            var jg = jh - jf / 2 - jp - js * (i9 - 1) - js
            jr = ji - T / 2
            jq = jg + jm + js * jl
            break
          case gH:
            var jg = jh + jf / 2 + js / 2
            jr = ji - T / 2
            jq = jg + jm + js * jl
            break
          case h7:
            var jg = jh - e / 2 - (js * (i9 - 1)) / 2
            jr = ji - T / 2
            jq = jg + jm + js * jl
            break
        }
        jm += e
        if (T > 0 && e > 0) {
          jn.push({
            srcX: ja,
            srcY: i,
            destX: jr,
            destY: jq,
            width: T,
            height: e,
          })
        }
      }
      if (jn.length > 0) {
        return jn
      }
      return null
    },
    _getLineLabelInfo: function (jg, i8, i9, jv, jI, jn, jt, js, ju, jm) {
      if (jg.length !== 10) {
        return
      }
      var jx = this.ratio
      var T = this.ratio
      var jE = jg[7].length
      var jo = jg[1]
      var jG = jg[3]
      var jM = jg[8]
      var jc = jg[4]
      var e = 2
      var ja = jc.slice(0, e)
      for (var jJ = e; jJ < jc.length; jJ += e) {
        ja[jJ] = ja[jJ - e] + jc[jJ]
        ja[jJ + 1] = ja[jJ - (e - 1)] + jc[jJ + 1]
      }
      for (var jJ = e; jJ < jc.length; jJ += e) {
        if (jJ % (jG * e) === 0 || jJ % (jG * e) === 1) {
          continue
        }
        ja[jJ] = ja[jJ - e] + jc[jJ] / ju
        ja[jJ + 1] = ja[jJ - (e - 1)] + jc[jJ + 1] / ju
      }
      for (var jL = 0; jL < jE; jL++) {
        var jH = jg[7][jL]
        if (!this._isVisible(jH, jv)) {
          continue
        }
        var jz = jg[6][jL]
        var jl = jL * jG * e
        jc = ja.slice(jl, jl + jG * e)
        var jp = []
        var jy = undefined
        var jw = undefined
        var jk = undefined
        var jj = undefined
        var jM = jg[9].slice(0)
        if (jz) {
          jM.reverse()
        }
        var jC
        var jA
        for (var jK = 0; jK < jG; jK++) {
          var ji = jg[5][jG * jL + jK]
          var jD = jc[jK * e] / 100
          var jB = jc[jK * e + 1] / 100
          var jh = jM[jK]
          var jd = jh[0]
          var jf = jh[1]
          var jb = jh[2]
          var je = jh[3]
          var jr
          var jq
          var jO
          var jN
          if (jK === 0) {
            jC = jO = jD / jI
            jA = jn - jB / jI
            jN = jB / jI
          } else {
            jO = jD / jI
            jN = jB / jI
          }
          var jQ = jC + (jO - jC) * T - jb / 2
          var jP = jA + (jn - jN - jA) * T - je / 2
          if (jy === undefined) {
            jy = jC - jb / 2
            jw = jA - je / 2
            jk = jy + jb
            jj = jw + je
          } else {
            if (jQ < jy) {
              jy = jQ
            }
            if (jP < jw) {
              jw = jP
            }
            if (jQ + jb > jk) {
              jk = jQ + jb
            }
            if (jP + je > jj) {
              jj = jP + je
            }
          }
          jp.push({
            angle: ji,
            srcX: jd,
            srcY: jf,
            destX: jQ,
            destY: jP,
            width: jb,
            height: je,
          })
        }
        var jF = {
          type: 'line',
          textImg: i8,
          rank: jo,
          baseX: jC,
          baseY: jA,
          arrWordPos: jp,
          minXOriginal: jy,
          minYOriginal: jw,
          maxXOriginal: jk,
          maxYOriginal: jj,
          text: '',
        }
        jm.push(jF)
      }
    },
    alterColor: function (jb, e, ja) {
      var T = this._colorCtx,
        i = this._canvas2dMapMgr
      T.clearRect(0, 0, jb.width, jb.height)
      T.drawImage(
        e,
        jb.srcX,
        jb.srcY,
        jb.width,
        jb.height,
        0,
        0,
        jb.width,
        jb.height
      )
      var i9 = T.getImageData(0, 0, jb.width, jb.height),
        i8 = i.getFilterImageData(i9, ja)
      T.putImageData(i8, 0, 0)
    },
    drawIconAndText: function (jn, jm, e) {
      var je = this.ratio
      var jc = this.sizeRatio / je
      var jg = 2 / je
      var jy = this
      for (var jq = 0, jo = jm.length; jq < jo; jq++) {
        var jf = jm[jq]
        if (jf.isDel == false) {
          var i9 = jf.baseDrawX
          var i8 = jf.baseDrawY
          if (jf.type == 'fixed') {
            var jb = jf.iconPos,
              jr = jf.textPos,
              jk = jf.textImg,
              ju = jf.startScale
            if (jb && ju <= e) {
              var T = this._iconCache[jb.iconType]
              if (T) {
                if (T.img) {
                  jn.drawImage(
                    T.img,
                    0,
                    0,
                    T.img.width,
                    T.img.height,
                    Math.round(i9 * je + (jb.drawX - i9) / jg),
                    Math.round(i8 * je + (jb.drawY - i8) / jg),
                    jb.width / jg,
                    jb.height / jg
                  )
                } else {
                  T.drawLabels.push(jf)
                }
              } else {
                if (!T) {
                  this._iconCache[jb.iconType] = { img: null, drawLabels: [jf] }
                  var jA = new Image()
                  jA._iconName = jb.iconType
                  jA.onload = function () {
                    var jG = jy._iconCache[this._iconName]
                    jG.img = this
                    this.onload = null
                    for (var jC = 0; jC < jG.drawLabels.length; jC++) {
                      var jE = jG.drawLabels[jC]
                      var jD = jE.baseDrawX
                      var jB = jE.baseDrawY
                      var jF = jE.iconPos
                      jn.drawImage(
                        this,
                        0,
                        0,
                        this.width,
                        this.height,
                        Math.round(jD * je + (jF.drawX - jD) / jg),
                        Math.round(jB * je + (jF.drawY - jB) / jg),
                        jF.width / jg,
                        jF.height / jg
                      )
                    }
                    jG.drawPos = []
                  }
                  jA.src =
                    w.getIconSetPath(jy._map.config.style) +
                    jb.iconType +
                    '.png'
                }
              }
            }
            if (jr && jk && ju <= e) {
              for (var jd = 0; jd < jr.length; jd++) {
                var jl = jr[jd]
                if (!jf._tempRank) {
                  jn.drawImage(
                    jk,
                    jl.srcX,
                    jl.srcY,
                    jl.width,
                    jl.height,
                    Math.round(i9 * je + (jl.drawX - i9) / jc),
                    Math.round(i8 * je + (jl.drawY - i8) / jc),
                    jl.width / jc,
                    jl.height / jc
                  )
                } else {
                  this.alterColor(jl, jk, jf._tempRank)
                  jn.drawImage(
                    this._colorCvs,
                    0,
                    0,
                    jl.width,
                    jl.height,
                    Math.round(i9 * je + (jl.drawX - i9) / jc),
                    Math.round(i8 * je + (jl.drawY - i8) / jc),
                    jl.width / jc,
                    jl.height / jc
                  )
                }
              }
            }
          } else {
            var ja = jf.arrWordPos,
              jk = jf.textImg,
              jj = jf.tileX,
              jh = jf.tileY
            for (var jp = 0, ji = ja.length; jp < ji; jp++) {
              var js = ja[jp]
              var jz = Math.round(jj + js.destX)
              var jx = Math.round(jh + js.destY)
              var jt = js.angle
              jz = i9 * je + jz - i9
              jx = i8 * je + jx - i8
              if (jt > 10 && jt < 350) {
                jn.save()
                var jw = Math.round(jz + js.width / 2)
                var jv = Math.round(jx + js.height / 2)
                jn.translate(jw, jv)
                jn.rotate((-jt / 180) * Math.PI)
                jn.drawImage(
                  jk,
                  js.srcX,
                  js.srcY,
                  js.width,
                  js.height,
                  -Math.round(js.width / 2),
                  -Math.round(js.height / 2),
                  js.width / jc,
                  js.height / jc
                )
                jn.restore()
              } else {
                jn.drawImage(
                  jk,
                  js.srcX,
                  js.srcY,
                  js.width,
                  js.height,
                  jz,
                  jx,
                  js.width / jc,
                  js.height / jc
                )
              }
            }
          }
        }
      }
    },
    isCollide: function (ja, jj, ji, e, jc, T, je) {
      for (var i9 = 0, i8 = T.length; i9 < i8; i9++) {
        var jd = T[i9],
          jb = 1 / Math.pow(2, je + 1),
          jh = (jb * jd[3]) / 2,
          jg = (jb * jd[4]) / 2,
          jf = jd[0]
        if (jf != ja) {
          if (
            !(
              jj + e < jd[1] - jh ||
              jj > jd[1] + jd[3] + jh ||
              ji + jc < jd[2] - jg ||
              ji > jd[2] + jd[4] + jg
            )
          ) {
            return true
          }
        }
      }
      return false
    },
    zoomingIconAndText: function (jy, js, i8, jw, jx, jZ, jF, jg, jL, jE, jp) {
      var j0 = this.ratio
      var jh = this.sizeRatio / j0
      var j1 = 2 / j0
      var kb = j0 / 2
      var jV = jw.x
      var jU = jw.y
      var jz = 2 * j0
      if (jp !== 0) {
        jU += jE
      }
      var jk = undefined,
        jd = undefined,
        ja = undefined,
        jf = undefined,
        jo = undefined
      var jK = jZ > 0 ? true : false
      if (!jK) {
        jk = []
        var jO = 1 - jF
      }
      for (var j7 = 0, j5 = js.length; j7 < j5; j7++) {
        var j2 = js[j7]
        if (j2.isDel == false) {
          var kc = j2.baseDrawX
          var j9 = j2.baseDrawY
          jy.save()
          jy.translate(-jg * j0, -jL * j0)
          if (j2.isFadeout) {
            if (!jK && j2._schedule <= jF && !j2._isIgnore) {
              jy.globalAlpha = jO
              j2._schedule = jF
            } else {
              j2._isIgnore = true
              continue
            }
          }
          if (j2.type == 'fixed') {
            var jA = j2.iconPos,
              jH = j2.textPos,
              jb = j2.textImg,
              jB = j2.startScale
            var T
            var jS = 0
            if (jA) {
              jS = jz
            }
            if (jA && !j2.iconImg && this._iconCache[jA.iconType]) {
              T = this._iconCache[jA.iconType].img
            }
            if (jA && jB <= jx && T) {
              jf = jA.width
              jo = jA.height
              jd = (jV + (kc - jV) * i8) * j0 - jf / 2 / j1
              ja = (jU + (j9 - jU) * i8) * j0 - jo / 2 / j1 + jp
              if (!jK && this.isCollide(j7, jd, ja, jf, jo, jk, jZ)) {
                j2.isFadeout = true
              }
              jy.drawImage(
                T,
                jA.srcX,
                jA.srcY,
                T.width,
                T.height,
                Math.round(jd),
                Math.round(ja),
                jf / j1,
                jo / j1
              )
              !jK && jk.push([j7, jd, ja, jf, jo])
            }
            if (jH && jb && jB <= jx) {
              var jG
              var jI
              var jr = 0
              var jD = 0
              if (jA) {
                jr = jA.width
                jD = jA.height
              }
              var jT = jH.length
              var jj = 0
              var jJ = 0
              for (var jt = 0; jt < jT; jt++) {
                var j4 = jH[jt]
                jJ += j4.height
                if (jj < j4.width) {
                  jj = j4.width
                }
              }
              jJ += (jt - 1) * jz
              if (!jK && this.isCollide(j7, jd, ja, jj, jJ, jk, jZ)) {
                j2.isFadeout = true
              }
              var j3 = 0
              for (var jt = 0; jt < jT; jt++) {
                var j4 = jH[jt]
                switch (j2.direction) {
                  case fR:
                    jG = -(jr / 2 / j1 + j4.width + jS)
                    jI = -jJ / 2 + j3 + jz * jt
                    break
                  case dU:
                    jG = jr / 2 / j1 + jS
                    jI = -jJ / 2 + j3 + jz * jt
                    break
                  case H:
                    jG = -j4.width / 2
                    jI = -jD / 2 / j1 - jJ + j3 - jz * (jt + 1)
                    break
                  case gH:
                    jG = -j4.width / 2
                    jI = jD / 2 / j1 + j3 + jz * (jt + 1)
                    break
                  case h7:
                    jG = -j4.width / 2
                    jI = -jJ / 2 + j3 + jz * jt
                    break
                }
                j3 += j4.height
                jd = (jV + (kc - jV) * i8) * j0 + jG / jh
                ja = (jU + (j9 - jU) * i8) * j0 + jI / jh
                ;+jp
                jf = j4.width
                jo = j4.height
                if (!j2._tempRank) {
                  jy.drawImage(
                    jb,
                    j4.srcX,
                    j4.srcY,
                    jf,
                    jo,
                    Math.round(jd),
                    Math.round(ja),
                    jf / jh,
                    jo / jh
                  )
                } else {
                  this.alterColor(j4, jb, j2._tempRank)
                  jy.drawImage(
                    this._colorCvs,
                    0,
                    0,
                    jf,
                    jo,
                    Math.round(jd),
                    Math.round(ja),
                    jf / jh,
                    jo / jh
                  )
                }
                !jK && jk.push([j7, jd, ja, jf, jo])
              }
            }
          } else {
            var jq = j2.arrWordPos,
              jb = j2.textImg,
              ka = j2.tileX,
              j8 = j2.tileY
            var ji = jq[0]
            var je = Math.round(ka + ji.destX)
            var jc = Math.round(j8 + ji.destY)
            for (var j6 = 0, jR = jq.length; j6 < jR; j6++) {
              var jY = jq[j6]
              var ke = Math.round(ka + jY.destX)
              var kd = Math.round(j8 + jY.destY)
              var jv = jY.angle
              var jQ = Math.round(
                (jV + (kc - jV) * i8) * j0 - ji.width / 2 + ke - je
              )
              var jP = Math.round(
                (jU + (j9 - jU) * i8) * j0 - ji.height / 2 + kd - jc
              )
              jd = jQ
              ja = jP
              jf = jY.width
              jo = jY.height
              if (!jK && this.isCollide(j7, jd, ja, jf, jo, jk, jZ)) {
                j2.isFadeout = true
              }
              if (jv > 10 && jv < 350) {
                var jX = jQ + jY.width / 2
                var jW = jP + jY.height / 2
                var i9 = (jv / 180) * Math.PI
                var jC = Math.cos(i9)
                var jl = Math.sin(i9)
                var jN = jC
                var jm = jC
                var jM = jl
                var jn = -jl
                var ju = jX - jX * jC - jW * jl
                var e = jW + jX * jl - jW * jC
                jy.save()
                jy.transform(jN, jn, jM, jm, ju, e)
                jy.drawImage(
                  jb,
                  jY.srcX,
                  jY.srcY,
                  jf,
                  jo,
                  jd,
                  ja,
                  jf / jh,
                  jo / jh
                )
                jy.restore()
              } else {
                jy.drawImage(
                  jb,
                  jY.srcX,
                  jY.srcY,
                  jf,
                  jo,
                  jd,
                  ja,
                  jf / jh,
                  jo / jh
                )
              }
              !jK && jk.push([j7, jd, ja, jf, jo])
            }
          }
          jy.restore()
        }
      }
    },
  })
  function dV(e) {
    this.initVars(e)
  }
  es.extend(dV.prototype, {
    initVars: function (e) {
      this._map = e._map
      this._canvas2dMapMgr = e
      this.base64Prefix = 'data:image/png;base64,'
      this.bizData = null
      this.objTextsPng = null
      this.arrIconsPng = null
      this.bizLabels = null
    },
    proecessBizData: function (ja, je) {
      var jc = this
      this.bizData = ja
      this.objTextsPng = null
      this.arrIconsPng = null
      var T = ja.textsPng
      var jg = ja.iconsPng
      if (!T || !jg) {
        return
      }
      var jd = new Image()
      jd.onload = function () {
        jc.objTextsPng = this
        jc.calcIconAndTextInfo(je)
        this.onload = null
      }
      jd.src = this.base64Prefix + T
      var jf = jg.length
      var e = []
      for (var i9 = 0; i9 < jf; i9++) {
        var jb = jg[i9]
        var i8 = new Image()
        ;(function (i) {
          i8.onload = function () {
            jf--
            e[i] = this
            if (jf === 0) {
              jc.arrIconsPng = e
              jc.calcIconAndTextInfo(je)
            }
            this.onload = null
          }
        })(i9)
        i8.src = this.base64Prefix + jb
      }
    },
    calcIconAndTextInfo: function (jh) {
      if (this.objTextsPng && this.arrIconsPng) {
        var jd = this.bizData
        var jb = jd.pois
        var e = []
        for (var je = 0, ja = jb.length; je < ja; je++) {
          var i8 = jb[je]
          var jc = this.arrIconsPng[i8.iconPng]
          var i9 = jc.height / 2
          var jg = {
            type: 'fixed',
            name: '',
            textImg: this.objTextsPng,
            iconImg: jc,
            rank: i8.rank,
            iconPos: {
              srcX: 0,
              srcY: 0,
              destX: -jc.width / 2,
              destY: -i9 / 2,
              width: jc.width,
              height: i9,
              geoX: i8.x,
              geoY: i8.y,
              iconType: 'vectorCustom',
            },
            textPos: this.calcTextPos(i8.pos, jc),
            startScale: i8.from < 12 ? 12 : i8.from,
            guid: i8.guid,
            guidExt: 1,
            adver_log: i8.adver_log || '',
          }
          var T = {
            type: 'fixed',
            textDirLeft: 'left',
            name: '',
            textImg: this.objTextsPng,
            iconImg: jc,
            rank: i8.rank,
            iconPos: {
              srcX: 0,
              srcY: 0,
              destX: -jc.width / 2,
              destY: -i9 / 2,
              width: jc.width,
              height: i9,
              geoX: i8.x,
              geoY: i8.y,
              iconType: 'vectorCustom',
            },
            textPos: this.calcTextPosLeft(i8.pos, jc),
            startScale: i8.from < 12 ? 12 : i8.from,
            guid: i8.guid,
            guidExt: 1,
            adver_log: i8.adver_log || '',
          }
          var jf = [jg, T]
          e.push(jf)
        }
        this.bizLabels = e
        jh && jh()
      }
    },
    calcTextPos: function (jb, T) {
      var i = []
      var ja = jb.length / 4
      var i9 = T.width / 2
      if (ja === 1) {
        var i8 = {
          srcX: jb[0],
          srcY: jb[1],
          destX: i9,
          destY: -jb[3] / 2,
          width: jb[2],
          height: jb[3],
        }
        i.push(i8)
      } else {
        var i8 = {
          srcX: jb[0],
          srcY: jb[1],
          destX: i9,
          destY: -jb[3],
          width: jb[2],
          height: jb[3],
        }
        var e = {
          srcX: jb[4],
          srcY: jb[5],
          destX: i9,
          destY: 0,
          width: jb[6],
          height: jb[7],
        }
        i.push(i8)
        i.push(e)
      }
      return i
    },
    calcTextPosLeft: function (jb, T) {
      var i = []
      var ja = jb.length / 4
      var i9 = T.width / 2
      if (ja === 1) {
        var i8 = {
          srcX: jb[0],
          srcY: jb[1],
          destX: -i9 - jb[2],
          destY: -jb[3] / 2,
          width: jb[2],
          height: jb[3],
        }
        i.push(i8)
      } else {
        var i8 = {
          srcX: jb[0],
          srcY: jb[1],
          destX: -i9 - jb[2],
          destY: -jb[3],
          width: jb[2],
          height: jb[3],
        }
        var e = {
          srcX: jb[4],
          srcY: jb[5],
          destX: -i9 - jb[2],
          destY: 0,
          width: jb[6],
          height: jb[7],
        }
        i.push(i8)
        i.push(e)
      }
      return i
    },
    clearBizData: function () {
      this.bizData = null
      this.bizLabels = null
    },
  })
  function x() {}
  es.extend(x.prototype, {
    centerAndZoomIn: function (T, je, jf) {
      jf = jf || {}
      if (!this.loaded) {
        this.firstTileLoad = false
      }
      je = this._getProperZoom(je).zoom
      if (jf.noAnimation !== true && this.loaded) {
        var ja = this._ifUseAnimation(T, je)
        if (ja) {
          this.flyToIn(T, je, jf)
          return
        }
      }
      var jc = this
      if (!T && !je) {
        return
      }
      this._stopAllAnimations()
      if (T && !T.equals(this.centerPoint)) {
        this.fire(new e7('oncenter_changed'))
      }
      if (je && je !== this.zoomLevel) {
        this.fire(new e7('onzoom_changed'))
      }
      T = T || this.centerPoint
      je = je || this.zoomLevel
      je = this._getProperZoom(je).zoom
      if (this.mapType === BMAP_EARTH_MAP) {
        if (!this._earth) {
          this.mapType = BMAPGL_NORMAL_MAP
          this.temp.originMapType = BMAP_EARTH_MAP
          function jd() {
            jc._earth = new bo.Earth(jc, {
              showRealSunlight: jc.config.showRealSunlight,
              showMilkyway: jc.config.showMilkyway,
              earthBackground: jc.config.earthBackground,
            })
            jc._proxyEarthEvents()
            jc._changeEarthMapType(BMAP_EARTH_MAP)
            es.extend(jc, bo.EarthView.prototype)
            delete jc.temp.originMapType
          }
          gi.load('earth', function () {
            if (bo['FeatureStyle' + jc.config.style]) {
              jd()
            } else {
              jc.loadMapStyleFiles(function () {
                jd()
              })
            }
          })
        }
      }
      this.lastLevel = this.zoomLevel || je
      this.zoomLevel = je
      var jb = new e7('onload')
      jb.point = T
      jb.zoom = je
      this.centerPoint = new cd(T.lng, T.lat)
      this.defaultZoomLevel = this.defaultZoomLevel || this.zoomLevel
      this.defaultCenter = this.defaultCenter || this.centerPoint
      if (this.mapType !== BMAP_EARTH_MAP) {
        this.centerPoint = this.restrictCenter(this.centerPoint)
      }
      if (!this.loaded && !(this.temp.originMapType === BMAP_EARTH_MAP)) {
        var i = this.config.defaultMaxBounds
        var i9 = new h(i, 'baidu', this.mapType)
        if (this.mapType !== BMAP_NONE_MAP) {
          var i8 = new gI({
            mapType: this.mapType,
            copyright: i9,
            dataType: this.mapType === BMAP_SATELLITE_MAP ? fY : gT,
            customLayer: this.mapType === BMAP_SATELLITE_MAP,
            baseLayer: true,
            transparentPng: true,
            tileTypeName: this.mapType === BMAP_SATELLITE_MAP ? 'web' : 'na',
          })
          i8._isInnerLayer = true
          this.addTileLayer(i8)
          this.baseLayerAdded = true
        }
        if (
          this.mapType === BMAP_SATELLITE_MAP &&
          this._isHybridShow === true
        ) {
          this._addHybirdMap()
        }
        this.on('zoom_changed', function () {
          if (this._heading === 0) {
            return
          }
          if (this.getZoom() < 7 && this.config.restrictCenter === true) {
            jc.resetHeading()
          }
        })
      }
      this.loaded = true
      this.dispatchEvent(jb)
      jf.callback && jf.callback()
    },
    _ifUseAnimation: function (i8, jd) {
      var jc = this.getSize()
      var T = { zoom: this.zoomLevel }
      var jf = { zoom: jd }
      var je = this.pointToPixelIn(this.centerPoint)
      var i9 = this.pointToPixelIn(i8, T)
      var jb = this.pointToPixelIn(this.centerPoint, jf)
      var jh = this.pointToPixelIn(i8, jf)
      var ja = Math.abs(je.x - i9.x)
      var i = Math.abs(je.y - i9.y)
      var e = Math.abs(jb.x - jh.x)
      var jg = Math.abs(jb.y - jh.y)
      if (
        (ja > jc.width || i > jc.height) &&
        (e > jc.width || jg > jc.height)
      ) {
        return false
      }
      return true
    },
    _setPlatformPosition: function (jf, je, jh) {
      jh = jh || {}
      if (jf === 0 && je === 0 && !jh.point) {
        return
      }
      if (isNaN(jh.initMapOffsetX)) {
        jh.initMapOffsetX = this.offsetX
      }
      if (isNaN(jh.initMapOffsetY)) {
        jh.initMapOffsetY = this.offsetY
      }
      var jb = hH(this._heading)
      if (this._tilt > 0) {
        je = je / Math.cos(hH(this._tilt))
      }
      var jg = jf * Math.cos(jb) + je * Math.sin(jb)
      var jd = -jf * Math.sin(jb) + je * Math.cos(jb)
      jg = jg + jh.initMapOffsetX
      jd = jd + jh.initMapOffsetY
      if (jh.point) {
        var i = this.restrictCenter(jh.point)
        if (!i.equals(this.centerPoint)) {
          this.centerPoint = i.clone()
          this.fire(new e7('oncenter_changed'))
        }
      } else {
        var i8 = this.offsetX - jg
        var e = this.offsetY - jd
        var jc = this.centerPoint.lng
        var ja = this.centerPoint.lat
        var i9 = new cd(jc, ja)
        var T = this.getZoomUnits()
        this.centerPoint = this.restrictCenter(
          new cd(i9.lng + i8 * T, i9.lat - e * T),
          T
        )
        this.fire(new e7('oncenter_changed'))
      }
      this.offsetX = jg
      this.offsetY = jd
      this.dispatchEvent(new e7('onmoving'))
    },
    restrictCenter: function (jg, e) {
      if (this.config.restrictCenter === false) {
        return jg
      }
      e = e || this.getZoomUnits()
      var je = this.pixelToPointIn(new eL(this.width, 0), { center: jg })
      var jb = this.pixelToPointIn(new eL(0, this.height), { center: jg })
      var jh = jg.lng
      var jm = jg.lat
      if (
        this.config.restrictBounds !== null &&
        !this.config.restrictBounds.isEmpty()
      ) {
        var jl = this.config.restrictBounds
        var T = jl.getSouthWest()
        var jj = jl.getNorthEast()
        var jf = ia.convertLL2MC(T)
        var i9 = ia.convertLL2MC(jj)
        var jc = this.calcNewZoomByRestriction(
          jh,
          jm,
          jb,
          je,
          jf.lng,
          i9.lng,
          jf.lat,
          i9.lat
        )
        if (jc > this.zoomLevel) {
          this.zoomLevel = jc
          return jg
        }
        jg.lng = this.calcNewLngByBounds(jh, jb, je, jf.lng, i9.lng, e)
        jg.lat = this.calcNewLatByBounds(jm, jb, je, jf.lat, i9.lat, e)
        return jg
      }
      var jd = this.pixelToPointIn(new eL(0, 0), { center: jg })
      var i8 = this.pixelToPointIn(new eL(0, this.height), { center: jg })
      if (this.zoomLevel < 5) {
        if (jd.lat > gV.MAX_LAT && i8.lat < gV.MIN_LAT) {
          var i = gV.MAX_LAT - jg.lat
          var ja = jg.lat - gV.MIN_LAT
          var jk
          if (i < ja) {
            jk = i / (this.height / 2)
          } else {
            jk = ja / (this.height / 2)
          }
          var ji = 18 - m(jk)
          this.zoomLevel = ji
          return jg
        }
      }
      if (jd.lat > gV.MAX_LAT) {
        jg.lat = gV.MAX_LAT - (this.height / 2) * e
      } else {
        if (i8.lat < gV.MIN_LAT) {
          jg.lat = gV.MIN_LAT + (this.height / 2) * e
        }
      }
      return jg
    },
    calcNewZoomByRestriction: function (jf, je, e, jd, i9, jb, i8, ja) {
      var ji = 0
      var jj = 0
      if (
        typeof i8 === 'number' &&
        typeof ja === 'number' &&
        jd.lat > ja &&
        e.lat < i8
      ) {
        var T = ja - je
        var i = je - i8
        var jc
        if (T < i) {
          jc = T / (this.height / 2)
        } else {
          jc = i / (this.height / 2)
        }
        ji = 18 - m(jc)
      }
      if (
        typeof i9 === 'number' &&
        typeof jb === 'number' &&
        jd.lng > jb &&
        e.lng < i9
      ) {
        var jh = jb - jf
        var jg = jf - i9
        var jc
        if (jh < jg) {
          jc = jh / (this.width / 2)
        } else {
          jc = jg / (this.width / 2)
        }
        jj = 18 - m(jc)
      }
      return Math.max(ji, jj) || this.zoomLevel
    },
    calcNewLatByBounds: function (i, i8, T, jb, ja, e) {
      var i9 = i
      if (T.lat > ja) {
        i9 = ja - (this.height / 2) * e
      } else {
        if (i8.lat < jb) {
          i9 = jb + (this.height / 2) * e
        }
      }
      return i9
    },
    calcNewLngByBounds: function (jb, ja, i8, i9, T, e) {
      var i = jb
      if (i8.lng > T) {
        i = T - (this.width / 2) * e
      } else {
        if (ja.lng < i9) {
          i = i9 + (this.width / 2) * e
        }
      }
      return i
    },
    zoomTo: function (e, jj, jk) {
      var jf = dO[this.mapType]
      if (!jf) {
        return
      }
      var je = this._getProperZoom(e)
      e = je.zoom
      if (this.zoomLevel === e) {
        jk && jk.callback && jk.callback()
        return
      }
      var ja = e
      this.lastLevel = this.zoomLevel
      jk = jk || {}
      if (this.zoomEventStatus === 'idle') {
        this.fire(new e7('onzoomstart'))
        this.zoomEventStatus = 'zooming'
      }
      if (
        !jj &&
        this.getInfoWindow() &&
        this.temp.infoWin &&
        this.temp.infoWin.isOpen()
      ) {
        jj = ia.convertLL2MC(this.getInfoWindow().getPoint())
      }
      var T = null
      if (jk.fixPixel) {
        T = jk.fixPixel
      } else {
        if (jj) {
          T = this.pointToPixelIn(jj, { useRound: false })
        }
      }
      var jb = this.pixelToPointIn(T)
      var jc = this.centerPoint.clone()
      this.fixPoint = jj
      this.fixPixel = T
      this.fixCenter = jc
      this.mousePosMCPoint = jb
      if (jk.noAnimation) {
        e = je.zoom
        this.zoomLevel = e
        this.fire(new e7('onzoom_changed'))
        var i9 = this.getCurrentMaxTilt()
        if (this._tilt > i9) {
          this._tilt = i9
        }
        if (jj) {
          if (this._heading % 360 !== 0 || this._tilt > 0) {
            var i = this._webglMapCamera.fromScreenPixelToMC(T.x, T.y, {
              center: jc,
              zoom: this.zoomLevel,
            })
            if (i) {
              var jg = i.sub(jb)
              var i8 = jc.sub(jg)
              this.centerPoint = this.restrictCenter(i8)
            }
          } else {
            var jd = this.getZoomUnits()
            var i8 = new cd(
              jj.lng - jd * (T.x - this.width / 2),
              jj.lat + jd * (T.y - this.height / 2)
            )
            this.centerPoint = this.restrictCenter(i8, jd)
          }
          this.fire(new e7('oncenter_changed'))
        }
        this._checkFireZoomend()
        jk.callback && jk.callback()
        return
      }
      this._animationInfo.zoom = {
        current: this.zoomLevel,
        diff: e - this.zoomLevel,
        target: e,
      }
      var jh = this
      jh._checkFireZoomend()
      var ji = this._tilt
      if (this.fixPoint || ji > gV.MAX_DRAG_TILT_L2) {
        jk.renderCallback = function () {
          var jo = jh.getCurrentMaxTilt()
          if (jh._tilt > jo) {
            jh._tilt = jo
          }
          var jp = jh.fixPixel
          if (!jh.fixPixel || !jh.fixPoint) {
            return
          }
          var jl = jh.fixPixel
          var jv = jh.fixPoint
          var js = jh.fixCenter
          var jq = jh.mousePosMCPoint
          if (jh._heading % 360 !== 0 || jh._tilt > 0) {
            var jm = jh._webglMapCamera.fromScreenPixelToMC(jl.x, jl.y, {
              center: js,
              zoom: jh.zoomLevel,
              tilt: jh._tilt,
            })
            if (jm) {
              var ju = jm.sub(jq)
              var jn = js.sub(ju)
              jh.centerPoint = jh.restrictCenter(jn)
            }
          } else {
            var jr = jl
            var jt = jh.getZoomUnits()
            var jn = new cd(
              jv.lng - jt * (jr.x - jh.width / 2),
              jv.lat + jt * (jr.y - jh.height / 2)
            )
            jh.centerPoint = jh.restrictCenter(jn, jt)
          }
          jh.fire(new e7('oncenter_changed'))
        }
      }
      if (jk.fromMouseWheel === true) {
        this._startInfiniteZoomAnimation(jk)
        jk.callback && jk.callback()
        return
      }
      this._startAnimation(jk)
    },
    _checkFireZoomend: function () {
      var e = this
      if (e.fireZoomendTimer) {
        clearTimeout(e.fireZoomendTimer)
      }
      e.fireZoomendTimer = setTimeout(function () {
        if (e.zoomEventStatus === 'zooming') {
          e.fire(new e7('onzoomend'))
          e.zoomEventStatus = 'idle'
        }
        e.fireZoomendTimer = null
      }, 150)
    },
    deepZoomMedia: function (e) {
      var i = this
      if (!i.temp.isStdCtrlBusy) {
        i.temp.isStdCtrlBusy = true
        i.deepZoomTo(i.zoomLevel + e)
        setTimeout(function () {
          i.temp.isStdCtrlBusy = false
        }, 400)
      }
    },
    deepZoomTo: function (e) {
      this.zoomTo(e)
    },
    flyToIn: function (T, jC, jn) {
      jn = jn || {}
      var i9 = this._getProperZoom(jC)
      jC = i9.zoom
      if (
        this.centerPoint.equals(T) &&
        this.zoomLevel === jC &&
        typeof jn.heading !== 'number' &&
        typeof jn.tilt !== 'number'
      ) {
        return
      }
      var e = this.getHeading() % 360
      var jf = this.getTilt()
      var jl = 0
      var jp = 0
      var ji = this.getBounds().containsPoint(T)
      if (typeof jn.heading === 'number') {
        jl = jn.heading
      } else {
        if (ji) {
          jl = e
        }
      }
      if (typeof jn.tilt === 'number') {
        jp = jn.tilt
      } else {
        if (ji) {
          jp = jf
        }
      }
      this._heading = e
      var jz = jl - e
      var jv = jp - jf
      var jj = this
      var jb = this.zoomLevel
      var jc = 1.42
      var jr = this.zoomScale(jC - jb)
      var jE = this.getZoomUnits()
      var jh = this.centerPoint.div(jE)
      var jF = T.div(jE)
      var jy = this.worldSize()
      var ju = jc
      var jt = Math.max(this.width, this.height)
      var js = jt / jr
      var jg = jF.sub(jh).mag()
      var i = ju * ju
      function jB(jH) {
        var jG =
          (js * js - jt * jt + (jH ? -1 : 1) * i * i * jg * jg) /
          (2 * (jH ? js : jt) * i * jg)
        return Math.log(Math.sqrt(jG * jG + 1) - jG)
      }
      function i8(jG) {
        return (Math.exp(jG) - Math.exp(-jG)) / 2
      }
      function jd(jG) {
        return (Math.exp(jG) + Math.exp(-jG)) / 2
      }
      function jm(jG) {
        return i8(jG) / jd(jG)
      }
      var je = jB(0)
      var jw = function (jG) {
        return jd(je) / jd(je + ju * jG)
      }
      var jx = function (jG) {
        return (jt * ((jd(je) * jm(je + ju * jG) - i8(je)) / i)) / jg
      }
      var ja = (jB(1) - je) / ju
      if (Math.abs(jg) < 0.000001 || ja === Infinity || isNaN(ja)) {
        if (Math.abs(jt - js) < 0.000001) {
          this._animationInfo.zoom = {
            current: this.zoomLevel,
            diff: jC - this.zoomLevel,
          }
          this._animationInfo.center = {
            current: this.centerPoint,
            diff: T.sub(this.centerPoint),
          }
          this._animationInfo.heading = { current: e, diff: jl - e }
          this._animationInfo.tilt = { current: jf, diff: jp - jf }
          this.setLock(true)
          this._startAnimation({
            callback: function (jG) {
              jj.setLock(false)
              if (jn.callback) {
                jn.callback(jG)
              }
            },
            duration: jn.duration,
          })
          return
        }
        var jD = js < jt ? -1 : 1
        ja = Math.abs(Math.log(js / jt)) / ju
        jx = function () {
          return 0
        }
        jw = function (jG) {
          return Math.exp(jD * ju * jG)
        }
      }
      var jA = 1.7
      if (ja < 0.3) {
        jA = 0.8
      } else {
        if (ja > 5) {
          jA = (ja - 5) / 2 + jA
        }
      }
      var jo = jn.duration || (1000 * ja) / jA
      if (isNaN(jo)) {
        var jq = {}
        for (var jk in jn) {
          jq[jk] = jn[jk]
          jq.noAnimation = true
        }
        this.centerAndZoomIn(T, jC, jq)
        return
      }
      this.fire(new e7('onmovestart'))
      this.fire(new e7('onzoomstart'))
      this.setLock(true)
      this._startAnimation({
        duration: jo,
        renderCallback: function (jG, jH) {
          var jI = jG * ja
          var jL = jx(jI)
          var jK = jb + jj.scaleZoom(1 / jw(jI))
          if (jK < jj.getMinZoom()) {
            jK = jj.getMinZoom()
          }
          if (jK > jj.getMaxZoom()) {
            jK = jj.getMaxZoom()
          }
          if (jK !== jj.zoomLevel) {
            jj.zoomLevel = jK
            jj.fire(new e7('onzoom_changed'))
          }
          jj.centerPoint = jh.add(jF.sub(jh).mult(jL)).mult(jE)
          jj.fire(new e7('oncenter_changed'))
          if (typeof jl === 'number') {
            var jJ = jG / 0.7
            if (jJ > 1) {
              jJ = 1
            }
            jj.setHeading(e + jz * jG, { noAnimation: true })
          }
          if (typeof jp === 'number') {
            jj.setTilt(jf + jv * jG, { noAnimation: true })
          }
        },
        callback: function (jG, jH) {
          jj.setLock(false)
          if (jH && jH.stop === true) {
            jj.fire(new e7('onmoveend'))
            jj.fire(new e7('onzoomend'))
            jn.callback && jn.callback(jG)
            return
          }
          if (jC !== jj.zoomLevel) {
            jj.zoomLevel = jC
            jj.fire(new e7('onzoom_changed'))
          }
          jj.fire(new e7('onmoveend'))
          jj.fire(new e7('onzoomend'))
          jn.callback && jn.callback(jG)
        },
      })
    },
    zoomScale: function (e) {
      return Math.pow(2, e)
    },
    scaleZoom: function (e) {
      return Math.log(e) / Math.LN2
    },
    panToIn: function (i, T) {
      T = T || {}
      if (!i || i.equals(this.centerPoint)) {
        T.callback && T.callback()
        return
      }
      var i8 = this.pointToPixelIn(i)
      var e = Math.round(this.width / 2)
      var ja = Math.round(this.height / 2)
      var i9 = this._ifUseAnimation(i, this.zoomLevel)
      if (T.noAnimation === true || i9 === false) {
        this._stopAllAnimations()
        this._panToIn(e - i8.x, ja - i8.y, i)
        T.callback && T.callback()
        return
      }
      this.flyToIn(i, this.zoomLevel, T)
    },
    _panToIn: function (i, e, i8) {
      var T = this.temp
      if (T.operating === true) {
        return
      }
      if (T.dragAni) {
        T.dragAni.stop(false, { readyToMove: true })
        T.dragAni = null
      }
      this.dispatchEvent(new e7('onmovestart'))
      this._setPlatformPosition(i, e, { point: i8 })
      this.dispatchEvent(new e7('onmoveend'))
    },
    _stopAllAnimations: function (e) {
      e = e || {}
      if (this._ani) {
        this._ani.stop(!!e.goToEnd, {
          stopCurrentAnimation: e.stopCurrentAnimation,
        })
        this._ani = null
      }
      if (this._infiniteAni) {
        this._infiniteAni.stop()
        this._infiniteAni = null
      }
    },
    panBy: function (i, e, T) {
      i = Math.round(i) || 0
      e = Math.round(e) || 0
      T = T || {}
      if (
        Math.abs(i) <= this.width &&
        Math.abs(e) <= this.height &&
        T.noAnimation !== true
      ) {
        this._panBy(i, e, T)
      } else {
        this._panToIn(i, e, T.point)
        T.callback && T.callback()
      }
    },
    _panBy: function (i, e, i9) {
      if (this.temp.operating === true) {
        return
      }
      i9 = i9 || {}
      this.dispatchEvent(new e7('onmovestart'))
      var i8 = this
      var T = i8.temp
      T.pl = i8.offsetX
      T.pt = i8.offsetY
      if (T.tlPan) {
        T.tlPan.cancel()
      }
      if (T.dragAni) {
        T.dragAni.stop(false, { readyToMove: true })
        T.dragAni = null
      }
      T.tlPan = new e0({
        fps: i9.fps || i8.config.fps,
        duration: i9.duration || i8.config.actionDuration,
        transition: i9.transition || fT.easeInOutQuad,
        render: function (ja) {
          this.terminative = i8.temp.operating
          if (i8.temp.operating) {
            return
          }
          i8._setPlatformPosition(i * ja, e * ja, {
            initMapOffsetX: T.pl,
            initMapOffsetY: T.pt,
          })
        },
        finish: function (ja) {
          i8.dispatchEvent(new e7('onmoveend'))
          i8.temp.tlPan = false
          if (i8.temp.stopArrow === true) {
            i8.temp.stopArrow = false
            if (i8.temp.arrow !== 0) {
              i8._arrow()
            }
          }
        },
      })
    },
    _startAnimation: function (i) {
      var i9 = this._animationInfo
      var T = this
      i = i || {}
      if (T._ani) {
        T._ani.stop(!!i.goToEnd, {
          stopCurrentAnimation: i.stopCurrentAnimation,
        })
      }
      if (T._infiniteAni) {
        T._infiniteAni.stop()
        T._infiniteAni = null
      }
      var ja = i.duration || 500
      var jb = i.transition || fT.ease
      var e = new e7('onanimation_start')
      this.fire(e)
      if (i.unstopable) {
        i9 = this._animationInfoUnstopable
      }
      var i8 = new e0({
        duration: ja,
        transition: jb,
        render: function (je, jd) {
          for (var jc in i9) {
            if (!i9.hasOwnProperty(jc)) {
              continue
            }
            var jg = i9[jc].current
            var jf = i9[jc].diff
            T._setValueTick(jc, jg, jf, je)
          }
          if (i.renderCallback) {
            i.renderCallback(je, jd)
          }
        },
        finish: function (jc) {
          T.fire(new e7('onanimation_end'))
          if (i.unstopable) {
            T._animationInfoUnstopable = {}
            T._unstopableAni = null
          } else {
            T._ani = null
            T._animationInfo = {}
          }
          if (i.mapNeedCbk) {
            i.mapNeedCbk()
          }
          if (i.callback) {
            i.callback(jc)
          }
        },
        onStop: function (jc) {
          jc = jc || {}
          T.fire(new e7('onanimation_end'))
          if (jc.stopCurrentAnimation) {
            T._animationInfo = {}
          }
          T._ani = null
          if (i.mapNeedCbk) {
            i.mapNeedCbk()
          }
          if (i.callback) {
            i.callback(null, { stop: true })
          }
        },
      })
      if (i.unstopable) {
        T._unstopableAni = i8
      } else {
        T._ani = i8
      }
    },
    _startInfiniteZoomAnimation: function (e) {
      var i = this
      if (i._ani) {
        i._ani.stop(!!e.goToEnd, {
          stopCurrentAnimation: e.stopCurrentAnimation,
        })
      }
      if (i._infiniteAni) {
        return
      }
      this.fire(new e7('onanimation_start'))
      i._infiniteAni = new e0({
        duration: 10000,
        transition: fT.linear,
        render: function () {
          var T = i._animationInfo.zoom
          if (Math.abs(T.current - T.target) < 0.001) {
            i._setValue('zoom', T.target)
            i._infiniteAni.stop()
            return
          }
          T.current += (T.target - T.current) * 0.35
          i._setValue('zoom', T.current)
          if (e.renderCallback) {
            e.renderCallback()
          }
        },
        finish: function () {
          i._infiniteAni = null
          i._animationInfo = {}
          i.fire(new e7('onanimation_end'))
          if (e.callback) {
            e.callback()
          }
        },
        onStop: function () {
          i._infiniteAni = null
          i._animationInfo = {}
          i.fire(new e7('onanimation_end'))
          if (e.callback) {
            e.callback()
          }
        },
      })
    },
    _setValue: function (e, T) {
      if (e === 'zoom') {
        this._preZoomLevel = this.zoomLevel
        var i = this._getProperZoom(T)
        T = i.zoom
        if (T !== this.zoomLevel) {
          this.zoomLevel = T
          if (T < 5) {
            this.restrictCenter(this.centerPoint)
          }
          this.fire(new e7('on' + e + '_changed'))
        }
        return
      } else {
        if (e === 'center') {
          this.centerPoint = T
        }
      }
      this['_' + e] = T
      this.fire(new e7('on' + e + '_changed'))
    },
    _setValueTick: function (e, i9, i8, i) {
      if (e === 'center') {
        var T = new cd(i9.lng + i8.lng * i, i9.lat + i8.lat * i)
        this._setValue(e, T)
        return
      }
      if (e === 'zoom') {
        this._setValue(e, Math.pow(i9, 1 - i) * Math.pow(i9 + i8, i))
        return
      }
      this._setValue(e, i9 + i8 * i)
    },
    setHeading: function (i8, i) {
      i = i || {}
      if (i8 === this._heading) {
        i.callback && i.callback()
        return
      }
      var T = dJ(this._heading, 360)
      var e = dJ(i8, 360)
      if (e === T) {
        this._heading = i8
        i.callback && i.callback()
        return
      }
      if (i.noAnimation) {
        this._setValue('heading', i8)
        i.callback && i.callback()
        return
      }
      if (i.unstopable) {
        this._animationInfoUnstopable.heading = {
          current: this._heading,
          diff: i8 - this._heading,
        }
      } else {
        this._animationInfo.heading = {
          current: this._heading,
          diff: i8 - this._heading,
        }
      }
      this._startAnimation(i)
    },
    resetHeading: function (e) {
      var i = this._heading
      while (i < 0) {
        i += 360
      }
      i = i % 360
      if (i > 180) {
        i -= 360
      }
      this._heading = i
      e = e || {}
      e.unstopable = true
      this.setHeading(0, e)
    },
    getHeading: function () {
      return this._heading
    },
    setTilt: function (e, i) {
      i = i || {}
      if (e === this._tilt) {
        i.callback && i.callback()
        return
      }
      if (e > gV.MAX_TILT) {
        e = gV.MAX_TILT
      }
      if (e < gV.MIN_TILT) {
        e = gV.MIN_TILT
      }
      if (i && i.noAnimation) {
        this._setValue('tilt', e)
        i.callback && i.callback()
        return
      }
      this._animationInfo.tilt = { current: this._tilt, diff: e - this._tilt }
      this._startAnimation(i)
    },
    getTilt: function () {
      return this._tilt
    },
    getCenterIn: function () {
      return this.centerPoint
    },
    getZoom: function () {
      return this.zoomLevel
    },
    getCameraPosition: function (T) {
      T = T || {}
      var e = T.center || this.centerPoint
      var i8 = T.zoom || this.zoomLevel
      var jb = typeof T.heading === 'number' ? T.heading : this._heading
      var i = typeof T.tilt === 'number' ? T.tilt : this._tilt
      var ja = this._webglMapCamera.generateMVMatrix(e, i8, jb, i)
      var i9 = mat4.create(Float32Array)
      mat4.invert(i9, ja)
      return this._webglMapCamera.getPosition(i9)
    },
  })
  function ba(i) {
    this._jobQueue = []
    this._idleOnlyJobQueue = []
    var e = this
    this.isIdle = true
    i.on('updateframe', function (i8) {
      var T = 12 - i8.frameTime
      T = T < 1 ? 1 : T
      e.isIdle = false
      if (e.idleWorkTimer) {
        clearInterval(e.idleWorkTimer)
        e.idleWorkTimer = null
      }
      e.runJobs(T)
    })
    this._idleWorkerTicker = (function (T) {
      return function () {
        if (T.isIdle) {
          T.runJobs()
          T.runIdleOnlyJobs()
        }
      }
    })(this)
    i.on('mapglidle', function () {
      e.isIdle = true
      e.runJobs()
      e.runIdleOnlyJobs()
      e.idleWorkTimer = setInterval(e._idleWorkerTicker, ba.MAX_IDLE_TIME)
    })
  }
  ba.MAX_IDLE_TIME = 50
  ba.MAX_FRAME_TIME = 6
  ba.prototype.runJobs = function (i) {
    if (this._jobQueue.length === 0) {
      return
    }
    var i8 = hl()
    var e = 0
    i = i || ba.MAX_FRAME_TIME
    while (this._jobQueue.length && e < i) {
      var T = this._jobQueue.shift()
      if (T.state !== 'invalid') {
        T.call()
      }
      e = hl() - i8
    }
  }
  ba.prototype.runIdleOnlyJobs = function () {
    if (this._idleOnlyJobQueue.length === 0) {
      return
    }
    var T = hl()
    var e = 0
    while (this._idleOnlyJobQueue.length && e < ba.MAX_IDLE_TIME) {
      var i = this._idleOnlyJobQueue.shift()
      if (i.state !== 'invalid') {
        i.call()
      }
      e = hl() - T
    }
  }
  ba.prototype.checkIdleRunning = function () {
    if (this.isIdle && !this.idleWorkTimer) {
      this.runJobs()
      this.runIdleOnlyJobs()
      this.idleWorkTimer = setInterval(this._idleWorkerTicker, 50)
    }
  }
  ba.prototype.addJob = function (e) {
    this._jobQueue.push(e)
    this.checkIdleRunning()
  }
  ba.prototype.clearJobs = function () {
    this._jobQueue.length = 0
    this._idleOnlyJobQueue.length = 0
  }
  ba.prototype.addIdleOnlyJob = function (e) {
    this._idleOnlyJobQueue.push(e)
    this.checkIdleRunning()
  }
  var dq = {}
  ;(function (jb) {
    if (!jf) {
      var jf = 0.000001
    }
    if (!i) {
      var i = typeof Float32Array !== 'undefined' ? Float32Array : Array
    }
    if (!i9) {
      var i9 = Math.random
    }
    var T = {}
    var ja = Math.PI / 180
    T.toRadian = function (jg) {
      return jg * ja
    }
    var je = {}
    je.create = function (jh) {
      jh = jh || i
      var jg = new jh(2)
      jg[0] = 0
      jg[1] = 0
      return jg
    }
    je.clone = function (jg, ji) {
      ji = ji || i
      var jh = new ji(2)
      jh[0] = jg[0]
      jh[1] = jg[1]
      return jh
    }
    je.fromValues = function (jg, jj, ji) {
      ji = ji || i
      var jh = new ji(2)
      jh[0] = jg
      jh[1] = jj
      return jh
    }
    je.copy = function (jh, jg) {
      jh[0] = jg[0]
      jh[1] = jg[1]
      return jh
    }
    je.set = function (jh, jg, ji) {
      jh[0] = jg
      jh[1] = ji
      return jh
    }
    je.add = function (ji, jh, jg) {
      ji[0] = jh[0] + jg[0]
      ji[1] = jh[1] + jg[1]
      return ji
    }
    je.subtract = function (ji, jh, jg) {
      ji[0] = jh[0] - jg[0]
      ji[1] = jh[1] - jg[1]
      return ji
    }
    je.sub = je.subtract
    je.multiply = function (ji, jh, jg) {
      ji[0] = jh[0] * jg[0]
      ji[1] = jh[1] * jg[1]
      return ji
    }
    je.mul = je.multiply
    je.divide = function (ji, jh, jg) {
      ji[0] = jh[0] / jg[0]
      ji[1] = jh[1] / jg[1]
      return ji
    }
    je.div = je.divide
    je.min = function (ji, jh, jg) {
      ji[0] = Math.min(jh[0], jg[0])
      ji[1] = Math.min(jh[1], jg[1])
      return ji
    }
    je.max = function (ji, jh, jg) {
      ji[0] = Math.max(jh[0], jg[0])
      ji[1] = Math.max(jh[1], jg[1])
      return ji
    }
    je.scale = function (ji, jh, jg) {
      ji[0] = jh[0] * jg
      ji[1] = jh[1] * jg
      return ji
    }
    je.scaleAndAdd = function (ji, jh, jg, jj) {
      ji[0] = jh[0] + jg[0] * jj
      ji[1] = jh[1] + jg[1] * jj
      return ji
    }
    je.distance = function (ji, jh) {
      var jg = jh[0] - ji[0],
        jj = jh[1] - ji[1]
      return Math.sqrt(jg * jg + jj * jj)
    }
    je.dist = je.distance
    je.squaredDistance = function (ji, jh) {
      var jg = jh[0] - ji[0],
        jj = jh[1] - ji[1]
      return jg * jg + jj * jj
    }
    je.sqrDist = je.squaredDistance
    je.length = function (jh) {
      var jg = jh[0],
        ji = jh[1]
      return Math.sqrt(jg * jg + ji * ji)
    }
    je.len = je.length
    je.squaredLength = function (jh) {
      var jg = jh[0],
        ji = jh[1]
      return jg * jg + ji * ji
    }
    je.sqrLen = je.squaredLength
    je.negate = function (jh, jg) {
      jh[0] = -jg[0]
      jh[1] = -jg[1]
      return jh
    }
    je.normalize = function (jj, ji) {
      var jh = ji[0],
        jk = ji[1]
      var jg = jh * jh + jk * jk
      if (jg > 0) {
        jg = 1 / Math.sqrt(jg)
        jj[0] = ji[0] * jg
        jj[1] = ji[1] * jg
      }
      return jj
    }
    je.dot = function (jh, jg) {
      return jh[0] * jg[0] + jh[1] * jg[1]
    }
    je.cross = function (ji, jh, jg) {
      var jj = jh[0] * jg[1] - jh[1] * jg[0]
      ji[0] = ji[1] = 0
      ji[2] = jj
      return ji
    }
    je.lerp = function (ji, jh, jg, jj) {
      var jl = jh[0],
        jk = jh[1]
      ji[0] = jl + jj * (jg[0] - jl)
      ji[1] = jk + jj * (jg[1] - jk)
      return ji
    }
    je.random = function (jg, ji) {
      ji = ji || 1
      var jh = i9() * 2 * Math.PI
      jg[0] = Math.cos(jh) * ji
      jg[1] = Math.sin(jh) * ji
      return jg
    }
    je.transformMat2 = function (jj, ji, jh) {
      var jg = ji[0],
        jk = ji[1]
      jj[0] = jh[0] * jg + jh[2] * jk
      jj[1] = jh[1] * jg + jh[3] * jk
      return jj
    }
    je.transformMat2d = function (jj, ji, jh) {
      var jg = ji[0],
        jk = ji[1]
      jj[0] = jh[0] * jg + jh[2] * jk + jh[4]
      jj[1] = jh[1] * jg + jh[3] * jk + jh[5]
      return jj
    }
    je.transformMat3 = function (jj, ji, jh) {
      var jg = ji[0],
        jk = ji[1]
      jj[0] = jh[0] * jg + jh[3] * jk + jh[6]
      jj[1] = jh[1] * jg + jh[4] * jk + jh[7]
      return jj
    }
    je.transformMat4 = function (jj, ji, jh) {
      var jg = ji[0],
        jk = ji[1]
      jj[0] = jh[0] * jg + jh[4] * jk + jh[12]
      jj[1] = jh[1] * jg + jh[5] * jk + jh[13]
      return jj
    }
    je.rotate = function (jj, jh, jg, jn) {
      var jm = jh[0] - jg[0]
      var jl = jh[1] - jg[1]
      var ji = Math.sin(jn)
      var jk = Math.cos(jn)
      jj[0] = jm * jk - jl * ji + jg[0]
      jj[1] = jm * ji + jl * jk + jg[1]
      return jj
    }
    je.forEach = (function () {
      var jg = je.create()
      return function (jj, jn, jo, jm, jl, jh) {
        var jk, ji
        if (!jn) {
          jn = 2
        }
        if (!jo) {
          jo = 0
        }
        if (jm) {
          ji = Math.min(jm * jn + jo, jj.length)
        } else {
          ji = jj.length
        }
        for (jk = jo; jk < ji; jk += jn) {
          jg[0] = jj[jk]
          jg[1] = jj[jk + 1]
          jl(jg, jg, jh)
          jj[jk] = jg[0]
          jj[jk + 1] = jg[1]
        }
        return jj
      }
    })()
    je.str = function (jg) {
      return 'vec2(' + jg[0] + ', ' + jg[1] + ')'
    }
    jb.vec2 = je
    var jd = {}
    jd.create = function (jh) {
      jh = jh || i
      var jg = new jh(3)
      jg[0] = 0
      jg[1] = 0
      jg[2] = 0
      return jg
    }
    jd.clone = function (jg, ji) {
      ji = ji || i
      var jh = new ji(3)
      jh[0] = jg[0]
      jh[1] = jg[1]
      jh[2] = jg[2]
      return jh
    }
    jd.fromValues = function (jg, jk, ji, jj) {
      jj = jj || i
      var jh = new jj(3)
      jh[0] = jg
      jh[1] = jk
      jh[2] = ji
      return jh
    }
    jd.copy = function (jh, jg) {
      jh[0] = jg[0]
      jh[1] = jg[1]
      jh[2] = jg[2]
      return jh
    }
    jd.set = function (jh, jg, jj, ji) {
      jh[0] = jg
      jh[1] = jj
      jh[2] = ji
      return jh
    }
    jd.add = function (ji, jh, jg) {
      ji[0] = jh[0] + jg[0]
      ji[1] = jh[1] + jg[1]
      ji[2] = jh[2] + jg[2]
      return ji
    }
    jd.subtract = function (ji, jh, jg) {
      ji[0] = jh[0] - jg[0]
      ji[1] = jh[1] - jg[1]
      ji[2] = jh[2] - jg[2]
      return ji
    }
    jd.sub = jd.subtract
    jd.multiply = function (ji, jh, jg) {
      ji[0] = jh[0] * jg[0]
      ji[1] = jh[1] * jg[1]
      ji[2] = jh[2] * jg[2]
      return ji
    }
    jd.mul = jd.multiply
    jd.divide = function (ji, jh, jg) {
      ji[0] = jh[0] / jg[0]
      ji[1] = jh[1] / jg[1]
      ji[2] = jh[2] / jg[2]
      return ji
    }
    jd.div = jd.divide
    jd.min = function (ji, jh, jg) {
      ji[0] = Math.min(jh[0], jg[0])
      ji[1] = Math.min(jh[1], jg[1])
      ji[2] = Math.min(jh[2], jg[2])
      return ji
    }
    jd.max = function (ji, jh, jg) {
      ji[0] = Math.max(jh[0], jg[0])
      ji[1] = Math.max(jh[1], jg[1])
      ji[2] = Math.max(jh[2], jg[2])
      return ji
    }
    jd.scale = function (ji, jh, jg) {
      ji[0] = jh[0] * jg
      ji[1] = jh[1] * jg
      ji[2] = jh[2] * jg
      return ji
    }
    jd.scaleAndAdd = function (ji, jh, jg, jj) {
      ji[0] = jh[0] + jg[0] * jj
      ji[1] = jh[1] + jg[1] * jj
      ji[2] = jh[2] + jg[2] * jj
      return ji
    }
    jd.distance = function (ji, jh) {
      var jg = jh[0] - ji[0],
        jk = jh[1] - ji[1],
        jj = jh[2] - ji[2]
      return Math.sqrt(jg * jg + jk * jk + jj * jj)
    }
    jd.dist = jd.distance
    jd.squaredDistance = function (ji, jh) {
      var jg = jh[0] - ji[0],
        jk = jh[1] - ji[1],
        jj = jh[2] - ji[2]
      return jg * jg + jk * jk + jj * jj
    }
    jd.sqrDist = jd.squaredDistance
    jd.length = function (jh) {
      var jg = jh[0],
        jj = jh[1],
        ji = jh[2]
      return Math.sqrt(jg * jg + jj * jj + ji * ji)
    }
    jd.len = jd.length
    jd.squaredLength = function (jh) {
      var jg = jh[0],
        jj = jh[1],
        ji = jh[2]
      return jg * jg + jj * jj + ji * ji
    }
    jd.sqrLen = jd.squaredLength
    jd.negate = function (jh, jg) {
      jh[0] = -jg[0]
      jh[1] = -jg[1]
      jh[2] = -jg[2]
      return jh
    }
    jd.normalize = function (jj, ji) {
      var jh = ji[0],
        jl = ji[1],
        jk = ji[2]
      var jg = jh * jh + jl * jl + jk * jk
      if (jg > 0) {
        jg = 1 / Math.sqrt(jg)
        jj[0] = ji[0] * jg
        jj[1] = ji[1] * jg
        jj[2] = ji[2] * jg
      }
      return jj
    }
    jd.dot = function (jh, jg) {
      return jh[0] * jg[0] + jh[1] * jg[1] + jh[2] * jg[2]
    }
    jd.cross = function (jh, jm, jl) {
      var jg = jm[0],
        jo = jm[1],
        jn = jm[2],
        jk = jl[0],
        jj = jl[1],
        ji = jl[2]
      jh[0] = jo * ji - jn * jj
      jh[1] = jn * jk - jg * ji
      jh[2] = jg * jj - jo * jk
      return jh
    }
    jd.lerp = function (ji, jh, jg, jj) {
      var jm = jh[0],
        jl = jh[1],
        jk = jh[2]
      ji[0] = jm + jj * (jg[0] - jm)
      ji[1] = jl + jj * (jg[1] - jl)
      ji[2] = jk + jj * (jg[2] - jk)
      return ji
    }
    jd.random = function (jg, jk) {
      jk = jk || 1
      var ji = i9() * 2 * Math.PI
      var jj = i9() * 2 - 1
      var jh = Math.sqrt(1 - jj * jj) * jk
      jg[0] = Math.cos(ji) * jh
      jg[1] = Math.sin(ji) * jh
      jg[2] = jj * jk
      return jg
    }
    jd.transformMat4 = function (jj, ji, jh) {
      var jg = ji[0],
        jl = ji[1],
        jk = ji[2]
      jj[0] = jh[0] * jg + jh[4] * jl + jh[8] * jk + jh[12]
      jj[1] = jh[1] * jg + jh[5] * jl + jh[9] * jk + jh[13]
      jj[2] = jh[2] * jg + jh[6] * jl + jh[10] * jk + jh[14]
      return jj
    }
    jd.transformMat3 = function (jj, ji, jh) {
      var jg = ji[0],
        jl = ji[1],
        jk = ji[2]
      jj[0] = jg * jh[0] + jl * jh[3] + jk * jh[6]
      jj[1] = jg * jh[1] + jl * jh[4] + jk * jh[7]
      jj[2] = jg * jh[2] + jl * jh[5] + jk * jh[8]
      return jj
    }
    jd.transformQuat = function (jm, js, jg) {
      var jt = js[0],
        jr = js[1],
        jq = js[2],
        jo = jg[0],
        jn = jg[1],
        jl = jg[2],
        jp = jg[3],
        jj = jp * jt + jn * jq - jl * jr,
        ji = jp * jr + jl * jt - jo * jq,
        jh = jp * jq + jo * jr - jn * jt,
        jk = -jo * jt - jn * jr - jl * jq
      jm[0] = jj * jp + jk * -jo + ji * -jl - jh * -jn
      jm[1] = ji * jp + jk * -jn + jh * -jo - jj * -jl
      jm[2] = jh * jp + jk * -jl + jj * -jn - ji * -jo
      return jm
    }
    jd.rotateX = function (ji, jh, jg, jl) {
      var jk = [],
        jj = []
      jk[0] = jh[0] - jg[0]
      jk[1] = jh[1] - jg[1]
      jk[2] = jh[2] - jg[2]
      jj[0] = jk[0]
      jj[1] = jk[1] * Math.cos(jl) - jk[2] * Math.sin(jl)
      jj[2] = jk[1] * Math.sin(jl) + jk[2] * Math.cos(jl)
      ji[0] = jj[0] + jg[0]
      ji[1] = jj[1] + jg[1]
      ji[2] = jj[2] + jg[2]
      return ji
    }
    jd.rotateY = function (ji, jh, jg, jl) {
      var jk = [],
        jj = []
      jk[0] = jh[0] - jg[0]
      jk[1] = jh[1] - jg[1]
      jk[2] = jh[2] - jg[2]
      jj[0] = jk[2] * Math.sin(jl) + jk[0] * Math.cos(jl)
      jj[1] = jk[1]
      jj[2] = jk[2] * Math.cos(jl) - jk[0] * Math.sin(jl)
      ji[0] = jj[0] + jg[0]
      ji[1] = jj[1] + jg[1]
      ji[2] = jj[2] + jg[2]
      return ji
    }
    jd.rotateZ = function (ji, jh, jg, jl) {
      var jk = [],
        jj = []
      jk[0] = jh[0] - jg[0]
      jk[1] = jh[1] - jg[1]
      jk[2] = jh[2] - jg[2]
      jj[0] = jk[0] * Math.cos(jl) - jk[1] * Math.sin(jl)
      jj[1] = jk[0] * Math.sin(jl) + jk[1] * Math.cos(jl)
      jj[2] = jk[2]
      ji[0] = jj[0] + jg[0]
      ji[1] = jj[1] + jg[1]
      ji[2] = jj[2] + jg[2]
      return ji
    }
    jd.forEach = (function () {
      var jg = jd.create()
      return function (jj, jn, jo, jm, jl, jh) {
        var jk, ji
        if (!jn) {
          jn = 3
        }
        if (!jo) {
          jo = 0
        }
        if (jm) {
          ji = Math.min(jm * jn + jo, jj.length)
        } else {
          ji = jj.length
        }
        for (jk = jo; jk < ji; jk += jn) {
          jg[0] = jj[jk]
          jg[1] = jj[jk + 1]
          jg[2] = jj[jk + 2]
          jl(jg, jg, jh)
          jj[jk] = jg[0]
          jj[jk + 1] = jg[1]
          jj[jk + 2] = jg[2]
        }
        return jj
      }
    })()
    jd.str = function (jg) {
      return 'vec3(' + jg[0] + ', ' + jg[1] + ', ' + jg[2] + ')'
    }
    jb.vec3 = jd
    var jc = {}
    jc.create = function (jh) {
      jh = jh || i
      var jg = new jh(4)
      jg[0] = 0
      jg[1] = 0
      jg[2] = 0
      jg[3] = 0
      return jg
    }
    jc.clone = function (jg, ji) {
      ji = ji || i
      var jh = new ji(4)
      jh[0] = jg[0]
      jh[1] = jg[1]
      jh[2] = jg[2]
      jh[3] = jg[3]
      return jh
    }
    jc.fromValues = function (jg, jl, jj, jh, jk) {
      jk = jk || i
      var ji = new jk(4)
      ji[0] = jg
      ji[1] = jl
      ji[2] = jj
      ji[3] = jh
      return ji
    }
    jc.copy = function (jh, jg) {
      jh[0] = jg[0]
      jh[1] = jg[1]
      jh[2] = jg[2]
      jh[3] = jg[3]
      return jh
    }
    jc.set = function (ji, jg, jk, jj, jh) {
      ji[0] = jg
      ji[1] = jk
      ji[2] = jj
      ji[3] = jh
      return ji
    }
    jc.add = function (ji, jh, jg) {
      ji[0] = jh[0] + jg[0]
      ji[1] = jh[1] + jg[1]
      ji[2] = jh[2] + jg[2]
      ji[3] = jh[3] + jg[3]
      return ji
    }
    jc.subtract = function (ji, jh, jg) {
      ji[0] = jh[0] - jg[0]
      ji[1] = jh[1] - jg[1]
      ji[2] = jh[2] - jg[2]
      ji[3] = jh[3] - jg[3]
      return ji
    }
    jc.sub = jc.subtract
    jc.multiply = function (ji, jh, jg) {
      ji[0] = jh[0] * jg[0]
      ji[1] = jh[1] * jg[1]
      ji[2] = jh[2] * jg[2]
      ji[3] = jh[3] * jg[3]
      return ji
    }
    jc.mul = jc.multiply
    jc.divide = function (ji, jh, jg) {
      ji[0] = jh[0] / jg[0]
      ji[1] = jh[1] / jg[1]
      ji[2] = jh[2] / jg[2]
      ji[3] = jh[3] / jg[3]
      return ji
    }
    jc.div = jc.divide
    jc.min = function (ji, jh, jg) {
      ji[0] = Math.min(jh[0], jg[0])
      ji[1] = Math.min(jh[1], jg[1])
      ji[2] = Math.min(jh[2], jg[2])
      ji[3] = Math.min(jh[3], jg[3])
      return ji
    }
    jc.max = function (ji, jh, jg) {
      ji[0] = Math.max(jh[0], jg[0])
      ji[1] = Math.max(jh[1], jg[1])
      ji[2] = Math.max(jh[2], jg[2])
      ji[3] = Math.max(jh[3], jg[3])
      return ji
    }
    jc.scale = function (ji, jh, jg) {
      ji[0] = jh[0] * jg
      ji[1] = jh[1] * jg
      ji[2] = jh[2] * jg
      ji[3] = jh[3] * jg
      return ji
    }
    jc.scaleAndAdd = function (ji, jh, jg, jj) {
      ji[0] = jh[0] + jg[0] * jj
      ji[1] = jh[1] + jg[1] * jj
      ji[2] = jh[2] + jg[2] * jj
      ji[3] = jh[3] + jg[3] * jj
      return ji
    }
    jc.distance = function (jj, jh) {
      var jg = jh[0] - jj[0],
        jl = jh[1] - jj[1],
        jk = jh[2] - jj[2],
        ji = jh[3] - jj[3]
      return Math.sqrt(jg * jg + jl * jl + jk * jk + ji * ji)
    }
    jc.dist = jc.distance
    jc.squaredDistance = function (jj, jh) {
      var jg = jh[0] - jj[0],
        jl = jh[1] - jj[1],
        jk = jh[2] - jj[2],
        ji = jh[3] - jj[3]
      return jg * jg + jl * jl + jk * jk + ji * ji
    }
    jc.sqrDist = jc.squaredDistance
    jc.length = function (ji) {
      var jg = ji[0],
        jk = ji[1],
        jj = ji[2],
        jh = ji[3]
      return Math.sqrt(jg * jg + jk * jk + jj * jj + jh * jh)
    }
    jc.len = jc.length
    jc.squaredLength = function (ji) {
      var jg = ji[0],
        jk = ji[1],
        jj = ji[2],
        jh = ji[3]
      return jg * jg + jk * jk + jj * jj + jh * jh
    }
    jc.sqrLen = jc.squaredLength
    jc.negate = function (jh, jg) {
      jh[0] = -jg[0]
      jh[1] = -jg[1]
      jh[2] = -jg[2]
      jh[3] = -jg[3]
      return jh
    }
    jc.normalize = function (jk, jj) {
      var jh = jj[0],
        jm = jj[1],
        jl = jj[2],
        ji = jj[3]
      var jg = jh * jh + jm * jm + jl * jl + ji * ji
      if (jg > 0) {
        jg = 1 / Math.sqrt(jg)
        jk[0] = jj[0] * jg
        jk[1] = jj[1] * jg
        jk[2] = jj[2] * jg
        jk[3] = jj[3] * jg
      }
      return jk
    }
    jc.dot = function (jh, jg) {
      return jh[0] * jg[0] + jh[1] * jg[1] + jh[2] * jg[2] + jh[3] * jg[3]
    }
    jc.lerp = function (ji, jh, jg, jj) {
      var jm = jh[0],
        jl = jh[1],
        jk = jh[2],
        jn = jh[3]
      ji[0] = jm + jj * (jg[0] - jm)
      ji[1] = jl + jj * (jg[1] - jl)
      ji[2] = jk + jj * (jg[2] - jk)
      ji[3] = jn + jj * (jg[3] - jn)
      return ji
    }
    jc.random = function (jg, jh) {
      jh = jh || 1
      jg[0] = i9()
      jg[1] = i9()
      jg[2] = i9()
      jg[3] = i9()
      jc.normalize(jg, jg)
      jc.scale(jg, jg, jh)
      return jg
    }
    jc.transformMat4 = function (jk, jj, jh) {
      var jg = jj[0],
        jm = jj[1],
        jl = jj[2],
        ji = jj[3]
      jk[0] = jh[0] * jg + jh[4] * jm + jh[8] * jl + jh[12] * ji
      jk[1] = jh[1] * jg + jh[5] * jm + jh[9] * jl + jh[13] * ji
      jk[2] = jh[2] * jg + jh[6] * jm + jh[10] * jl + jh[14] * ji
      jk[3] = jh[3] * jg + jh[7] * jm + jh[11] * jl + jh[15] * ji
      return jk
    }
    jc.transformQuat = function (jm, js, jg) {
      var jt = js[0],
        jr = js[1],
        jq = js[2],
        jo = jg[0],
        jn = jg[1],
        jl = jg[2],
        jp = jg[3],
        jj = jp * jt + jn * jq - jl * jr,
        ji = jp * jr + jl * jt - jo * jq,
        jh = jp * jq + jo * jr - jn * jt,
        jk = -jo * jt - jn * jr - jl * jq
      jm[0] = jj * jp + jk * -jo + ji * -jl - jh * -jn
      jm[1] = ji * jp + jk * -jn + jh * -jo - jj * -jl
      jm[2] = jh * jp + jk * -jl + jj * -jn - ji * -jo
      return jm
    }
    jc.forEach = (function () {
      var jg = jc.create()
      return function (jj, jn, jo, jm, jl, jh) {
        var jk, ji
        if (!jn) {
          jn = 4
        }
        if (!jo) {
          jo = 0
        }
        if (jm) {
          ji = Math.min(jm * jn + jo, jj.length)
        } else {
          ji = jj.length
        }
        for (jk = jo; jk < ji; jk += jn) {
          jg[0] = jj[jk]
          jg[1] = jj[jk + 1]
          jg[2] = jj[jk + 2]
          jg[3] = jj[jk + 3]
          jl(jg, jg, jh)
          jj[jk] = jg[0]
          jj[jk + 1] = jg[1]
          jj[jk + 2] = jg[2]
          jj[jk + 3] = jg[3]
        }
        return jj
      }
    })()
    jc.str = function (jg) {
      return 'vec4(' + jg[0] + ', ' + jg[1] + ', ' + jg[2] + ', ' + jg[3] + ')'
    }
    jb.vec4 = jc
    var i8 = {}
    i8.create = function (jh) {
      jh = jh || i
      var jg = new jh(4)
      jg[0] = 1
      jg[1] = 0
      jg[2] = 0
      jg[3] = 1
      return jg
    }
    i8.clone = function (jg, ji) {
      ji = ji || i
      var jh = new ji(4)
      jh[0] = jg[0]
      jh[1] = jg[1]
      jh[2] = jg[2]
      jh[3] = jg[3]
      return jh
    }
    i8.copy = function (jh, jg) {
      jh[0] = jg[0]
      jh[1] = jg[1]
      jh[2] = jg[2]
      jh[3] = jg[3]
      return jh
    }
    i8.identity = function (jg) {
      jg[0] = 1
      jg[1] = 0
      jg[2] = 0
      jg[3] = 1
      return jg
    }
    i8.transpose = function (ji, jh) {
      if (ji === jh) {
        var jg = jh[1]
        ji[1] = jh[2]
        ji[2] = jg
      } else {
        ji[0] = jh[0]
        ji[1] = jh[2]
        ji[2] = jh[1]
        ji[3] = jh[3]
      }
      return ji
    }
    i8.invert = function (jk, ji) {
      var jj = ji[0],
        jh = ji[1],
        jg = ji[2],
        jm = ji[3],
        jl = jj * jm - jg * jh
      if (!jl) {
        return null
      }
      jl = 1 / jl
      jk[0] = jm * jl
      jk[1] = -jh * jl
      jk[2] = -jg * jl
      jk[3] = jj * jl
      return jk
    }
    i8.adjoint = function (ji, jg) {
      var jh = jg[0]
      ji[0] = jg[3]
      ji[1] = -jg[1]
      ji[2] = -jg[2]
      ji[3] = jh
      return ji
    }
    i8.determinant = function (jg) {
      return jg[0] * jg[3] - jg[2] * jg[1]
    }
    i8.multiply = function (jk, jp, jn) {
      var jj = jp[0],
        ji = jp[1],
        jh = jp[2],
        jg = jp[3]
      var jq = jn[0],
        jo = jn[1],
        jm = jn[2],
        jl = jn[3]
      jk[0] = jj * jq + jh * jo
      jk[1] = ji * jq + jg * jo
      jk[2] = jj * jm + jh * jl
      jk[3] = ji * jm + jg * jl
      return jk
    }
    i8.mul = i8.multiply
    i8.rotate = function (jk, jn, jm) {
      var jj = jn[0],
        ji = jn[1],
        jh = jn[2],
        jg = jn[3],
        jo = Math.sin(jm),
        jl = Math.cos(jm)
      jk[0] = jj * jl + jh * jo
      jk[1] = ji * jl + jg * jo
      jk[2] = jj * -jo + jh * jl
      jk[3] = ji * -jo + jg * jl
      return jk
    }
    i8.scale = function (jk, jl, jn) {
      var jj = jl[0],
        ji = jl[1],
        jh = jl[2],
        jg = jl[3],
        jo = jn[0],
        jm = jn[1]
      jk[0] = jj * jo
      jk[1] = ji * jo
      jk[2] = jh * jm
      jk[3] = jg * jm
      return jk
    }
    i8.str = function (jg) {
      return 'mat2(' + jg[0] + ', ' + jg[1] + ', ' + jg[2] + ', ' + jg[3] + ')'
    }
    i8.frob = function (jg) {
      return Math.sqrt(
        Math.pow(jg[0], 2) +
          Math.pow(jg[1], 2) +
          Math.pow(jg[2], 2) +
          Math.pow(jg[3], 2)
      )
    }
    i8.LDU = function (jg, jj, ji, jh) {
      jg[2] = jh[2] / jh[0]
      ji[0] = jh[0]
      ji[1] = jh[1]
      ji[3] = jh[3] - jg[2] * ji[1]
      return [jg, jj, ji]
    }
    jb.mat2 = i8
    var e = {}
    e.create = function (jh) {
      jh = jh || i
      var jg = new jh(16)
      jg[0] = 1
      jg[1] = 0
      jg[2] = 0
      jg[3] = 0
      jg[4] = 0
      jg[5] = 1
      jg[6] = 0
      jg[7] = 0
      jg[8] = 0
      jg[9] = 0
      jg[10] = 1
      jg[11] = 0
      jg[12] = 0
      jg[13] = 0
      jg[14] = 0
      jg[15] = 1
      return jg
    }
    e.clone = function (jg) {
      var jh = new i(16)
      jh[0] = jg[0]
      jh[1] = jg[1]
      jh[2] = jg[2]
      jh[3] = jg[3]
      jh[4] = jg[4]
      jh[5] = jg[5]
      jh[6] = jg[6]
      jh[7] = jg[7]
      jh[8] = jg[8]
      jh[9] = jg[9]
      jh[10] = jg[10]
      jh[11] = jg[11]
      jh[12] = jg[12]
      jh[13] = jg[13]
      jh[14] = jg[14]
      jh[15] = jg[15]
      return jh
    }
    e.copy = function (jh, jg) {
      jh[0] = jg[0]
      jh[1] = jg[1]
      jh[2] = jg[2]
      jh[3] = jg[3]
      jh[4] = jg[4]
      jh[5] = jg[5]
      jh[6] = jg[6]
      jh[7] = jg[7]
      jh[8] = jg[8]
      jh[9] = jg[9]
      jh[10] = jg[10]
      jh[11] = jg[11]
      jh[12] = jg[12]
      jh[13] = jg[13]
      jh[14] = jg[14]
      jh[15] = jg[15]
      return jh
    }
    e.identity = function (jg) {
      jg[0] = 1
      jg[1] = 0
      jg[2] = 0
      jg[3] = 0
      jg[4] = 0
      jg[5] = 1
      jg[6] = 0
      jg[7] = 0
      jg[8] = 0
      jg[9] = 0
      jg[10] = 1
      jg[11] = 0
      jg[12] = 0
      jg[13] = 0
      jg[14] = 0
      jg[15] = 1
      return jg
    }
    e.transpose = function (jj, ji) {
      if (jj === ji) {
        var jn = ji[1],
          jl = ji[2],
          jk = ji[3],
          jg = ji[6],
          jm = ji[7],
          jh = ji[11]
        jj[1] = ji[4]
        jj[2] = ji[8]
        jj[3] = ji[12]
        jj[4] = jn
        jj[6] = ji[9]
        jj[7] = ji[13]
        jj[8] = jl
        jj[9] = jg
        jj[11] = ji[14]
        jj[12] = jk
        jj[13] = jm
        jj[14] = jh
      } else {
        jj[0] = ji[0]
        jj[1] = ji[4]
        jj[2] = ji[8]
        jj[3] = ji[12]
        jj[4] = ji[1]
        jj[5] = ji[5]
        jj[6] = ji[9]
        jj[7] = ji[13]
        jj[8] = ji[2]
        jj[9] = ji[6]
        jj[10] = ji[10]
        jj[11] = ji[14]
        jj[12] = ji[3]
        jj[13] = ji[7]
        jj[14] = ji[11]
        jj[15] = ji[15]
      }
      return jj
    }
    e.invert = function (jz, jE) {
      var jI = jE[0],
        jG = jE[1],
        jF = jE[2],
        jC = jE[3],
        jk = jE[4],
        jj = jE[5],
        ji = jE[6],
        jh = jE[7],
        jy = jE[8],
        jx = jE[9],
        jw = jE[10],
        jv = jE[11],
        jK = jE[12],
        jJ = jE[13],
        jH = jE[14],
        jD = jE[15],
        ju = jI * jj - jG * jk,
        jt = jI * ji - jF * jk,
        js = jI * jh - jC * jk,
        jr = jG * ji - jF * jj,
        jq = jG * jh - jC * jj,
        jp = jF * jh - jC * ji,
        jo = jy * jJ - jx * jK,
        jn = jy * jH - jw * jK,
        jm = jy * jD - jv * jK,
        jl = jx * jH - jw * jJ,
        jB = jx * jD - jv * jJ,
        jA = jw * jD - jv * jH,
        jg = ju * jA - jt * jB + js * jl + jr * jm - jq * jn + jp * jo
      if (!jg) {
        return null
      }
      jg = 1 / jg
      jz[0] = (jj * jA - ji * jB + jh * jl) * jg
      jz[1] = (jF * jB - jG * jA - jC * jl) * jg
      jz[2] = (jJ * jp - jH * jq + jD * jr) * jg
      jz[3] = (jw * jq - jx * jp - jv * jr) * jg
      jz[4] = (ji * jm - jk * jA - jh * jn) * jg
      jz[5] = (jI * jA - jF * jm + jC * jn) * jg
      jz[6] = (jH * js - jK * jp - jD * jt) * jg
      jz[7] = (jy * jp - jw * js + jv * jt) * jg
      jz[8] = (jk * jB - jj * jm + jh * jo) * jg
      jz[9] = (jG * jm - jI * jB - jC * jo) * jg
      jz[10] = (jK * jq - jJ * js + jD * ju) * jg
      jz[11] = (jx * js - jy * jq - jv * ju) * jg
      jz[12] = (jj * jn - jk * jl - ji * jo) * jg
      jz[13] = (jI * jl - jG * jn + jF * jo) * jg
      jz[14] = (jJ * jt - jK * jr - jH * ju) * jg
      jz[15] = (jy * jr - jx * jt + jw * ju) * jg
      return jz
    }
    e.adjoint = function (jo, jr) {
      var jv = jr[0],
        jt = jr[1],
        js = jr[2],
        jp = jr[3],
        jj = jr[4],
        ji = jr[5],
        jh = jr[6],
        jg = jr[7],
        jn = jr[8],
        jm = jr[9],
        jl = jr[10],
        jk = jr[11],
        jx = jr[12],
        jw = jr[13],
        ju = jr[14],
        jq = jr[15]
      jo[0] =
        ji * (jl * jq - jk * ju) -
        jm * (jh * jq - jg * ju) +
        jw * (jh * jk - jg * jl)
      jo[1] = -(
        jt * (jl * jq - jk * ju) -
        jm * (js * jq - jp * ju) +
        jw * (js * jk - jp * jl)
      )
      jo[2] =
        jt * (jh * jq - jg * ju) -
        ji * (js * jq - jp * ju) +
        jw * (js * jg - jp * jh)
      jo[3] = -(
        jt * (jh * jk - jg * jl) -
        ji * (js * jk - jp * jl) +
        jm * (js * jg - jp * jh)
      )
      jo[4] = -(
        jj * (jl * jq - jk * ju) -
        jn * (jh * jq - jg * ju) +
        jx * (jh * jk - jg * jl)
      )
      jo[5] =
        jv * (jl * jq - jk * ju) -
        jn * (js * jq - jp * ju) +
        jx * (js * jk - jp * jl)
      jo[6] = -(
        jv * (jh * jq - jg * ju) -
        jj * (js * jq - jp * ju) +
        jx * (js * jg - jp * jh)
      )
      jo[7] =
        jv * (jh * jk - jg * jl) -
        jj * (js * jk - jp * jl) +
        jn * (js * jg - jp * jh)
      jo[8] =
        jj * (jm * jq - jk * jw) -
        jn * (ji * jq - jg * jw) +
        jx * (ji * jk - jg * jm)
      jo[9] = -(
        jv * (jm * jq - jk * jw) -
        jn * (jt * jq - jp * jw) +
        jx * (jt * jk - jp * jm)
      )
      jo[10] =
        jv * (ji * jq - jg * jw) -
        jj * (jt * jq - jp * jw) +
        jx * (jt * jg - jp * ji)
      jo[11] = -(
        jv * (ji * jk - jg * jm) -
        jj * (jt * jk - jp * jm) +
        jn * (jt * jg - jp * ji)
      )
      jo[12] = -(
        jj * (jm * ju - jl * jw) -
        jn * (ji * ju - jh * jw) +
        jx * (ji * jl - jh * jm)
      )
      jo[13] =
        jv * (jm * ju - jl * jw) -
        jn * (jt * ju - js * jw) +
        jx * (jt * jl - js * jm)
      jo[14] = -(
        jv * (ji * ju - jh * jw) -
        jj * (jt * ju - js * jw) +
        jx * (jt * jh - js * ji)
      )
      jo[15] =
        jv * (ji * jl - jh * jm) -
        jj * (jt * jl - js * jm) +
        jn * (jt * jh - js * ji)
      return jo
    }
    e.determinant = function (jB) {
      var jG = jB[0],
        jE = jB[1],
        jC = jB[2],
        jA = jB[3],
        jj = jB[4],
        ji = jB[5],
        jh = jB[6],
        jg = jB[7],
        jx = jB[8],
        jw = jB[9],
        jv = jB[10],
        ju = jB[11],
        jI = jB[12],
        jH = jB[13],
        jF = jB[14],
        jD = jB[15],
        jt = jG * ji - jE * jj,
        js = jG * jh - jC * jj,
        jr = jG * jg - jA * jj,
        jq = jE * jh - jC * ji,
        jp = jE * jg - jA * ji,
        jo = jC * jg - jA * jh,
        jn = jx * jH - jw * jI,
        jm = jx * jF - jv * jI,
        jl = jx * jD - ju * jI,
        jk = jw * jF - jv * jH,
        jz = jw * jD - ju * jH,
        jy = jv * jD - ju * jF
      return jt * jy - js * jz + jr * jk + jq * jl - jp * jm + jo * jn
    }
    e.multiply = function (js, jw, jt) {
      var jA = jw[0],
        jz = jw[1],
        jx = jw[2],
        ju = jw[3],
        jm = jw[4],
        jk = jw[5],
        ji = jw[6],
        jg = jw[7],
        jr = jw[8],
        jq = jw[9],
        jp = jw[10],
        jo = jw[11],
        jC = jw[12],
        jB = jw[13],
        jy = jw[14],
        jv = jw[15]
      var jn = jt[0],
        jl = jt[1],
        jj = jt[2],
        jh = jt[3]
      js[0] = jn * jA + jl * jm + jj * jr + jh * jC
      js[1] = jn * jz + jl * jk + jj * jq + jh * jB
      js[2] = jn * jx + jl * ji + jj * jp + jh * jy
      js[3] = jn * ju + jl * jg + jj * jo + jh * jv
      jn = jt[4]
      jl = jt[5]
      jj = jt[6]
      jh = jt[7]
      js[4] = jn * jA + jl * jm + jj * jr + jh * jC
      js[5] = jn * jz + jl * jk + jj * jq + jh * jB
      js[6] = jn * jx + jl * ji + jj * jp + jh * jy
      js[7] = jn * ju + jl * jg + jj * jo + jh * jv
      jn = jt[8]
      jl = jt[9]
      jj = jt[10]
      jh = jt[11]
      js[8] = jn * jA + jl * jm + jj * jr + jh * jC
      js[9] = jn * jz + jl * jk + jj * jq + jh * jB
      js[10] = jn * jx + jl * ji + jj * jp + jh * jy
      js[11] = jn * ju + jl * jg + jj * jo + jh * jv
      jn = jt[12]
      jl = jt[13]
      jj = jt[14]
      jh = jt[15]
      js[12] = jn * jA + jl * jm + jj * jr + jh * jC
      js[13] = jn * jz + jl * jk + jj * jq + jh * jB
      js[14] = jn * jx + jl * ji + jj * jp + jh * jy
      js[15] = jn * ju + jl * jg + jj * jo + jh * jv
      return js
    }
    e.mul = e.multiply
    e.translate = function (js, ju, jn) {
      var jm = jn[0],
        jl = jn[1],
        jk = jn[2],
        jx,
        jw,
        jv,
        jt,
        jj,
        ji,
        jh,
        jg,
        jr,
        jq,
        jp,
        jo
      if (ju === js) {
        js[12] = ju[0] * jm + ju[4] * jl + ju[8] * jk + ju[12]
        js[13] = ju[1] * jm + ju[5] * jl + ju[9] * jk + ju[13]
        js[14] = ju[2] * jm + ju[6] * jl + ju[10] * jk + ju[14]
        js[15] = ju[3] * jm + ju[7] * jl + ju[11] * jk + ju[15]
      } else {
        jx = ju[0]
        jw = ju[1]
        jv = ju[2]
        jt = ju[3]
        jj = ju[4]
        ji = ju[5]
        jh = ju[6]
        jg = ju[7]
        jr = ju[8]
        jq = ju[9]
        jp = ju[10]
        jo = ju[11]
        js[0] = jx
        js[1] = jw
        js[2] = jv
        js[3] = jt
        js[4] = jj
        js[5] = ji
        js[6] = jh
        js[7] = jg
        js[8] = jr
        js[9] = jq
        js[10] = jp
        js[11] = jo
        js[12] = jx * jm + jj * jl + jr * jk + ju[12]
        js[13] = jw * jm + ji * jl + jq * jk + ju[13]
        js[14] = jv * jm + jh * jl + jp * jk + ju[14]
        js[15] = jt * jm + jg * jl + jo * jk + ju[15]
      }
      return js
    }
    e.scale = function (jj, jh, ji) {
      var jg = ji[0],
        jl = ji[1],
        jk = ji[2]
      jj[0] = jh[0] * jg
      jj[1] = jh[1] * jg
      jj[2] = jh[2] * jg
      jj[3] = jh[3] * jg
      jj[4] = jh[4] * jl
      jj[5] = jh[5] * jl
      jj[6] = jh[6] * jl
      jj[7] = jh[7] * jl
      jj[8] = jh[8] * jk
      jj[9] = jh[9] * jk
      jj[10] = jh[10] * jk
      jj[11] = jh[11] * jk
      jj[12] = jh[12]
      jj[13] = jh[13]
      jj[14] = jh[14]
      jj[15] = jh[15]
      return jj
    }
    e.rotate = function (jA, jH, jJ, jg) {
      var jq = jg[0],
        jp = jg[1],
        jo = jg[2],
        jB = Math.sqrt(jq * jq + jp * jp + jo * jo),
        jv,
        jF,
        ju,
        jL,
        jK,
        jI,
        jG,
        jn,
        jm,
        jl,
        jk,
        jz,
        jy,
        jx,
        jw,
        jt,
        js,
        jr,
        jE,
        jD,
        jC,
        jj,
        ji,
        jh
      if (Math.abs(jB) < jf) {
        return null
      }
      jB = 1 / jB
      jq *= jB
      jp *= jB
      jo *= jB
      jv = Math.sin(jJ)
      jF = Math.cos(jJ)
      ju = 1 - jF
      jL = jH[0]
      jK = jH[1]
      jI = jH[2]
      jG = jH[3]
      jn = jH[4]
      jm = jH[5]
      jl = jH[6]
      jk = jH[7]
      jz = jH[8]
      jy = jH[9]
      jx = jH[10]
      jw = jH[11]
      jt = jq * jq * ju + jF
      js = jp * jq * ju + jo * jv
      jr = jo * jq * ju - jp * jv
      jE = jq * jp * ju - jo * jv
      jD = jp * jp * ju + jF
      jC = jo * jp * ju + jq * jv
      jj = jq * jo * ju + jp * jv
      ji = jp * jo * ju - jq * jv
      jh = jo * jo * ju + jF
      jA[0] = jL * jt + jn * js + jz * jr
      jA[1] = jK * jt + jm * js + jy * jr
      jA[2] = jI * jt + jl * js + jx * jr
      jA[3] = jG * jt + jk * js + jw * jr
      jA[4] = jL * jE + jn * jD + jz * jC
      jA[5] = jK * jE + jm * jD + jy * jC
      jA[6] = jI * jE + jl * jD + jx * jC
      jA[7] = jG * jE + jk * jD + jw * jC
      jA[8] = jL * jj + jn * ji + jz * jh
      jA[9] = jK * jj + jm * ji + jy * jh
      jA[10] = jI * jj + jl * ji + jx * jh
      jA[11] = jG * jj + jk * ji + jw * jh
      if (jH !== jA) {
        jA[12] = jH[12]
        jA[13] = jH[13]
        jA[14] = jH[14]
        jA[15] = jH[15]
      }
      return jA
    }
    e.rotateX = function (jg, jn, jm) {
      var js = Math.sin(jm),
        jl = Math.cos(jm),
        jr = jn[4],
        jq = jn[5],
        jp = jn[6],
        jo = jn[7],
        jk = jn[8],
        jj = jn[9],
        ji = jn[10],
        jh = jn[11]
      if (jn !== jg) {
        jg[0] = jn[0]
        jg[1] = jn[1]
        jg[2] = jn[2]
        jg[3] = jn[3]
        jg[12] = jn[12]
        jg[13] = jn[13]
        jg[14] = jn[14]
        jg[15] = jn[15]
      }
      jg[4] = jr * jl + jk * js
      jg[5] = jq * jl + jj * js
      jg[6] = jp * jl + ji * js
      jg[7] = jo * jl + jh * js
      jg[8] = jk * jl - jr * js
      jg[9] = jj * jl - jq * js
      jg[10] = ji * jl - jp * js
      jg[11] = jh * jl - jo * js
      return jg
    }
    e.rotateY = function (jk, jr, jq) {
      var js = Math.sin(jq),
        jp = Math.cos(jq),
        jj = jr[0],
        ji = jr[1],
        jh = jr[2],
        jg = jr[3],
        jo = jr[8],
        jn = jr[9],
        jm = jr[10],
        jl = jr[11]
      if (jr !== jk) {
        jk[4] = jr[4]
        jk[5] = jr[5]
        jk[6] = jr[6]
        jk[7] = jr[7]
        jk[12] = jr[12]
        jk[13] = jr[13]
        jk[14] = jr[14]
        jk[15] = jr[15]
      }
      jk[0] = jj * jp - jo * js
      jk[1] = ji * jp - jn * js
      jk[2] = jh * jp - jm * js
      jk[3] = jg * jp - jl * js
      jk[8] = jj * js + jo * jp
      jk[9] = ji * js + jn * jp
      jk[10] = jh * js + jm * jp
      jk[11] = jg * js + jl * jp
      return jk
    }
    e.rotateZ = function (jk, jn, jm) {
      var js = Math.sin(jm),
        jl = Math.cos(jm),
        jj = jn[0],
        ji = jn[1],
        jh = jn[2],
        jg = jn[3],
        jr = jn[4],
        jq = jn[5],
        jp = jn[6],
        jo = jn[7]
      if (jn !== jk) {
        jk[8] = jn[8]
        jk[9] = jn[9]
        jk[10] = jn[10]
        jk[11] = jn[11]
        jk[12] = jn[12]
        jk[13] = jn[13]
        jk[14] = jn[14]
        jk[15] = jn[15]
      }
      jk[0] = jj * jl + jr * js
      jk[1] = ji * jl + jq * js
      jk[2] = jh * jl + jp * js
      jk[3] = jg * jl + jo * js
      jk[4] = jr * jl - jj * js
      jk[5] = jq * jl - ji * js
      jk[6] = jp * jl - jh * js
      jk[7] = jo * jl - jg * js
      return jk
    }
    e.fromRotationTranslation = function (jt, jr, jp) {
      var jm = jr[0],
        jl = jr[1],
        jk = jr[2],
        jn = jr[3],
        ju = jm + jm,
        jg = jl + jl,
        jo = jk + jk,
        jj = jm * ju,
        ji = jm * jg,
        jh = jm * jo,
        js = jl * jg,
        jq = jl * jo,
        jx = jk * jo,
        jy = jn * ju,
        jw = jn * jg,
        jv = jn * jo
      jt[0] = 1 - (js + jx)
      jt[1] = ji + jv
      jt[2] = jh - jw
      jt[3] = 0
      jt[4] = ji - jv
      jt[5] = 1 - (jj + jx)
      jt[6] = jq + jy
      jt[7] = 0
      jt[8] = jh + jw
      jt[9] = jq - jy
      jt[10] = 1 - (jj + js)
      jt[11] = 0
      jt[12] = jp[0]
      jt[13] = jp[1]
      jt[14] = jp[2]
      jt[15] = 1
      return jt
    }
    e.fromQuat = function (jq, jn) {
      var jk = jn[0],
        jj = jn[1],
        ji = jn[2],
        jl = jn[3],
        jr = jk + jk,
        jg = jj + jj,
        jm = ji + ji,
        jh = jk * jr,
        jp = jj * jr,
        jo = jj * jg,
        jx = ji * jr,
        jw = ji * jg,
        ju = ji * jm,
        jv = jl * jr,
        jt = jl * jg,
        js = jl * jm
      jq[0] = 1 - jo - ju
      jq[1] = jp + js
      jq[2] = jx - jt
      jq[3] = 0
      jq[4] = jp - js
      jq[5] = 1 - jh - ju
      jq[6] = jw + jv
      jq[7] = 0
      jq[8] = jx + jt
      jq[9] = jw - jv
      jq[10] = 1 - jh - jo
      jq[11] = 0
      jq[12] = 0
      jq[13] = 0
      jq[14] = 0
      jq[15] = 1
      return jq
    }
    e.frustum = function (jk, jh, jp, jg, jo, jm, jl) {
      var jn = 1 / (jp - jh),
        jj = 1 / (jo - jg),
        ji = 1 / (jm - jl)
      jk[0] = jm * 2 * jn
      jk[1] = 0
      jk[2] = 0
      jk[3] = 0
      jk[4] = 0
      jk[5] = jm * 2 * jj
      jk[6] = 0
      jk[7] = 0
      jk[8] = (jp + jh) * jn
      jk[9] = (jo + jg) * jj
      jk[10] = (jl + jm) * ji
      jk[11] = -1
      jk[12] = 0
      jk[13] = 0
      jk[14] = jl * jm * 2 * ji
      jk[15] = 0
      return jk
    }
    e.perspective = function (jj, ji, jh, jk, jg) {
      var jm = 1 / Math.tan(ji / 2),
        jl = 1 / (jk - jg)
      jj[0] = jm / jh
      jj[1] = 0
      jj[2] = 0
      jj[3] = 0
      jj[4] = 0
      jj[5] = jm
      jj[6] = 0
      jj[7] = 0
      jj[8] = 0
      jj[9] = 0
      jj[10] = (jg + jk) * jl
      jj[11] = -1
      jj[12] = 0
      jj[13] = 0
      jj[14] = 2 * jg * jk * jl
      jj[15] = 0
      return jj
    }
    e.ortho = function (jj, jh, jp, jg, jn, jm, jl) {
      var jk = 1 / (jh - jp),
        jo = 1 / (jg - jn),
        ji = 1 / (jm - jl)
      jj[0] = -2 * jk
      jj[1] = 0
      jj[2] = 0
      jj[3] = 0
      jj[4] = 0
      jj[5] = -2 * jo
      jj[6] = 0
      jj[7] = 0
      jj[8] = 0
      jj[9] = 0
      jj[10] = 2 * ji
      jj[11] = 0
      jj[12] = (jh + jp) * jk
      jj[13] = (jn + jg) * jo
      jj[14] = (jl + jm) * ji
      jj[15] = 1
      return jj
    }
    e.lookAt = function (ju, jB, jC, jm) {
      var jA,
        jz,
        jx,
        ji,
        jh,
        jg,
        jp,
        jo,
        jn,
        jv,
        jy = jB[0],
        jw = jB[1],
        jt = jB[2],
        jl = jm[0],
        jk = jm[1],
        jj = jm[2],
        js = jC[0],
        jr = jC[1],
        jq = jC[2]
      if (
        Math.abs(jy - js) < jf &&
        Math.abs(jw - jr) < jf &&
        Math.abs(jt - jq) < jf
      ) {
        return e.identity(ju)
      }
      jp = jy - js
      jo = jw - jr
      jn = jt - jq
      jv = 1 / Math.sqrt(jp * jp + jo * jo + jn * jn)
      jp *= jv
      jo *= jv
      jn *= jv
      jA = jk * jn - jj * jo
      jz = jj * jp - jl * jn
      jx = jl * jo - jk * jp
      jv = Math.sqrt(jA * jA + jz * jz + jx * jx)
      if (!jv) {
        jA = 0
        jz = 0
        jx = 0
      } else {
        jv = 1 / jv
        jA *= jv
        jz *= jv
        jx *= jv
      }
      ji = jo * jx - jn * jz
      jh = jn * jA - jp * jx
      jg = jp * jz - jo * jA
      jv = Math.sqrt(ji * ji + jh * jh + jg * jg)
      if (!jv) {
        ji = 0
        jh = 0
        jg = 0
      } else {
        jv = 1 / jv
        ji *= jv
        jh *= jv
        jg *= jv
      }
      ju[0] = jA
      ju[1] = ji
      ju[2] = jp
      ju[3] = 0
      ju[4] = jz
      ju[5] = jh
      ju[6] = jo
      ju[7] = 0
      ju[8] = jx
      ju[9] = jg
      ju[10] = jn
      ju[11] = 0
      ju[12] = -(jA * jy + jz * jw + jx * jt)
      ju[13] = -(ji * jy + jh * jw + jg * jt)
      ju[14] = -(jp * jy + jo * jw + jn * jt)
      ju[15] = 1
      return ju
    }
    e.str = function (jg) {
      return (
        'mat4(' +
        jg[0] +
        ', ' +
        jg[1] +
        ', ' +
        jg[2] +
        ', ' +
        jg[3] +
        ', ' +
        jg[4] +
        ', ' +
        jg[5] +
        ', ' +
        jg[6] +
        ', ' +
        jg[7] +
        ', ' +
        jg[8] +
        ', ' +
        jg[9] +
        ', ' +
        jg[10] +
        ', ' +
        jg[11] +
        ', ' +
        jg[12] +
        ', ' +
        jg[13] +
        ', ' +
        jg[14] +
        ', ' +
        jg[15] +
        ')'
      )
    }
    e.frob = function (jg) {
      return Math.sqrt(
        Math.pow(jg[0], 2) +
          Math.pow(jg[1], 2) +
          Math.pow(jg[2], 2) +
          Math.pow(jg[3], 2) +
          Math.pow(jg[4], 2) +
          Math.pow(jg[5], 2) +
          Math.pow(jg[6], 2) +
          Math.pow(jg[6], 2) +
          Math.pow(jg[7], 2) +
          Math.pow(jg[8], 2) +
          Math.pow(jg[9], 2) +
          Math.pow(jg[10], 2) +
          Math.pow(jg[11], 2) +
          Math.pow(jg[12], 2) +
          Math.pow(jg[13], 2) +
          Math.pow(jg[14], 2) +
          Math.pow(jg[15], 2)
      )
    }
    jb.mat4 = e
  })(window)
  function bX() {
    this.result = {
      bkData: [],
      eleData: [[], [], [], [], [], [], [], [], [], []],
      tileLabels: [],
    }
  }
  es.extend(bX.prototype, {
    createLayer: function (T, i) {
      var e = this.result.bkData
      i = i || {}
      if (!e[T]) {
        e[T] = [[], [], []]
      }
      e[T].tileTypeName = i.tileTypeName || 'na'
      e[T].dataType = i.dataType || 2
      e[T].png8 = i.png8 || false
      e[T].clipTile = i.clipTile || false
      e[T].boundary = i.boundary || false
      if (i.ontology) {
        e[T].ontology = i.ontology
      }
    },
    removeLayer: function (i) {
      var e = this.result.bkData
      e[i] = null
    },
    hasLayerBoundary: function () {
      var e = this.result.bkData
      var T = false
      for (var i8 = 0; i8 < e.length; i8++) {
        if (e[i8] && e[i8].boundary) {
          T = true
          break
        }
      }
      return T
    },
    getResult: function () {
      return this.result
    },
    setData: function (ja, i9, jb) {
      var e = this.result.bkData
      var T = e[i9] ? e[i9][jb] : null
      if (!T) {
        return
      }
      for (var i8 = 0; i8 < T.length; i8++) {
        if (T[i8].key && T[i8].key === ja.key) {
          T[i8] = ja
          return
        }
      }
      T.push(ja)
    },
    setLabelData: function (e) {
      this.result.tileLabels = e
    },
    getLabelData: function () {
      return this.result.tileLabels
    },
    setOverlayData: function (i, e) {
      if (!this.result.eleData[e]) {
        return
      }
      this.result.eleData[e] = i
    },
    clearLabelOverlayData: function () {
      this.result.eleData[2] = []
      this.result.eleData[3] = []
      this.result.eleData[4] = []
    },
    clearData: function (i8) {
      var e = this.result.bkData
      if (typeof i8 === 'number') {
        if (e[i8]) {
          e[i8][0] = []
          e[i8][1] = []
          e[i8][2] = []
        }
        return
      }
      for (var T = 0; T < e.length; T++) {
        if (!e[T]) {
          continue
        }
        e[T][0] = []
        e[T][1] = []
        e[T][2] = []
      }
    },
    sortThumbData: function (i) {
      var e = this.result.bkData
      var T = e[i]
      if (!T) {
        return
      }
      if (T[0] && T[0].length > 0) {
        T[0].sort(function (i9, i8) {
          return i9.tileInfo.useZoom - i8.tileInfo.useZoom
        })
      }
    },
  })
  var fH = (function () {
    var ji = new Int8Array(4)
    var T = new Int32Array(ji.buffer, 0, 1)
    var jd = new Float32Array(ji.buffer, 0, 1)
    function jk(jr) {
      T[0] = jr
      return jd[0]
    }
    function i(jr) {
      jd[0] = jr
      return T[0]
    }
    function je(jr) {
      var jt = (jr[3] << 24) | (jr[2] << 16) | (jr[1] << 8) | jr[0]
      var js = jk(jt & 4278190079)
      return js
    }
    var i9 = 0
    var jc = 1
    var jg = 2
    var jo = 0
    var jl = 1
    var jj = 2
    var ja = 9
    function jh(jr, js) {
      var jt
      if (js % 2 === 0) {
        jt = [-jr[1], jr[0]]
      } else {
        jt = [jr[1], -jr[0]]
      }
      return jt
    }
    function e(jr, js, jt) {
      var ju = jh(jr, js)
      var jv
      if (jt === jc) {
        return ju
      } else {
        if (js === 4 || js === 5) {
          jv = [ju[0] - jr[0], ju[1] - jr[1]]
        } else {
          jv = [ju[0] + jr[0], ju[1] + jr[1]]
        }
        if (jt === i9) {
          vec2.normalize(jv, jv)
        }
        return jv
      }
    }
    function jn(js, jr) {
      return Math.sqrt(Math.pow(js[0] - jr[0], 2) + Math.pow(js[1] - jr[1], 2))
    }
    function i8(jv, ju, jt, jr) {
      var js = vec2.dot(jv, ju)
      if (jt === jj || jt === jl) {
        if ((jr === 0 || jr === 1) && js > 0) {
          return true
        } else {
          if ((jr === 2 || jr === 3) && js < 0) {
            return true
          }
        }
      }
      if ((jr === 0 || jr === 1) && js < 0) {
        return true
      } else {
        if ((jr === 2 || jr === 3) && js > 0) {
          return true
        }
      }
      return false
    }
    function jf(js, jx, jz) {
      var jy = jh(js, jx)
      var ju
      var jw = js
      var jv = jz
      var jB = []
      vec2.normalize(jB, [jw[0] + jv[0], jw[1] + jv[1]])
      var jA = vec2.dot(jy, [-jB[1], jB[0]])
      if (Math.abs(jA) < 0.1) {
        jA = 1
      }
      var jt = 1 / jA
      ju = [-jB[1] * jt, jB[0] * jt]
      var jr = vec2.dot(js, ju)
      if (jr < 0) {
        vec2.negate(ju, ju)
      }
      return { cos2: jr, offset: ju }
    }
    function jq(js, jx, jz, jr) {
      var jy = jh(js, jx)
      var jw
      var jv
      var ju
      if (jx === 0 || jx === 1) {
        jw = jz
        jv = js
      } else {
        jw = js
        jv = jz
      }
      if (!jw || !jv) {
        return jy
      }
      var jB = [jw[0] + jv[0], jw[1] + jv[1]]
      if (jB[0] === 0 && jB[1] === 0) {
        vec2.normalize(jB, jv)
      } else {
        vec2.normalize(jB, jB)
      }
      var jC = i8(jB, jy, jr, jx)
      if (jC) {
        return jy
      }
      var jA = vec2.dot(jy, [-jB[1], jB[0]])
      if (Math.abs(jA) < 0.1) {
        jA = 1
      }
      var jt = 1 / jA
      ju = [-jB[1] * jt, jB[0] * jt]
      return ju
    }
    function jp(jC, jD, jw, jv, jE, jB, ju, jx, jt, jA) {
      var jz
      var js = 0
      var jr = false
      jz = jB.length / ja - 1
      jb(jD[0], jC[0], jw[0], jE, jv, 4, jx, jt, undefined, jB, jA)
      jz++
      js++
      jb(jD[0], jC[0], jw[0], jE, jv, 5, jx, jt, undefined, jB, jA)
      jz++
      js++
      for (var jy = 0; jy < jC.length; jy++) {
        jb(jD[jy], jC[jy], jw[jy], jE, jv, 0, jx, jt, jC[jy - 1], jB, jA)
        jm(ju, ++jz, ++js, jr)
        jb(jD[jy], jC[jy], jw[jy], jE, jv, 1, jx, jt, jC[jy - 1], jB, jA)
        jm(ju, ++jz, ++js, jr)
        jb(
          jD[jy + 1],
          jC[jy],
          jw[jy + 1],
          jE,
          jv,
          2,
          jx,
          jt,
          jC[jy + 1],
          jB,
          jA
        )
        jm(ju, ++jz, ++js, jr)
        jb(
          jD[jy + 1],
          jC[jy],
          jw[jy + 1],
          jE,
          jv,
          3,
          jx,
          jt,
          jC[jy + 1],
          jB,
          jA
        )
        jm(ju, ++jz, ++js, jr)
        if (jv === jl && jy !== jC.length - 1) {
          jb(
            jD[jy + 1],
            jC[jy],
            jw[jy + 1],
            jE,
            jv,
            8,
            jx,
            jt,
            jC[jy + 1],
            jB,
            jA
          )
          jm(ju, ++jz, ++js, jr)
          jr = jr ? false : true
        }
      }
      jb(
        jD[jD.length - 1],
        jC[jC.length - 1],
        jw[jD.length - 1],
        jE,
        jv,
        6,
        jx,
        jt,
        undefined,
        jB,
        jA
      )
      jm(ju, ++jz, ++js, jr)
      jb(
        jD[jD.length - 1],
        jC[jC.length - 1],
        jw[jD.length - 1],
        jE,
        jv,
        7,
        jx,
        jt,
        undefined,
        jB,
        jA
      )
      jm(ju, ++jz, ++js, jr)
    }
    function jb(jE, ju, jy, jF, jt, jz, jw, js, jC, jB, jA) {
      var jD = jz % 2 === 0 ? 1 : -1
      var jx
      if (jz === 4 || jz === 5 || jz === 6 || jz === 7) {
        jx = e(ju, jz, jF)
      } else {
        if (jz === 0 || jz === 1 || jz === 2 || jz === 3) {
          jx = jq(ju, jz, jC, jt)
        } else {
          if (jz === 8) {
            var jv = jf(ju, jz, jC)
            jx = jv.offset
            vec2.normalize(jx, jx)
            var jr = jv.cos2
            if (jr < 0) {
              jD = -jD
            }
          }
        }
      }
      jB[jB.length] = jE[0] * 10
      jB[jB.length] = jE[1] * 10
      jB[jB.length] = jx[0] * js * 10
      jB[jB.length] = jx[1] * js * 10
      jB[jB.length] = jw
      jB[jB.length] = jD
      jB[jB.length] = 0
      jB[jB.length] = jA || 0
      jB[jB.length] = jy
    }
    function jm(jv, jt, jr, ju) {
      var js
      if (jr % 2 === 0) {
        if (ju) {
          jv[jv.length] = jt - 2
          jv[jv.length] = jt - 1
          jv[jv.length] = jt
        } else {
          jv[jv.length] = jt - 1
          jv[jv.length] = jt - 2
          jv[jv.length] = jt
        }
      } else {
        if (ju) {
          jv[jv.length] = jt - 1
          jv[jv.length] = jt - 2
          jv[jv.length] = jt
        } else {
          jv[jv.length] = jt - 2
          jv[jv.length] = jt - 1
          jv[jv.length] = jt
        }
      }
    }
    return {
      getVertexCount: function (js, jr) {
        if (jr === jl) {
          return js * 5 - 2
        } else {
          return js * 4
        }
      },
      buildData: function (jC, jt, jD, jz, jr, jw, js, jA) {
        var jB = []
        var jy = 0
        var jv = [0]
        for (var jx = 0; jx < jC.length; jx++) {
          if (jx > 0) {
            jy += jn(jC[jx], jC[jx - 1])
            jv.push(jy * 10)
          }
          if (jx !== jC.length - 1) {
            var ju = [jC[jx + 1][0] - jC[jx][0], jC[jx + 1][1] - jC[jx][1]]
            var jE = []
            if (ju[0] === 0 && ju[1] === 0) {
              jE = [0, 0]
            } else {
              vec2.normalize(jE, ju)
            }
            jB[jB.length] = [jE[0], jE[1]]
          }
        }
        return jp(jB, jC, jv, jt, jD, jz, jr, je(jw), js, jA)
      },
      toTileSolidLineVertices: function (jv, js) {
        var jt = new Float32Array((jv.length / ja) * 5)
        var jr = new Int16Array(jt.buffer)
        var jx = 0
        var ju = 0
        for (var jw = 0; jw < jv.length; jw += ja) {
          jr[jx] = ~~jv[jw]
          jr[jx + 1] = ~~jv[jw + 1]
          jr[jx + 2] = ~~jv[jw + 2]
          jr[jx + 3] = ~~jv[jw + 3]
          jt[ju + 2] = jv[jw + 4]
          jr[jx + 6] = jv[jw + 5]
          jr[jx + 7] = js ? js : 0
          jr[jx + 8] = jv[jw + 7]
          jr[jx + 9] = 0
          jx += 10
          ju += 5
        }
        return jt
      },
    }
  })()
  var fY = 1
  var gT = 2
  var eH = {
    drawIndex: 0,
    devicePixelRatio: fz(),
    zoomState: 1,
    curViewTilesInfo: null,
    iconSetImg: null,
    LAST_CALC_ZOOM: -1,
    LAST_LOAD_VECTOR_ZOOM_CHANGE: false,
    lastCollisionTestTime: 0,
    remove: function () {
      this.tileCache.clear()
    },
    initDrawData: function () {
      this.drawIndex = this.zIndex
      var e = {
        tileTypeName: this.tileType.getName(),
        dataType: this.dataType,
        png8: this.png8,
        clipTile: this.clipTile,
        boundary: this.boundary,
      }
      if (this.ontology) {
        e.ontology = this.ontology
      }
      this.map._featureMgr.createLayer(this.drawIndex, e)
      this.dispatchEvent(new e7('oninitDrawData'))
    },
    destroyDrawData: function () {
      this.map._featureMgr.removeLayer(this.drawIndex)
      var i = new e7('onremoveLayerMask')
      i.hasLayerBoundary = this.map._featureMgr.hasLayerBoundary()
      this.map.dispatchEvent(i)
    },
    setZIndex: function (jc) {
      jc = Math.abs(Math.floor(jc)) || 1
      if (!jc || jc === this.zIndex) {
        return
      }
      var i = this.map._featureMgr.result.bkData
      var i8 = this.map.tileMgr.tileLayers
      function T(jf) {
        var je = null
        for (var jd = 0; jd < i8.length; jd++) {
          if (i8[jd].zIndex === jf) {
            je = i8[jd]
            break
          }
        }
        return je
      }
      var e = []
      var jb = []
      var ja = this.zIndex
      if (i[jc]) {
        e.push(T(jc))
        jb.push(i[jc])
        this.setTargetZIndex(jc)
        i[jc] = i[ja]
        i[ja] = null
      } else {
        this.setTargetZIndex(jc)
        i[jc] = i[ja]
        i[ja] = null
        this.map.dispatchEvent(new e7('onrefresh'))
        return
      }
      var i9 = jc + 1
      while (i9) {
        if (i[i9]) {
          e.push(T(i9))
          jb.push(i[i9])
          e.shift().setTargetZIndex(i9)
          i[i9] = jb.shift()
          i9 += 1
        } else {
          e.shift().setTargetZIndex(i9)
          i[i9] = jb.shift()
          i9 = 0
        }
      }
      this.map.dispatchEvent(new e7('onrefresh'))
    },
    setZIndexTop: function () {
      var e = this.map._featureMgr.result.bkData
      e[e.length] = e[this.zIndex]
      e[this.zIndex] = null
      this.setTargetZIndex(e.length - 1)
      this.map.dispatchEvent(new e7('onrefresh'))
    },
    getTileKey: function (e, i8) {
      i8 = i8 || {}
      var i = typeof i8.useZoom === 'number' ? i8.useZoom : e.useZoom
      var T = e.style || this.mapStyleId || 'default'
      return (
        this.mapType +
        '_' +
        T +
        '_' +
        e.col +
        '_' +
        e.row +
        '_' +
        e.zoom +
        '_' +
        i
      )
    },
    getTileRenderDataKey: function (i) {
      var T = i.col
      var i8 = i.zoom
      var e = i.baseTileSize
      T = ev.calcLoopParam(T, i8, e).col
      return this.mapType + '_' + T + '_' + i.row + '_' + i8 + '_' + i.useZoom
    },
    getTileUnits: function (e) {
      var i8 = this.map
      var T = dO[i8.getMapType()]
      var i = T.baseUnits * Math.pow(2, T.zoomLevelBase - e)
      return i
    },
    getTilesUrl: function (i9, ji, jj) {
      var i = i9.x
      var jk = i9.y
      var jf = iN('ditu', 'normal')
      var jb = jf.ver
      var jc = jf.udt
      i = ev.calcLoopParam(i, ji, jj).col
      var jh = dO.B_NORMAL_MAP.vectorTileUrls
      var ja = Math.abs(i + jk) % jh.length
      var jg = jh[ja]
      if (window.offLineIPAddress) {
        jh = [window.offLineIPAddress + 'pvd/']
        jg = jh[0]
      }
      var T = 'x=' + i + '&y=' + jk + '&z=' + Math.floor(ji)
      var je = this.devicePixelRatio > 1 ? '&scaler=2' : ''
      var jd = '&textimg=1'
      if (this.map.config.textRenderType === 'canvas') {
        jd = '&textimg=0'
      }
      var i8 = this.map.config.style
      if (typeof i8 === 'string' && i8 !== 'default') {
        T += '&styleId=' + w.mapStyleNameIdPair[i8]
      }
      T += '&styles=pl' + jd + je + '&v=' + jb + '&udt=' + jc + '&json=0'
      var e = jg + '?qt=vtile&param=' + window.encodeURIComponent(eo(T))
      return e
    },
    getRasterTilesUrl: function (T, ja, i8) {
      var i9 = dO[this.map.mapType]
      var i = this.map.config.style
      var e =
        i9.tileUrls[Math.abs(ja + T) % i9.tileUrls.length] +
        '?qt=tile&x=' +
        T +
        '&y=' +
        ja +
        '&z=' +
        i8 +
        (i === 'default' || typeof i !== 'string'
          ? ''
          : '&styleId=' + w.mapStyleNameIdPair[i]) +
        '&styles=pl&udt=' +
        this.normalUdt +
        '&scaler=' +
        this.scaler +
        '&p=1'
      e = e.replace(/-(\d+)/gi, 'M$1')
      return e
    },
    getZoomState: function () {
      var T = this.map
      var i = T.getZoom()
      var e = i - this.lastZoom
      if (e > 0) {
        this.zoomState = 1
      } else {
        if (e < 0) {
          this.zoomState = -1
        }
      }
      this.lastZoom = i
      return this.zoomState
    },
    releaseOutViewTileData: function (e) {
      var i9 = this.map._workerMgr.releasePendingData(e)
      for (var i8 = 0, T = i9.length; i8 < T; i8++) {
        var ja = this.getTileKey(i9[i8])
        this.tileCache.removeData(ja)
      }
    },
    loadLayerData: function (e, i8, i) {
      this.hasZoomChange = i
      this.curViewTilesInfo = e
      this.mapStyleId = this.map.getMapStyleId()
      this.releaseOutViewTileData(e)
      var T = this.getZoomState()
      if (this.dataType === gT) {
        if (i8) {
          this.getVectorLayerDataFromCache(e, T)
        } else {
          this.loadVectorLayerData(e)
        }
      } else {
        this.loadRasterLayerData(e, i8)
      }
    },
    getVectorLayerDataFromCache: function (jd, jn) {
      this.map.temp.isPermitSpotOver = false
      this.tileLabels = []
      if (this.baseLayer === true) {
        var jh = this.map._customLabelMgr.virtualTile
        if (jh && jh.label) {
          this.tileLabels.push(jh.label)
        }
      }
      this.thumbCache = {}
      var jo = -1
      for (var jk = 0, ji = jd.length; jk < ji; jk++) {
        var jl = jd[jk]
        var i9 = jl.col
        var ja = jl.row
        var T = jl.zoom
        var jj = this._getTileTexImgKey(jl)
        var i8 = jl.useZoom
        jo = T
        var jb = this.getTileKey(jl)
        var jq = this.tileCache.getData(jb)
        if (jq && jq.status === 'ready') {
          var jr = jq
          this.map._featureMgr.setData(jq, this.drawIndex, 2)
          if (jq.label) {
            if (jq.label.status === 'ready') {
              jq.label.tileInfo = jq.tileInfo
              this.tileLabels.push(jq.label)
              if (
                jq.label.textureSources &&
                jq.label.textureSources[i8] &&
                this.map._webglMapScene
              ) {
                var jp = this.map._webglMapScene._painter
                if (!jp._labelTextureAtlasOffset[jj]) {
                  jp._addToAsyncJob(jq.label.textureSources[i8])
                }
              }
            } else {
              if (jq.label.status !== 'processing') {
                this.processLabelData(jq)
              }
            }
          }
        } else {
          var jm = { tileInfo: jl, dataType: gT, key: jb }
          this.map._featureMgr.setData(jm, this.drawIndex, 2)
          if (this.useThumbData) {
            this.setThumbData(i9, ja, T, i8, jn)
          }
        }
      }
      this.tileLabels.labelZoom = jo
      this.updateLabels(jn)
      var je = this.map.getZoom()
      var jc = Math.floor(je)
      var jg = je - jc
      var jf = Math.floor(this.LAST_CALC_ZOOM)
      var e = this.LAST_CALC_ZOOM - jf
      var js = false
      if (this.hasZoomChange) {
        if (Math.abs(je - this.LAST_CALC_ZOOM) >= 0.5) {
          js = true
        } else {
          if (jg < 0.5 && e >= 0.5) {
            js = true
          } else {
            if (jg >= 0.5 && e < 0.5) {
              js = true
            }
          }
        }
        if (js) {
          this.cacheDataCollideLabels(0)
        }
        this.LAST_CALC_ZOOM = je
      } else {
        if (this.tileLabels.length > 0) {
          this.cacheDataCollideLabels(es.Browser.ie ? 50 : 30)
        }
      }
    },
    loadVectorLayerData: function (je) {
      this.map.temp.isPermitSpotOver = false
      var jd = this
      function jc(i, jf) {
        var jh = jd.tileCache.getData(jf)
        if (!jh) {
          return
        }
        if (!i || i.error) {
          i.event &&
            bo.fetchDebug &&
            bo.fetchDebug.sendError({
              title: i.event.title,
              msg: i.event.msg,
              category: bo.fetchDebug.category.AJAX,
              level: bo.fetchDebug.levels.ERROR,
              url: i.event.title,
            })
          var jg = new e7('ontileloaderror')
          i = i || {}
          jg.error = i.error || ''
          jg.message = i.message || ''
          jd.map.fire(jg)
          jh.status = 'init'
          jh.reloadTimer = setTimeout(function () {
            if (jh.retry < 3) {
              jh.retry++
              jh.status = 'loading'
              jd.loadVectorTileData(i.tileInfo, jc)
            } else {
              jd.tileCache.removeData(jf)
            }
          }, 4000)
          jd.map._featureMgr.clearData(jd.drawIndex)
          jd._checkTilesLoaded()
          jd.getVectorLayerDataFromCache(jd.curViewTilesInfo, jd.getZoomState())
          return
        }
        if (jh.reloadTimer) {
          clearTimeout(jh.reloadTimer)
          jh.reloadTimer = null
        }
        jd.callbackDataQueue.push([i, jf])
        if (jd.processDataTimer) {
          return
        }
        jd.processDataTimer = setTimeout(function () {
          while (jd.callbackDataQueue.length > 0) {
            var jj = jd.callbackDataQueue.shift()
            jd.vectorTileDataCbk(jj[0], jj[1])
            jd._checkTilesLoaded()
          }
          jd.map._featureMgr.clearData(jd.drawIndex)
          jd.getVectorLayerDataFromCache(jd.curViewTilesInfo, jd.getZoomState())
          var ji = new e7('onrefresh')
          ji.source = 'webgllayer'
          jd.map.dispatchEvent(ji)
          jd.processDataTimer = null
        }, 200)
      }
      for (var jb = 0, i9 = je.length; jb < i9; jb++) {
        var T = je[jb]
        var ja = this.getTileKey(T)
        var e = this.tileCache.getData(ja)
        if (!e) {
          e = { status: 'init', tileInfo: T, dataType: gT, key: ja, retry: 0 }
        }
        if (e.status !== 'ready' && e.status !== 'loading') {
          this.numLoading++
          e.status = 'loading'
          this.tileCache.setData(ja, e)
          var i8 = this.getProcessedLabelZoom(T)
          if (i8) {
            T.processedLabelZooms = i8
          }
          this.loadVectorTileData(T, jc)
        }
      }
    },
    setThumbData: function (i, i9, i8, e, T) {
      if (T === 1) {
        if (this._findParentZoomTile(i, i9, i8, e, 8) === false) {
          this._findChildZoomTile(i, i9, i8, e, 3)
        }
      } else {
        if (T === -1) {
          if (this._findChildZoomTile(i, i9, i8, e, 3) === false) {
            this._findParentZoomTile(i, i9, i8, e, 8)
          }
        }
      }
      this.map._featureMgr.sortThumbData(this.drawIndex)
    },
    _findParentZoomTile: function (jb, jk, jj, i9, je) {
      var ja = dO[this.getMapType()]
      var T = ja.minDataZoom
      var e = jb
      var jh = jk
      var jf = jj
      var jg = i9
      for (var jd = 1; jd <= je; jd++) {
        var i8 = this.tileType.getParentTile(e, jh, jf, jg, T)
        if (i8 === null) {
          continue
        }
        var ji = this.getTileKey(i8)
        var jc = this.tileCache.getData(ji)
        if (jc && jc.status === 'ready') {
          if (this.thumbCache[ji]) {
            continue
          }
          this.map._featureMgr.setData(jc, this.drawIndex, 0)
          this.thumbCache[ji] = true
          return true
        }
        e = i8.col
        jh = i8.row
        jf = i8.zoom
        jg = i8.useZoom
      }
      return false
    },
    _findChildZoomTile: function (jc, je, e, i9, jn) {
      var jl = dO[this.getMapType()]
      var jh = jl.maxDataZoom
      var jb = jc
      var jd = je
      var jf = e
      var i8 = i9
      var ja = true
      for (var jk = 1; jk <= jn; jk++) {
        var ji = false
        var T = this.tileType.getChildTiles(jb, jd, jf, i8, jh, jk)
        if (!T) {
          continue
        }
        for (var jj = 0; jj < T.length; jj++) {
          var jg = this.getTileKey(T[jj])
          var jm = this.tileCache.getData(jg)
          if (jm && jm.status === 'ready') {
            if (!this.thumbCache[jg]) {
              this.map._featureMgr.setData(jm, this.drawIndex, 1)
              this.thumbCache[jg] = true
            }
            ji = true
          } else {
            ja = false
          }
        }
        if (ji) {
          break
        }
      }
      return ja
    },
    loadVectorTileData: function (jk, jl) {
      var i9 = jk.col
      var ja = jk.row
      var e = jk.zoom
      var ji = jk.baseTileSize
      var i8 = this.getTilesUrl(new eL(i9, ja), e, ji)
      var jb = this.map.getPrivateRegions()
      if (!this.processData && this.map.getPrivateStatus() && jb) {
        var jg = jk.useZoom
        var jf = this.tileType.getMercatorSize(jg)
        var je = i9 * jf
        var jd = ja * jf
        var jh = new cd(je + jf / 2, jd + jf / 2)
        var jc = new ha(new cd(je, jd), new cd(je + jf, jd + jf))
        for (var jj = 0; jj < jb.length; jj++) {
          if (jb[jj] instanceof cp) {
            if (jb[jj].crossPoint(jh, jc, jg)) {
              var jm = { x: i9, y: ja, z: e, mapZoom: jg }
              var T = jb[jj].tileUrlFunction(i8, jm)
              if (T && T.url) {
                i8 = T.url
                T.header && (jk.header = T.header)
              }
              break
            }
          }
        }
      }
      if (!i8) {
        return
      }
      var jo = this.getTileKey(jk)
      gv(this.map)
      if (!this.processData) {
        this.map._workerMgr.loadTileData(i8, jk, jo, jl)
        return
      }
      var jl = 'cbk' + jo.replace(/-/g, '_')
      var jn = this
      bo[jl] = function (i) {
        var jp = (function (jq) {
          return function () {
            jq.tileInfo = jk
            var jw = jn.processData(jq)
            if (!jw.road) {
              return
            }
            var jt = {
              tileInfo: jk,
              renderData: { base: [] },
              status: 'ready',
              key: jo,
              mapType: jn.mapType,
            }
            var jz = []
            var jC = []
            for (var jv = 0; jv < jw.road.length; jv++) {
              var jy = jw.road[jv]
              var jx = -1
              for (var ju = 0; ju < jy.length; ju++) {
                var jA = jy[ju]
                var jB = []
                if (jz.length / 7 + jA[0].length / 2 > 65536) {
                  jt.renderData.base.push({
                    type: 'line',
                    data: [
                      fH.toTileSolidLineVertices(jz, 4000),
                      new Uint16Array(jC),
                    ],
                  })
                  jz = []
                  jC = []
                }
                for (var js = 0; js < jA[0].length; js += 2) {
                  jB[jB.length] = [jA[0][js], jA[0][js + 1]]
                }
                var jr = jA[3]
                fH.buildData(
                  jB,
                  jA[1],
                  jA[2],
                  jz,
                  jC,
                  jr,
                  jA[4],
                  jv + 20,
                  false
                )
              }
              jt.renderData.base.push({
                type: 'line',
                data: [
                  fH.toTileSolidLineVertices(jz, 4000),
                  new Uint16Array(jC),
                ],
              })
            }
            jn.tileCache.setData(jo, jt)
            jn.map._featureMgr.clearData(jn.drawIndex)
            jn.getVectorLayerDataFromCache(
              jn.curViewTilesInfo,
              jn.getZoomState()
            )
            jn.map.dispatchEvent(new e7('onrefresh'))
          }
        })(i)
        jn.map.jobScheduler.addJob(jp)
        delete bo[jl]
      }
      i8 += '&fn=' + encodeURIComponent(eV + '.' + jl)
      f5.load(i8)
    },
    vectorTileDataCbk: function (i8, i9) {
      var jd = new e7('ontileloaded')
      jd.perfStat = i8.perfStat || []
      var e = this.map
      e.fire(jd)
      var i = i8.tileInfo
      var T = i.col
      var jh = i.row
      var jg = i.zoom
      var jf = i.baseTileSize
      var jb = this.tileCache.getData(i9)
      if (!jb) {
        return
      }
      if (!this.showLabel) {
        i8.label = null
      }
      jb.renderData = i8
      jb.tileInfo = i
      var ja = ev.calcLoopParam(T, jg, jf)
      var je = ja.geoOffsetX
      jb.tileInfo.loopOffsetX = je
      jb.status = 'ready'
      jb.mapType = this.mapType
      this.tileCache.setData(i9, jb)
      jb.label = i8.label
      i8.label = null
      if (i8.indoorData && e._indoorMgr) {
        e._indoorMgr.setData(i8.indoorData)
      }
      var jc = 'id_' + T + '_' + jh + '_' + jg
      if (!this.curViewTilesInfo[jc]) {
        e.fire(new e7('ontilenotinview'))
        return
      }
      this.processLabelData(jb)
      if (i8.indoorData && e._indoorMgr && e._indoorMgr.currentUid) {
        this._refreshIndoorData(
          e._indoorMgr.currentUid,
          e._indoorMgr.currentFloor
        )
      }
    },
    _refreshIndoorData: function (jg, jf) {
      var ji = this.map._indoorMgr.getIndoorData(jg)
      var jl = ji.tileKeys
      var jj = Math.floor(this.map.getZoom())
      for (var jd = 0; jd < jl.length; jd++) {
        var ja = jl[jd]
        var jc = this.tileCache.getData(ja)
        if (!jc) {
          continue
        }
        var jk = jc.renderData
        jk.indoorBase = []
        jk.indoorBaseContour = []
        jk.indoorBorder3D = []
        jk.indoorArea3D = []
        jc.label.indoorLabel = []
        this.labelProcessor.clearCollisionCache(jc.label)
        for (var je in jk.indoorData) {
          if (je === 'tileInfo') {
            continue
          }
          var e = jk.indoorData[je]
          var i9 = e.defaultFloor
          if (je === jg) {
            i9 = jf
            e.currentFloor = jf
          }
          if (e.floors[i9]) {
            if (e.floors[i9].base) {
              for (var jb = 0; jb < e.floors[i9].base.length; jb++) {
                jk.indoorBase.push(e.floors[i9].base[jb])
              }
            }
            if (e.floors[i9].contour) {
              for (var jb = 0; jb < e.floors[i9].contour.length; jb++) {
                jk.indoorBaseContour.push(e.floors[i9].contour[jb])
              }
            }
            if (e.floors[i9].indoorBorder3D) {
              jk.indoorBorder3D.push(e.floors[i9].indoorBorder3D)
            }
            if (e.floors[i9].area3D) {
              jk.indoorArea3D.push(e.floors[i9].area3D)
            }
            if (e.floors[i9].pois) {
              jc.label.indoorLabel = jc.label.indoorLabel.concat(
                e.floors[i9].pois
              )
            }
          }
        }
        this.updateAllIconsTextureCoords(jc)
        var jh = this
        this.labelProcessor.loadIconImages(jc, function (i) {
          jh.updateAllIconsTextureCoords(i)
        })
        var i8 = ja.split('_')
        var T = parseInt(i8[i8.length - 1], 10)
        if (T !== jj) {
          continue
        }
        jh.map._featureMgr.setData(jc, this.drawIndex, 2)
      }
      this.dataBackCollideLabels()
      this.map.dispatchEvent(new e7('onrefresh'))
    },
    _removeIndoorData: function (i) {
      if (!i.indoorData) {
        return
      }
      for (var e in i.indoorData) {
        if (e === 'tileInfo') {
          continue
        }
        this.map._indoorMgr.removeData(e, i.key)
      }
    },
    getProcessedLabelZoom: function (i8) {
      var i9 = i3.baseZoomInfo[i8.zoom]
      if (!i9) {
        return false
      }
      var T = []
      for (var ja = 0; ja < i9.length; ja++) {
        var jb = this.getTileKey(i8, { useZoom: i9[ja] })
        var e = this.tileCache.getData(jb)
        if (
          e &&
          e.status === 'ready' &&
          e.label &&
          e.label.status === 'ready'
        ) {
          T.push(i9[ja])
        }
      }
      if (T.length) {
        return T
      } else {
        return false
      }
    },
    getSameZoomDataFromCache: function (T) {
      var i8 = i3.baseZoomInfo[T.zoom]
      for (var i9 = 0; i9 < i8.length; i9++) {
        var ja = this.getTileKey(T, { useZoom: i8[i9] })
        if (T.useZoom === i8[i9]) {
          continue
        }
        var e = this.tileCache.getData(ja)
        if (
          e &&
          e.status === 'ready' &&
          e.label &&
          e.label.status === 'ready'
        ) {
          return e
        }
      }
      return false
    },
    hasSameLabelData: function (i8, T) {
      for (var e = 0; e < T.length; e++) {
        if (T[e].key === i8) {
          return true
        }
      }
      return false
    },
    getDataByFloorName: function (T, i8) {
      for (var e = 0; e < T.length; e++) {
        if (T[e].floorName === i8) {
          return T[e]
        }
      }
      return null
    },
    mergeIndoorLabelData: function (jd, e) {
      for (var jb in jd) {
        if (jb === 'tileInfo') {
          continue
        }
        if (e[jb]) {
          var T = jd[jb].floors
          var je = e[jb].floors
          for (var i9 = 0; i9 < T.length; i9++) {
            var i8 = T[i9]
            var jc = i8.floorName
            var ja = this.getDataByFloorName(je, jc)
            if (ja) {
              if (ja.pois) {
                ja.pois = ja.pois.concat(i8.pois)
                i8.pois = ja.pois
              } else {
                ja.pois = i8.pois
              }
            }
          }
        }
      }
    },
    mergeSameZoomLabelData: function (jb) {
      var i9 = jb.label
      if (!i9) {
        return
      }
      var e = jb.tileInfo
      var ja = this.getSameZoomDataFromCache(e)
      if (!ja) {
        return
      }
      var i8 = ja.label
      if (!i8) {
        return
      }
      for (var T = 0; T < i9.fixedLabel.length; T++) {
        if (!this.hasSameLabelData(i9.fixedLabel[T].key, i8.fixedLabel)) {
          i8.hasNewData = true
          i8.fixedLabel.push(i9.fixedLabel[T])
        }
      }
      for (var T = 0; T < i9.lineLabel.length; T++) {
        if (!this.hasSameLabelData(i9.lineLabel[T].key, i8.lineLabel)) {
          i8.hasNewData = true
          i8.lineLabel.push(i9.lineLabel[T])
        }
      }
      for (var T = 0; T < i9.indoorLabel.length; T++) {
        if (!this.hasSameLabelData(i9.indoorLabel[T].key, i8.indoorLabel)) {
          i8.hasNewData = true
          i8.indoorLabel.push(i9.indoorLabel[T])
        }
      }
      jb.label = i8
      if (ja.renderData.indoorData && jb.renderData.indoorData) {
        this.mergeIndoorLabelData(
          jb.renderData.indoorData,
          ja.renderData.indoorData
        )
      }
    },
    processLabelData: function (ja) {
      if (!ja.label) {
        return
      }
      if (ja.label.status === 'processing') {
        return
      }
      ja.label.status = 'processing'
      var i8 = this
      i8.updateAllIconsTextureCoords(ja)
      this.labelProcessor.loadIconImages(ja, function (jb) {
        i8.updateAllIconsTextureCoords(jb)
      })
      if (this.map.config.textRenderType === 'canvas') {
        var e = this.labelProcessor.drawLabelsOnCanvas(ja, function (jd, jf) {
          var jc = ja.tileInfo
          var je = i8.map.config.mapStyleId
          if (!bo['customStyleInfo_' + je]) {
            i8.mergeSameZoomLabelData(ja)
          }
          if (jd) {
            if (!ja.label.textureHeights) {
              ja.label.textureHeights = []
            }
            ja.label.textureHeights[jc.useZoom] = jd.height
          }
          if (jf) {
            if (!ja.label.indoorTextureHeights) {
              ja.label.indoorTextureHeights = []
            }
            ja.label.indoorTextureHeights[jc.useZoom] = jf.height
          }
          var jb = i8._getTileTexImgKey(jc)
          i8._doWorkAfterLabelImageLoad(ja, jd, jf, jb)
        })
        return
      }
      var T = ja.label.textImageBitmap || ja.label.textImgStr
      var i9 = ja.label.indoorTextImageBitmap || ja.label.indoorTextImgStr
      this.labelProcessor.loadImgByStr(T, i9, function i(jg, je) {
        var jd = ja.label.textureHeight
        var jh = ja.label.indoorTextureHeight
        ja.label.textureHeight = undefined
        ja.label.indoorTextureHeight = undefined
        var jc = ja.tileInfo
        i8.mergeSameZoomLabelData(ja)
        var jf = ja.label
        jf.textImgStr = ''
        jf.indoorTextImgStr && (jf.indoorTextImgStr = '')
        if (!jf.textureHeights) {
          jf.textureHeights = []
        }
        jf.textureHeights[jc.useZoom] = jd
        if (!jf.indoorTextureHeights) {
          jf.indoorTextureHeights = []
        }
        jf.indoorTextureHeights[jc.useZoom] = jh
        var jb = i8._getTileTexImgKey(jc)
        i8._doWorkAfterLabelImageLoad(ja, jg, je, jb)
      })
    },
    _getTileTexImgKey: function (i) {
      var T = i.style || this.mapStyleId || 'default'
      var e = T + '_' + i.col + '_' + i.row + '_' + i.zoom
      if (this.map.config.textRenderType === 'canvas') {
        e += '_' + i.useZoom
      }
      return e
    },
    _doWorkAfterLabelImageLoad: function (jc, ja, i8, i) {
      var jb = this
      var i9 = jc.label
      i9.tileInfo = jc.tileInfo
      i9.status = 'ready'
      if (ja || i8) {
        var e = i9.tileInfo
        if (ja) {
          ja.id = i
          if (!i9.textureSources) {
            i9.textureSources = []
          }
          i9.textureSources[e.useZoom] = ja
        }
        if (i8) {
          i8.id = i + '_indoor'
          if (!i9.indoorTextureSources) {
            i9.indoorTextureSources = []
          }
          i9.indoorTextureSources[e.useZoom] = i8
        }
        if (jb.map._webglMapScene) {
          var T = jb.map._webglMapScene._painter
          if (ja) {
            T._addToAsyncJob(i9.textureSources[e.useZoom])
          }
        }
      }
      if (jc.custom !== true) {
        jb.tileLabels.push(i9)
      }
      if (jb.collisionTimer) {
        return
      }
      jb.collisionTimer = setTimeout(function () {
        jb.dataBackCollideLabels()
        jb.collisionTimer = null
      }, 300)
    },
    _updateIconTextureCoords: function (jc, T) {
      if (!jc) {
        return
      }
      var jb = this.map
      for (var i8 = 0; i8 < jc.length; i8++) {
        var ja = jc[i8]
        if (!ja.iconPos) {
          continue
        }
        if (jb._webglMapScene) {
          var e = jb._webglMapScene._painter
          var i9 = T + '_' + ja.iconPos.iconType
          ja.iconPos.texcoord = e._iconTextureAtlasCoords[i9] || null
        }
      }
    },
    updateAllIconsTextureCoords: function (i9) {
      if (this.map.viewAnimationTime) {
        return
      }
      if (i9) {
        if (i9.label) {
          var i = i9.tileInfo.style
          this._updateIconTextureCoords(i9.label.fixedLabel, i)
          this._updateIconTextureCoords(i9.label.indoorLabel, i)
        }
      } else {
        var i8 = this.tileCache.getAllData()
        for (var T in i8) {
          var e = i8[T].data
          if (e.status === 'ready' && e.label) {
            var i = e.tileInfo.style
            this._updateIconTextureCoords(e.label.fixedLabel, i)
            this._updateIconTextureCoords(e.label.indoorLabel, i)
          }
        }
      }
      this.updateLabels()
      this.map.dispatchEvent(new e7('onrefresh'))
    },
    cacheDataCollideLabels: function (T) {
      var i9 = this
      var i = this.map._featureMgr
      function i8() {
        i9.cacheLabelTimer = null
        var ja
        var jb = i9.map.getTilt()
        var jd = i9.map.getHeading() % 360
        if (
          i9.tileLabels.length === 0 ||
          (i9.tileLabels.length === 1 && i9.tileLabels[0].tileInfo.zoom === 0)
        ) {
          ja = i.getLabelData()
          if (ja.length > 0) {
            ja = i9.labelProcessor.collisionTest(ja, -1)
          }
        } else {
          if (jb || jd) {
            if (this._collisionTimer) {
              if (!jb) {
                clearTimeout(this._collisionTimer)
              } else {
                if (Date.now() - i9.lastCollisionTestTime > 500) {
                  i9.lastCollisionTestTime = Date.now()
                } else {
                  clearTimeout(this._collisionTimer)
                }
              }
            }
            this._collisionTimer = setTimeout(function () {
              ja = i9.labelProcessor.collisionTest(i9.tileLabels)
              if (ja) {
                if (i9.map.stencil && i9.map.stencil.isPoiMask) {
                  var je = i9.isPoiInPolygon(ja)
                  i.setLabelData(je)
                } else {
                  i.setLabelData(ja)
                }
              }
              i9.updateLabels()
              i9.map.dispatchEvent(new e7('onrefresh'))
              i9._collisionTimer = null
            }, 60)
            return
          } else {
            ja = i9.labelProcessor.getCachedLabels(i9.tileLabels)
          }
        }
        if (ja) {
          if (i9.map.stencil && i9.map.stencil.isPoiMask) {
            var jc = i9.isPoiInPolygon(ja)
            i.setLabelData(jc)
          } else {
            i.setLabelData(ja)
          }
        }
        i9.updateLabels()
        i9.map.dispatchEvent(new e7('onrefresh'))
      }
      if (!T) {
        clearTimeout(i9.cacheLabelTimer)
        i8()
      } else {
        if (i9.cacheLabelTimer) {
          return
        }
        i9.cacheLabelTimer = setTimeout(function e() {
          i8()
        }, T)
      }
    },
    isPoiInPolygon: function (T) {
      var jr = this
      var jh = jr.map.stencil
      var i9 = jr.map._featureMgr.result.eleData[9]
      var i8 = []
      for (var jm = 0; jm < i9.length; jm++) {
        var ji = i9[jm].overlay.points
        i8 = i8.concat(ji)
      }
      for (var jp = 1; jp < T.length; jp++) {
        var jb = []
        var ja = []
        for (var jn = 0; jn < T[jp].fixedLabel.length; jn++) {
          var jg = T[jp].fixedLabel[jn]
          var jk = jg.pt
          if (jg.pt && am(jk, i8)) {
            jb.push(jg)
          } else {
            ja.push(jg)
          }
        }
        if (jh.showRegion === 'inside') {
          T[jp].fixedLabel = jb
        } else {
          if (jh.showRegion === 'outside') {
            T[jp].fixedLabel = ja
          }
        }
        var jl = []
        var jd = []
        for (var jm = 0; jm < T[jp].lineLabel.length; jm++) {
          var jo = T[jp].lineLabel[jm]
          var e = jo.pt
          if (e && am(e, i8)) {
            jl.push(jo)
          } else {
            jd.push(jo)
          }
        }
        if (jh.showRegion === 'inside') {
          T[jp].lineLabel = jl
        } else {
          if (jh.showRegion === 'outside') {
            T[jp].lineLabel = jd
          }
        }
        var jj = []
        var jf = []
        for (var je = 0; je < T[jp].indoorLabel.length; je++) {
          var jq = T[jp].indoorLabel[je]
          var jc = jq.pt
          if (jc && am(jc, i8)) {
            jj.push(jq)
          } else {
            jf.push(jq)
          }
        }
        if (jh.showRegion === 'inside') {
          T[jp].indoorLabel = jj
        } else {
          if (jh.showRegion === 'outside') {
            T[jp].indoorLabel = jf
          }
        }
      }
      return T
    },
    dataBackCollideLabels: function () {
      var T = this
      if (T.tileLabels && T.tileLabels.length === 0) {
        return
      }
      var e
      T.labelProcessor.calcLabelsCollision(T.tileLabels)
      e = T.labelProcessor.getCachedLabels(T.tileLabels)
      if (e) {
        if (T.map.stencil && T.map.stencil.isPoiMask) {
          var i = T.isPoiInPolygon(e)
          T.map._featureMgr.setLabelData(i)
        } else {
          T.map._featureMgr.setLabelData(e)
        }
      }
      T.updateLabels()
      T.map.dispatchEvent(new e7('onrefresh'))
      if (bJ()) {
        this.labelProcessor._refreshSpotData()
      }
    },
    updateLabels: function (i9) {
      var ja = this.map
      var i = ja._featureMgr
      var T = i.getLabelData()
      if (T.length > 0) {
        var i8 = ja.getZoom()
        if (T.labelZoom - i8 < 3) {
          this.labelProcessor.updateLabels(T)
          var e = this.labelProcessor.fixDataFormat(T)
          i.setOverlayData(e[0], 2)
          i.setOverlayData(e[1], 3)
          i.setOverlayData(e[2], 4)
        } else {
          i.clearLabelOverlayData()
        }
        ja.temp.isPermitSpotOver = false
        this.labelProcessor.curSpotAdded = false
      }
    },
    loadRasterLayerData: function (jd, i8) {
      this.thumbCache = {}
      var je = this.getZoomState()
      if (i8) {
        for (var jb = 0, i9 = jd.length; jb < i9; jb++) {
          var T = jd[jb]
          var ja = this.getTileKey(T)
          var e = this.tileCache.getData(ja)
          if (e && e.status === 'ready') {
            if (T.tileTypeName === 'xyz') {
              e.tileInfo = T
            }
            this.map._featureMgr.setData(e, this.drawIndex, 2)
          } else {
            if (this.useThumbData) {
              this.setThumbData(T.col, T.row, T.zoom, T.useZoom, je)
            }
          }
        }
        return
      }
      for (var jb = 0, i9 = jd.length; jb < i9; jb++) {
        var T = jd[jb]
        var ja = this.getTileKey(T)
        var e = this.tileCache.getData(ja)
        if (!e) {
          this.tileCache.setData(ja, {})
          var jc = this
          this.loadRasterTileData(T, function (i, jf) {
            jc.rasterTileDataCbk(i, jf)
          })
        }
      }
    },
    loadRasterTileData: function (i, e) {
      var T = new Image()
      var i9 = i.col
      var jc = i.row
      var ja = i.zoom
      var i8 = this.getTilesUrl(new eL(i9, jc), ja, i)
      if (!i8) {
        return
      }
      var jb = this.getTileKey(i)
      if (i.combine) {
        T = i8
        T.tileInfo = i
        if (T) {
          e && e(T, jb)
        } else {
          e && e(null, jb)
        }
      } else {
        T = this.loadTileImage(i8, jb, e)
      }
      T.tileInfo = i
    },
    loadTileImage: function (i8, T, e) {
      var i = new Image()
      i.crossOrigin = 'anonymous'
      i.onload = function () {
        e && e(this, T)
      }
      i.onerror = function () {
        bo.fetchDebug &&
          bo.fetchDebug.sendError({
            title: i8,
            msg: i8,
            category: bo.fetchDebug.category.RESOURCE,
            level: bo.fetchDebug.levels.ERROR,
            url: i8,
          })
        e && e(null, T)
      }
      i.src = i8
      return i
    },
    rasterTileDataCbk: function (ja, i8) {
      if (!ja || typeof ja === 'string') {
        this.tileCache.removeData(i8)
        return
      }
      var i = ja.tileInfo
      var T = i.col
      var jg = i.row
      var jf = i.zoom
      var e = this.tileCache.getData(i8)
      if (!e) {
        return
      }
      var jb = 'id_' + T + '_' + jg + '_' + jf
      var je = this
      e.dataType = fY
      e.tileInfo = i
      if (i.tileTypeName === 'xyz') {
        var jd = i.tileSize
        e.textureSource = ja
        e.renderData = {
          vertexAll: [
            0,
            0,
            0,
            0,
            0,
            jd,
            0,
            0,
            1,
            0,
            jd,
            jd,
            0,
            1,
            1,
            0,
            0,
            0,
            0,
            0,
            jd,
            jd,
            0,
            1,
            1,
            0,
            jd,
            0,
            0,
            1,
          ],
        }
        je.setRasterTileData(i8, e, jb)
      } else {
        e.textureSource = ja
        var i9 = ev.calcLoopParam(T, jf)
        var jc = i9.geoOffsetX
        ja.tileInfo.loopOffsetX = jc
        e.renderData = {
          vertexAll: [
            0, 0, 0, 0, 0, 256, 0, 0, 1, 0, 256, 256, 0, 1, 1, 0, 0, 0, 0, 0,
            256, 256, 0, 1, 1, 0, 256, 0, 0, 1,
          ],
        }
        this.setRasterTileData(i8, e, jb)
      }
    },
    setRasterTileData: function (i9, e, i8) {
      e.status = 'ready'
      this.tileCache.setData(i9, e)
      var T = false
      if (this.curViewTilesInfo[i8]) {
        e.dataType = fY
        e.png8 = this.png8 || false
        this.map._featureMgr.setData(e, this.drawIndex, 2)
        T = true
      }
      if (T) {
        var i = new e7('onrefresh')
        i.source = 'webgllayer'
        this.map.dispatchEvent(i)
      }
    },
    _checkTilesLoaded: function () {
      this.numLoading--
      if (this.map.firstTileLoad === false) {
        this.map.dispatchEvent(new e7('onfirsttilesloaded'))
        this.map.firstTileLoad = true
      }
      var e = this
      if (this.numLoading === 0) {
        if (this._checkLoadedTimer) {
          clearTimeout(this._checkLoadedTimer)
          this._checkLoadedTimer = null
        }
        this._checkLoadedTimer = setTimeout(function () {
          if (e.numLoading === 0) {
            e.map.dispatchEvent(new e7('ontilesloaded'))
          }
          e._checkLoadedTimer = null
        }, 60)
      }
    },
    isClickableLabel: function (e) {
      if (e.isDel) {
        return false
      }
      if (e.zoom > 9 && !e.guid) {
        return false
      }
      if (e.zoom <= 9 && !e.name && !e.guid) {
        return false
      }
      return true
    },
  }
  var aJ = 5
  var h7 = 4
  var fR = 3
  var H = 2
  var dU = 1
  var gH = 0
  function ap(e) {
    this._ratio = fz()
    this._iconCache = {}
    this._map = e
    this._drawingCanvasPool = []
    this._drawingCanvasHeight = 4096
  }
  es.extend(ap.prototype, {
    _loadIcons: function (i, jc) {
      var ja = 0
      var i9 = this
      var T = this._map.config.style
      for (var jb in i) {
        ja++
        var e = new Image()
        e.id = jb
        e.crossOrigin = 'anonymous'
        e.onload = function () {
          i9._iconCache[this.id].loaded = true
          ja--
          if (ja === 0) {
            jc()
          }
          this.onload = null
        }
        e.onerror = function () {
          i9._iconCache[this.id] = null
          ja--
          if (ja === 0) {
            jc()
          }
          this.onerror = null
        }
        var i8 = w.getIconSetPath(T) + jb + '.png'
        e.src = i8
        this._iconCache[jb] = { loaded: false, image: e }
      }
    },
    _getEmptyDrawingCanvas: function () {
      for (var T = 0; T < this._drawingCanvasPool.length; T++) {
        if (this._drawingCanvasPool[T]._free === true) {
          this._drawingCanvasPool[T]._free = false
          return this._drawingCanvasPool[T]
        }
      }
      var e = this._createNewDrawingCanvas()
      this._drawingCanvasPool.push(e)
      e._free = false
      return e
    },
    _createNewDrawingCanvas: function () {
      var e = bK('canvas')
      e.width = 512
      e.height = this._drawingCanvasHeight
      e._free = true
      e._id = bo.getGUID()
      var i = e.getContext('2d')
      i.textBaseline = 'bottom'
      i.lineJoin = 'round'
      return e
    },
    drawLabelsOnCanvas: function (jq, i8) {
      var jg = jq.label.fixedLabel.slice(0)
      var jm = jq.label.lineLabel.slice(0)
      var T = jq.label.indoorLabel.slice(0)
      if (jg.length === 0 && jm.length === 0 && T.length === 0) {
        i8()
        return
      }
      var jb = function (jv, i) {
        return jv.styleId - i.styleId
      }
      jg.sort(jb)
      jm.sort(jb)
      T.sort(jb)
      var jp = {}
      var e = this._getEmptyDrawingCanvas()
      var jl = e.getContext('2d')
      jl.clearRect(0, 0, e.width, e.height)
      var jt = 0
      var jh = null
      var ja = 0
      if (jg.length > 0) {
        while (ja < jg.length && !jg[ja].styleText[0]) {
          ja++
        }
        if (jg[ja] && jg[ja].styleText[0]) {
          jh = jg[ja].styleText[0].fontSize + jg[ja].styleText[0].haloSize * 2
        }
      }
      if (jh === null && T.length > 0) {
        ja = 0
        while (ja < T.length && !T[ja].styleText[0]) {
          ja++
        }
        if (T[ja] && T[ja].styleText[0]) {
          jh = T[ja].styleText[0].fontSize + T[ja].styleText[0].haloSize * 2
        }
      }
      if (jh === null && jm.length > 0) {
        ja = 0
        while (ja < jm.length && !jm[ja].styleText[0]) {
          ja++
        }
        if (jm[ja] && jm[ja].styleText[0]) {
          jh = jm[ja].styleText[0].fontSize + jm[ja].styleText[0].haloSize * 2
        }
      }
      if (jh === null || isNaN(jh)) {
        i8()
        return
      }
      var jd = 0
      var jc = jh
      var jj = {}
      var ju = 0
      var jk = []
      for (var jo = 0; jo < jg.length; jo++) {
        var jf = jg[jo]
        var ji = jf.name
        var jn = jf.styleText
        if (!ji || jn.length === 0) {
          continue
        }
        var i9 = jf.icon
        if (
          jf.textOnIcon &&
          (!this._iconCache[i9] || this._iconCache[i9].loaded === false)
        ) {
          jk.push(jf)
          ju++
          if (!jj[i9]) {
            jj[i9] = true
          }
          continue
        }
        var jr = this._drawEachText(jl, jf, jt, jd, jc, jh, jp)
        if (!jr) {
          continue
        }
        jd = jr.curX
        jc = jr.curY
        jh = jr.curLineHeight
        jt = jr.styleId
      }
      var jr = this._drawEachTypeOfLabels(jl, T, jt, jd, jc, jh, jp)
      jt = jr.curStyleId
      jd = jr.curX
      jc = jr.curY
      jh = jr.curLineHeight
      var jr = this._drawEachTypeOfLabels(jl, jm, jt, jd, jc, jh, jp)
      jt = jr.curStyleId
      jd = jr.curX
      jc = jr.curY
      jh = jr.curLineHeight
      if (ju > 0) {
        var js = this
        this._loadIcons(jj, function () {
          jr = js._drawEachTypeOfLabels(jl, jk, jt, jd, jc, jh, jp)
          jt = jr.curStyleId
          jd = jr.curX
          jc = jr.curY
          jh = jr.curLineHeight
          var i = js._generateEachLabelCanvas(e, jc, jg, jm, T, jq)
          i8(i[0], i[1])
        })
        return
      }
      var je = this._generateEachLabelCanvas(e, jc, jg, jm, T, jq)
      i8(je[0], je[1])
    },
    drawCustomLabelsOnCanvas: function (jb, jh) {
      if (jb.length === 0) {
        jh()
        return
      }
      var T = 0
      var e = jb[0].style.fontSize + (jb[0].style.haloSize || 0) * 2 || 0
      var i8 = e
      var jd = this._getEmptyDrawingCanvas()
      var ji = jd.getContext('2d')
      ji.clearRect(0, 0, jd.width, jd.height)
      var je = {}
      var jg = -1
      for (var i9 = 0; i9 < jb.length; i9++) {
        if (!jb[i9].name) {
          continue
        }
        var jf = this._drawEachText(ji, jb[i9], jg, T, e, i8, je)
        if (!jf) {
          continue
        }
        T = jf.curX
        e = jf.curY
        i8 = jf.curLineHeight
        jg = jf.styleId
      }
      var ja = e
      var jc = this._copyToNewCanvas(jd, ja)
      for (var i9 = 0; i9 < jb.length; i9++) {
        if (!jb[i9].name && jb[i9].style.iconSize) {
          this._addFixedLabelBounds(jb[i9])
          continue
        }
        if (!jb[i9].textSize) {
          continue
        }
        this._updateFixedLabelCoords(jb[i9], ja)
        this._addFixedLabelBounds(jb[i9])
      }
      jh(jc)
    },
    _drawEachTypeOfLabels: function (jh, jb, jf, i8, T, i9, jd) {
      for (var ja = 0; ja < jb.length; ja++) {
        var jc = jb[ja]
        var jg = jc.name
        var e = jc.styleText
        if (!jg || e.length === 0) {
          continue
        }
        var je = this._drawEachText(jh, jc, jf, i8, T, i9, jd)
        if (!je) {
          continue
        }
        i8 = je.curX
        T = je.curY
        i9 = je.curLineHeight
        jf = je.styleId
        if (je.curY > this._drawingCanvasHeight) {
          return { curX: i8, curY: T, curLineHeight: i9, curStyleId: jf }
        }
      }
      return { curX: i8, curY: T, curLineHeight: i9, curStyleId: jf }
    },
    _drawIndoorTextLabelOnCanvas: function (i9) {
      var e = this._getEmptyDrawingCanvas()
      var jg = e.getContext('2d')
      jg.clearRect(0, 0, e.width, e.height)
      var jo = 0
      var jf = null
      var je = 0
      var jc
      var jl = {}
      var jk = []
      for (var ja in i9) {
        if (ja === 'tileInfo') {
          continue
        }
        var i8 = i9[ja]
        var jj = i8.defaultFloor
        var jd = i8.floors
        for (var ji = 0; ji < jd.length; ji++) {
          if (ji === jj) {
            continue
          }
          var jm = jd[ji]
          if (!jm.pois) {
            continue
          }
          var jb = jm.pois
          for (var jh = 0; jh < jb.length; jh++) {
            if (jf === null && jb[jh].styleText[0]) {
              jf =
                jb[jh].styleText[0].fontSize + jb[jh].styleText[0].haloSize * 2
              jc = jf
            }
            jk.push(jb[jh])
          }
        }
      }
      if (jf === null) {
        return null
      }
      jk.sort(function (jp, i) {
        return i.rank - jp.rank || jp.styleId - i.styleId
      })
      var jn = this._drawEachTypeOfLabels(jg, jk, jo, je, jc, jf, jl)
      jo = jn.curStyleId
      je = jn.curX
      jc = jn.curY
      jf = jn.curLineHeight
      var T = this._copyToNewCanvas(e, jc)
      return T
    },
    _updateIndoorLabelsCoords: function (jf, jg) {
      for (var je in jf) {
        if (je === 'tileInfo') {
          continue
        }
        var e = jf[je]
        var ja = e.defaultFloor
        var jb = e.floors
        for (var jc = 0; jc < jb.length; jc++) {
          if (jc === ja) {
            continue
          }
          var T = jb[jc]
          if (!T.pois) {
            continue
          }
          var i9 = T.pois
          for (var i8 = 0; i8 < i9.length; i8++) {
            var jd = i9[i8]
            if (jd.name && (!jd.textSize || jd.textSize.length === 0)) {
              i9.splice(i8, 1)
              i8--
              continue
            }
            this._updateFixedLabelCoords(jd, jg)
            this._addFixedLabelBounds(jd)
          }
        }
      }
    },
    _generateEachLabelCanvas: function (jb, ja, jc, e, je, T) {
      ja = Math.min(ja, this._drawingCanvasHeight)
      var jd = this._copyToNewCanvas(jb, ja)
      var i8 = null
      if (T.renderData.indoorData) {
        i8 = this._drawIndoorTextLabelOnCanvas(T.renderData.indoorData)
        if (i8) {
          this._updateIndoorLabelsCoords(T.renderData.indoorData, i8.height)
        }
      }
      for (var i9 = 0; i9 < jc.length; i9++) {
        if (!jc[i9].textSize) {
          continue
        }
        this._updateFixedLabelCoords(jc[i9], ja)
        this._addFixedLabelBounds(jc[i9])
      }
      for (var i9 = 0; i9 < je.length; i9++) {
        if (!je[i9].textSize) {
          continue
        }
        this._updateFixedLabelCoords(je[i9], ja)
        this._addFixedLabelBounds(je[i9])
      }
      for (var i9 = 0; i9 < e.length; i9++) {
        this._updateLineLabelCoords(e[i9], ja)
      }
      return [jd, i8]
    },
    _copyToNewCanvas: function (T, i) {
      if (i === 0) {
        return null
      }
      var i8 = bK('canvas')
      i8.width = T.width
      i8.height = i
      var e = i8.getContext('2d')
      e.drawImage(T, 0, 0, 512, i, 0, 0, 512, i)
      i8._id = T._id
      T._free = true
      return i8
    },
    _drawEachText: function (jq, jc, T, js, jr, jz, i9) {
      var jy = jc.name
      var jh = jc.styleText ? jc.styleText[0] : jc.style
      if (!jh) {
        return null
      }
      var jk = jh.fontSize
      var jD = jh.fontWeight
      var jQ = jh.haloSize || 0
      if (!jl) {
      }
      if (jh.fontRgba) {
        var jW = jh.fontRgba[3] / 255
        var jg = []
        jg[3] = jW
        for (var jV = 0; jV < 3; jV++) {
          jg[jV] = jh.fontRgba[jV]
        }
      }
      if (jh.haloRgba) {
        var jW = jh.haloRgba[3] / 255
        var jn = []
        jn[3] = jW
        for (var jV = 0; jV < 3; jV++) {
          jn[jV] = jh.haloRgba[jV]
        }
      }
      var jK = jg ? 'rgba(' + jg.join(',') + ')' : jh.color
      var jb = jn ? 'rgba(' + jn.join(',') + ')' : jh.strokeColor
      var jS = jc.styleId || 0
      if (jQ > 4) {
        jQ = 4
      }
      var jA = []
      var jp = []
      var jw = 0
      if (i9 && !i9[jS]) {
        i9[jS] = {}
      }
      var jj = jk + jQ * 2
      var jB = jj
      if (jc.containDescendings) {
        jB += 4
      }
      if (jQ === 0) {
        jB += 2
      }
      if (jc.textOnIcon) {
        jB = Math.max(jB, jc.iconSize[1])
      }
      if (jS !== T || jB > jz) {
        T = jS
        if (jD >= 10 && jD % 10 === 0) {
          jq.font = jD * 10 + ' ' + jk + 'px sans-serif'
        } else {
          jq.font = jk + 'px sans-serif'
        }
        if (jB > jz) {
          var jx = jB - jz
          jz += jx
          jr += jx
        }
        if (jQ > 0) {
          jq.lineWidth = jQ * 2
          jq.strokeStyle = jb
        }
        jq.fillStyle = jK
      }
      if (jc.type === 'line') {
        var je = jy.split('')
        for (var jT = 0; jT < je.length; jT++) {
          var jM = je[jT]
          var jt
          var jE
          if (i9[jS][jM]) {
            var jl = i9[jS][jM]
            jt = jl.displaySize
            jE = jl.curWordPosition
          } else {
            var i8 = Math.ceil(jq.measureText(jM).width)
            if (js + i8 > 512) {
              js = 0
              jr += jB
              jz = jB
            }
            if (jr > this._drawingCanvasHeight) {
              return { curX: js, curY: jr, curLineHeight: jz, styleId: jS }
            }
            var jN = js
            if (jQ > 0) {
              i8 += jQ
              jN -= Math.round(jQ / 2)
              jq.strokeText(jM, js, jr)
            }
            jq.fillText(jM, js, jr)
            var jJ = [i8, jB]
            jt = [Math.round(jJ[0] / 2), Math.round(jJ[1] / 2)]
            jE = [jN, jr - jB]
            i9[jS][jM] = {
              displaySize: jt,
              curWordPosition: jE,
              totalHeight: jw,
            }
            js += i8 + 2
          }
          jA.push(jt)
          jp.push(jE)
        }
        jw = Math.round(jA[0][1])
      } else {
        if (i9[jS][jy]) {
          var jl = i9[jS][jy]
          jA = jl.textSize
          jp = jl.labelImagePosition
          jw = jl.totalHeight
        } else {
          var jm = jy.split('\\')
          if (jm.length > 1 && jc.textOnIcon) {
            var jU = 0
            var jR = 0
            var jX = []
            var ju = 8
            for (var jT = 0; jT < jm.length; jT++) {
              var jy = jm[jT]
              var ji = Math.ceil(jq.measureText(jy).width)
              if (ji > jU) {
                jU = ji
              }
              jX.push(Math.round(ji / 2))
              jR += jB
            }
            var jf = jU + 2 * ju
            var jP = jR + 2 * ju
            if (js + jf > 512) {
              js = 0
              jr += jz
            }
            jr += jR - jB + 2 * ju
            var jI = js
            var jv = jr - jP
            var e = Math.round(jf / 2)
            var jo = this._iconCache[jc.icon].image
            this.drawStretchedIcon(jq, jo, [jI, jv], ju, jU, jR)
            for (var jT = 0; jT < jm.length; jT++) {
              var jy = jm[jT]
              var jO = jI + (e - jX[jT])
              var jL = jv + 4 + (jT + 1) * jB
              jq.fillText(jy, jO, jL)
            }
            jA.push([Math.round(jf / 2), Math.round(jP / 2)])
            jp.push([jI, jv])
            js += jf
            jz = jP
            jw = Math.round(jP / 2)
          } else {
            for (var jT = 0; jT < jm.length; jT++) {
              var jy = jm[jT]
              var ji = Math.ceil(jq.measureText(jy).width)
              var jf = ji
              var ja = 0
              if (jc.textOnIcon) {
                ja = 10
                jf += ja * 2
                if (jc.styleId === 519) {
                  jf = jc.iconSize[0]
                  ja = Math.round((jf - ji) / 2)
                }
              }
              if (js + jf > 512) {
                js = 0
                jr += jB
                jz = jB
              }
              if (jr > this._drawingCanvasHeight) {
                return { curX: js, curY: jr, curLineHeight: jz, styleId: jS }
              }
              var jI = js
              var jv = jr - jB
              var jH = js
              var jG = jr
              if (jc.containDescendings) {
                jG -= 4
              }
              if (jc.textOnIcon) {
                var jC = false
                var jo = this._iconCache[jc.icon].image
                var jF = jc.iconSize.concat([])
                if (jj > jF[1]) {
                  jF[1] = jj
                  jC = true
                }
                if (ji > jF[0]) {
                  jF[0] = ji
                  jC = true
                }
                if (jc.styleId === 519) {
                  jq.drawImage(jo, 0, 0, jF[0], jF[1], jI, jv, jF[0], jF[1])
                } else {
                  if (jC) {
                    this.drawStretchedIcon(jq, jo, [jI, jv], ja, ji, jF[1])
                  } else {
                    this.draw3StretchedIcon(jq, jo, [jI, jv], ja, ji, jF[1])
                  }
                }
                jH += ja
                if (jc.iconSize[1] > jj) {
                  jG -= (jc.iconSize[1] - jj) / 2 - 1
                }
                jf += 1
              }
              if (jQ > 0) {
                jf += jQ
                jI -= Math.round(jQ / 2)
                jv += Math.round(jQ / 2)
                if (jS === 71028) {
                  jB -= 2
                }
                if (jS === 32) {
                  jB -= 2
                }
                jq.strokeText(jy, jH, jG)
              }
              jq.fillText(jy, jH, jG)
              var jd = [jf, jB]
              var jt = [Math.round(jd[0] / 2), Math.round(jd[1] / 2)]
              jA.push(jt)
              jp.push([jI, jv])
              jw += Math.round(jt[1])
              js += jf
            }
          }
          i9[jS][jy] = { textSize: jA, labelImagePosition: jp, totalHeight: jw }
        }
      }
      jc.textSize = jA
      jc.labelImagePosition = jp
      jc.totalHeight = jw
      return { curX: js, curY: jr, curLineHeight: jz, styleId: jS }
    },
    drawStretchedIcon: function (e, T, i8, jb, jc, i) {
      var ja = i8[0]
      var i9 = i8[1]
      e.drawImage(T, 0, 0, jb, jb, ja, i9, jb, jb)
      e.drawImage(T, jb, 0, 1, jb, ja + jb, i9, jc, jb)
      e.drawImage(T, T.width - jb, 0, jb, jb, ja + jc + jb, i9, jb, jb)
      e.drawImage(T, 0, jb, jb, 1, ja, i9 + jb, jb, i)
      e.drawImage(T, jb, jb, 1, 1, ja + jb, i9 + jb, jc, i)
      e.drawImage(T, T.width - jb, jb, jb, 1, ja + jc + jb, i9 + jb, jb, i)
      e.drawImage(T, 0, T.height - jb, jb, jb, ja, i9 + i + jb, jb, jb)
      e.drawImage(T, jb, T.height - jb, 1, jb, ja + jb, i9 + i + jb, jc, jb)
      e.drawImage(
        T,
        T.width - jb,
        T.height - jb,
        jb,
        jb,
        ja + jc + jb,
        i9 + i + jb,
        jb,
        jb
      )
    },
    draw3StretchedIcon: function (e, i, T, ja, jc, jb) {
      var i9 = T[0]
      var i8 = T[1]
      e.drawImage(i, 0, 0, ja, i.height, i9, i8, ja, i.height)
      e.drawImage(i, ja, 0, 1, i.height, i9 + ja, i8, jc, i.height)
      e.drawImage(
        i,
        i.width - ja,
        0,
        ja,
        i.height,
        i9 + ja + jc,
        i8,
        ja,
        i.height
      )
    },
    _updateFixedLabelCoords: function (i9, jo) {
      if (jo === 0) {
        return
      }
      var jj = []
      var jv = []
      var jw = 0
      var jm = i9.totalHeight
      var jE = i9.textSize.length
      var ja = i9.direction
      if (typeof ja !== 'number') {
        ja = 0
      }
      for (var jx = 0; jx < jE; jx++) {
        var jp = i9.labelImagePosition[jx]
        var jn = i9.textSize[jx]
        var jl = jp[0]
        var i8 = jp[1]
        var jb = jn[0]
        var jg = jn[1]
        var ji = 0
        var ju = 0
        if (typeof i9.textMargin === 'number') {
          ju = i9.textMargin
        }
        var jh
        var e
        var jd = 0
        var jk = 0
        if (!i9.iconPos) {
          if (!i9.custom) {
            ja = h7
          }
        } else {
          jd = i9.iconPos.width
          jk = i9.iconPos.height
        }
        switch (ja) {
          case fR:
            var T = jm / 2 - jg + (ji * (jE - 1)) / 2
            jh = Math.round(-jd / 2 - jb - ju)
            e = Math.round(T - jw - ji * jx)
            break
          case dU:
            var T = jm / 2 - jg + (ji * (jE - 1)) / 2
            jh = Math.round(jd / 2 + ju)
            e = Math.round(T - jw - ji * jx)
            break
          case H:
            var T = jk / 2 + jm - jg + ji * jE
            jh = Math.round(-jb / 2)
            e = Math.round(T - jw - ji * jx)
            break
          case gH:
            var T = -jk / 2 - ji - jg
            jh = Math.round(-jb / 2)
            e = Math.round(T - jw - ji * jx)
            break
          case h7:
            var T = -jm / 2 - (ji * (jE - 1)) / 2
            jh = Math.round(-jb / 2)
            e = Math.round(T - jw - ji * jx)
            break
        }
        jw += jg
        var jf = jh + jb
        var jF = e
        var je = jf
        var jD = jF + jg
        var jc = jh
        var jC = jD
        jj.push(jh, e, jf, jF, je, jD, jh, e, je, jD, jc, jC)
        var jB = jl / 512
        var jt = (jo - i8 - jg * 2) / jo
        var jA = (jl + jb * 2) / 512
        var js = jt
        var jz = jA
        var jr = (jo - i8) / jo
        var jy = jB
        var jq = jr
        jv.push(jB, jt, jA, js, jz, jr, jB, jt, jz, jr, jy, jq)
      }
      if (!i9.textPos) {
        i9.textPos = {}
      }
      i9.textPos.vertex = jj
      i9.textPos.texcoord = jv
    },
    _addFixedLabelBounds: function (je) {
      var ja = 1000
      var i8 = 1000
      var T = -1000
      var e = -1000
      if (je.iconPos) {
        var jc = je.iconPos['vertex']
        for (var jd = 0, i9 = jc.length; jd < i9; jd += 2) {
          var ji = jc[jd]
          var jg = jc[jd + 1]
          if (ji < ja) {
            ja = ji
          }
          if (ji > T) {
            T = ji
          }
          if (jg < i8) {
            i8 = jg
          }
          if (jg > e) {
            e = jg
          }
        }
      }
      if (je.custom && je.style.iconSize && !je.name) {
        var jf = je.style.iconSize
        var jh = je.direction
        switch (jh) {
          case h7:
            ja = -Math.round(jf[0] / 2)
            i8 = -Math.round(jf[1] / 2)
            T = Math.round(jf[0] / 2)
            e = Math.round(jf[1] / 2)
            break
          case H:
            ja = -Math.round(jf[0] / 2)
            i8 = 0
            T = Math.round(jf[0] / 2)
            e = jf[1]
            break
        }
      }
      if (je.textPos) {
        var jb = je.textPos['vertex']
        for (var jd = 0, i9 = jb.length; jd < i9; jd += 2) {
          var ji = jb[jd]
          var jg = jb[jd + 1]
          if (ji < ja) {
            ja = ji
          }
          if (ji > T) {
            T = ji
          }
          if (jg < i8) {
            i8 = jg
          }
          if (jg > e) {
            e = jg
          }
        }
      }
      je.bds = [ja, i8, T, e]
    },
    _updateLineLabelCoords: function (jp, jf) {
      if (jf === 0) {
        return
      }
      var i8 = jp.wordsInfo
      var jm = jp.wordCount
      if (!jp.labelImagePosition) {
        return
      }
      var jh = jp.labelImagePosition.slice(0)
      if (jp.reverse) {
        jh.reverse()
      }
      var jy = 1000
      var jv = 1000
      var jw = -1000
      var ju = -1000
      for (var jq = 0; jq < jm; jq++) {
        var jz = jh[jq]
        var jx = jz[0]
        var jn = jz[1]
        var jl = jp.textSize[jq]
        var je = jl[0]
        var e = jl[1]
        var jd = jx / 512
        var jk = (jf - jn - e * 2) / jf
        var jb = (jx + je * 2) / 512
        var jj = jk
        var i9 = jb
        var ji = (jf - jn) / jf
        var T = jd
        var jg = ji
        i8[jq].size = [je, e]
        i8[jq].texcoord = [jd, jk, jb, jj, i9, ji, jd, jk, i9, ji, T, jg]
        var jt = i8[jq].offset[0]
        var js = i8[jq].offset[1]
        var jr = jt - je / 2
        var jc = js + e / 2
        var ja = js - e / 2
        var jo = jt + je / 2
        if (jr < jy) {
          jy = jr
        }
        if (jo > jw) {
          jw = jo
        }
        if (ja < jv) {
          jv = ja
        }
        if (jc > ju) {
          ju = jc
        }
      }
      jp.bds = [jy, jv, jw, ju]
    },
  })
  var fo = {
    0: '00000000',
    16: '00010000',
    32: '00100000',
    48: '00110000',
    64: '01000000',
    96: '01100000',
  }
  function dM(T, i8, i9) {
    var e = T.bds
    if (!e) {
      return false
    }
    var i = T.tracer
    var jc
    if (i) {
      if (!fo[i]) {
        jc = i.toString(2)
        if (jc.length < 8) {
          jc = new Array(8 - jc.length + 1).join('0') + jc
        }
        fo[i] = jc
      }
      jc = fo[i]
      var jb = i3.mapZoomStartZoomMapping[i8]
      return jc[i8 - jb] === '1'
    }
    var ja = T.displayRange
    if (i9 >= ja[0] && i9 <= ja[1]) {
      return true
    }
    return false
  }
  function ic(i, e) {
    this.map = i.map
    this.layer = i
    e = e || []
    this.allLabels = []
    this._spotData = []
    this._strategyInfo = null
    this.RANK1 = 1000000
    this.RANK2 = 2000000
    this.RANK3 = 3000000
    this.RANK4 = 4000000
    this.RANK5 = 5000000
    this._ratio = fz()
    this._useRound = true
    this._sharpenRender = false
    if (this._ratio > gV.HIGH_RES_MIN_RATIO) {
      this._useRound = false
      this._sharpenRender = true
    }
    this._mapIsMoving = false
    this._onMapIdleCallback = e.onMapIdleCallback
    this.map.temp.isPermitSpotOver = true
    this.currentSelectedLabel = null
    this.map._labelProcessor = this
    this.iconCache = {}
    this.fixedLabelData = []
    this.lineLabelData = []
    this.highlightLabelData = []
    this._iconLoadTimer = null
    this._labelTextCanvas = null
    if (this.map.config.textRenderType === 'canvas') {
      this._labelTextCanvas = this.map.tileMgr.getLabelTextCanvas()
    }
    this.bind()
  }
  es.extend(ic.prototype, {
    bind: function () {
      var T = this.map
      var i = this
      T.addEventListener('mapstatusbusy_inner', function (i8) {
        i._mapIsMoving = true
        if (i._ratio > gV.HIGH_RES_MIN_RATIO) {
          i._sharpenRender = false
        } else {
          i._useRound = false
        }
      })
      T.addEventListener('mapstatusidle_inner', function (i8) {
        if (i._ratio > gV.HIGH_RES_MIN_RATIO) {
          i._sharpenRender = true
        } else {
          i._useRound = true
        }
        i._mapIsMoving = false
      })
      T.addEventListener('onspotmouseover', function (ja) {
        if (!this.temp.isPermitSpotOver) {
          return
        }
        if (ja.spots.length > 0) {
          var i9 = ja.spots[0].userdata.uid
          var jb = ja.spots[0].userdata.tilePosStr
          var i8 = i.getLabelByUid(i9, jb)
          i8 && i8.formatedData && i._toHighlightColor(i8.formatedData)
        }
      })
      T.addEventListener('onspotmouseout', function (ja) {
        if (!this.temp.isPermitSpotOver) {
          return
        }
        if (ja.spots.length > 0) {
          var i9 = ja.spots[0].userdata.uid
          var jb = ja.spots[0].userdata.tilePosStr
          var i8 = i.getLabelByUid(i9, jb)
          i8 && i8.formatedData && i._toDefaultColor(i8.formatedData)
        }
      })
      T.addEventListener('spotclick', function (ja) {
        if (ja.spots && ja.spots.length > 0) {
          if (ja.spots[0].userdata.zoom < 10) {
            return
          }
          var i9 = ja.spots[0].userdata.uid
          var jb = ja.spots[0].userdata.tilePosStr
          if (
            i.currentSelectedLabel &&
            (i.currentSelectedLabel.uid !== i9 ||
              i.currentSelectedLabel.tilePosStr !== jb)
          ) {
            i._recoverNormalState()
          }
          var i8 = i.getLabelByUid(i9, jb)
          i8 && i._changeBaseMapState(i8)
        } else {
          i._recoverNormalState()
        }
      })
      T.on('spot_status_reset', function () {
        i._recoverNormalState()
      })
      T.on('spot_highlight', function (i9) {
        var i8 = i.getLabelByUid(i9.uid, i9.tilePosStr)
        i8 && i8.formatedData && i._toHighlightColor(i8.formatedData)
      })
      T.addEventListener('mousemove', function (i8) {
        if (i.curSpotAdded) {
          return
        }
        if (this.currentOperation !== dI.idle || i._mapIsMoving === true) {
          return
        }
        i._refreshSpotData()
        this.temp.isPermitSpotOver = true
        i.curSpotAdded = true
      })
      if (bJ()) {
        function e() {
          i._refreshSpotData()
        }
        T.addEventListener('mapstatusidle_inner', e)
      }
      T.on('style_loaded', function () {
        if (i.map.config.textRenderType === 'canvas' && !i._labelTextCanvas) {
          i._labelTextCanvas = i.map.tileMgr.getLabelTextCanvas()
        }
      })
    },
    getLabelByUid: function (jc, jd) {
      var e = this.map._featureMgr.getResult().tileLabels
      for (var jb = 0; jb < e.length; jb++) {
        var i8 = e[jb].fixedLabel
        for (var ja = 0; ja < i8.length; ja++) {
          if (
            e[jb].fixedLabel[ja].guid === jc &&
            e[jb].fixedLabel[ja].tilePosStr === jd
          ) {
            return e[jb].fixedLabel[ja]
          }
        }
        var i9 = e[jb].indoorLabel
        for (var T = 0; T < i9.length; T++) {
          if (
            e[jb].indoorLabel[T].guid === jc &&
            e[jb].indoorLabel[T].tilePosStr === jd
          ) {
            return e[jb].indoorLabel[T]
          }
        }
      }
      return null
    },
    getTileByLabelUid: function (jc) {
      var e = this.map._featureMgr.getResult().tileLabels
      for (var jb = 0; jb < e.length; jb++) {
        var i8 = e[jb].fixedLabel
        for (var ja = 0; ja < i8.length; ja++) {
          if (e[jb].fixedLabel[ja].guid === jc) {
            return e[jb]
          }
        }
        var i9 = e[jb].indoorLabel
        for (var T = 0; T < i9.length; T++) {
          if (e[jb].indoorLabel[T].guid === jc) {
            return e[jb]
          }
        }
      }
      return null
    },
    _toHighlightColor: function (T) {
      if (T.tempRank && T.tempRank === this.RANK5) {
        return
      }
      var e = this.map._featureMgr.getResult().eleData[4] || []
      var i9 = false
      for (var i8 = 0; i8 < e.length; i8++) {
        if (
          e[i8] === T ||
          (e[i8].guid === T.guid &&
            e[i8].tilePosStr === T.tilePosStr &&
            e[i8].zoom === T.zoom)
        ) {
          i9 = true
          break
        }
      }
      if (i9) {
        return
      }
      e.push(T)
      this.map._featureMgr.setOverlayData(e, 4)
      this.map.dispatchEvent(new e7('onrefresh'))
    },
    _toDefaultColor: function (T) {
      if (T.tempRank && T.tempRank === this.RANK5) {
        return
      }
      var e = this.map._featureMgr.getResult().eleData[4] || []
      for (var i8 = 0; i8 < e.length; i8++) {
        if (
          T === e[i8] ||
          (T.guid === e[i8].guid &&
            T.tilePosStr === e[i8].tilePosStr &&
            T.zoom === e[i8].zoom)
        ) {
          e.splice(i8, 1)
          break
        }
      }
      this.map._featureMgr.setOverlayData(e, 4)
      this.map.dispatchEvent(new e7('onrefresh'))
    },
    _changeBaseMapState: function (i) {
      var i9 = i.guid
      var jd = i.formatedData.guidExt
      var je = { guid: i9, tilePosStr: i.tilePosStr, guidExt: jd }
      this._strategyInfo = je
      this.currentSelectedLabel = i
      var i8 = this.map._featureMgr
      var e = i8.getLabelData()
      e = this.collisionTest(e)
      this.updateLabels(e)
      var jf = this.fixDataFormat(e)
      i8.setOverlayData(jf[0], 2)
      i8.setOverlayData(jf[1], 3)
      i8.setOverlayData(jf[2], 4)
      var T = this.getTileByLabelUid(i9)
      this.currentSelectedLabel.tileInfo = T.tileInfo
      var jc = this.layer.tileCache.getAllData()
      for (var jb in jc) {
        var ja = jc[jb].data
        if (!ja.label) {
          continue
        }
        this.clearCollisionCache(ja.label)
      }
      this.map.dispatchEvent(new e7('onrefresh'))
    },
    _recoverNormalState: function () {
      this._strategyInfo = null
      var jc = false
      var ja = this.map._featureMgr.getLabelData()
      if (this.currentSelectedLabel) {
        var T = this.currentSelectedLabel.guid
        this.clearCollisionCache(this.getTileByLabelUid(T))
        var i9 = this.layer.tileCache.getAllData()
        for (var i8 in i9) {
          if (Object.prototype.hasOwnProperty.call(i9, i8)) {
            var jb = i9[i8].data
            if (!jb.label) {
              continue
            }
            this.clearCollisionCache(jb.label)
          }
        }
        this.currentSelectedLabel.tempRank = null
        this.currentSelectedLabel = null
        jc = true
      }
      ja = this.collisionTest(ja)
      this.updateLabels(ja)
      var e = this.fixDataFormat(ja)
      var i = this.map._featureMgr
      i.setOverlayData(e[0], 2)
      i.setOverlayData(e[1], 3)
      i.setOverlayData([], 4)
      this.map.dispatchEvent(new e7('onrefresh'))
      if (jc) {
        this.curSpotAdded = false
        this._refreshSpotData()
      }
    },
    loadIconImages: function (i9, jk) {
      var jc = i9.label
      var ja = i9.tileInfo.style
      var T = jc.fixedLabel
      var jh = jc.indoorLabel
      var jl = T.length + jh.length
      var je = this
      var i8 = 0
      var jj = 200
      for (var jb = 0; jb < jl; jb++) {
        var jd
        if (jb < T.length) {
          jd = T[jb]
        } else {
          jd = jh[jb - T.length]
        }
        if (!jd.iconPos) {
          continue
        }
        var jg = jd.iconPos.iconType
        var ji = ja + '_' + jg
        i8++
        if (this.iconCache[ji]) {
          if (this.iconCache[ji].loaded) {
            jk(i9)
          }
          continue
        }
        var e = w.getIconSetPath(this.map.config.style) + jg + '.png'
        var jf = new Image()
        jf.id = ji
        jf.iconUrl = e
        jf.crossOrigin = 'anonymous'
        jf.onload = function () {
          je.iconCache[this.id].loaded = true
          je._addToIconTexture(this)
          if (je._iconLoadTimer === null) {
            je._iconLoadTimer = setTimeout(function () {
              jk()
              je._iconLoadTimer = null
            }, jj)
          }
          this.onload = null
        }
        jf.onerror = function () {
          if (!je._iconLoadTimer) {
            je._iconLoadTimer = setTimeout(function () {
              jk()
              je._iconLoadTimer = null
            }, jj)
          }
          je.iconCache[this.id] = null
          this.onerror = null
          bo.fetchDebug &&
            bo.fetchDebug.sendError({
              title: this.iconUrl,
              msg: this.iconUrl,
              category: bo.fetchDebug.category.RESOURCE,
              level: bo.fetchDebug.levels.ERROR,
              url: this.iconUrl,
            })
        }
        jf.src = e
        this.iconCache[ji] = { loaded: false, image: jf }
      }
      return i8
    },
    _addToIconTexture: function (ja) {
      if (!this.map._webglMapScene) {
        return
      }
      var jc = this.map._webglMapScene._painter
      var e = jc._iconTextureAtlas.addTexture(ja)
      jc._iconTextureAtlasOffset[ja.id] = e
      var jf = (0 * ja.width) / 1024 + e.width
      var i9 = (0 * ja.height) / 1024 + e.height
      var je = ja.width / 1024 + e.width
      var i8 = i9
      var jd = je
      var T = ja.height / 1024 + e.height
      var jb = jf
      var i = T
      jc._iconTextureAtlasCoords[ja.id] = [
        jf,
        i9,
        je,
        i8,
        jd,
        T,
        jf,
        i9,
        jd,
        T,
        jb,
        i,
      ]
    },
    loadImgByStr: function (i8, i9, ja) {
      if (!i8 && !i9) {
        ja && ja(null, null)
        return
      }
      if (typeof i8 === 'object' && typeof i9 === 'object') {
        ja(i8, i9)
        return
      }
      var i = 0
      var T = null
      var e = null
      if (i8) {
        i++
        T = new Image()
        T.onload = function () {
          i--
          if (i === 0) {
            ja && ja(this, e)
          }
          this.onload = null
        }
        T.src = i8
      }
      if (i9) {
        i++
        e = new Image()
        e.onload = function () {
          i--
          if (i === 0) {
            ja && ja(T, this)
          }
          this.onload = null
        }
        e.src = i9
      }
    },
    collisionTest: function (jo, ke, jJ) {
      if (this.map.viewAnimationTime) {
        return []
      }
      if (!jo) {
        return []
      }
      var jz = this.map
      var jS = jz.getHeading()
      jS = this.calcLoopHeading(jS)
      var j4 = jz.height
      var jY = this.allLabels
      jY.length = 0
      jo.sort(function (j1, i) {
        var kh = j1.tileInfo
        var j2 = i.tileInfo
        if (kh.col * kh.row < j2.col * j2.row) {
          return -1
        } else {
          return 1
        }
      })
      var jA = jz.getTilt()
      var jq = jz.getZoom()
      var jX
      if (jJ) {
        jX = jJ
      } else {
        jX = this.getZoomStep()
      }
      for (var ka = 0, j5 = jo.length; ka < j5; ka++) {
        var jE = jo[ka]
        var jm = jE.tileInfo
        var jg = jm.zoom
        var jW = jm.loopOffsetX / Math.pow(2, 18 - jg)
        if (!jS && !jA) {
          if (jE.unnecessaryCollisionTest && jE.unnecessaryCollisionTest[jJ]) {
            continue
          }
        }
        var jO = jE.fixedLabel || []
        for (var j8 = 0, jG = jO.length; j8 < jG; j8++) {
          var jj = jO[j8]
          jj.zoom = jg
          if (ke === -1 && jj.isDel) {
            continue
          }
          if (!dM(jj, jm.useZoom, jq)) {
            jj.isDel = true
            continue
          }
          this.calcCollisionBounds(jj, jX, jW, j4)
          jY.push(jj)
        }
        var jM = jE.indoorLabel || []
        for (var j6 = 0, jb = jM.length; j6 < jb; j6++) {
          var jB = jM[j6]
          jB.zoom = jg
          if (ke === -1 && jB.isDel) {
            continue
          }
          if (!dM(jB, jm.useZoom)) {
            jB.isDel = true
            continue
          }
          this.calcCollisionBounds(jB, jX, jW, j4)
          jY.push(jB)
        }
        var jl = jE.lineLabel || []
        for (var kb = 0, ju = jl.length; kb < ju; kb++) {
          var i8 = jl[kb]
          if (ke === -1 && i8.isDel) {
            continue
          }
          if (!dM(i8, jm.useZoom)) {
            i8.isDel = true
            continue
          }
          var kg = i8.pt
          var jI = jz.pointToPixelIn(kg, { zoom: jX, useRound: this._useRound })
          var jF = jI.x + jW
          var jD = j4 - jI.y
          var jL = i8.bds
          var j3 = jL[0]
          var jZ = jL[1]
          var jx = jL[2]
          var jw = jL[3]
          var jT = j3
          var jR = jZ
          var jt = jx
          var js = jw
          if ((jS >= 0 && jS < 45) || (jS >= 315 && jS < 360)) {
            jT = j3
            jR = jZ
            jt = jx
            js = jw
          } else {
            if (jS >= 45 && jS < 135) {
              jT = jZ
              jR = -jx
              jt = jw
              js = -j3
            } else {
              if (jS >= 135 && jS < 225) {
                jT = -jx
                jR = -jw
                jt = -j3
                js = -jZ
              } else {
                if (jS >= 225 && jS < 315) {
                  jT = -jw
                  jR = j3
                  jt = -jZ
                  js = jx
                }
              }
            }
          }
          i8._tempBds = [jF + jT, jD + jR, jF + jt, jD + js]
          var jn = jz.pixelToPointIn(new eL(i8._tempBds[0], jI.y + jR), {
            zoom: jX,
          })
          var ja = jz.pixelToPointIn(new eL(i8._tempBds[2], jI.y + js), {
            zoom: jX,
          })
          i8._mcBds = [jn, ja]
          jY.push(i8)
        }
      }
      var jV = this._strategyInfo
      if (jV) {
        var jr = jV.guid
        var jC = jV.guidExt
        var i9 = false
        for (var jH = 0, jk = jY.length; jH < jk; jH++) {
          var j0 = jY[jH]
          delete j0.tempRank
          if (!this.layer.isClickableLabel(j0) || (jC === 1 && !j0.guidExt)) {
            continue
          }
          if (jr === j0.guid && jV.tilePosStr === j0.tilePosStr) {
            j0.tempRank = this.RANK5
            i9 = true
          }
        }
        if (!i9 && this.currentSelectedLabel) {
          this.currentSelectedLabel.tempRank = this.RANK5
          var jK = this.currentSelectedLabel.tileInfo
          var T = jK.zoom
          var jU = jK.loopOffsetX / Math.pow(2, 18 - T)
          this.calcCollisionBounds(this.currentSelectedLabel, jX, jU, j4)
          jY.push(this.currentSelectedLabel)
        }
      } else {
        for (var jv = 0, ji = jY.length; jv < ji; jv++) {
          var kf = jY[jv]
          if (kf.type === 'line' || !kf.iconPos) {
            continue
          }
          delete kf.tempRank
        }
      }
      jY.sort(function (j2, j1) {
        var kh = j2.tempRank ? j2.tempRank : j2.rank
        var i = j1.tempRank ? j1.tempRank : j1.rank
        return (
          i - kh ||
          j2.startZoom - j1.startZoom ||
          j1.pt.lng - j2.pt.lng ||
          j1.pt.lat - j2.pt.lat
        )
      })
      var jc = 0
      if (jA > 0) {
        jc = 6
      }
      jq = jz.getZoom()
      if (jq >= 8 && jq < 9) {
        jq < 8.5 ? (jc = 6) : (jc = 3)
      }
      if (jz._displayOptions.labelMargin > 0) {
        jc = jz._displayOptions.labelMargin
      }
      var e = 2
      if (jq < 6 && jq >= 5) {
        e = -1
      }
      for (var jh = 0, jf = jY.length; jh < jf; jh++) {
        var jQ = jY[jh]
        var jp = jQ._tempBds
        jQ.isDel = false
        jQ._intersectIdx = []
        for (var j9 = jh + 1; j9 < jf; j9++) {
          var jy = jY[j9]
          var kd = jy._tempBds
          if (
            !(
              jp[2] + jc + e < kd[0] - jc ||
              jp[0] - jc > kd[2] + jc + e ||
              jp[3] + jc + e < kd[1] - jc ||
              jp[1] - jc > kd[3] + jc + e
            )
          ) {
            jQ._intersectIdx.push(j9)
          }
        }
      }
      for (var je = 0, jd = jY.length; je < jd; je++) {
        var kc = jY[je]
        if (kc.isDel === false) {
          var jP = kc._intersectIdx
          for (var j7 = 0, jN = jP.length; j7 < jN; j7++) {
            jY[jP[j7]].isDel = true
          }
        }
      }
      return jo
    },
    calcCollisionBounds: function (je, jc, i, jd) {
      var ja = je.ptFix || je.pt
      var i8 = this.map
      var i9 = i8.pointToPixelIn(ja, { zoom: jc, useRound: this._useRound })
      var T = i9.x + i
      var jg = jd - i9.y
      var e = je.bds
      je._tempBds = [T + e[0], jg + e[1], T + e[2], jg + e[3]]
      var jb = i8.pixelToPointIn(new eL(je._tempBds[0], i9.y + e[1]), {
        zoom: jc,
      })
      var jf = i8.pixelToPointIn(new eL(je._tempBds[2], i9.y + e[3]), {
        zoom: jc,
      })
      je._mcBds = [jb, jf]
    },
    getZoomStep: function () {
      var T = this.map.getZoom()
      var e = Math.floor(T)
      var i = T - e >= 0.5 ? e + 0.5 : e
      return i
    },
    clearCollisionCache: function (e) {
      if (!e) {
        return
      }
      e.cacheState = null
      e.unnecessaryCollisionTest = null
    },
    getCachedLabels: function (e) {
      e = e || []
      var T = this.getZoomStep()
      var ja = false
      for (var i8 = 0; i8 < e.length; i8++) {
        var i9 = e[i8]
        if (!i9.cacheState || !i9.cacheState[T]) {
          ja = true
          break
        }
        if (i9.hasNewData) {
          ja = true
          break
        }
      }
      if (ja) {
        this.calcLabelsCollision(e)
      }
      return e
    },
    calcLabelsCollision: function (T) {
      var i9 = this.getZoomStep()
      var ja = {}
      var jh
      var i8
      var jj
      var jl
      var jk
      var ji
      T = this.collisionTest(T, undefined, i9)
      aN.addLabelIntoAreaSpots(T)
      for (var je = 0; je < T.length; je++) {
        jh = T[je]
        i8 = jh.tileInfo
        jl = i8.col + ',' + i8.row
        ja[jl] = 1
      }
      var e = {}
      for (var jc = 0; jc < T.length; jc++) {
        jh = T[jc]
        if (!jh.cacheState) {
          jh.cacheState = {}
        }
        i8 = jh.tileInfo
        jk = i8.col
        ji = i8.row
        jl = jk + ',' + ji
        if (jh.cacheState[i9] === 'stable') {
          e[jl] = 1
          if (!jh.hasNewData) {
            continue
          }
        }
        for (var jd = 0; jd < jh.fixedLabel.length; jd++) {
          jj = jh.fixedLabel[jd]
          if (!jj.cachedIsDel) {
            jj.cachedIsDel = {}
          }
          jj.cachedIsDel[i9] = jj.isDel
        }
        for (var jg = 0; jg < jh.indoorLabel.length; jg++) {
          jj = jh.indoorLabel[jg]
          if (!jj.cachedIsDel) {
            jj.cachedIsDel = {}
          }
          jj.cachedIsDel[i9] = jj.isDel
        }
        for (var jf = 0; jf < jh.lineLabel.length; jf++) {
          jj = jh.lineLabel[jf]
          if (!jj.cachedIsDel) {
            jj.cachedIsDel = {}
          }
          jj.cachedIsDel[i9] = jj.isDel
        }
        if (
          ja[jk - 1 + ',' + (ji - 1)] &&
          ja[jk - 1 + ',' + ji] &&
          ja[jk - 1 + ',' + (ji + 1)] &&
          ja[jk + ',' + (ji - 1)] &&
          ja[jk + ',' + (ji + 1)] &&
          ja[jk + 1 + ',' + (ji - 1)] &&
          ja[jk + 1 + ',' + ji] &&
          ja[jk + 1 + ',' + (ji + 1)]
        ) {
          jh.cacheState[i9] = 'stable'
          e[jl] = 1
        } else {
          if (!jh.cacheState[i9]) {
            jh.cacheState[i9] = 'unstable'
          }
        }
      }
      for (var jb = 0; jb < T.length; jb++) {
        jh = T[jb]
        i8 = jh.tileInfo
        jl = i8.col + ',' + i8.row
        jk = +i8.col
        ji = +i8.row
        if (
          e[jk - 1 + ',' + (ji - 1)] &&
          e[jk - 1 + ',' + ji] &&
          e[jk - 1 + ',' + (ji + 1)] &&
          e[jk + ',' + (ji - 1)] &&
          e[jk + ',' + (ji + 1)] &&
          e[jk + 1 + ',' + (ji - 1)] &&
          e[jk + 1 + ',' + ji] &&
          e[jk + 1 + ',' + (ji + 1)]
        ) {
          if (!jh.unnecessaryCollisionTest) {
            jh.unnecessaryCollisionTest = {}
          }
          jh.unnecessaryCollisionTest[i9] = 1
        }
      }
      T.hasNewData = false
    },
    updateLabels: function (i9) {
      var T = this.map
      var jf = T.getZoom()
      var jh = T.getHeading()
      jh = this.calcLoopHeading(jh)
      var jg = T.getTilt()
      var ja = this.getZoomStep()
      for (var je = 0, jb = i9.length; je < jb; je++) {
        var jd = i9[je]
        var i8 = jd.tileInfo
        var jc = i8.loopOffsetX || 0
        var e = { zoom: jf, mcOffsetX: jc }
        this.updateFixedLabel(jd.fixedLabel, jg, jh, jd, ja, e)
        e = { zoom: jf, mcOffsetX: 0 }
        this.updateFixedLabel(jd.indoorLabel, jg, jh, jd, ja, e)
        this.updateLineLabel(jd.lineLabel, jg, jh, jd, ja)
      }
    },
    updateFixedLabel: function (jd, jg, i, jj, i9, je) {
      if (jd.length === 1) {
      }
      var e = je.zoom
      var i8 = je.mcOffsetX
      var jo
      for (var jk = 0, jb = jd.length; jk < jb; jk++) {
        var jf = jd[jk]
        if (!jf.cachedIsDel) {
          continue
        }
        if (!jg && !i && jj.cacheState && jj.cacheState[i9]) {
          jf.isDel = jf.cachedIsDel[i9]
          if (typeof jf.isDel === 'undefined') {
            jf.isDel = jf.cachedIsDel[i9] = true
          }
        }
        if (jf.startScale > e) {
          jf.isDel = true
        }
        if (jf.isDel) {
          continue
        }
        var jm = jf.pt
        var T = jf.iconPos
        if (T && T.texcoord) {
          if (!T.rtVertex) {
            T.rtVertex = []
            jo = T.vertex
            var jc = hO(jm.lng)
            var jl = hO(jm.lat)
            T.rtVertex = [
              jc[0],
              jl[0],
              jc[1],
              jl[1],
              0,
              jo[0],
              jo[1],
              0,
              0,
              T.texcoord[0],
              T.texcoord[1],
              jc[0],
              jl[0],
              jc[1],
              jl[1],
              0,
              jo[2],
              jo[3],
              0,
              0,
              T.texcoord[2],
              T.texcoord[3],
              jc[0],
              jl[0],
              jc[1],
              jl[1],
              0,
              jo[4],
              jo[5],
              0,
              0,
              T.texcoord[4],
              T.texcoord[5],
              jc[0],
              jl[0],
              jc[1],
              jl[1],
              0,
              jo[6],
              jo[7],
              0,
              0,
              T.texcoord[6],
              T.texcoord[7],
              jc[0],
              jl[0],
              jc[1],
              jl[1],
              0,
              jo[8],
              jo[9],
              0,
              0,
              T.texcoord[8],
              T.texcoord[9],
              jc[0],
              jl[0],
              jc[1],
              jl[1],
              0,
              jo[10],
              jo[11],
              0,
              0,
              T.texcoord[10],
              T.texcoord[11],
            ]
          }
        }
        var jn = jf.textPos
        if (jn) {
          if (!jn.rtVertex) {
            jn.rtVertex = []
            jo = jn.vertex
            var ja = jn.rtVertex
            var ji = hO(jm.lng)
            var jr = hO(jm.lat)
            var jq = hO(i8)
            for (var jh = 0, jp = jo.length; jh < jp; jh += 12) {
              ja.push(
                ji[0],
                jr[0],
                ji[1],
                jr[1],
                0,
                jo[jh],
                jo[jh + 1],
                jq[0],
                jq[1],
                jn.texcoord[0],
                jn.texcoord[1]
              )
              ja.push(
                ji[0],
                jr[0],
                ji[1],
                jr[1],
                0,
                jo[jh + 2],
                jo[jh + 3],
                jq[0],
                jq[1],
                jn.texcoord[2],
                jn.texcoord[3]
              )
              ja.push(
                ji[0],
                jr[0],
                ji[1],
                jr[1],
                0,
                jo[jh + 4],
                jo[jh + 5],
                jq[0],
                jq[1],
                jn.texcoord[4],
                jn.texcoord[5]
              )
              ja.push(
                ji[0],
                jr[0],
                ji[1],
                jr[1],
                0,
                jo[jh + 6],
                jo[jh + 7],
                jq[0],
                jq[1],
                jn.texcoord[6],
                jn.texcoord[7]
              )
              ja.push(
                ji[0],
                jr[0],
                ji[1],
                jr[1],
                0,
                jo[jh + 8],
                jo[jh + 9],
                jq[0],
                jq[1],
                jn.texcoord[8],
                jn.texcoord[9]
              )
              ja.push(
                ji[0],
                jr[0],
                ji[1],
                jr[1],
                0,
                jo[jh + 10],
                jo[jh + 11],
                jq[0],
                jq[1],
                jn.texcoord[10],
                jn.texcoord[11]
              )
            }
          }
        }
      }
    },
    updateLineLabel: function (jd, jG, jw, jr, js) {
      jd = jd || []
      var jm = this.map
      var jg = jm.getZoomUnits()
      for (var jF = 0, jD = jd.length; jF < jD; jF++) {
        var jc = jd[jF]
        if (!jc.cachedIsDel) {
          continue
        }
        if (!jG && !jw && jr.cacheState && jr.cacheState[js]) {
          jc.isDel = jc.cachedIsDel[js]
          if (typeof jc.isDel === 'undefined') {
            jc.isDel = jc.cachedIsDel[js] = true
          }
        }
        if (jc.isDel) {
          continue
        }
        if (!jc.styleText || jc.styleText.length === 0) {
          continue
        }
        var je = jc.mcInTile
        var jz = je.x
        var jx = je.y
        var jq = jc.wordsInfo
        var jo = jc.labelAngle
        var jk = false
        var jy = 0
        if (jw !== 0) {
          var jl = jq[0].angle
          var jC = this.calcLoopHeading(jl - jw)
          if (jC > 45 && jC < 315) {
            if (jC > 45 && jC <= 135) {
              jy = 270
            } else {
              if (jC > 135 && jC <= 225) {
                jy = 180
              } else {
                if (jC > 225 && jC < 315) {
                  jy = 90
                }
              }
            }
            if (jo > 225 && jo <= 315 && jy <= 180) {
              jk = true
            } else {
              if (
                ((jo >= 0 && jo <= 45) || (jo >= 315 && jo < 360)) &&
                jy >= 180
              ) {
                jk = true
              }
            }
          }
        }
        for (var jE = 0, jh = jq.length; jE < jh; jE++) {
          var jB = jq[jE]
          var jj = jB.calcInfo
          var jv = jB.offset[0]
          var jt = jB.offset[1]
          if (!jB.size) {
            continue
          }
          var e = jB.size[0]
          var T = jB.size[1]
          var ji = jB.angle
          if (!jj) {
            jj = {}
          }
          if (jw !== jj.mapHeading || jg !== jj.zoomUnits) {
            jj.mapHeading = jw
            jj.zoomUnits = jg
            if (jk) {
              var jn = jq[jh - 1 - jE]
              jv = jn.offset[0]
              jt = jn.offset[1]
              ji = jn.angle
            }
            var i9 = jz + jv * jg
            var i8 = jx + jt * jg
            jj.rotationCenter = { lng: i9, lat: i8 }
            jj.calcHeading = jy
            jj.angle = ji
            jj.offsetX = jv
            jj.offsetY = jt
            jB.calcInfo = jj
          }
          if (!jB.rtVertex) {
            jB.rtVertex = []
          }
          jB.rtVertex.length = 0
          var jp = jj.calcHeading + jj.angle
          var ja = jj.rotationCenter
          jv = jj.offsetX
          jt = jj.offsetY
          var jb = Math.round(jv - e / 2)
          var jA = Math.round(jv + e / 2)
          var ju = Math.round(jt + T / 2)
          var jf = Math.round(jt - T / 2)
          jB.rtVertex.push(
            jz,
            jx,
            jB.z,
            jb,
            jf,
            ja.lng,
            ja.lat,
            jp,
            jB.texcoord[0],
            jB.texcoord[1],
            jz,
            jx,
            jB.z,
            jA,
            jf,
            ja.lng,
            ja.lat,
            jp,
            jB.texcoord[2],
            jB.texcoord[3],
            jz,
            jx,
            jB.z,
            jA,
            ju,
            ja.lng,
            ja.lat,
            jp,
            jB.texcoord[4],
            jB.texcoord[5],
            jz,
            jx,
            jB.z,
            jb,
            jf,
            ja.lng,
            ja.lat,
            jp,
            jB.texcoord[6],
            jB.texcoord[7],
            jz,
            jx,
            jB.z,
            jA,
            ju,
            ja.lng,
            ja.lat,
            jp,
            jB.texcoord[8],
            jB.texcoord[9],
            jz,
            jx,
            jB.z,
            jb,
            ju,
            ja.lng,
            ja.lat,
            jp,
            jB.texcoord[10],
            jB.texcoord[11]
          )
        }
      }
    },
    calcLoopHeading: function (e) {
      while (e >= 360) {
        e -= 360
      }
      while (e < 0) {
        e += 360
      }
      return e
    },
    fixDataFormat: function (jg) {
      var i8 = this.fixedLabelData
      var e = this.lineLabelData
      var T = this.highlightLabelData
      var jo = 0
      var jc = 0
      var jl = 0
      var jm
      if (this.currentSelectedLabel) {
        var jb = this.getLabelByUid(
          this.currentSelectedLabel.guid,
          this.currentSelectedLabel.tilePosStr
        )
        if (!jb || jb.isDel) {
          i8[jo] = this.currentSelectedLabel.formatedData
          jo++
          T[jl] = this.currentSelectedLabel.formatedData
          jl++
        }
      }
      for (var jk = 0; jk < jg.length; jk++) {
        var je = jg[jk]
        var jd = je.fixedLabel
        var i9 = je.indoorLabel
        var jj = je.lineLabel
        var jn = { highlightLabelData: T, highlightLabelDataLen: jl }
        jm = this.fixFixedLabelDataFormat(jd, je, i8, jo, jn)
        jo = jm[0]
        jl = jm[1]
        jm = this.fixFixedLabelDataFormat(i9, je, i8, jo, jn, true)
        jo = jm[0]
        jl = jm[1]
        e[jc] = { tileInfo: je.tileInfo, lineLabels: [] }
        for (var ji = 0; ji < jj.length; ji++) {
          if (jj[ji].isDel) {
            continue
          }
          var jf = jj[ji].wordsInfo
          if (jf) {
            for (var jh = 0; jh < jf.length; jh++) {
              if (!jf[jh].rtVertex) {
                continue
              }
              var ja = jf[jh].formatedData
              if (!ja) {
                ja = {
                  textureSource: je.textureSources[jj[ji].processedInZoom],
                  textureHeight: je.textureHeights[jj[ji].processedInZoom],
                  renderData: {
                    vertex: jf[jh].rtVertex,
                    textureCoord: jf[jh].texcoord,
                  },
                }
                jf[jh].formatedData = ja
              }
              e[jc].lineLabels.push(ja)
            }
          }
        }
        jc++
      }
      i8.length = jo
      e.length = jc
      T.length = jl
      return [e, i8, T]
    },
    fixFixedLabelDataFormat: function (jc, jf, jg, jd, T, je) {
      var ja = T.highlightLabelData
      var e = T.highlightLabelDataLen
      for (var i = 0; i < jc.length; i++) {
        if (jc[i].isDel) {
          continue
        }
        var jb = jc[i].textPos
        var i9 = jc[i].iconPos
        var i8 = null
        if (jb && jb.rtVertex) {
          if (!jc[i].formatedData) {
            i8 = {
              guid: jc[i].guid,
              guidExt: jc[i].guidExt,
              tilePosStr: jc[i].tilePosStr,
              zoom: jc[i].zoom,
              tempRank: jc[i].tempRank,
              textureSource: jf.textureSources[jc[i].processedInZoom],
              textureHeight: jf.textureHeights[jc[i].processedInZoom],
              renderData: { vertex: jb.rtVertex, textureCoord: jb.texcoord },
            }
            if (je && jc[i].onDefaultFloor === false) {
              i8.textureSource = jf.indoorTextureSources[jc[i].processedInZoom]
              i8.textureHeight = jf.indoorTextureHeights[jc[i].processedInZoom]
            }
            jc[i].formatedData = i8
          } else {
            i8 = jc[i].formatedData
            i8.tempRank = jc[i].tempRank
          }
          if (
            this.currentSelectedLabel &&
            i8.guid === this.currentSelectedLabel.guid &&
            i8.tilePosStr === this.currentSelectedLabel.tilePosStr
          ) {
            ja[e] = i8
            e++
          }
        }
        if (i9 && i9.rtVertex) {
          if (i8) {
            if (!i8.iconRenderData) {
              i8.iconRenderData = {
                vertex: i9.rtVertex,
                textureCoord: i9.texcoord,
              }
            }
          } else {
            i8 = {
              guid: jc[i].guid,
              guidExt: jc[i].guidExt,
              zoom: jc[i].zoom,
              tempRank: jc[i].tempRank,
              iconRenderData: {
                vertex: i9.rtVertex,
                textureCoord: i9.texcoord,
              },
            }
            jc[i].formatedData = i8
          }
        }
        jg[jd] = i8
        jd++
      }
      return [jd, e]
    },
    _refreshSpotData: function () {
      this._spotData.length = 0
      var jd = this.map
      var jb = Math.floor(jd.getZoom())
      var T = this.map._featureMgr.getLabelData()
      if (T) {
        for (var i9 = 0, i8 = T.length; i9 < i8; i9++) {
          this._addFixedSpotData(T[i9].fixedLabel, jb)
          this._addFixedSpotData(T[i9].indoorLabel, jb)
        }
      }
      var je = this.currentSelectedLabel
      if (je && !this.getTileByLabelUid(je.guid, je.tilePosStr)) {
        var ja = this._getSpotDataFromLabel(this.currentSelectedLabel)
        if (ja) {
          this._spotData.push(ja)
        }
      }
      var jc = new e7('onspotsdataready')
      jc.spots = this._spotData
      jd._spotDataOnCanvas = this._spotData
      jd.dispatchEvent(jc)
    },
    _addFixedSpotData: function (i9, i8) {
      for (var e = 0; e < i9.length; e++) {
        var T = i9[e]
        if (
          !this.layer.isClickableLabel(T) ||
          (T.guidExt === 1 && T.startScale > i8)
        ) {
          continue
        }
        var i = i9[e].spot || this._getSpotDataFromLabel(i9[e])
        if (i) {
          this._spotData.push(i)
        }
      }
    },
    _getSpotDataFromLabel: function (T) {
      var ja = this.map
      if (!T.bds) {
        return null
      }
      var e = T.bds.slice(0)
      var i8 = null
      if (T.iconPos) {
        i8 = new cd(T.pt.lng, T.pt.lat)
      }
      var i = T.name ? T.name.replace('\\\\', '<br>') : ''
      if (
        T.iconPos &&
        T.iconPos.iconType.indexOf('ditie') > -1 &&
        ja.getZoom() > 14
      ) {
        i = ''
      }
      var i9 = {
        n: i,
        pt: new cd(T.pt.lng, T.pt.lat),
        userdata: {
          iconPoint: i8,
          uid: T.guid,
          name: i,
          mapPoi: true,
          type: T.iconPos ? T.iconPos.iconType : '',
          rank: T.rank,
          zoom: T.zoom,
          tilePosStr: T.tilePosStr,
        },
        bd: e,
        tag: 'MAP_SPOT_INFO',
      }
      T.spot = i9
      return i9
    },
    drawLabelsOnCanvas: function (i, e) {
      if (this._labelTextCanvas) {
        this._labelTextCanvas.drawLabelsOnCanvas(i, e)
      }
    },
  })
  function h6(e) {
    this._map = e
    this.virtualTile = {
      custom: true,
      label: {
        fixedLabel: [],
        indoorLabel: [],
        lineLabel: [],
        textureHeights: [],
        status: 'ready',
      },
      tileInfo: { col: 0, row: 0, zoom: 0, useZoom: 0, loopOffsetX: 0 },
      status: 'ready',
    }
    this.virtualTile.label.tileInfo = this.virtualTile.tileInfo
    this.init()
  }
  h6.prototype.init = function () {
    var T = this._map
    var i = this
    function e() {
      i.updateLabels()
    }
    T.addEventListener('add_tile_labels', e)
    T.addEventListener('onremove_tile_labels', e)
    T.addEventListener('onclear_labels', e)
  }
  h6.prototype.updateLabels = function () {
    var i = this._map.tileMgr.getLabelTextCanvas()
    var T = this._map
    var e = this
    i.drawCustomLabelsOnCanvas(T._customTileLabels, function (i9) {
      var i8 = e.virtualTile
      if (i9) {
        i8.label.textureHeights[0] = [i9.height]
      }
      i8.label.fixedLabel = T._customTileLabels
      var ja = new e7('oncustom_labels_ready')
      ja.virtualTile = i8
      ja.labelCanvas = i9
      ja.imgKey = bo.getGUID('custom_labels_')
      T.dispatchEvent(ja)
    })
  }
  bo.register(function (e) {
    e._customLabelMgr = new h6(e)
  })
  var fs = (function (jp, jo) {
    var jn = {
      '\x65\x61\x65\x78\x63': function (jq, jr) {
        return jq < jr
      },
      '\x69\x65\x61\x69\x65': function (jr, jq) {
        return jr + jq
      },
      '\x65\x61\x6c\x78\x6c': '\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72',
      '\x6d\x61\x65\x78\x64': function (jr, jq) {
        return jr(jq)
      },
      '\x61\x6c\x68\x78\x65': function (js, jr, jq) {
        return js(jr, jq)
      },
      '\x65\x6d\x63\x63\x6c': '\x31\x2e\x31\x2e\x32',
      '\x69\x64\x61\x61\x68': '\x43\x68\x61\x72',
      '\x61\x64\x69\x65\x6c': function (jr, jq) {
        return jr + jq
      },
    }
    var jj = jn['\x65\x6d\x63\x63\x6c']
    function jh(jq, jv) {
      var ju = jq['\x6c\x65\x6e\x67\x74\x68']
      var jt = []
      for (var js = 0; jn['\x65\x61\x65\x78\x63'](js, ju); js++) {
        var jr = jv(jq[js])
        jt['\x70\x75\x73\x68'](jr)
      }
      return jt
    }
    var jm,
      jl,
      jk,
      ji,
      jg,
      jf = decodeURIComponent,
      je = jn['\x69\x64\x61\x61\x68'],
      jd = ''
    var jc = [fs]
    jm = '\x64\x65'
    jl = '\x66\x72'
    jk = '\x6f'
    jg = jn['\x61\x64\x69\x65\x6c'](jl, jk) + '\x6d'
    ji = jn['\x61\x64\x69\x65\x6c']('\x43\x6f', jm)
    var jb = function (jq) {
      return jn['\x69\x65\x61\x69\x65'](jq, jd)[jn['\x65\x61\x6c\x78\x6c']][
        jg + je + ji
      ](jq)
    }
    var ja = function (jq) {
      return jn['\x61\x6c\x68\x78\x65'](jh, jq, function (jr) {
        return jn['\x6d\x61\x65\x78\x64'](jb, jr)
      })
    }
    var i9 = ja['\x63\x61\x6c\x6c'](
      jb,
      [
        39, 34, 37, 96, 60, 120, 97, 65, 98, 66, 99, 67, 100, 68, 101, 69, 102,
        70, 103, 110, 109, 111, 112, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57,
      ]
    )
    var i8 = jh([28782, 27702, 26416, 25167, 24183], function (jq) {
      return jn['\x6d\x61\x65\x78\x64'](jf, jq)
    })
    var T = ja['\x63\x61\x6c\x6c'](
        i8,
        [
          22354, 22749, 24415, 23346, 22257, 22688, 24306, 25174, 23595, 25547,
          22984, 25690, 22212, 27547, 21594, 27210, 23090, 29193, 22394, 29368,
          29532, 29459, 29530, 24146, 24500, 26352, 27441, 28788, 29370, 27673,
          26925, 25249, 24430,
        ]
      ),
      i = {}
    i8 = jn['\x6d\x61\x65\x78\x64'](ja, i8)
    var e = new RegExp(i8['\x6a\x6f\x69\x6e']('\x7c'))
    for (var jm = 0; jm < i9['\x6c\x65\x6e\x67\x74\x68']; jm++) {
      i[T[jm]] = i9[jm]
    }
    jo = jh(jo['\x73\x70\x6c\x69\x74'](jd), function (jq) {
      return i[jq] || jq
    })['\x6a\x6f\x69\x6e'](jd)
    return jh(jo['\x73\x70\x6c\x69\x74'](e), function (jq) {
      return jn['\x6d\x61\x65\x78\x64'](jf, jq)
    })
  })(
    this,
    '\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\u645a\x75\x73\x74\u7313\u735c\x53\x74\x79\x6c\u545a\x49\u72b8\u5a32\u7313\x5a\u7313\u7313\u735c\u6730\u59c8\u5ef2\u72b8\x55\x73\u545a\x57\u545a\u5c2b\u6256\x73\x73\u545a\u735c\u5c2b\x6c\x79\u706e\u545a\x68\u58a0\u6c36\u59c8\u545a\x69\u735c\u59c8\u706e\u5ef2\u545a\x68\u545a\u5ef2\u706e\u59c8\u5ef2\u59c8\u5ef2\u5ef2\u706e\x69\u56c4\u59c8\u5ef2\u56c4\u624f\x68\u56c4\u56c4\u5e77\x6c\u59c8\x68\x6c\x69\u6730\x6c\x69\u58a0\u6730\u56c4\u735c\x69\x6c\u545a\u6730\u5ef2\u735c\u5ef2\x69\u545a\u6c36\x6c\u545a\u72b8\u577a\x74\x68\u706e\u58a0\x69\u56c4\u56c4\x69\u6c36\u58a0\x6c\u545a\u6c36\x6c\x68\u735c\u6730\u545a\u58a0\u58a0\u735c\x6c\u706e\x68\u545a\u56c4\u735c\u545a\u6c36\x68\u58a0\u58a0\u6c36\u5ef2\x68\u56c4\u58a0\u58a0\u5e77\u7313\u72b8\u735c\u545a\x73\x73\u5ef2\u577a\u545a\u6730\x5f\u59c8\u5c2b\x6b\u6730\u56c4\x6c\x68\u624f\u5ef2\u56c4\x68\u6730\u56c4\u5ef2\x74\u5ef2\u706e\u56c4\x68\x69\u5ef2\u5ef2\u706e\u545a\u545a\u545a\x6c\u5ef2\u706e\x5f\u735a\u5ef2\x72\x73\x69\u72b8\u577a\x54\x69\x6c\u545a\x4b\u545a\x79\u706e\u56c4\u5ef2\x69\u56c4\x69\u706e\u58a0\x69\u5ef2\u6730\u545a\u545a\u5ef2\u706e\u5ef2\x69\u5ef2\u6c36\x73\u7313\x75\x72\u59c8\u545a\u624f\x77\u7313\x72\x6b\u545a\x72\u735c\u577a\x72\u706e\u5ef2\u58a0\x69\u706e\x73\x68\x69\u5a32\x74\u5e77\u545a\u5ef2\x6c\u59c8\u735c\u6c36\u58a0\u5ef2\u56c4\u624f\u545a\x68\u545a\u6c36\x6c\u7313\u5ef2\u56c4\x54\x69\x6c\u545a\u6b9b\u5ef2\x74\u5ef2\u6c36\x75\x72\x6c\u624f\x74\x69\x6c\u545a\x49\u72b8\u5a32\u7313\u6c36\x74\x69\x6c\u545a\x4b\u545a\x79\u6730\x68\u5ef2\u5ef2\u735c\u735c\u6c36\x5f\x69\x73\u63cb\x75\x73\x79\u6730\u735c\u5ef2\u735c\u735c\u59c8\u624f\u7313\u72b8\x72\u545a\u5a32\x72\u545a\x73\x68\u6c36\u5ef2\u5ef2\x68\u545a\u735c\u624f\u545a\x69\u59c8\x69\u545a\u6730\x6c\u545a\u5ef2\u735c\u5ef2\u6c36\u59c8\u56c4\x69\x6c\x69\u6c36\u5ef2\u59c8\u545a\x69\u545a\u624f\u5ef2\u545a\u5ef2\u5ef2\u5ef2\u6c36\u5ef2\x6c\u5ef2\u5ef2\x68\u6730\x73\x74\x79\x6c\u545a\u624f\u545a\u56c4\u5ef2\u706e\x68\u545a\u5ef2\u735c\x69\u624f\x69\x73\x53\u545a\u72b8\u56c4\u7209\x53\u5e77\x6c\u735c\u5ef2\u624f\u735c\x69\x69\u56c4\u545a\u6730\u56c4\u56c4\u5ef2\x68\u5ef2\u624f\x6c\u5ef2\x6c\x69\u58a0\u6c36\x6c\x69\u545a\u5e77\u735c\x6c\u56c4\u545a\u5ef2\u6730\u545a\u59c8\u5ef2\u706e\x6c\u5ef2\x69\u735c\u735c\u6c36\u5ef2\u58a0\x6c\u735c\u59c8\u6c36\x74\u545a\x72\u735c\x69\u72b8\u5ef2\x74\u545a\u6c36\u5ef2\x69\u735c\u6730\u5ef2\u735c\u5ef2\u6730\x68\u5ef2\u5ef2\u706e\x69\u5ef2\u56c4\u5ef2\u59c8\u706e\x6c\u545a\u59c8\u5ef2\u735c\u6c36\u735c\u56c4\u5ef2\x69\u5e77\u5ef2\u58a0\u545a\x69\u56c4\u6730\u5ef2\x68\u59c8\u58a0\u545a\u6730\x69\u56c4\x5f\u5e77\x69\u58a0\x68\u5ef2\u5ef2\u624f\u56c4\u5ef2\u59c8\u58a0\u545a\u6c36\x74\x69\x6c\u545a\x54\x79\u735a\u545a\x4e\u5ef2\u735c\u545a\u706e\u5ef2\u5ef2\x6c\x68\u56c4\u5e77\u59c8\u7313\x6c\u624f\x72\u7313\x77\u706e\x73\u735a\x6c\x69\u59c8\u545a\u5e77\u735a\x75\x73\x68\u6730\x68\u735c\u545a\u6c36\u735c\u59c8\u545a\u5e77\u59c8\u58a0\u735c\u706e\u545a\u5ef2\u735c\u6730\x69\x69\u545a\u624f\x6c\u58a0\x68\u5e77\u59c8\u59c8\u58a0\u6c36\u58a0\x69\x68\u624f\u59c8\u58a0\u5ef2\u6730\x6c\u735c\u545a\u706e\x68\x68\x68\u5e77\u5ef2\x6c\u545a\u6c36\u56c4\u58a0\u58a0\u5e77\u7209\u545a\u5ef2\x74\x75\x72\u545a\x53\x74\x79\x6c\u545a\u706e\u5ef2\u58a0\u58a0\u706e\x69\x69\x69\u706e\x69\u545a\u58a0\u6c36\u59c8\x75\x73\x74\u7313\u735c\x53\x74\x79\x6c\u545a\x49\u72b8\u5a32\u7313\x5f\u6730\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\x49\u59c8\u7313\u72b8\x53\u545a\x74\x49\u72b8\u5a32\u7313\u706e\x69\u59c8\u7313\u72b8\x53\u545a\x74\x49\u72b8\u5a32\u7313\u5e77\u59c8\x69\u56c4\u5e77\u545a\x6c\u5ef2\u6c36\u5ef2\u545a\u545a\u6c36\u735c\u5ef2\u735c\u706e\u5ef2\u5ef2\x6c\u5e77\x69\u56c4\u5ef2\u6c36\u545a\x6c\x6c\u624f\u577a\u545a\x74\x49\u56c4\x6c\u545a\x57\u7313\x72\x6b\u545a\x72\u624f\x5f\u56c4\x69\x73\u735a\x6c\u5ef2\x79\x4f\u735a\x74\x69\u7313\u72b8\x73\u5e77\u735a\u7313\x69\u6c36\u735a\u7313\x69\x54\u545a\u58a0\x74\u5e77\u545a\u5ef2\u5ef2\x69\x68\u624f\u5ef2\u545a\x68\x69\u6c36\u59c8\x6c\u58a0\u58a0\x69\u5e77\x69\u5ef2\u59c8\u735c\u5ef2\u706e\x6c\u735c\u5ef2\x6c\u735c\u6730\x6c\u56c4\u735c\u545a\x69\u6730\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\x49\u72b8\u56c4\u7313\u7313\x72\x53\x74\x79\x6c\u545a\u706e\u56c4\u545a\u5ef2\u59c8\x69\u6730\u545a\u59c8\u58a0\u735c\u58a0\u6730\u5ef2\u545a\u545a\x68\u59c8\u706e\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x79\u5e77\x69\u72b8\u56c4\u7313\u7313\x72\x53\x74\x79\x6c\u545a\u6730\u5ef2\u58a0\u58a0\u545a\u56c4\u706e\u59c8\u5ef2\u56c4\u59c8\u735c\u6730\u58a0\x6c\u58a0\u5ef2\u58a0\u706e\u56c4\x69\x68\u5ef2\x69\u6730\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\u7209\u545a\u5ef2\x74\x75\x72\u545a\x53\x74\x79\x6c\u545a\u5e77\u5ef2\x68\x69\u5ef2\x6c\u624f\u59c8\u545a\u5ef2\u545a\u545a\u5e77\u59c8\x68\x6c\u5ef2\x69\u706e\u735c\x68\u545a\u5ef2\x69\u624f\u735c\u545a\u5ef2\u56c4\u5ef2\u6730\u5ef2\x69\u545a\u6730\u59c8\u545a\u56c4\u545a\x69\u706e\x69\x69\u545a\x6c\u5ef2\u6c36\u5ef2\u5ef2\x68\u5ef2\u545a\u624f\u59c8\x75\x73\x74\u7313\u735c\x4d\u5ef2\u735a\x53\x74\x79\x6c\u545a\u706e\x68\u5ef2\u5ef2\u735c\u5ef2\u706e\u5ef2\u5ef2\u5ef2\u545a\u735c\u5e77\u59c8\u545a\x69\u59c8\u545a\u5e77\u5ef2\u58a0\u545a\u545a\x6c\u6c36\u59c8\x69\u545a\u545a\u545a\u706e\x68\u545a\u56c4\u59c8\u5ef2\u5e77\x69\u72b8\u56c4\u545a\u58a0\x4f\u5a32\u706e\u59c8\x75\x73\x74\u7313\u735c\u5e77\u5ef2\x68\u56c4\u5ef2\x6c\u624f\u58a0\u545a\u59c8\x6c\x68\u5e77\u56c4\u5ef2\x69\u58a0\x69\u706e\u735c\u5ef2\u735a\x53\x74\x79\x6c\u545a\x49\u56c4\u706e\u735a\u7313\x73\x74\x4d\u545a\x73\x73\u5ef2\u577a\u545a\u6730\u545a\x68\u545a\u5ef2\u545a\u6730\u545a\x6c\u56c4\u58a0\u5ef2\u6730\u59c8\x69\u5ef2\x68\u545a\u706e\u59c8\u58a0\u5ef2\u735c\x68\u706e\u645a\x75\x73\x74\u7313\u735c\u5e77\x5f\u735a\u5ef2\x72\x73\x69\u72b8\u577a\x54\x69\x6c\u545a\x49\u72b8\u5a32\u7313\u6730\x68\x6c\u5ef2\u6c36\u545a\u58a0\x6c\u5ef2\u735c\u624f\u5ef2\u59c8\u735c\u5ef2\u545a\u6c36\x6c\u545a\u5ef2\u59c8\x68\u5e77\u545a\u58a0\x74\u545a\u72b8\u56c4\u6c36\u735c\u56c4\u5ef2\u6c36\x68\u59c8\u735c\u6730\x6c\u735c\x69\x6c\u545a\u6730\u735c\u735c\x69\x68\u624f\u545a\u735c\u56c4\u59c8\u56c4\u5e77\x69\u72b8\x4d\u5ef2\u735a\x48\u7313\x73\x74\u5e77\u735a\x72\u545a\x76\u545a\u72b8\x74\u6b9b\u545a\u5a32\u5ef2\x75\x6c\x74\u5e77\u545a\u5ef2\u545a\x68\x68\u624f\u5ef2\x68\x6c\x68\u56c4\u6730\u735c\u735c\x68\u545a\u706e\u5ef2\u545a\u5ef2\u5e77\u5ef2\u58a0\u735c\u6c36\x69\u735c\u735a\u7313\x72\x74\x53\u59c8\x72\x69\u735a\x74\x73\x28\u5f5f\u66f0\u66f0\u5e77\u5f5f\u66f0\u66f0\x29\u5f5f\u6b31\u63cb\u5e77\u5ef2\u735a\u735a\x6c\x69\u59c8\u5ef2\x74\x69\u7313\u72b8\u5f5f\u66f0\u7209\x6a\u5ef2\x76\u5ef2\x73\u59c8\x72\x69\u735a\x74\u6730\u56c4\u735c\x6c\u706e\u545a\x6c\x6c\u735c\u6730\u545a\u58a0\x69\u6730\u735c\x6c\u58a0\u706e\u5ef2\u58a0\u5ef2\u6c36\u56c4\x68\u56c4\u6730\u5ef2\u545a\u59c8\u58a0\u545a\u706e\u545a\x6c\u545a\u5ef2\u5ef2\u6730\u545a\u735c\u56c4\u5ef2\u59c8\u706e\x68\u545a\u56c4\u58a0\x69\u706e\u545a\u56c4\x68\u6730\x68\u5ef2\u56c4\u56c4\u6730\x68\u545a\u58a0\u5ef2\u58a0\u5e77\u59c8\u5ef2\x6c\u735c\x68\u624f\u545a\u58a0\u5ef2\u735c\u5ef2\u6730\x69\u545a\x69\x6c\x6c\u706e\u56c4\x68\u545a\x6c\u735c\u5e77\x6c\u5ef2\u59c8\x6c\x68\u706e\x68\u735c\u56c4\u545a\u58a0\u5e77\u5ef2\u735a\u735a\u545a\u72b8\u56c4\u6730\u577a\u545a\x74\u63cb\x6c\u7313\u5c2b\u5e77\u63cb\x6c\u7313\u5c2b\u63cb\x75\x69\x6c\u56c4\u545a\x72\u706e\x57\u545a\u5c2b\x4b\x69\x74\u63cb\x6c\u7313\u5c2b\u63cb\x75\x69\x6c\u56c4\u545a\x72\u624f\x4d\u7313\x7a\u63cb\x6c\u7313\u5c2b\u63cb\x75\x69\x6c\u56c4\u545a\x72\u6c36\u5ef2\x6c\u5ef2\u5e77\u735c\u58a0\x6c\u624f\u59c8\x72\u545a\u5ef2\x74\u545a\x4f\u5c2b\x6a\u545a\u59c8\x74\x55\x52\x4c\u6730\u5ef2\x68\u545a\u545a\u5ef2\u5e77\x77\u545a\u5c2b\x6b\x69\x74\x55\x52\x4c\u706e\u545a\u56c4\x6c\u5e77\x69\u545a\u545a\u5ef2\u5ef2\u6730\u58a0\x68\u545a\u624f\x6c\u545a\x6c\u735c\u6730\x69\u735c\u5ef2\u5e77\u735c\x6c\x69\u706e\u545a\x68\u5ef2\u5ef2\u5e77\u56c4\x68\x6c\u624f\u59c8\u545a\x68\u624f\u5ef2\u59c8\u58a0\u624f\x6c\u5ef2\u5ef2\u624f\x73\x74\x72\x69\u72b8\u577a\u6730\x68\u5ef2\u545a\u58a0\u6730\x69\u56c4\u58a0\u624f\x6c\x69\u735c\x68\u624f\u5ef2\u545a\u59c8\u5e77\u56c4\u545a\x73\x74\x72\u7313\x79\u5e77\u735c\u5ef2\u735a\u6c36\u5ef2\x72\x72\x50\u545a\u72b8\u56c4\x69\u72b8\u577a\u6b9b\u5ef2\x74\u5ef2\u624f\u63cb\x72\u7313\x77\x73\u545a\x72\u6c36\u545a\u5ef2\u58a0\u545a\u545a\u6c36\u5ef2\x72\x72\x57\u7313\x72\x6b\u545a\x72\u5e77\x72\u5ef2\x74\x69\u7313\u624f\x6c\u5ef2\u5ef2\u545a\u735c\u624f\x77\u7313\x72\u56c4\x53\u735a\u5ef2\u59c8\u545a\x52\u5ef2\x74\x69\u7313\u5e77\x74\u545a\u58a0\x74\x53\x69\x7a\u545a\x52\u5ef2\x74\x69\u7313\u624f\u59c8\u7313\u72b8\u5a32\x69\u577a\u6c36\u56c4\u58a0\u5ef2\u545a\u59c8\u706e\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\u645a\x75\x73\x74\u7313\u735c\x53\x74\x79\x6c\u545a\x49\u72b8\u5a32\u7313'
  )
  ;(function (i8, T) {
    var e = function (i) {
      while (--i) {
        i8.push(i8.shift())
      }
    }
    e(++T)
  })(fs, 407)
  var fq = function (i8, T) {
    i8 = i8 - 0
    var e = fs[i8]
    return e
  }
  function iJ(i8) {
    var T = {
      '\x6c\x6d\x69\x6c\x65': function (jb, i) {
        return jb !== i
      },
      '\x65\x6d\x64\x63\x64': fq('0x0'),
      '\x65\x61\x65\x68\x68': fq('0x1'),
      '\x61\x68\x6c\x68\x64': '\x69\x61\x68',
    }
    var e = '\x69\x61\x68'
    while (T[fq('0x2')](e, fq('0x3'))) {
      switch (e) {
        case T[fq('0x4')]:
          try {
            if (aA[fq('0x5')]) {
              i9 = new Worker(i8)
              i9['\x6f\x6e\x65\x72\x72\x6f\x72'] = function (i) {
                i[fq('0x6')]()
                i9 = fQ(i8)
              }
            } else {
              i9 = fQ(i8)
            }
          } catch (ja) {
            i9 = fQ(i8)
          }
          e = T[fq('0x7')]
          break
        case fq('0x1'):
          return i9
        case T[fq('0x8')]:
          var i9 = null
          e = T['\x65\x6d\x64\x63\x64']
          break
      }
    }
  }
  function fQ(i9) {
    var T = {
      '\x61\x65\x63\x78\x65': function (ji, jh) {
        return ji !== jh
      },
      '\x65\x6c\x65\x61\x61': fq('0x9'),
      '\x65\x6d\x64\x61\x63': '\x65\x64\x6c',
      '\x68\x65\x64\x78\x69': fq('0xa'),
      '\x68\x78\x61\x68\x61': function (ji, jh) {
        return ji !== jh
      },
      '\x68\x65\x78\x61\x78': fq('0xb'),
      '\x63\x61\x6c\x6d\x68': function (ji, jh) {
        return ji + jh
      },
      '\x65\x78\x61\x6d\x61': fq('0xc'),
      '\x69\x65\x69\x6c\x6c': fq('0xd'),
      '\x64\x68\x65\x6c\x6d': fq('0xe'),
      '\x6c\x61\x63\x6c\x68': fq('0xf'),
      '\x68\x6d\x64\x65\x78': fq('0x10'),
      '\x6d\x65\x6c\x69\x78': fq('0x11'),
      '\x61\x78\x68\x69\x69': fq('0x12'),
      '\x61\x68\x65\x65\x61': fq('0x13'),
      '\x69\x65\x65\x61\x61': fq('0x14'),
    }
    var jd = '\x64\x68\x64'
    while (T[fq('0x15')](jd, T[fq('0x16')])) {
      switch (jd) {
        case T[fq('0x17')]:
          return je
        case T[fq('0x18')]:
          try {
            var jc = fq('0x19')
            while (T['\x68\x78\x61\x68\x61'](jc, fq('0x1a'))) {
              switch (jc) {
                case T[fq('0x1b')]:
                  je = new Worker(i)
                  jc = fq('0x1a')
                  break
                case fq('0x13'):
                  try {
                    e = new Blob(
                      [T[fq('0x1c')](T[fq('0x1d')] + i9, T[fq('0x1e')])],
                      { type: T[fq('0x1f')] }
                    )
                  } catch (jb) {
                    var ja = T[fq('0x20')]
                    while (ja !== T[fq('0x21')]) {
                      switch (ja) {
                        case T['\x6d\x65\x6c\x69\x78']:
                          i8[fq('0x22')](
                            T[fq('0x1c')](fq('0xc'), i9) + T[fq('0x1e')]
                          )
                          ja = T['\x61\x78\x68\x69\x69']
                          break
                        case T['\x61\x78\x68\x69\x69']:
                          e = i8[fq('0x23')](T[fq('0x1f')])
                          ja = '\x65\x6c\x6c\x6d'
                          break
                        case fq('0xf'):
                          var i8 = new (window[fq('0x24')] ||
                            window[fq('0x25')] ||
                            window[fq('0x26')])()
                          ja = '\x65\x78\x69'
                          break
                      }
                    }
                  }
                  jc = fq('0x27')
                  break
                case fq('0x28'):
                  var i = jg[fq('0x29')](e)
                  jc = fq('0xb')
                  break
                case fq('0x19'):
                  var e
                  jc = T[fq('0x2a')]
                  break
                case fq('0x27'):
                  var jg = window['\x55\x52\x4c'] || window[fq('0x2b')]
                  jc = fq('0x28')
                  break
              }
            }
          } catch (jf) {}
          jd = fq('0x2c')
          break
        case T[fq('0x2d')]:
          var je = null
          jd = '\x61\x65\x61'
          break
      }
    }
  }
  function iu(e) {
    this['\x69\x6e\x69\x74'](e)
  }
  var gl = {
    '\x69\x6e\x69\x74': function (i8) {
      var T = {
        '\x68\x69\x63\x65\x63': '\x6c\x65\x6c',
        '\x63\x65\x69\x6d\x63': fq('0x2e'),
        '\x61\x65\x68\x65\x61': fq('0x2f'),
        '\x63\x61\x63\x61\x61': fq('0x30'),
        '\x69\x64\x63\x61\x64': fq('0x31'),
        '\x6c\x63\x68\x6c\x69': '\x61\x69\x61',
        '\x64\x6d\x69\x6c\x65': function (ja, i9) {
          return ja !== i9
        },
        '\x61\x6d\x61\x69\x65': fq('0x32'),
        '\x78\x69\x64\x64\x69': fq('0x33'),
        '\x6c\x61\x61\x64\x78': '\x78\x6c\x65',
        '\x65\x78\x78\x6d\x6c':
          (window.location.protocol === 'http:' ? 'http:' : 'https:') +
          '//api.map.baidu.com/res/webgl/10/worker_asm_0nl4rd.js',
        '\x68\x65\x64\x6d\x65': '\x68\x78\x78',
        '\x61\x68\x64\x78\x78': function (ja, i9) {
          return ja(i9)
        },
        '\x65\x69\x63\x69\x65': fq('0x34'),
        '\x6c\x65\x61\x6d\x61': function (ja, i9) {
          return ja < i9
        },
        '\x63\x64\x69\x6c\x69': fq('0x35'),
        '\x61\x63\x65\x69\x65': function (ja, i9) {
          return ja !== i9
        },
        '\x61\x65\x61\x61\x61': fq('0x36'),
        '\x61\x6c\x61\x61\x68': '\x6c\x6d\x61',
        '\x64\x78\x61\x65\x63': fq('0x37'),
        '\x68\x65\x61\x6d\x69': fq('0x38'),
        '\x64\x65\x65\x6c\x65': fq('0x39'),
        '\x6d\x69\x69\x64\x65': '\x64\x65\x65',
        '\x64\x64\x61\x68\x61': fq('0x3a'),
        '\x6c\x61\x6c\x69\x78': '\x65\x63\x61',
        '\x6d\x6c\x64\x65\x61': fq('0x3b'),
        '\x61\x78\x6c\x6d\x63': function (ja, i9) {
          return ja < i9
        },
        '\x68\x78\x6c\x68\x78': function (i9) {
          return i9()
        },
        '\x65\x61\x78\x65\x65': function (ja, i9) {
          return ja > i9
        },
        '\x6c\x61\x61\x65\x6d': function (i9) {
          return i9()
        },
        '\x6d\x65\x69\x65\x61': function (ja, i9) {
          return ja === i9
        },
        '\x78\x69\x68\x6d\x6c':
          '\x6f\x6e\x73\x74\x79\x6c\x65\x5f\x6c\x6f\x61\x64\x65\x64',
        '\x6c\x61\x69\x6d\x6d': fq('0x3c'),
      }
      var i = this
      this[fq('0x3d')] = i8
      this[fq('0x3e')] = []
      var e =
        navigator[
          '\x68\x61\x72\x64\x77\x61\x72\x65\x43\x6f\x6e\x63\x75\x72\x72\x65\x6e\x63\x79'
        ] || 4
      if (
        (T['\x68\x78\x6c\x68\x78'](bJ) || es[fq('0x3f')]['\x69\x65']) &&
        T[fq('0x40')](e, 2)
      ) {
        e = 2
      }
      this[fq('0x41')] = []
      this[fq('0x42')] = T[fq('0x43')](fz)
      this[fq('0x44')] = this[fq('0x42')]
      if (this[fq('0x42')] > 1) {
        this[fq('0x45')] = 2
      } else {
        this[fq('0x45')] = 1
      }
      if (
        T['\x6d\x65\x69\x65\x61'](
          typeof this['\x6d\x61\x70'][fq('0x46')]['\x73\x74\x79\x6c\x65'],
          T[fq('0x47')]
        )
      ) {
        this[fq('0x48')] = null
        this[fq('0x49')] = []
      }
      eW[fq('0x4a')](function (ja) {
        var i9 = {
          '\x64\x68\x69\x61\x61': fq('0x4b'),
          '\x65\x65\x65\x6c\x61': T['\x68\x69\x63\x65\x63'],
          '\x64\x61\x69\x64\x69': T[fq('0x4c')],
          '\x69\x6c\x61\x78\x69': T[fq('0x4d')],
          '\x68\x61\x61\x6d\x6d': T[fq('0x4e')],
          '\x65\x61\x6c\x63\x6d': T[fq('0x4f')],
          '\x6d\x61\x6d\x6d\x63': fq('0x50'),
          '\x61\x61\x68\x65\x6d': T[fq('0x51')],
        }
        var jh = fq('0x52')
        while (T[fq('0x53')](jh, T[fq('0x54')])) {
          switch (jh) {
            case fq('0x34'):
              if (
                i['\x61\x72\x72\x50\x65\x6e\x64\x69\x6e\x67\x44\x61\x74\x61'][
                  fq('0x55')
                ] > 0
              ) {
                jh = T[fq('0x56')]
                break
              }
              jh = T[fq('0x54')]
              break
            case fq('0x52'):
              var jg
              jh = fq('0x57')
              break
            case T['\x6c\x61\x61\x64\x78']:
              jh = ja ? fq('0x35') : fq('0x58')
              break
            case fq('0x58'):
              jg = T[fq('0x59')]
              jh = T[fq('0x5a')]
              break
            case fq('0x5b'):
              for (var je = 0; je < e; je++) {
                var jd = T[fq('0x5c')](iJ, jg)
                jd[fq('0x5d')] = function jb(jj) {
                  var ji = '\x61\x64\x68'
                  while (ji !== '\x6c\x65\x6c\x6d') {
                    switch (ji) {
                      case fq('0x50'):
                        this[fq('0x5e')] = null
                        ji = fq('0x5f')
                        break
                      case fq('0x60'):
                        ji = jj[fq('0x61')] ? i9[fq('0x62')] : i9[fq('0x63')]
                        break
                      case '\x6c\x65\x6c':
                        this[fq('0x5e')] &&
                          this[fq('0x5e')](null, this[fq('0x64')])
                        ji = i9[fq('0x65')]
                        break
                      case fq('0x4b'):
                        this[fq('0x5e')] &&
                          this[fq('0x5e')](jj[fq('0x61')], this[fq('0x64')])
                        ji = i9[fq('0x65')]
                        break
                      case fq('0x66'):
                        this[
                          '\x5f\x70\x61\x72\x73\x69\x6e\x67\x54\x69\x6c\x65\x4b\x65\x79'
                        ] = null
                        ji = fq('0x31')
                        break
                      case fq('0x67'):
                        i8['\x66\x69\x72\x65'](jk)
                        ji = i9['\x69\x6c\x61\x78\x69']
                        break
                      case fq('0x5f'):
                        this[
                          '\x5f\x70\x61\x72\x73\x69\x6e\x67\x54\x69\x6c\x65\x49\x6e\x66\x6f'
                        ] = null
                        ji = fq('0x66')
                        break
                      case fq('0x68'):
                        jk[fq('0x69')] = fq('0x6a')
                        ji = fq('0x67')
                        break
                      case fq('0x6b'):
                        var jm = i[fq('0x3e')][fq('0x6c')]()
                        ji = i9['\x68\x61\x61\x6d\x6d']
                        break
                      case i9[fq('0x6d')]:
                        if (i[fq('0x3e')][fq('0x55')] > 0) {
                          ji = fq('0x6b')
                          break
                        }
                        ji = fq('0x6e')
                        break
                      case fq('0x6f'):
                        i[fq('0x70')](
                          jm[fq('0x71')],
                          jm[fq('0x72')],
                          jm[fq('0x73')],
                          jl
                        )
                        ji = '\x78\x61\x64'
                        break
                      case i9[fq('0x74')]:
                        var jl = jm['\x63\x62\x6b']
                        ji = fq('0x6f')
                        break
                      case fq('0x2e'):
                        this[fq('0x75')] = ![]
                        ji = i9[fq('0x76')]
                        break
                      case fq('0x6e'):
                        var jk = new e7(fq('0x77'))
                        ji = i9[fq('0x78')]
                        break
                    }
                  }
                }
                i[fq('0x41')]['\x70\x75\x73\x68'](jd)
              }
              jh = T[fq('0x79')]
              break
            case T[fq('0x56')]:
              for (
                var jf = 0;
                T[fq('0x7a')](
                  jf,
                  Math['\x6d\x69\x6e'](
                    i[
                      '\x61\x72\x72\x50\x65\x6e\x64\x69\x6e\x67\x44\x61\x74\x61'
                    ][fq('0x55')],
                    e
                  )
                );
                jf++
              ) {
                var jc = i[fq('0x3e')][fq('0x6c')]()
                i[fq('0x70')](
                  jc[fq('0x71')],
                  jc[fq('0x72')],
                  jc[fq('0x73')],
                  jc['\x63\x62\x6b']
                )
              }
              jh = fq('0x32')
              break
            case T[fq('0x7b')]:
              jg =
                (window.location.protocol === 'http:' ? 'http:' : 'https:') +
                '//api.map.baidu.com/res/webgl/10/worker_wasm_4i3lbq.js'
              jh = T['\x68\x65\x64\x6d\x65']
              break
          }
        }
      })
      i8['\x6f\x6e'](T['\x78\x69\x68\x6d\x6c'], function () {
        var jb = '\x69\x64\x78'
        while (T[fq('0x7c')](jb, fq('0x38'))) {
          switch (jb) {
            case T[fq('0x7d')]:
              i[
                '\x73\x74\x72\x69\x6e\x67\x69\x66\x69\x65\x64\x43\x75\x73\x74\x6f\x6d\x53\x74\x79\x6c\x65\x49\x6e\x66\x6f\x5a\x6f\x6f\x6d'
              ] = []
              jb = fq('0x38')
              break
            case T[fq('0x7e')]:
              if (typeof this[fq('0x46')][fq('0x7f')] !== T[fq('0x47')]) {
                jb = fq('0x80')
                break
              }
              jb = T[fq('0x81')]
              break
            case fq('0x80'):
              i[fq('0x48')] = null
              jb = '\x6c\x61\x61'
              break
            case T['\x64\x65\x65\x6c\x65']:
              for (var ja = 0, i9 = i[fq('0x41')][fq('0x55')]; ja < i9; ja++) {
                i['\x61\x72\x72\x57\x6f\x72\x6b\x65\x72'][ja][fq('0x82')] = ![]
              }
              jb = fq('0x83')
              break
          }
        }
      })
      i8['\x6f\x6e'](
        '\x6f\x6e\x73\x74\x79\x6c\x65\x7a\x6f\x6f\x6d\x75\x70\x64\x61\x74\x65',
        function () {
          var i9 = T[fq('0x84')]
          while (i9 !== fq('0x3a')) {
            switch (i9) {
              case '\x61\x65\x63':
                i[fq('0x49')] = []
                i9 = T[fq('0x85')]
                break
              case T[fq('0x86')]:
                if (
                  T['\x61\x63\x65\x69\x65'](
                    typeof this['\x63\x6f\x6e\x66\x69\x67'][fq('0x7f')],
                    fq('0x37')
                  )
                ) {
                  i9 = fq('0x87')
                  break
                }
                i9 = T[fq('0x85')]
                break
              case fq('0x87'):
                i[fq('0x48')] = null
                i9 = T[fq('0x88')]
                break
              case T[fq('0x84')]:
                for (
                  var jb = 0, ja = i[fq('0x41')]['\x6c\x65\x6e\x67\x74\x68'];
                  jb < ja;
                  jb++
                ) {
                  i[fq('0x41')][jb][fq('0x82')] = ![]
                }
                i9 = fq('0x89')
                break
            }
          }
        }
      )
      i8['\x6f\x6e'](T[fq('0x8a')], function () {
        for (var i9 = 0; T[fq('0x8b')](i9, i[fq('0x41')][fq('0x55')]); i9++) {
          if (i[fq('0x41')][i9]) {
            i[fq('0x41')][i9][fq('0x8c')]()
          }
        }
        i['\x61\x72\x72\x57\x6f\x72\x6b\x65\x72'][fq('0x55')] = 0
      })
    },
    '\x67\x65\x74\x49\x64\x6c\x65\x57\x6f\x72\x6b\x65\x72': function () {
      var i9 = {
        '\x61\x6c\x61\x61\x68': function (jb, ja) {
          return jb < ja
        },
        '\x69\x78\x65\x63\x64': '\x6d\x64\x61\x69',
        '\x69\x61\x64\x61\x63': '\x61\x6d\x68',
        '\x6c\x65\x63\x61\x6d': fq('0x8d'),
        '\x61\x78\x65\x69\x64': fq('0x8e'),
        '\x61\x68\x63\x78\x65': fq('0x8f'),
      }
      for (
        var i8 = 0, T = this[fq('0x41')][fq('0x55')];
        i9[fq('0x7e')](i8, T);
        i8++
      ) {
        var i = fq('0x8e')
        while (i !== i9['\x69\x78\x65\x63\x64']) {
          switch (i) {
            case i9[fq('0x90')]:
              return e
            case i9[fq('0x91')]:
              if (!e[fq('0x75')]) {
                i = fq('0x8f')
                break
              }
              i = fq('0x92')
              break
            case i9[fq('0x93')]:
              var e = this[fq('0x41')][i8]
              i = i9[fq('0x91')]
              break
            case i9[fq('0x94')]:
              e[fq('0x75')] = !![]
              i = i9[fq('0x90')]
              break
          }
        }
      }
      return null
    },
    '\x72\x65\x6c\x65\x61\x73\x65\x50\x65\x6e\x64\x69\x6e\x67\x44\x61\x74\x61':
      function (e) {
        var jc = {
          '\x69\x78\x68\x61\x61': function (je, jd) {
            return je - jd
          },
          '\x64\x61\x63\x78\x65': function (je, jd) {
            return je !== jd
          },
          '\x61\x61\x6c\x68\x64': fq('0x95'),
        }
        var i9 = []
        var jb = this[fq('0x3e')]
        for (var ja = jc[fq('0x96')](jb[fq('0x55')], 1); ja >= 0; ja--) {
          var i8 = jb[ja]
          var T = i8['\x74\x69\x6c\x65\x49\x6e\x66\x6f']
          if (jc[fq('0x97')](e[fq('0x98')], T[fq('0x98')])) {
            continue
          }
          var i =
            jc[fq('0x99')] +
            T[fq('0x9a')] +
            '\x5f' +
            T[fq('0x9b')] +
            '\x5f' +
            T['\x7a\x6f\x6f\x6d']
          if (!e[i]) {
            jb[fq('0x9c')](ja, 1)
            i9[fq('0x9d')](T)
          }
        }
        return i9
      },
    '\x6c\x6f\x61\x64\x54\x69\x6c\x65\x44\x61\x74\x61': function (
      i9,
      i8,
      T,
      i
    ) {
      var e = {
        '\x65\x61\x61\x69\x68': fq('0x9e'),
        '\x63\x6c\x78\x78\x69': fq('0x9f'),
        '\x69\x61\x63\x6d\x61': fq('0xa0'),
        '\x6c\x6d\x61\x6c\x6d': fq('0x13'),
        '\x6c\x64\x6d\x65\x69': fq('0xa1'),
        '\x64\x65\x61\x63\x69': fq('0xa2'),
        '\x65\x63\x78\x6d\x78': fq('0xa3'),
        '\x61\x65\x65\x68\x63': fq('0xa4'),
        '\x61\x78\x78\x65\x64': fq('0xa5'),
        '\x63\x61\x64\x63\x6d': fq('0xa6'),
        '\x61\x63\x63\x61\x6d': fq('0x70'),
        '\x78\x6c\x78\x61\x78': fq('0xa7'),
        '\x64\x69\x68\x61\x69': function (jk, jj) {
          return jk + jj
        },
        '\x61\x68\x69\x61\x6c': '\x65\x61\x61',
        '\x63\x65\x61\x65\x65': fq('0xa8'),
        '\x63\x68\x6c\x61\x69': fq('0xa9'),
        '\x6d\x68\x65\x61\x69': fq('0xaa'),
        '\x6d\x65\x61\x64\x61': fq('0xab'),
        '\x63\x65\x64\x65\x69': fq('0xac'),
        '\x69\x69\x65\x6c\x61': '\x61\x69\x65',
        '\x61\x61\x68\x61\x65': fq('0xad'),
        '\x63\x69\x61\x68\x65': '\x63\x78\x65',
        '\x68\x61\x61\x6d\x61':
          '\x73\x74\x72\x69\x6e\x67\x69\x66\x69\x65\x64\x46\x65\x61\x74\x75\x72\x65\x53\x74\x79\x6c\x65',
        '\x61\x61\x61\x65\x6d': fq('0xae'),
        '\x63\x65\x69\x63\x65': function (jk, jj) {
          return jk + jj
        },
        '\x68\x65\x78\x61\x78': fq('0xaf'),
        '\x61\x78\x65\x65\x6c': function (jk, jj) {
          return jk + jj
        },
        '\x63\x69\x65\x65\x65': fq('0xb0'),
        '\x68\x65\x64\x63\x61': fq('0xb1'),
        '\x61\x68\x64\x61\x6c': fq('0xb2'),
        '\x78\x65\x63\x6c\x68': fq('0xb3'),
        '\x64\x61\x69\x78\x69': fq('0xb4'),
        '\x65\x68\x65\x61\x65': fq('0xb5'),
        '\x65\x6c\x64\x78\x61': fq('0x3b'),
        '\x63\x78\x61\x6d\x68': fq('0xb6'),
        '\x65\x78\x6c\x61\x6d': fq('0xb7'),
        '\x61\x63\x6d\x61\x65': function (jk, jj) {
          return jk + jj
        },
        '\x6c\x65\x61\x63\x68': fq('0xb8'),
      }
      var jh = this[fq('0xb9')]()
      var jg = this['\x6d\x61\x70'][fq('0xba')][fq('0xbb')]
      var jf = jg ? this[fq('0x3d')][fq('0xba')][fq('0xbc')] : ![]
      if (jh) {
        var je = e[fq('0xbd')]
        while (je !== fq('0xbe')) {
          switch (je) {
            case e[fq('0xbf')]:
              if (!this[fq('0x48')]) {
                je = e[fq('0xc0')]
                break
              }
              je = e[fq('0xc1')]
              break
            case e[fq('0xc2')]:
              if (!this[fq('0xc3')]) {
                je = fq('0xa4')
                break
              }
              je = fq('0xa5')
              break
            case e[fq('0xc4')]:
              if (jb) {
                je = e[fq('0xc5')]
                break
              }
              je = fq('0xac')
              break
            case e[fq('0xc6')]:
              this[fq('0xc3')] = JSON[fq('0xc7')](bo[fq('0xc8')])
              je = e[fq('0xc9')]
              break
            case e[fq('0xca')]:
              var jd = {
                '\x61\x63\x74\x69\x6f\x6e': e['\x61\x63\x63\x61\x6d'],
                '\x75\x72\x6c': i9,
                '\x74\x69\x6c\x65\x49\x6e\x66\x6f': i8,
                '\x74\x69\x6c\x65\x4b\x65\x79': T,
                '\x69\x73\x54\x65\x78\x74': jf,
                '\x69\x73\x50\x6f\x69': jg,
              }
              je = fq('0xa8')
              break
            case e[fq('0xcb')]:
              jd['\x66\x65\x61\x74\x75\x72\x65\x53\x74\x79\x6c\x65'] =
                this[e[fq('0xcc')](fq('0xcd'), jc)]
              je = e[fq('0xce')]
              break
            case e[fq('0xcf')]:
              var jc =
                this[fq('0x3d')][
                  '\x67\x65\x74\x4d\x61\x70\x53\x74\x79\x6c\x65\x49\x64'
                ]()
              je = e[fq('0xd0')]
              break
            case e[fq('0xd1')]:
              this[
                '\x73\x74\x72\x69\x6e\x67\x69\x66\x69\x65\x64\x46\x65\x61\x74\x75\x72\x65\x53\x74\x79\x6c\x65' +
                  jc
              ] = JSON[fq('0xc7')](bo[e[fq('0xcc')](e[fq('0xd2')], jc)])
              je = fq('0xb7')
              break
            case fq('0xd3'):
              if (
                !this[fq('0xcd') + jc] &&
                bo[e[fq('0xcc')](e[fq('0xd2')], jc)]
              ) {
                je = e[fq('0xd1')]
                break
              }
              je = '\x69\x64\x61'
              break
            case e[fq('0xd4')]:
              if (!jh[fq('0x82')]) {
                je = e[fq('0xd5')]
                break
              }
              je = e[fq('0xd6')]
              break
            case fq('0x3b'):
              jd[fq('0xd7')] = this[fq('0x48')]
              je = e['\x63\x69\x61\x68\x65']
              break
            case e[fq('0xc1')]:
              if (this[e[fq('0xd8')] + jc]) {
                je = e['\x78\x6c\x78\x61\x78']
                break
              }
              je = e[fq('0xce')]
              break
            case e[fq('0xd9')]:
              jd[fq('0xc8')] =
                this[
                  '\x73\x74\x72\x69\x6e\x67\x69\x66\x69\x65\x64\x49\x6e\x64\x6f\x6f\x72\x53\x74\x79\x6c\x65'
                ]
              je = fq('0xb5')
              break
            case e['\x69\x61\x63\x6d\x61']:
              this[fq('0x48')] = JSON[fq('0xc7')](
                bo[e[fq('0xda')](e[fq('0x1b')], jc)]
              )
              je = '\x61\x78\x61'
              break
            case '\x65\x6c\x6c':
              this[e[fq('0xdb')](e[fq('0xdc')], ja)] = JSON[fq('0xc7')](
                bo[e[fq('0xdd')] + ja]
              )
              je = fq('0xa1')
              break
            case e[fq('0xd0')]:
              var jb = !!(jc[fq('0xde')](fq('0xdf')) === 0)
              je = e[fq('0xe0')]
              break
            case e[fq('0xe1')]:
              jh[fq('0x82')] = !![]
              je = e[fq('0xd6')]
              break
            case e[fq('0xe2')]:
              jd[fq('0xe3')] = jc
              je = e[fq('0xe1')]
              break
            case fq('0xa5'):
              if (jb && bo[e[fq('0xdb')](fq('0xaf'), jc)]) {
                je = fq('0x9f')
                break
              }
              je = fq('0x13')
              break
            case '\x69\x69\x69':
              jh[fq('0xe4')](jd)
              je = fq('0xbe')
              break
            case '\x63\x78\x65':
              jd['\x69\x63\x6f\x6e\x49\x6e\x66\x6f'] = {
                '\x77\x6f\x72\x64\x53\x70\x61\x63\x65\x52\x61\x74\x69\x6f':
                  this[fq('0x44')],
                '\x74\x65\x78\x74\x53\x69\x7a\x65\x52\x61\x74\x69\x6f':
                  this[fq('0x45')],
              }
              je = '\x61\x65\x65'
              break
            case e[fq('0xe5')]:
              if (jb && this[fq('0x48')]) {
                je = e[fq('0xe6')]
                break
              }
              je = e[fq('0xe7')]
              break
            case e[fq('0xbd')]:
              jh[fq('0x5e')] = i
              je = e[fq('0xe8')]
              break
            case e[fq('0xce')]:
              jd[fq('0xb1')] = this[fq('0xb0') + ja]
              je = e[fq('0xd9')]
              break
            case e[fq('0xe0')]:
              var ja = jc
              je = e[fq('0xc4')]
              break
            case fq('0xa3'):
              ja = fq('0xe9')
              je = e['\x63\x65\x64\x65\x69']
              break
            case fq('0xb6'):
              jh[fq('0xea')] = i8
              je = fq('0xeb')
              break
            case '\x68\x6c\x61':
              jh[fq('0x64')] = T
              je = e[fq('0xca')]
              break
            case e[fq('0xec')]:
              if (!this[e[fq('0xed')](fq('0xb0'), ja)]) {
                je = e[fq('0xee')]
                break
              }
              je = fq('0xa1')
              break
          }
        }
      } else {
        var ji = {
          '\x75\x72\x6c': i9,
          '\x74\x69\x6c\x65\x49\x6e\x66\x6f': i8,
          '\x74\x69\x6c\x65\x4b\x65\x79': T,
          '\x63\x62\x6b': i,
        }
        this['\x61\x72\x72\x50\x65\x6e\x64\x69\x6e\x67\x44\x61\x74\x61'][
          fq('0x9d')
        ](ji)
      }
    },
  }
  es[fq('0xef')](iu['\x70\x72\x6f\x74\x6f\x74\x79\x70\x65'], gl)
  function hU(i) {
    this.tileLayers = []
    this.map = i
    var e = (this.config = dO[this.map.mapType])
    this.errorUrl = e.errorUrl
    this.tileSize = e.tileSize
    this.baseUnits = e.baseUnits
    this.baseZoomLevel = e.zoomLevelBase
    this.tileURLs = e.tileUrls
    this.tilesInfoCache = {}
    this.loadDelay = 10
    this._labelTextCanvas = null
  }
  bo.register(function (i) {
    if (i._renderType !== 'webgl') {
      return
    }
    var e = (i.tileMgr = new hU(i))
    i.addEventListener('addtilelayer', function (i8) {
      e.addWebGLLayer(i8.target)
    })
    i.addEventListener('removetilelayer', function (i8) {
      e.removeWebGLLayer(i8.target)
    })
    i.on('update', function T(i9) {
      if (i.getFeatureStyleTags().length === 0 || !i.customLoaded) {
        return
      }
      var i8 = false
      if (i9.changedStatus && i9.changedStatus.onzoom_changed) {
        i8 = true
      }
      e.loadLayersData({ zoomChanged: i8 })
    })
    i.on('style_changed', function () {
      e.loadLayersData()
    })
  })
  es.extend(hU.prototype, {
    addWebGLLayer: function (T) {
      this.tileLayers.push(T)
      T.initDrawData()
      if (this.tileLayers.length > 1) {
        for (var e = 1; e < this.tileLayers.length; e++) {
          if (this.tileLayers[e].isFlat) {
            this.map.setDisplayOptions({ isFlat: true })
            break
          }
        }
      }
      if (this.map.getFeatureStyleTags().length > 0 && this.map.customLoaded) {
        this.loadLayersData()
      } else {
        var i8 = this
        this.map.loadMapStyleFiles(function () {
          i8.loadLayersData()
        })
      }
    },
    removeWebGLLayer: function (ja) {
      var jb = false
      for (var i9 = 0, i8 = this.tileLayers.length; i9 < i8; i9++) {
        if (ja === this.tileLayers[i9]) {
          jb = true
          this.tileLayers.splice(i9, 1)
          break
        }
      }
      if (jb === false) {
        return
      }
      ja.destroyDrawData()
      if (this.map.getFeatureStyleTags().length > 0) {
        this.loadLayersData()
      }
      if (this.tileLayers.length === 1) {
        this.map.setDisplayOptions({ isFlat: false })
      } else {
        var e = false
        for (var i9 = 1; i9 < this.tileLayers.length; i9++) {
          if (this.tileLayers[i9].isFlat) {
            e = true
            break
          }
        }
        this.map.setDisplayOptions({ isFlat: e })
      }
      var T = new e7('onrefresh')
      T.source = 'removewebgllayer'
      this.map.fire(T)
    },
    getLabelTextCanvas: function () {
      if (!this._labelTextCanvas) {
        this._labelTextCanvas = new ap(this.map)
      }
      return this._labelTextCanvas
    },
    loadLayersData: function (i) {
      if (this.map.suspendLoad) {
        return
      }
      var i8 = this
      i = i || {}
      var T = !!i.zoomChanged
      var e = T === true || this.map.getTilt() > 50
      if (!e) {
        if (!this.syncLoadTimer) {
          this.syncLoadTimer = setTimeout(function () {
            i8._loadLayersFromCache(T)
            i8.syncLoadTimer = null
          }, 40)
        }
      } else {
        this._loadLayersFromCache(T)
      }
      if (!i8.map.viewAnimationTime) {
        this.timer && window.clearTimeout(this.timer)
      }
      this.timer = window.setTimeout(function () {
        if (i8.map.viewAnimationTime) {
          if (new Date().getTime() - i8.map.viewAnimationTime < 1000) {
            return
          }
          i8.map.viewAnimationTime = new Date().getTime()
        }
        var ja = i8.tileLayers.length
        i8.tilesInfoCache = {}
        for (var jb = 0; jb < ja; jb++) {
          var jd = i8.tileLayers[jb]
          var jc = jd.tileType
          var i9 = null
          if (i8.tilesInfoCache[jc.getName()]) {
            i9 = i8.tilesInfoCache[jc.getName()]
          } else {
            i9 = i8.calcTilesInfo(jc, jd)
            i8.tilesInfoCache[jc.getName()] = i9
          }
          jd.loadLayerData(i9, false, T)
        }
        i8.timer = null
      }, this.loadDelay)
      if ((bJ() || es.Browser.ie) && T) {
        this.loadDelay = 200
      } else {
        this.loadDelay = 80
      }
    },
    _loadLayersFromCache: function (i9) {
      this.map._featureMgr.clearData()
      var jc = this.tileLayers
      jc.sort(function (jd, i) {
        return jd.zIndex - i.zIndex > 0
      })
      var T = jc.length
      this.tilesInfoCache = {}
      for (var i8 = 0; i8 < T; i8++) {
        var jb = jc[i8]
        var ja = jb.tileType
        var e = null
        if (this.tilesInfoCache[ja.getName()]) {
          e = this.tilesInfoCache[ja.getName()]
        } else {
          e = this.calcTilesInfo(ja, jb)
          this.tilesInfoCache[ja.getName()] = e
        }
        jb.loadLayerData(e, true, i9)
      }
    },
    calcTilesInfo: function (jl, jM) {
      var jy = this.map
      var jE = jy.getMapType()
      var jz = dO[jE]
      var js = jy.getZoom()
      var e = Math.floor(js)
      var jb = jl.getDataZoom(js)
      var jR = jl.getName()
      jb = bV(jb, jz.minDataZoom, jz.maxDataZoom)
      var jH = e
      if (jl._name === 'web' || jl._name === 'xyz') {
        jH = jb
      } else {
        if (jH < 3) {
          jH = 3
        }
      }
      var jw = jl.getTileSize(js)
      var ja = jl.getBaseTileSize(js)
      var ju = jy.getBoundsIn()
      var jp = jl.getMercatorSize(js, jb)
      var jo
      var jF
      var jv
      var jJ
      var jA = jy.getCenterIn()
      if (jE !== BMAP_SATELLITE_MAP) {
        jA = ev.calcLoopCenterPoint(jA)
      }
      if (jR === 'xyz') {
        return this.calcXYZTilesInfo(jA, ju, jb, jR, jM, jy)
      }
      var jt = Math.floor(jA.lng / jp)
      var jd = Math.floor(jA.lat / jp)
      var jC = 0
      var i8 = 0
      if (jR !== 'web') {
        ju = ev.calcLoopMapBounds(ju, jy.getCenter())
      }
      if (ju.ne.lng > ev._mc180X) {
        var jj = ev.getSpaceDistanceInPixel(jb)
        jC = Math.ceil(jj / ja)
      }
      if (ju.sw.lng < ev._mcM180X) {
        var jj = ev.getSpaceDistanceInPixel(jb)
        i8 = Math.ceil(jj / ja)
      }
      if (ju.ne.lat > 19505879.362428114 || ju.sw.lat < -15949096.637571886) {
        ju.ne.lat = 19505879.362428114
        ju.sw.lat = -15949096.637571886
      }
      var jf = [Math.floor(ju.sw.lng / jp) - i8, Math.floor(ju.sw.lat / jp)]
      var jP = [Math.floor(ju.ne.lng / jp) + jC, Math.floor(ju.ne.lat / jp)]
      jo = jf[0]
      jF = jP[0] + 1
      jv = jf[1]
      jJ = jP[1] + 1
      var jk = []
      for (var jh = jo; jh < jF; jh++) {
        if (ev.isTileBlank(jh, jb, ja) === true) {
          continue
        }
        for (var jm = jv; jm < jJ; jm++) {
          var jL = false
          var jg = 256
          if (jR === 'web') {
            var jG = ev.calcLoopParam(jh, jb)
            var jO = { col: jG.col, row: jm, baseTileSize: 256, zoom: jb }
            var jx = ia.prototype.tileToBound(jO, jy.getCenter())
            if (
              jx.LL.sw.lng * jx.LL.ne.lng < 0 &&
              Math.floor(jx.LL.ne.lng) < 0
            ) {
              jL = true
              jg = ev.pixelWidth(jx.MC.sw.lng, jy.getZoom())
            }
          }
          var ji = {
            col: jh,
            row: jm,
            zoom: jb,
            useZoom: jH,
            tileTypeName: jR,
            loopOffsetX: 0,
            tileSize: jw,
            baseTileSize: ja,
            mercatorSize: jp,
            combine: jL,
            dataIndex: jg,
          }
          jk.push(ji)
          var jD = 'id_' + jh + '_' + jm + '_' + jb
          jk[jD] = true
        }
      }
      if (jE !== BMAP_SATELLITE_MAP) {
        jk = ev.calcLoopTiles(jk, jb, ja, jp)
      }
      if (jb === 3) {
        for (var jN = 0, jK = jk.length; jN < jK; jN++) {
          var jh = jk[jN].col
          var jm = jk[jN].row
          var jG = ev.calcLoopParam(jh, jb)
          var jc = jG.T
          var jq = jh >= 0 ? jh - jc : jh + jc
          var jr = 'id_' + jq + '_' + jm + '_' + jb
          if (!jk[jr]) {
            var ji = {
              col: jq,
              row: jm,
              zoom: jb,
              useZoom: jH,
              loopOffsetX: 0,
              tileSize: jw,
              baseTileSize: ja,
              mercatorSize: jp,
              combine: false,
            }
            jk.push(ji)
            jk[jr] = true
          }
        }
      }
      if (this.map._tilt > 0) {
        for (var jN = 0; jN < jk.length; jN++) {
          var je = jk[jN]
          var jI = je.col
          var jQ = je.row
          var jB = []
          jB.minX = jI * jp
          jB.maxX = (jI + 1) * jp
          jB.minY = jQ * jp
          jB.maxY = (jQ + 1) * jp
          var i9 = new cd(0, 0)
          i9.lng = (jB.minX + jB.maxX) / 2
          i9.lat = (jB.minY + jB.maxY) / 2
          var jn = jy.pointToPixelIn(i9)
          if (
            jn.x > 0 &&
            jn.x < this.map.width &&
            jn.y > 0 &&
            jn.y < this.map.height
          ) {
            continue
          }
          if (
            jB.minX < jA.lng &&
            jB.maxX > jA.lng &&
            jB.minY < jA.lat &&
            jB.maxY > jA.lat
          ) {
            continue
          }
          if (!this.ifTileInMapBounds(jB, ju, jI, jQ)) {
            jk.splice(jN, 1)
            jN--
          }
        }
      }
      jk.sort(
        (function (i) {
          return function (T, jS) {
            return (
              0.4 * Math.abs(T.col - i[0]) +
              0.6 * Math.abs(T.row - i[1]) -
              (0.4 * Math.abs(jS.col - i[0]) + 0.6 * Math.abs(jS.row - i[1]))
            )
          }
        })([jt, jd])
      )
      jk.zoom = jb
      jk.tileTypeName = jR
      return jk
    },
    calcXYZTilesInfo: function (jj, jc, ji, jn, jb, jq) {
      var je = jq.width
      var jo = jq.height
      var jd = Math.floor(ji)
      var i8 = da.transformBDmcPoint(jj)
      if (!i8) {
        return []
      }
      var jf = null
      if (jb.transform.source === 'BD09MC') {
        var i9 = da.getRangeExtent(i8, je, jo, jd, jb.transform)
        jf = [i9.minX, i9.minY, i9.maxX, i9.maxY]
      } else {
        var ja = da.transformBDmcPoint(jc.ne)
        var jh = da.transformBDmcPoint(jc.sw)
        jf = da.getLoopBox(i8, [jh[0], jh[1], ja[0], ja[1]])
      }
      if (!jf) {
        return []
      }
      if (jb.transform.source === 'BD09MC') {
        jd += 1
      }
      var T = da.getTileRangeForExtentFactory(jf, jd, jb.transform)
      var e = []
      var jr = da.getResolutionScale(jd, jb.transform)
      for (var jm = T.minX; jm <= T.maxX; jm++) {
        for (var jk = T.minY; jk <= T.maxY; jk++) {
          var jl = {
            col: jm,
            row: jk,
            zoom: jd,
            useZoom: jd,
            tileTypeName: jn,
            loopOffsetX: 0,
            tileSize: 256 * jr,
            transform: jb.transform,
            combine: false,
            dataIndex: 0,
          }
          e.push(jl)
          var jg = 'id_' + jm + '_' + jk + '_' + jd
          e[jg] = true
        }
      }
      var jp = da.getTileCoordForCoordAndZ(i8, jd)
      e.sort(
        (function (i) {
          return function (js, jt) {
            return (
              0.4 * Math.abs(js.col - i[0]) +
              0.6 * Math.abs(js.row - i[1]) -
              (0.4 * Math.abs(jt.col - i[0]) + 0.6 * Math.abs(jt.row - i[1]))
            )
          }
        })([jp[1], jp[2]])
      )
      e.zoom = jd
      e.tileTypeName = jn
      return e
    },
    getCurrentViewTilesInfo: function (i) {
      var e = this.tilesInfoCache[i.getName()]
      if (!e) {
        return this.calcTilesInfo(i)
      }
      return e
    },
    ifTileInMapBounds: function (e, ja, T, i9) {
      var i = ja.normalizedBottomLeft
      var jl = ja.normalizedTopRight
      var jd = ja.normalizedTopLeft
      var jb = ja.normalizedBottomRight
      var i8 = false
      var jk = new cd(e.minX, e.minY)
      var jh = new cd(e.maxX, e.maxY)
      var jc = new cd(jh.lng, jk.lat)
      var ji = new cd(jk.lng, jh.lat)
      var jf = [ji, jh, jc, jk]
      for (var jj = 0, je = jf.length; jj < je; jj++) {
        var jg = jj + 1
        if (jg === je) {
          jg = 0
        }
        var jm = jj
        var jn = h9(jf[jg], jf[jm], jd, i)
        if (jn) {
          i8 = true
          break
        }
        jn = h9(jf[jg], jf[jm], jb, jl)
        if (jn) {
          i8 = true
          break
        }
        jn = h9(jf[jg], jf[jm], jl, jd)
        if (jn) {
          i8 = true
          break
        }
        jn = h9(jf[jg], jf[jm], i, jb)
        if (jn) {
          i8 = true
          break
        }
      }
      return i8
    },
    getTileLayer: function (i9) {
      for (var i8 = 0, e = this.tileLayers.length; i8 < e; i8++) {
        var T = this.tileLayers[i8]
        if (T.mapType === i9) {
          return T
        }
      }
      return null
    },
    getZoomState: function (i) {
      var e = i - this.lastZoom
      if (e > 0) {
        this.zoomState = 1
      } else {
        if (e < 0) {
          this.zoomState = -1
        }
      }
      this.lastZoom = i
      return this.zoomState
    },
  })
  function gF(e) {
    this._map = e
    this._spotsId = null
    this._init()
  }
  gF.prototype._init = function () {
    var e = this._map
    e.addEventListener('onspotsdataready', function (T) {
      var i = T.spots
      if (this._spotsId) {
        e.removeSpots(this._spotsId)
      }
      this._spotsId = e.addSpots(i)
    })
  }
  bo.register(function (e) {
    if (!e.config.enableIconClick) {
      return
    }
    e._mapIcon = new gF(e)
  })
  function cI(e) {
    this._indoorData = {}
    this._map = e
    this.currentUid = null
    this.currentFloor = null
    this._indoorControl = null
    this.enterMethod = null
    this.showMask = false
    this._isMobile = bJ()
    this._autoEnterZoom = 19
    if (this._isMobile) {
      this._autoEnterZoom = 17
    }
    this._init(e)
    window._indoorMgr = this
  }
  cI.prototype._init = function (i) {
    var e = this
    i.on('indoor_status_changed', function (jb) {
      var T = jb.uid
      var i9 = jb.floor
      if (T === null) {
        T = e.currentUid
        if (e._indoorData[T]) {
          i9 = e._indoorData[T].defaultFloor
        }
        if (e._indoorControl) {
          e._indoorControl.hide()
        }
        e.currentUid = null
        e.currentFloor = null
        e.enterMethod = null
      } else {
        if (e._indoorData[T]) {
          var ja = e._indoorData[T]
          i9 = typeof i9 === 'number' ? i9 : ja.defaultFloor
          if (!e._indoorControl) {
            if (i.config.showControls && i._displayOptions.indoor) {
              e._indoorControl = new an(i, ja)
            }
          } else {
            e._indoorControl.setInfo(ja)
            e._indoorControl.show()
          }
          e.currentUid = T
          e.currentFloor = i9
        }
      }
      if (
        !e._indoorData ||
        !e._indoorData[T] ||
        e._indoorData[T].currentFloor === i9
      ) {
        this.fire(new e7('onrefresh'))
        return
      }
      var i8 = new e7('onindoor_data_refresh')
      i8.uid = T
      i8.floor = i9
      i8.tileKey = e._indoorData[T].tileKey
      e._indoorData[T].currentFloor = i9
      e.currentFloor = i9
      this.fire(i8)
    })
    i.on('spotclick', function (i8) {
      var T = null
      if (i8.curAreaSpot && this.areaSpots[i8.curAreaSpot]) {
        T = this.areaSpots[i8.curAreaSpot].userData.uid
      }
      if (T === e.currentUid) {
        if (i8.curAreaSpot) {
          e.enterMethod = 'byClick'
        }
        return
      }
      if (T === null) {
        if (e.currentUid && e.enterMethod === 'byClick') {
          i.showIndoor(null)
          e.enterMethod = null
        }
      } else {
        e.enterMethod = 'byClick'
        if (e.currentUid) {
          i.showIndoor(e.currentUid, e._indoorData[e.currentUid].defaultFloor)
        }
        i.showIndoor(T, e._indoorData[T].defaultFloor)
      }
    })
    i.on('moveend', function () {
      if (this.getZoom() >= e._autoEnterZoom) {
        e._checkIndoorByMove()
      }
    })
    i.on('zoomend', function () {
      if (this.getZoom() >= e._autoEnterZoom) {
        e._checkIndoorByMove()
      } else {
        if (e.enterMethod !== 'byClick' && e.currentUid !== null) {
          this.showIndoor(null)
        }
      }
    })
  }
  cI.prototype._checkIndoorByMove = function () {
    var T = this._map
    var je = T.getSize()
    var jj = { x: je.width / 2, y: je.height / 2 }
    var ji = Math.max(je.width, je.height)
    var jk = []
    for (var jf in this._indoorData) {
      var e = this._indoorData[jf].center
      var i8 = T.pointToPixelIn(new bo.Point(e[0], e[1]))
      var jb = b1(jj, i8)
      jk.push({ uid: jf, distance: jb })
    }
    if (jk.length === 0) {
      return
    }
    jk.sort(function (jl, i) {
      return jl.distance - i.distance
    })
    var ja = jk[0]
    var jg = T.getCenterIn()
    var i9 = false
    for (var jd = 0; jd < this._indoorData[ja.uid].contour.length; jd++) {
      if (bB([jg.lng, jg.lat], this._indoorData[ja.uid].contour[jd])) {
        i9 = true
        break
      }
    }
    if (i9 === false && ja.uid === 'e96b44200baa3b4082288acc') {
      var jc = this._indoorData[ja.uid].boundsMin
      var jh = this._indoorData[ja.uid].boundsMax
      if (
        jg.lng > jc[0] &&
        jg.lat > jc[1] &&
        jg.lng < jh[0] &&
        jg.lat < jh[1]
      ) {
        i9 = true
      }
    }
    if (i9) {
      if (this.enterMethod !== 'byClick') {
        if (this.currentUid !== null && this.currentUid !== ja.uid) {
          this._map.showIndoor(
            this.currentUid,
            this._indoorData[this.currentUid].defaultFloor
          )
        }
        if (this.currentUid !== ja.uid) {
          this._map.showIndoor(ja.uid, this._indoorData[ja.uid].defaultFloor)
        }
        this.enterMethod = 'byMove'
      }
    } else {
      if (this.enterMethod !== 'byClick') {
        this._map.showIndoor(null)
      }
    }
  }
  cI.prototype.setData = function (i8) {
    if (i8 === null) {
      return
    }
    for (var T in i8) {
      if (T === 'tileInfo') {
        continue
      }
      var i9 = i8[T].tileKey
      if (this._indoorData[T]) {
        if (!this._indoorData[T][i9]) {
          this._indoorData[T].tileKeys.push(i9)
          this._indoorData[T][i9] = true
        }
      } else {
        this._indoorData[T] = i8[T]
        this._indoorData[T].tileKeys = [i8[T].tileKey]
        this._indoorData[T][i9] = true
        for (var e = 0; e < this._indoorData[T].contour.length; e++) {
          this._map.addAreaSpot(this._indoorData[T].contour[e], {
            id: T + e,
            userData: { uid: T },
          })
        }
      }
    }
    if (this._map.getZoom() >= this._autoEnterZoom) {
      this._checkIndoorByMove()
    }
  }
  cI.prototype.removeData = function (T, i9) {
    if (!this._indoorData[T]) {
      return
    }
    var i8 = this._indoorData[T]
    for (var e = 0; e < i8.tileKeys.length; e++) {
      if (i8.tileKeys[e] === i9) {
        i8.tileKeys.splice(e, 1)
        break
      }
    }
    delete i8[i9]
    if (i8.tileKeys.length === 0) {
      delete this._indoorData[T]
    }
  }
  cI.prototype.getIndoorData = function (e) {
    return this._indoorData[e] || null
  }
  cI.prototype.getData = function () {
    return this._indoorData
  }
  bo.register(function (e) {
    e._indoorMgr = new cI(e)
  })
  var aO = (function () {
    var i8 = {}
    var jh = {}
    var jd = {}
    function jf(jj) {
      if (Object.prototype.toString.call(jj) === '[object Object]') {
        for (var ji in jj) {
          return false
        }
        return true
      } else {
        return false
      }
    }
    function je(jp, jq, jt, jm, js) {
      var ji = ji || null
      jm = jm || ji
      var jk
      if (jm) {
        jk = jg(jp, jq, jt, jm)
      } else {
        jk = T(jp, jq, jt, js)
      }
      var jo = jk.drawId
      var jj = jk.style
      var jr = jk.styleUpdate
      var ju = []
      if (!jo) {
        return ju
      }
      for (var jl = 0; jl < jo.length; jl++) {
        var jn = jr[jo[jl]] || jj[jo[jl]]
        if (jn) {
          switch (jq) {
            case 'polygon':
              jn = i9(jn, jp)
              break
            case 'line':
              jn = jc(jn, jp)
              break
            case 'pointText':
              jn = ja(jn, jp)
              break
            case 'point':
              jn = e(jn, jp)
              break
            case 'polygon3d':
              jn = jb(jn, jp)
              break
          }
          if (jn) {
            jn.did = jo[jl]
            ju[ju.length] = jn
          }
        }
      }
      return ju
    }
    function jg(jj, jl, jm, ji) {
      var jk = ji[2]
      switch (jl) {
        case 'point':
          jk = jk[0]
          break
        case 'pointText':
          jk = jk[1]
          break
        case 'line':
          jk = jk[3]
          break
        case 'polygon':
          jk = jk[4]
          break
        case 'polygon3d':
          jk = jk[5]
          break
      }
      var jo = jm - 1
      if (jl === 'line' && jm === 12) {
        jo = jm
      }
      var jp = ji[1][jo][0]
      var jn = jp[jj]
      if (!jn) {
        if (jl === 'point' || jl === 'pointText') {
          jp = ji[1][jm][0]
          jn = jp[jj]
        }
      }
      return { drawId: jn, style: jk, styleUpdate: [] }
    }
    function T(jm, jn, jq, jp) {
      if (!jp) {
        return { drawId: null, style: [], styleUpdate: [] }
      }
      var jo
      var jk = jp.baseFs
      if (jf(jp.zoomRegion)) {
        jo = jp.StyleBody || []
      } else {
        jo = jp.zoomStyleBody[jq] || []
      }
      var jj = jk[2]
      switch (jn) {
        case 'point':
          jj = jj[0]
          jo = jo[0] || {}
          break
        case 'pointText':
          jj = jj[1]
          jo = jo[1] || {}
          break
        case 'line':
          jj = jj[3]
          jo = jo[3] || {}
          break
        case 'polygon':
          jj = jj[4]
          jo = jo[4] || {}
          break
        case 'polygon3d':
          jj = jj[5]
          jo = jo[5] || {}
          break
      }
      var ji = jk[1][jq - 1][0]
      var jl = ji[jm]
      return { drawId: jl, style: jj, styleUpdate: jo }
    }
    function ja(jj, ji) {
      if (!jj || jj.length === 0) {
        return null
      }
      return {
        sid: ji,
        fontRgba: i(jj[0]),
        haloRgba: i(jj[1]),
        backRgba: i(jj[2]),
        fontSize: jj[3],
        haloSize: jj[4],
        fontWeight: jj[5],
        fontStyle: jj[6],
        density: jj[7],
      }
    }
    function e(jj, ji) {
      return {
        sid: ji,
        rank: jj[0],
        ucflag: jj[1],
        icon: jj[2],
        iconType: jj[3],
        nineGG: jj[4],
        density: jj[5],
        zoom: jj[6],
      }
    }
    function jc(jj, ji) {
      return {
        sid: ji,
        borderRgba: i(jj[0]),
        fillRgba: i(jj[1]),
        borderWidth: jj[2],
        fillWidth: jj[3],
        borderCap: jj[4],
        fillCap: jj[5],
        haveBorderLine: jj[6],
        haveBorderTexture: jj[7],
        haveFillTexture: jj[8],
        isUseBorderRgba: jj[9],
        isUseFillRgba: jj[10],
        borderTexture: jj[11],
        fillTexture: jj[12],
        borderTextureType: jj[13],
        fillTextureType: jj[14],
        isRealWidth: jj[15],
        haveArrow: jj[16],
        needRound: jj[17],
        realBorderWidth: jj[18],
      }
    }
    function i9(jj, ji) {
      return {
        sid: ji,
        fillRgba: i(jj[0]),
        borderRgba: i(jj[1]),
        borderWidth: jj[2],
        borderTexture: jj[3],
        borderTextureType: jj[4],
        waterStyle: jj[5],
        haloStyle: jj[6],
        textureStyle: jj[7],
        thickRgba: i(jj[8]),
      }
    }
    function jb(jj, ji) {
      return {
        sid: ji,
        filter: jj[0],
        ratio: jj[1],
        haveBorder: jj[2],
        borderWidth: jj[3],
        borderRgba: i(jj[4]),
        fillTop: i(jj[5]),
        fillSide: i(jj[6]),
        polyTexture: jj[7],
      }
    }
    function i(jn) {
      var jm = jn
      if (jd[jm]) {
        return jd[jm]
      }
      jn = jn >>> 0
      var jl = jn & 255
      var jk = (jn >> 8) & 255
      var ji = (jn >> 16) & 255
      var jj = (jn >> 24) & 255
      jd[jm] = [jl, jk, ji, jj]
      return jd[jm]
    }
    return {
      getStyleFromCache: function (jp, jk, jn, jo, jj, jm, ji) {
        jp = jp || 'default'
        var jl = jp + '-' + jk + '-' + jn + '-' + jo
        if (jm) {
          jl += '-indoor'
        }
        if (jj) {
          if (!jh[jl]) {
            jh[jl] = je(jk, jn, jo, jj)
          }
          return jh[jl]
        }
        if (!i8[jl]) {
          i8[jl] = je(jk, jn, jo, jj, ji)
        }
        return i8[jl]
      },
    }
  })()
  bo.register(function (i) {
    var e = new hk(i)
  })
  function hk(e) {
    e.container.appendChild(this.render())
    this.bind(e)
  }
  hk.prototype.render = function () {
    var i = document.createElement('div')
    i.className = 'click-ripple-container'
    var e = document.createElement('div')
    e.className = 'click-ripple'
    i.appendChild(e)
    this._div = i
    this._ripple = e
    return i
  }
  hk.prototype.bind = function (i) {
    var e = this
    i.addEventListener('spotclick', function (T) {
      if (!T.spots || T.spots.length === 0) {
        return
      }
      e._div.style.left = T.pixel.x + 'px'
      e._div.style.top = T.pixel.y + 'px'
      es.ac(e._ripple, 'ripple-playing')
    })
    es.on(e._ripple, 'transitionend', function () {
      es.rc(e._ripple, 'ripple-playing')
    })
  }
  function bI(e) {
    cJ.call(this)
    if (!e) {
      return
    }
    this._opts = {}
    this._map = e
    this._maxLat = 84.6
    this._minLat = -80.6
    this._maxLatMC = ia.convertLL2MC(new b8(this._maxLat, 0)).lat
    this._minLatMC = ia.convertLL2MC(new b8(this._minLat, 0)).lat
  }
  bI.inherits(cJ, 'ToolbarItem')
  es.extend(bI.prototype, {
    open: function () {
      if (this._isOpen == true) {
        return true
      }
      if (this._map._toolInUse) {
        return false
      }
      this._map._toolInUse = true
      this._isOpen = true
      return true
    },
    close: function () {
      if (!this._isOpen) {
        return
      }
      this._map._toolInUse = false
      this._isOpen = false
    },
    _checkStr: function (e) {
      if (!e) {
        return ''
      }
      return e.replace(/</g, '&lt;').replace(/>/g, '&gt;')
    },
  })
  function bZ(T, i) {
    bI.call(this, T)
    i = i || {}
    this._opts = es.extend(
      es.extend(this._opts || {}, {
        autoClear: false,
        tips: '测距',
        followText: '单击确定起点，双击结束绘制',
        unit: 'metric',
        showResult: true,
        lineColor: 'blue',
        lineStroke: 2,
        opacity: 1,
        lineStyle: 'solid',
        cursor: w.distCursor,
        styleCodes: { lnCode: 0, spCode: 0, slCode: 0, tlCode: 0 },
        enableMassClear: true,
      }),
      i
    )
    if (this._opts.showResult === false) {
      if (typeof i.tips === 'undefined') {
        this._opts.tips = '绘制折线'
      }
      if (!i.cursor) {
        this._opts.cursor = 'crosshair'
      }
    }
    if (this._opts.lineStroke <= 0) {
      this._opts.lineStroke = 2
    }
    if (this._opts.opacity > 1) {
      this._opts.opacity = 1
    } else {
      if (this._opts.opacity < 0) {
        this._opts.opacity = 0
      }
    }
    if (this._opts.lineStyle !== 'solid' && this._opts.lineStyle !== 'dashed') {
      this._opts.lineStyle = 'solid'
    }
    this._checked = false
    this._drawing = null
    this.followTitle = null
    this._totalDis = {}
    this._points = []
    this._paths = []
    this._dots = []
    this._segDistance = []
    this._overlays = []
    this._units = {
      metric: { name: 'metric', conv: 1, incon: 1000, u1: '米', u2: '公里' },
      us: { name: 'us', conv: 3.2808, incon: 5279.856, u1: '英尺', u2: '英里' },
    }
    if (!this._units[this._opts.unit]) {
      this._opts.unit = 'metric'
    }
    this._dLineColor = '#ff6319'
    this._dLineStroke = 3
    this._dOpacity = 0.8
    this._dLineStyle = 'solid'
    this._dCursor = w.distCursor
    if (this._opts.showResult) {
      this._opts.followText = '单击确定起点'
    }
    this._followTextM = '单击确定地点，双击结束'
    this._sectionMarkerTip = '单击可删除此点，拖拽可调整位置'
    this._movingTimerId = null
    if (this._opts.showResult) {
      this.text = '测距'
    } else {
      this.text = '绘线'
    }
    this._isOpen = false
    var e = this
    gi.load('tools', function () {
      e._draw()
    })
  }
  bZ.inherits(bI, 'PolylineTItem')
  es.extend(bZ.prototype, {
    setLineColor: function (e) {
      this._opts.lineColor = e
    },
    setLineStroke: function (e) {
      if (Math.round(e) > 0) {
        this._opts.lineStroke = Math.round(e)
      }
    },
    setOpacity: function (e) {
      if (e >= 0 && e <= 1) {
        this._opts.opacity = e
      }
    },
    setLineStyle: function (e) {
      if (e === 'solid' || e === 'dashed') {
        this._opts.lineStyle = e
      }
    },
    clear: function () {
      for (var T = 0, e = this._overlays.length; T < e; T++) {
        if (this._overlays[T]) {
          this._map.removeOverlay(this._overlays[T])
        }
      }
      this._overlays.length = 0
      for (var T = 0, e = this._dots.length; T < e; T++) {
        if (this._dots[T] && this._dots[T].parentNode) {
          this._dots[T].parentNode.removeChild(this._dots[T])
        }
      }
      this._dots.length = 0
    },
    setCursor: function (e) {
      if (this._opts.showResult === true) {
        return
      }
      this._opts.cursor = e
    },
    getCursor: function () {
      if (this._opts.showResult === true) {
        return this._dCursor
      }
      var e = this._opts.cursor.match(/^url\((.+)\)(,.*)?/)
      if (e !== null) {
        return e[1]
      } else {
        return this._opts.cursor
      }
    },
    showResult: function (e) {
      this._opts.showResult = !!e
    },
  })
  function bt() {
    var i9 = 3
    var jg = 256
    var i8 = Math.pow(2, 18 - i9) * jg
    var jh = 2
    var jf = (jh + 1) * i8
    var T = ia.convertLL2MC(new cd(180, 0))
    var jd = T.lng
    var jb = jf - jd
    var je = -3
    var e = je * i8
    var ja = ia.convertLL2MC(new cd(-180, 0))
    var jc = ja.lng
    var i = jc - e
    this._validPixels = jd / Math.pow(2, 18 - i9)
    this._mc180X = jd
    this._mcM180X = jc
    this._loopOffset = jb + i
    this._mcTSpan = jd - jc
    this._spaceDistance = jb
    this._mSpaceDistance = i
  }
  bt.prototype = {
    calcLoopParam: function (i8, i, jf) {
      jf = jf || 256
      var jc = 0
      var i9 = 3
      var jb = 6
      var ja = (jb * Math.pow(2, i - i9) * 256) / jf
      var je = ja / 2 - 1
      var jd = -ja / 2
      while (i8 > je) {
        i8 -= ja
        jc -= this._loopOffset
      }
      while (i8 < jd) {
        i8 += ja
        jc += this._loopOffset
      }
      var e = jc
      jc = Math.round(jc / Math.pow(2, 18 - i))
      return {
        offsetX: jc,
        geoOffsetX: e,
        col: i8,
        T: ja,
        maxCol: je,
        minCol: jd,
      }
    },
    calcLoopCenterPoint: function (i) {
      var e = i.lng
      while (e > this._mc180X) {
        e -= this._mcTSpan
      }
      while (e < this._mcM180X) {
        e += this._mcTSpan
      }
      i.lng = e
      return i
    },
    calcLoopMapBounds: function (T, i8) {
      var i = i8 || T.getCenter()
      var e = T.sw.lng
      var i9 = T.ne.lng
      while (i.lng > this._mc180X) {
        i.lng -= this._mcTSpan
        e -= this._mcTSpan
        i9 -= this._mcTSpan
      }
      while (i.lng < this._mcM180X) {
        i.lng += this._mcTSpan
        e += this._mcTSpan
        i9 += this._mcTSpan
      }
      T.sw.lng = e
      T.ne.lng = i9
      if (T.pointBottomLeft) {
        T.pointBottomLeft = this.calcLoopCenterPoint(T.pointBottomLeft)
        T.pointTopLeft = this.calcLoopCenterPoint(T.pointTopLeft)
        T.pointTopRight = this.calcLoopCenterPoint(T.pointTopRight)
        T.pointBottomRight = this.calcLoopCenterPoint(T.pointBottomRight)
      }
      return T
    },
    calcLoopTiles: function (jg, e, jk, jd) {
      jk = jk || 256
      var i9 = jd || Math.pow(2, 18 - e) * jk
      var jf = Math.floor(this._mc180X / i9)
      var jb = Math.floor(this._mcM180X / i9)
      var jh = Math.floor(this._loopOffset / i9)
      var ji = []
      for (var jc = 0; jc < jg.length; jc++) {
        var jj = jg[jc]
        var i8 = jj[0]
        var jl = jj[1]
        if (i8 >= jf) {
          var je = i8 + jh
          if (this.isTileBlank(je, e, jk) === true) {
            continue
          }
          var T = 'id_' + je + '_' + jl + '_' + e
          if (!jg[T]) {
            jg[T] = true
            ji.push([je, jl, e, 0])
          }
        } else {
          if (i8 <= jb) {
            var je = i8 - jh
            if (this.isTileBlank(je, e, jk) === true) {
              continue
            }
            var T = 'id_' + je + '_' + jl + '_' + e
            if (!jg[T]) {
              jg[T] = true
              ji.push([je, jl, e, 0])
            }
          }
        }
      }
      for (var jc = 0, ja = ji.length; jc < ja; jc++) {
        jg.push(ji[jc])
      }
      for (var jc = jg.length - 1; jc >= 0; jc--) {
        var i8 = jg[jc][0]
        if (this.isTileBlank(i8, e, jk)) {
          jg.splice(jc, 1)
        }
      }
      return jg
    },
    isTileBlank: function (T, i9, e) {
      var ja = Math.pow(2, i9 - 3)
      var i = Math.round(this._validPixels * ja)
      var i8 = (6 * ja * 256) / e
      while (T > i8 / 2 - 1) {
        T -= i8
      }
      while (T < -(i8 / 2)) {
        T += i8
      }
      if (T > 0 && T * e > i) {
        return true
      }
      if (T < 0 && Math.abs((T + 1) * e) > i) {
        return true
      }
      return false
    },
    isAddWidth: function (e, i) {
      return e < this._mcM180X || i > this._mc180X
    },
    pixelWidth: function (e, i) {
      if (e < 0) {
        e = -e
      }
      return Math.abs(e - this._mc180X) / Math.pow(2, 18 - i)
    },
    getSpaceDistanceInPixel: function (i) {
      var e = Math.round(
        (this._spaceDistance + this._mSpaceDistance) / Math.pow(2, 18 - i)
      )
      return e
    },
  }
  var ev = new bt()
  var iB = (function () {
    var i = true
    var i9 = 256
    var e = true
    var jb = iN('ditu', 'normalTraffic')
    var i8 = jb.udt
    var jc = '//its.map.baidu.com/traffic/'
    var ja = [
      [2, '79,210,125,1', 3, 2, 0, [], 0, 0],
      [2, '79,210,125,1', 3, 2, 0, [], 0, 0],
      [2, '79,210,125,1', 4, 2, 0, [], 0, 0],
      [2, '79,210,125,1', 5, 2, 0, [], 0, 0],
      [2, '79,210,125,1', 6, 2, 0, [], 0, 0],
      [2, '255,208,69,1', 3, 2, 0, [], 0, 0],
      [2, '255,208,69,1', 3, 2, 0, [], 0, 0],
      [2, '255,208,69,1', 4, 2, 0, [], 0, 0],
      [2, '255,208,69,1', 5, 2, 0, [], 0, 0],
      [2, '255,208,69,1', 6, 2, 0, [], 0, 0],
      [2, '232,14,14,1', 3, 2, 0, [], 0, 0],
      [2, '232,14,14,1', 3, 2, 0, [], 0, 0],
      [2, '232,14,14,1', 4, 2, 0, [], 0, 0],
      [2, '232,14,14,1', 5, 2, 0, [], 0, 0],
      [2, '232,14,14,1', 6, 2, 0, [], 0, 0],
      [2, '181,0,0,1', 3, 2, 0, [], 0, 0],
      [2, '181,0,0,1', 3, 2, 0, [], 0, 0],
      [2, '181,0,0,1', 4, 2, 0, [], 0, 0],
      [2, '181,0,0,1', 5, 2, 0, [], 0, 0],
      [2, '181,0,0,1', 6, 2, 0, [], 0, 0],
      [2, '255,255,255,1', 4, 0, 0, [], 0, 0],
      [2, '255,255,255,1', 5.5, 0, 0, [], 0, 0],
      [2, '255,255,255,1', 7, 0, 0, [], 0, 0],
      [2, '255,255,255,1', 8.5, 0, 0, [], 0, 0],
      [2, '255,255,255,1', 10, 0, 0, [], 0, 0],
    ]
    var T = new gI({
      transparentPng: true,
      dataType: 2,
      cacheSize: 256,
      clipTile: true,
      isFlat: true,
    })
    T.zIndex = 2
    T.getTilesUrl = function (jf, jg) {
      if (!jf || jg < 7) {
        return null
      }
      var je = jf.x
      var jh = jf.y
      var jd =
        jc +
        'TrafficTileService?level=' +
        jg +
        '&x=' +
        je +
        '&y=' +
        jh +
        '&time=' +
        +new Date()
      if (this.map.getRenderType() === 'webgl') {
        jd =
          jc + '?qt=vtraffic&z=' + jg + '&x=' + je + '&y=' + jh + '&udt=' + i8
      }
      return jd
    }
    T.setColors = function (jd) {
      for (var jg = 0; jg < ja.length; jg++) {
        var jf = Math.floor(jg / 5)
        var je = jd[jf]
        if (je) {
          if (Object.prototype.toString.call(je) === '[object String]') {
            je = gM.parseCSSColor(je)
          }
          ja[jg][1] = [je[0], je[1], je[2], je[3] / 255].join(',')
        }
      }
    }
    T.setEdge = function (jd) {
      e = !!jd
    }
    T.processData = function (jg) {
      var jk = jg.content
      var ji = 10
      if (typeof jg.precision === 'number') {
        ji = jg.precision * 10
      }
      var jr = { road: [[], []] }
      if (!jk) {
        return jr
      }
      var jp = jk.tf
      if (!jp) {
        return jr
      }
      for (var jh = 0; jh < jp.length; jh++) {
        var jq = jp[jh][1]
        var jo = []
        var jm = 0
        var jl = 0
        var jn = ja[jp[jh][3]]
        for (var jf = 0, jd = jq.length; jf < jd / 2; jf++) {
          jm += jq[jf * 2] / ji
          jl += jq[jf * 2 + 1] / ji
          jo.push(jm, 256 - jl)
        }
        var je = jn[1].split(',')
        je[3] = je[3] * 255
        var jj = jn[2] / 2
        if (e) {
          jr.road[0].push([jo, 1, 2, [255, 255, 255, 255], jj + 2])
        }
        jr.road[1].push([jo, 1, 2, je, jj])
      }
      return jr
    }
    return T
  })()
  function ii() {}
  ii.prototype = iB
  function dw(e) {
    d6.call(this)
    e = e || {}
    this._opts = {}
    this._opts.districts = e.name || ''
    this._opts.kind = e.kind || 0
    this._config = {}
    this._config.strokeColor = e.strokeColor || '#00f'
    this._config.strokeOpacity =
      typeof e.strokeOpacity === 'number' ? e.strokeOpacity : 1
    bV(this._config.strokeOpacity, 0, 1)
    this._config.fillColor = e.fillColor || '#ff0'
    this._config.fillOpacity =
      typeof e.fillOpacity === 'number' ? e.fillOpacity : 0.6
    bV(this._config.fillOpacity, 0, 1)
    this._config.strokeWeight = e.strokeWeight || 1
    this._config.viewport = e.viewport || false
    this.disOverlays = []
    this.eventAndCallback = {}
    var i = this
    gi.load('layer', function () {
      i._asyncSearch()
    })
  }
  dw.inherits(cJ, 'DistrictLayer')
  es.extend(dw.prototype, {
    initialize: function (e) {
      this._map = e
      this.addDistrict()
    },
    removeDistrict: function (i, e) {
      this._map = i
      this.deleteDistrict(e)
    },
    toString: function () {
      return 'DistrictLayer'
    },
  })
  function iX(i) {
    var i = i || {}
    const i9 = i.transform || { source: 'EPSG3857', target: 'BD09MC' }
    const i8 = i.tileUrlTemplate || ''
    const jc =
      i.xTemplate ||
      function (jj, jl, jk) {
        return jj
      }
    const jg =
      i.yTemplate ||
      (i.tms
        ? function (jj, jl, jk) {
            return Math.pow(2, jk) - jl - 1
          }
        : function (jj, jl, jk) {
            return jl
          })
    const jb =
      i.zTemplate ||
      function (jj, jl, jk) {
        return jk
      }
    const jf =
      i.bTemplate ||
      function (jj, jm, jl) {
        const jk = da.getTileRangeExtent([jl, jj, jm])
        return jk.minX + ',' + jk.minY + ',' + jk.maxX + ',' + jk.maxY
      }
    var jh = i.extent || []
    const ja = i.extentCRSIsWGS84 || false
    var T = i.minZoom || 0
    var je = i.maxZoom || 23
    var jd = true
    var ji = new gI({
      transform: i9,
      transparentPng: jd,
      dataType: 1,
      tileTypeName: 'xyz',
      cacheSize: 256,
      customLayer: true,
      clipTile: false,
      boundary: i.boundary || false,
      useThumbData: i.useThumbData || false,
    })
    ji.zIndex = 2
    jh.length === 4 && ja && (jh = da.fromEPSG4326(jh))
    ji.getTilesUrl = function (jk, jq, jo) {
      if (!jk || jq < 0 || jq < T || jq > je) {
        ji.tileCache.clear()
        return null
      }
      if (i9.source !== 'BD09MC') {
        jk.x = da.getTilesLoop(jq, jk.x)
      }
      var jp = da.getTileRangeExtent([jq, jk.x, jk.y])
      var jn = e([jp.minX, jp.minY, jp.maxX, jp.maxY])
      if (!jn) {
        return null
      }
      var jl = ''
      if (i8) {
        jl = i8
        var jm = /[^\{}]*\{(.*)\}[^\}]*/
        jl.match(jm)
        var jj = []
        if (RegExp.$1) {
          jj = RegExp.$1.split(',')
        }
        jl = jl.replace(/\{(.*)\}/, jj[(jk.x + jk.y) % jj.length])
        jl = jl.replace(/\[x\]/gi, jc(jk.x, jk.y, jq))
        jl = jl.replace(/\[y\]/gi, jg(jk.x, jk.y, jq))
        jl = jl.replace(/\[z\]/gi, jb(jk.x, jk.y, jq))
        jl = jl.replace(/\[b\]/gi, jf(jk.x, jk.y, jq))
      } else {
        return null
      }
      return jl
    }
    function e(jj) {
      if (jh && jh instanceof Array && jh.length === 4) {
        if (
          jh[0] <= jj[2] &&
          jh[1] <= jj[3] &&
          jh[2] >= jj[0] &&
          jh[3] >= jj[1]
        ) {
          return true
        } else {
          return false
        }
      }
      return true
    }
    return ji
  }
  function c2(i) {
    this.src = cF()
    this.tileMaskUvCache = new at(64, { clearCallback: function (ja) {} })
    var i9 = 6
    if (i.pixelMap) {
      this.opacity =
        typeof i.pixelMap.opacity === 'number' ? i.pixelMap.opacity : 1
      bV(this.opacity, 0, 1)
      if (this.opacity < 1) {
        i.useThumbData = false
      }
      var i8 = i.pixelMap || {}
      this.colors = i8.colors || [
        '#F9F871',
        '#FFC75F',
        '#FF9671',
        '#FF6F91',
        '#D65DB1',
        '#845EC2',
      ]
      this.positions = i8.positions || [0, 0.2, 0.4, 0.6, 0.8, 1]
      this.domain = i8.domain || [0, 255]
      this.clamp = i8.clamp || this.domain
      this.noData = i8.noData !== undefined ? i8.noData : -99999
      this.fomularC =
        i8.fomularC || 'float generateValue(vec4 pixel){return pixel.r * 255.;}'
      this.fomularJS =
        i8.fomularJS ||
        function (ja) {
          return ja.r
        }
      this.maskPng = i8.maskPng || null
      if (this.maskPng) {
        this.loadMaskPng(this.maskPng)
      }
      this.maskData = i8.maskData || -1
      this.maskCoord = i8.maskCoord || null
      this.fHashcode = l({ str: this.fomularC })
      var e = this.canPixelMap()
      if (e) {
        this.isPixelMap = true
        this.setPixelMap()
      }
      i9 = i.pixelMap.cacheSize || i9
    }
    var T = new iX(i)
    T.ontology = this
    this.layer = T
    this.cacheSize = i9
    this.tileCache = new at(this.cacheSize, { clearCallback: function (ja) {} })
    this.tileImageDataCache = new at(this.cacheSize, {
      clearCallback: function (ja) {},
    })
  }
  c2.inherits(es.BaseClass, 'PixelLayer')
  es.extend(c2.prototype, {
    canPixelMap: function () {
      if (this.colors && this.positions) {
        return true
      }
      return false
    },
    setPixelMap: function () {
      if (!this.isPixelMap || !this.canPixelMap()) {
        return
      }
      var i = this.colors
      var e = this.positions
      this.pHashcode = l({ colors: i, positions: e })
      this.pixelColorMap = gM.generateColorRamp(i, e)
    },
    setDomain: function (e) {
      if (e instanceof Array && e.length === 2) {
        this.domain = e
        this.doOnceDraw()
      }
    },
    setClamp: function (e) {
      if (e instanceof Array && e.length === 2) {
        this.clamp = e
        this.doOnceDraw()
      }
    },
    setNoData: function (e) {
      this.noData = e
      this.doOnceDraw()
    },
    setPositions: function (e) {
      this.positions = e
      this.setPixelMap()
      this.doOnceDraw()
    },
    setColors: function (e) {
      this.colors = e
      this.setPixelMap()
      this.doOnceDraw()
    },
    setFomular: function (e, i) {
      if (e && i) {
        this.fomularJS = e
        this.fomularC = i
        this.fHashcode = l({ str: this.fomularC })
        this.doOnceDraw()
      }
    },
    setOpacity: function (e) {
      this.opacity = e
      this.doOnceDraw()
    },
    setIsPixelMap: function (e) {
      this.isPixelMap = e
      this.doOnceDraw()
    },
    setMaskPng: function (e) {
      this.maskPng = e
      this.loadMaskPng(this.maskPng)
      this.doOnceDraw()
    },
    setMaskData: function (e) {
      this.maskData = e
      this.doOnceDraw()
    },
    setMaskCoord: function (e) {
      this.maskCoord = e || null
      this.calMaskBox()
      this.doOnceDraw()
    },
    doOnceDraw: function () {
      if (this.layer.map) {
        var e = new e7('onupdate')
        this.layer.map.dispatchEvent(e)
      }
    },
    _getInLayer: function (jg) {
      if (!this.map) {
        return null
      }
      var jf = Math.floor(this.map.getZoom())
      var i8 = da.transformBDmcPoint(jg)
      var jc = da.getTileCoordForXYAndZ_(i8[0], i8[1], jf, false)
      var T = jc.join('-')
      var e = this.tileCache.getData(T)
      if (e) {
        return e
      }
      var i9 = this.layer.zIndex
      var jb = this.map._featureMgr.result.bkData
      var jd = jb[i9][2]
      var jh = null
      for (var ja = 0; ja < jd.length; ja++) {
        var jc = jd[ja]
        var je =
          jc.tileInfo.zoom + '-' + jc.tileInfo.col + '-' + jc.tileInfo.row
        if (T === je) {
          jh = jc
          break
        }
      }
      this.tileCache.setData(T, jh)
      return jh
    },
    _initEvent: function (i9) {
      this.map = i9
      var T = this
      this._layerMouseEvent = function (jd) {
        if (!T.map) {
          return
        }
        var jb
        var i = jd.point
        var jc = T._getInLayer(i)
        if (jc) {
          T.prox = jc
          jb = new e7('onmousemove')
          T.map.platform.style.cursor = T.map.config.overlayMoveCursor
        } else {
          T.map.platform.style.cursor = T.map.config.defaultCursor
          T.prox = null
        }
        if (jb) {
          jb.point = jd.point
          jb.pixel = jd.pixel
          jb.latLng = jd.latlng
          T.dispatchEvent(jb)
        }
      }
      this._layerClickEvent = function (jd) {
        if (!T.map) {
          return
        }
        var jb
        var i = jd.point
        var jc = T.getImagePixel(i)
        if (jc) {
          jb = new e7(jd.type)
          jb.point = i
          jb.pixel = jd.pixel
          jb.latLng = jd.latlng
          jb.color = jc
          jb.value = T.getValue(jb.color)
          T.dispatchEvent(jb)
        }
      }
      i9.addEventListener('onmousemove', this._layerMouseEvent)
      var i8 = ['onclick', 'dblclick']
      for (var e = 0; e < i8.length; e++) {
        var ja = i8[e]
        i9.addEventListener(ja, this._layerClickEvent)
      }
      i9.addEventListener('removetilelayer', function (i) {
        if (i.target && i.target.ontology) {
          if (i.target.ontology.src === T.src) {
            T.prox = null
            T.tileCache.clear()
            T.tileImageDataCache.clear()
            T.tileMaskUvCache.clear()
            i9.removeEventListener('onmousemove', this._layerMouseEvent)
            i9.removeEventListener('onclick', this._layerClickEvent)
            i9.removeEventListener('ondblclick', this._layerClickEvent)
          }
        }
      })
    },
    getImagePixel: function (jd) {
      if (!this.map) {
        return null
      }
      var i8 = da.transformBDmcPoint(jd)
      var jc = this._getInLayer(jd)
      if (!jc) {
        return null
      }
      if (!this.getImageMaskPixel(i8)) {
        return null
      }
      var ja = [jc.tileInfo.zoom, jc.tileInfo.col, jc.tileInfo.row]
      var jb = da.getTileRangeExtent(ja)
      var e = this.getImageObject(jc.textureSource, ja.join('-'))
      var T = Math.floor(((i8[0] - jb.minX) / (jb.maxX - jb.minX)) * e.width)
      var i = Math.floor(((-i8[1] + jb.maxY) / (jb.maxY - jb.minY)) * e.height)
      var i9 = Math.floor((i * e.width + T) * 4)
      return [
        e.data.data[i9],
        e.data.data[i9 + 1],
        e.data.data[i9 + 2],
        e.data.data[i9 + 3],
      ]
    },
    getImageObject: function (i9, i8) {
      var ja = this.tileImageDataCache.getData(i8)
      if (ja) {
        return ja
      }
      var i = document.createElement('canvas')
      i.width = i9.width
      i.height = i9.height
      var T = i.getContext('2d')
      T.drawImage(i9, 0, 0, i9.width, i9.height)
      var e = {
        width: i9.width,
        height: i9.height,
        data: T.getImageData(0, 0, i9.width, i9.height),
      }
      this.tileImageDataCache.setData(i8, e)
      T = null
      i = null
      return e
    },
    getValue: function (i) {
      if (this.isPixelMap && i && this.fomularJS) {
        if (!(i instanceof Array)) {
          i = this.getImagePixel(i.point)
        }
        var e = this.fomularJS({ r: i[0], g: i[1], b: i[2], a: i[3] })
        if (e >= this.clamp[0] && e <= this.clamp[1]) {
          return e
        }
      }
      return null
    },
    setMaskImageObject: function (T) {
      var e = document.createElement('canvas')
      e.width = T.width
      e.height = T.height
      var i = e.getContext('2d')
      i.drawImage(T, 0, 0, T.width, T.height)
      this.imageMaskObject = {
        width: T.width,
        height: T.height,
        data: i.getImageData(0, 0, T.width, T.height),
      }
      i = null
      e = null
    },
    getImageMaskPixel: function (e) {
      if (!this.imageMaskObject || !this.maskBox) {
        return true
      }
      var i8 = [e]
      var jd = this.maskBox
      var ja = jd[1][0] - jd[0][0]
      var i9 = jd[1][1] - jd[0][1]
      var T = Math.floor(
        ((i8[0][0] - jd[0][0]) / ja) * this.imageMaskObject.width
      )
      var i = Math.floor(
        ((-i8[0][1] + jd[1][1]) / i9) * this.imageMaskObject.height
      )
      var jc = Math.floor((i * this.imageMaskObject.width + T) * 4)
      if (T > this.imageMaskObject.width || T < 0) {
        return null
      }
      if (i > this.imageMaskObject.height || i < 0) {
        return null
      }
      var jb = this.imageMaskObject.data.data
      if (jc + 3 > jb.length) {
        return false
      }
      if (jb[jc + 3] > 0) {
        if (this.maskData > -1 && this.maskData !== jb[jc]) {
          return false
        }
        return true
      }
      return false
    },
    calMaskBox: function () {
      var T = this.maskCoord || []
      if (this.hasMaskPng && T && T.length === 2) {
        var e = []
        for (var i8 = 0; i8 < T.length; i8++) {
          e[i8] = da.transformBDmcPoint(ia.convertLL2MC(T[i8]))
        }
        this.maskBox = e
        this.tileMaskUvCache.clear()
      } else {
        this.maskBox = null
      }
    },
    buildFillMaskVertex: function (je, jc, jb) {
      var jd = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1]
      if (!this.maskBox) {
        return jd
      }
      var jg = [je, jc, jb].join('-')
      var e = this.tileMaskUvCache.getData(jg)
      if (e) {
        return e
      }
      if (this.hasMaskPng) {
        var jj = this.maskBox || []
        var ja = [jb, je, jc]
        var jf = da.getTileRangeExtent(ja)
        var i9 = jj[1][0] - jj[0][0]
        var T = jj[1][1] - jj[0][1]
        var ji = (jf.minX - jj[0][0]) / i9
        var jh = (jf.minY - jj[0][1]) / T
        var i8 = (jf.maxX - jj[0][0]) / i9
        var i = (jf.maxY - jj[0][1]) / T
        jd = [ji, jh, i8, jh, i8, i, ji, jh, i8, i, ji, i]
      }
      this.tileMaskUvCache.setData(jg, jd)
      return jd
    },
    loadMaskPng: function (T) {
      var e = this
      function i(i9, i8) {
        if (i8) {
          e.hasMaskPng = true
          e.setMaskImageObject(i9)
          e.calMaskBox()
          e.doOnceDraw()
        } else {
          e.hasMaskPng = false
        }
        e.maskTextureSource = i8 ? i9 : null
      }
      this.imageLoad(T, i)
    },
    imageLoad: function (i, i9) {
      if (!i) {
        i9 && i9(null, false)
      }
      var e = new Image()
      e.crossOrigin = 'anonymous'
      e.onload = function i8() {
        i9 && i9(this, true)
      }
      e.onerror = function T() {
        i9 && i9(null, false)
      }
      e.src = i
    },
    toString: function () {
      return 'PixelLayer'
    },
  })
  var O = function (e) {
    var e = e || {}
    this.inputCRS = e.inputCRS || 'EPSG3857'
    this.outCRS = e.outCRS || 'EPSG3857'
    this.minZoom = e.minZoom || 3
    this.maxZoom = e.maxZoom || 19
    this.retry = e.retry || false
    this.retryTime = e.retryTime || 600
    this.useThumbData = e.useThumbData || true
    this.lastZoom = 3
    this.cacheSize = e.cacheSize || 128
    this.tileType = hb.getInstance('web')
    this._mapCenter = {}
    this._featureMgr = [[], [], []]
    this._gridRefs = { row: {}, col: {} }
    this.tileCache = new at(this.cacheSize, { clearCallback: function (i) {} })
  }
  O.inherits(cJ, 'BaiduLayer')
  es.extend(O.prototype, {
    fetch: function (i, i8, i9) {
      var i8 = Math.ceil(i8) || 3
      var i = i || []
      if (i.length !== 4 || i8 > 19) {
        i9(null)
        return
      }
      var e = this.getZoomState(i8)
      var T = this.calCoord(i, i8, e)
      this.curViewTilesInfo = this.calTilesOrders(T.sw, T.ne, i8)
      this.clearData()
      this.clearRefs()
      this.loadLayerData(this.curViewTilesInfo, e, true, i9)
    },
    calCoord: function (T, i8, i) {
      if (T.length !== 4) {
        return
      }
      var e = gcoord.transform(
        [T[0], T[1]],
        gcoord[this.inputCRS],
        gcoord.BD09MC
      )
      var i9 = gcoord.transform(
        [T[2], T[3]],
        gcoord[this.inputCRS],
        gcoord.BD09MC
      )
      if (i9[1] > 19505879.362428114 || e[1] < -15949096.637571886) {
        i9[1] = 19505879.362428114
        e[1] = -15949096.637571886
      }
      this._mapCenter[i8] = new cd((e[0] + i9[0]) / 2, (e[1] + i9[1]) / 2)
      return { sw: e, ne: i9 }
    },
    calTilesOrders: function (jd, jj, jf) {
      var jg = this.tileType.getMercatorSize(jf, jf)
      var jb = [Math.floor(jd[0] / jg), Math.floor(jd[1] / jg)]
      var i = [Math.floor(jj[0] / jg), Math.floor(jj[1] / jg)]
      var jc = jb[0] - 1
      var ja = i[0] + 2
      var i9 = jb[1] - 1
      var ji = i[1] + 2
      var je = []
      for (var i8 = jc; i8 < ja; i8++) {
        for (var jh = i9; jh < ji; jh++) {
          var T = {
            col: i8,
            row: jh,
            zoom: jf,
            useZoom: jf,
            tileTypeName: 'web',
            loopOffsetX: 0,
            tileSize: 256,
            baseTileSize: 256,
            mercatorSize: jg,
            combine: false,
            dataIndex: 256,
          }
          je.push(T)
          var e = 'id_' + i8 + '_' + jh + '_' + jf
          je[e] = true
        }
      }
      je.sort(
        (function (jk) {
          return function (jl, jm) {
            return (
              0.4 * Math.abs(jl.col - jk[0]) +
              0.6 * Math.abs(jl.row - jk[1]) -
              (0.4 * Math.abs(jm.col - jk[0]) + 0.6 * Math.abs(jm.row - jk[1]))
            )
          }
        })([(jc + ja) / 2, (i9 + ji) / 2])
      )
      je.zoom = jf
      je.tileTypeName = 'web'
      return je
    },
    getZoomState: function (i) {
      var e = i - this.lastZoom
      if (e > 0) {
        this.zoomState = 1
      } else {
        if (e < 0) {
          this.zoomState = -1
        }
      }
      this.lastZoom = i
      return this.zoomState || 0
    },
    loadLayerData: function (jf, i8, i9, je) {
      this.thumbCache = {}
      if (i9) {
        for (var jc = 0, ja = jf.length; jc < ja; jc++) {
          var T = jf[jc]
          var jb = this.getTileKey(T)
          var e = this.tileCache.getData(jb)
          if (e && e.status === 'ready') {
            e.key = jb
            this.setData(e, 2)
          } else {
            if (this.useThumbData) {
              i8 === 1 && this.setThumbData(T.col, T.row, T.zoom, T.useZoom, i8)
            }
          }
        }
        this.calOutData(je)
      }
      for (var jc = 0, ja = jf.length; jc < ja; jc++) {
        var T = jf[jc]
        var jb = this.getTileKey(T)
        var e = this.tileCache.getData(jb)
        if (!e) {
          this.tileCache.setData(jb, {})
          var jd = this
          this.loadRasterTileData(T, function (i, jg) {
            jd.rasterTileDataCbk(i, jg, je)
          })
        }
      }
    },
    loadRasterTileData: function (i, e) {
      var T = new Image()
      var i9 = i.col
      var jc = i.row
      var ja = i.zoom
      var i8 = this.getTilesUrl(new eL(i9, jc), ja)
      if (!i8) {
        return
      }
      var jb = this.getTileKey(i)
      T = this.loadTileImage(i8, i, jb, e)
      T.tileInfo = i
    },
    loadTileImage: function (jc, e, T, ja) {
      var i8 = new Image()
      i8.crossOrigin = 'anonymous'
      var jb = this
      var i9
      function jd() {
        if (jb.retry) {
          i9 && clearInterval(i9)
          i9 = null
        }
      }
      if (this.retry) {
        var i = 1
        i9 = setInterval(function () {
          if (i > 3) {
            jd()
            return
          }
          var je = jb.getTilesUrl(new eL(e.col, e.row), e.zoom, i)
          i8.src = je
          i++
        }, this.retryTime)
      }
      i8.onload = function () {
        jd()
        ja && ja(this, T)
      }
      i8.onerror = function () {
        jd()
        ja && ja(null, T)
      }
      i8.src = jc
      return i8
    },
    rasterTileDataCbk: function (i9, i8, jc) {
      if (!i9 || typeof i9 === 'string') {
        this.tileCache.removeData(i8)
        return
      }
      var i = i9.tileInfo
      var T = i.col
      var je = i.row
      var jd = i.zoom
      var e = this.tileCache.getData(i8)
      if (!e) {
        return
      }
      e.textureSource = i9
      e.dataType = fY
      e.tileInfo = i
      e.status = 'ready'
      this.tileCache.setData(i8, e)
      var ja = 'id_' + T + '_' + je + '_' + jd
      var jb = false
      if (this.curViewTilesInfo[ja]) {
        e.png8 = this.png8 || false
        e.key = i8
        this.setData(e, 2)
        jb = true
      }
      if (jb) {
        this.calOutData(jc, e)
      }
    },
    getTilesUrl: function (i9, jg, i) {
      var jb = i || 0
      var T = i9.x
      var jh = i9.y
      var jd = iN('ditu', 'normal')
      var jc = jd.udt
      var jf = dO.B_NORMAL_MAP.tileUrls
      var ja = Math.abs(T + jh + jb) % jf.length
      var je = jf[ja]
      if (T < 0) {
        T = 'M' + -T
      }
      if (jh < 0) {
        jh = 'M' + -jh
      }
      var i8 = 'x=' + T + '&y=' + jh + '&z=' + Math.floor(jg)
      i8 += '&styles=pl&scaler=2&udt=' + jc + '&from=jsapi3_0'
      var e = je + '?qt=vtile&' + i8
      return e
    },
    calOutData: function (je, T) {
      if (!T) {
        for (var jb = 0; jb < this._featureMgr.length; jb++) {
          var e = this._featureMgr[jb]
          for (var i9 = 0; i9 < e.length; i9++) {
            var i8 = e[i9].tileInfo
            if (jb === 2) {
              var jc = e[i9].extent
              if (jc) {
                this.addRefs(jc, i8.col, i8.row)
              } else {
                var jd = this.calBoxCoord(i8)
                if (!jd) {
                  continue
                }
                e[i9].extent = this.findRefs(jd, i8.col, i8.row)
              }
            }
          }
        }
        je({
          size: this.curViewTilesInfo.length,
          zoom: this.lastZoom,
          data: this._featureMgr,
        })
      } else {
        var ja = this.calBoxCoord(T.tileInfo)
        if (!ja) {
          return
        }
        T.extent = this.findRefs(ja, T.tileInfo.col, T.tileInfo.row)
        je({
          zoom: this.lastZoom,
          size: this.curViewTilesInfo.length,
          data: [[], [], [T]],
        })
      }
    },
    calOutData_back: function (jg, i8) {
      if (!i8) {
        var ja
        var jh
        var je
        for (var jc = 0; jc < this._featureMgr.length; jc++) {
          var T = this._featureMgr[jc]
          for (var jb = 0; jb < T.length; jb++) {
            var i9 = T[jb].tileInfo
            if (jc === 2) {
              if (jb === 0) {
                var jd = this.calBoxCoord(i9)
                T[0].extent = jd
                ja = T[0]
                jh = jd[2] - jd[0]
                je = jd[3] - jd[1]
              } else {
                if (ja && jh && je) {
                  var e = (i9.row - ja.tileInfo.row) * je
                  var jf = (i9.col - ja.tileInfo.col) * jh
                  var jd = ja.extent
                  T[jb].extent = [jd[0] + jf, jd[1] + e, jd[2] + jf, jd[3] + e]
                }
              }
            } else {
              var jd = this.calBoxCoord(i9)
              T[jb].extent = jd
            }
          }
        }
        jg({
          size: this.curViewTilesInfo.length,
          zoom: this.lastZoom,
          data: this._featureMgr,
        })
      } else {
        if (this._featureMgr[2].length === 1) {
          var jd = this.calBoxCoord(i8.tileInfo)
          i8.extent = jd
          this.featureCell = i8
          this.cellW = jd[2] - jd[0]
          this.cellH = jd[3] - jd[1]
        } else {
          var e = (i8.tileInfo.row - this.featureCell.tileInfo.row) * this.cellH
          var jf =
            (i8.tileInfo.col - this.featureCell.tileInfo.col) * this.cellW
          var jd = this.featureCell.extent
          i8.extent = [jd[0] + jf, jd[1] + e, jd[2] + jf, jd[3] + e]
        }
        jg({
          zoom: this.lastZoom,
          size: this.curViewTilesInfo.length,
          data: [[], [], [i8]],
        })
      }
    },
    calBoxCoord: function (e) {
      var i = ia.prototype.tileToBound(e, this._mapCenter[e.zoom]).LL
      var T = gcoord.transform(
        [i.sw.lng, i.sw.lat],
        gcoord.BD09LL,
        gcoord[this.outCRS]
      )
      var i8 = gcoord.transform(
        [i.ne.lng, i.ne.lat],
        gcoord.BD09LL,
        gcoord[this.outCRS]
      )
      return [T[0], T[1], i8[0], i8[1]]
    },
    clearData: function () {
      this._featureMgr = [[], [], []]
    },
    addRefs: function (i, e, T) {
      this._gridRefs.row[T] = i[1]
      this._gridRefs.row[T + 1] = i[3]
      this._gridRefs.col[e] = i[0]
      this._gridRefs.col[e + 1] = i[2]
    },
    findRefs: function (i, e, i8) {
      var T = []
      this._gridRefs.row[i8] && (T[1] = this._gridRefs.row[i8])
      this._gridRefs.row[i8 + 1] && (T[3] = this._gridRefs.row[i8 + 1])
      this._gridRefs.col[e] && (T[0] = this._gridRefs.col[e])
      this._gridRefs.col[e + 1] && (T[2] = this._gridRefs.col[e + 1])
      !this._gridRefs.row[i8] &&
        (this._gridRefs.row[i8] = i[1]) &&
        (T[1] = i[1])
      !this._gridRefs.row[i8 + 1] &&
        (this._gridRefs.row[i8 + 1] = i[3]) &&
        (T[3] = i[3])
      !this._gridRefs.col[e] && (this._gridRefs.col[e] = i[0]) && (T[0] = i[0])
      !this._gridRefs.col[e + 1] &&
        (this._gridRefs.col[e + 1] = i[2]) &&
        (T[2] = i[2])
      return T
    },
    clearRefs: function () {
      this._gridRefs = { row: {}, col: {} }
    },
    destroy: function () {
      this.tileCache.clear()
      this.clearData()
      this.clearRefs()
      this._mapCenter = {}
    },
    setData: function (i9, T) {
      var e = this._featureMgr[T]
      for (var i8 = 0; i8 < e.length; i8++) {
        if (e[i8].key && e[i8].key === i9.key) {
          e[i8] = i9
          return
        }
      }
      e.push(i9)
    },
    getTileKey: function (e, i8) {
      i8 = i8 || {}
      var i = typeof i8.useZoom === 'number' ? i8.useZoom : e.useZoom
      var T = 'default'
      return 'web_' + T + '_' + e.col + '_' + e.row + '_' + e.zoom + '_' + i
    },
    setThumbData: function (i, i9, i8, e, T) {
      if (T === 1) {
        if (this._findParentZoomTile(i, i9, i8, e, 8) === false) {
          this._findChildZoomTile(i, i9, i8, e, 3)
        }
      } else {
        if (T === -1) {
          if (this._findChildZoomTile(i, i9, i8, e, 3) === false) {
            this._findParentZoomTile(i, i9, i8, e, 8)
          }
        }
      }
      this.sortThumbData()
    },
    _findParentZoomTile: function (jb, jk, jj, i9, je) {
      var ja = 'web'
      var T = 3
      var e = jb
      var jh = jk
      var jf = jj
      var jg = i9
      for (var jd = 1; jd <= je; jd++) {
        var i8 = this.tileType.getParentTile(e, jh, jf, jg, T)
        if (i8 === null) {
          continue
        }
        var ji = this.getTileKey(i8)
        var jc = this.tileCache.getData(ji)
        if (jc && jc.status === 'ready') {
          if (this.thumbCache[ji]) {
            continue
          }
          jc.key = ji
          this.setData(jc, 0)
          this.thumbCache[ji] = true
          return true
        }
        e = i8.col
        jh = i8.row
        jf = i8.zoom
        jg = i8.useZoom
      }
      return false
    },
    _findChildZoomTile: function (jc, je, e, i9, jn) {
      var jl = 'web'
      var jh = 21
      var jb = jc
      var jd = je
      var jf = e
      var i8 = i9
      var ja = true
      for (var jk = 1; jk <= jn; jk++) {
        var ji = false
        var T = this.tileType.getChildTiles(jb, jd, jf, i8, jh, jk)
        if (!T) {
          continue
        }
        for (var jj = 0; jj < T.length; jj++) {
          var jg = this.getTileKey(T[jj])
          var jm = this.tileCache.getData(jg)
          if (jm && jm.status === 'ready') {
            if (!this.thumbCache[jg]) {
              jm.key = jg
              this.setData(jm, 1)
              this.thumbCache[jg] = true
            }
            ji = true
          } else {
            ja = false
          }
        }
        if (ji) {
          break
        }
      }
      return ja
    },
    sortThumbData: function () {
      var e = this._featureMgr
      if (!e) {
        return
      }
      if (e[0] && e[0].length > 0) {
        e[0].sort(function (T, i) {
          return T.tileInfo.useZoom - i.tileInfo.useZoom
        })
      }
    },
  })
  bo.register(function (i) {
    if (i.config && i.config.isOverviewMap) {
      return
    }
    if (i.isLoaded()) {
      E(i)
    } else {
      i.addEventListener('load', function () {
        E(this)
      })
    }
    i.cityName = '中国'
    i.cCode = '1'
    var e = {}
    e.enableRequest = true
    e.request = function () {
      if (e.enableRequest) {
        e.enableRequest = false
        setTimeout(function () {
          e._request()
        }, 500)
      }
    }
    e._request = function () {
      var i8 = i.getBoundsIn()
      var ja = i.getZoom()
      var T = i8.getSouthWest()
      var i9 = i8.getNorthEast()
      iT.request(
        function (je) {
          if (
            je.current_city['code'] >= 9000 &&
            je.current_city['code'] <= 9378
          ) {
            je.current_city['name'] = '台湾省'
          }
          if (
            je.current_city['code'] >= 20000 &&
            je.current_city['code'] <= 20499
          ) {
            je.current_city['name'] = '新加坡'
          }
          if (
            je.current_city['code'] >= 20500 &&
            je.current_city['code'] <= 25999
          ) {
            je.current_city['name'] = '泰国'
          }
          if (
            je.current_city['code'] >= 26000 &&
            je.current_city['code'] <= 29999
          ) {
            je.current_city['name'] = '日本'
          }
          if (
            je.current_city['code'] >= 30000 &&
            je.current_city['code'] <= 30999
          ) {
            je.current_city['name'] = '韩国'
          }
          if (
            je.current_city['code'] >= 31000 &&
            je.current_city['code'] <= 37000
          ) {
            je.current_city['name'] = '亚太'
          }
          if (
            je.current_city['code'] >= 46609 &&
            je.current_city['code'] <= 52505
          ) {
            je.current_city['name'] = '欧洲'
          }
          if (
            je.current_city['code'] >= 39509 &&
            je.current_city['code'] <= 53500
          ) {
            je.current_city['name'] = '南美洲'
          }
          if (
            je.current_city['code'] >= 54000 &&
            je.current_city['code'] <= 70000
          ) {
            je.current_city['name'] = '北美洲'
          }
          if (
            je.current_city['code'] === 54003 &&
            je.current_city['code'] >= 60731 &&
            je.current_city['code'] <= 61123
          ) {
            je.current_city['name'] = '美国'
          }
          if (
            je.current_city['code'] === 54015 ||
            (je.current_city['code'] >= 57970 &&
              je.current_city['code'] <= 60223)
          ) {
            je.current_city['name'] = '加拿大'
          }
          if (
            je.current_city['code'] === 54025 ||
            (je.current_city['code'] >= 54338 &&
              je.current_city['code'] <= 57374)
          ) {
            je.current_city['name'] = '墨西哥'
          }
          e.enableRequest = true
          if (je && je.current_city) {
            var jd = je.current_city['name']
            var jc = je.current_city['code']
            if (jc !== i.cCode) {
              var jb = new e7('oncitychange')
              jb.name = jd
              jb.code = jc
              i.dispatchEvent(jb)
            }
            i.cityName = jd
            i.cCode = jc
            if (!bJ()) {
              cD(i)
            }
          }
        },
        {
          qt: 'cen',
          b: T.lng + ',' + T.lat + ';' + i9.lng + ',' + i9.lat,
          l: ja,
        },
        '',
        '',
        true
      )
    }
    i.addEventListener('load', function (T) {
      e.request()
    })
    i.addEventListener('moveend', function (T) {
      e.request()
    })
    i.addEventListener('zoomend', function (T) {
      e.request()
    })
    e.request()
  })
  function E(i) {
    if (i.temp.copyadded) {
      return
    }
    i.temp.copyadded = true
    if (!i.cpyCtrl) {
      var i8 = new h3(2, 2)
      i.config.cpyCtrlOffset = i8
      if (bJ()) {
        i8.width = 72
        i8.height = 0
      }
      var T = new ft({ offset: i8, printable: true })
      i.cpyCtrl = T
    }
    if (!bJ()) {
      cD(i)
      i.addEventListener('maptypechange', function () {
        cD(i)
      })
    }
    i.addControl(T)
    var e = new br()
    e._opts = { printable: true }
    i.logoCtrl = e
    i.addControl(e)
    i.addEventListener('resize', function () {
      if (this.getSize().width >= 300 && i.getSize().height >= 100) {
        e.show()
        T.setOffset(i.config.cpyCtrlOffset)
      } else {
        e.hide()
        T.setOffset(new h3(4, 2))
      }
    })
    if (i.getSize().width >= 300 && i.getSize().height >= 100) {
      e.show()
    } else {
      e.hide()
      T.setOffset(new h3(4, 2))
    }
    i.addEventListener('oncopyrightoffsetchange', function (i9) {
      i.logoCtrl.setOffset(i9.target.logo)
      i.cpyCtrl.setOffset(i9.target.cpy)
    })
    i.dispatchEvent(new e7('oncopyrightaddend'))
  }
  function cD(jn) {
    if (!jn.cpyCtrl) {
      var jv = new h3(2, 2)
      if (bJ()) {
        jv.width = 72
        jv.height = 0
      }
      var jq = new ft({ offset: jv, printable: true })
      jn.cpyCtrl = jq
    }
    var jE = jn.cityName || '中国'
    var jo = jn.getMapType()
    var jp = [
      '常州市',
      '南昌市',
      '乌鲁木齐市',
      '无锡市',
      '福州市',
      '泉州市',
      '珠海市',
      '贵阳市',
    ]
    var jh = [
      '北京市',
      '上海市',
      '广州市',
      '深圳市',
      '宁波市',
      '石家庄市',
      '沈阳市',
      '长春市',
      '青岛市',
      '温州市',
      '台州市',
      '金华市',
      '佛山市',
      '中山市',
      '昆明市',
      '南宁市',
      '苏州市',
      '西安市',
      '济南市',
      '郑州市',
      '合肥市',
      '呼和浩特市',
      '杭州市',
      '成都市',
      '武汉市',
      '长沙市',
      '天津市',
      '南京市',
      '重庆市',
      '大连市',
      '东莞市',
      '厦门市',
    ]
    var jj = ['香港特别行政区']
    var jd = ['台湾省']
    var jw = ['日本']
    var jC = ['韩国']
    var jr = ['泰国']
    var ju = ['亚太']
    var je = ['新加坡']
    var jD = ['欧洲']
    var i8 = ['南美洲']
    var jz = ['北美洲']
    var T = ['美国']
    var jt = ['墨西哥']
    var jb = ['加拿大']
    for (var jA in jp) {
      if (jp[jA] === jE) {
        var jk = true
        break
      }
    }
    for (var jA in jh) {
      if (jh[jA] === jE) {
        var i9 = true
        break
      }
    }
    for (var jA in jj) {
      if (jj[jA] === jE) {
        var jG = true
        break
      }
    }
    if (jd[0] === jE) {
      var jy = true
    }
    if (je[0] === jE) {
      var i = true
    }
    if (jw[0] === jE) {
      var jg = true
    }
    if (jC[0] === jE) {
      var jm = true
    }
    if (jr[0] === jE) {
      var jl = true
    }
    if (ju[0] === jE) {
      var jc = true
    }
    if (jD[0] === jE) {
      var ji = true
    }
    if (i8[0] === jE) {
      var jf = true
    }
    if (jz[0] === jE) {
      var e = true
    }
    if (T[0] === jE) {
      var jB = true
    }
    if (jb[0] === jE) {
      var jx = true
    }
    if (jt[0] === jE) {
      var ja = true
    }
    var jF = [
      '&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; ',
    ]
    var js = 'rgba(255, 255, 255, 0.701961)'
    if (jn.getZoom() <= 9) {
      jF = [
        '&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; ',
      ]
    } else {
      if (jy) {
        jF = [
          '&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; ',
        ]
      } else {
        if (jg || jm) {
          jF = [
            '&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; ',
          ]
        } else {
          if (i || jl) {
            jF = [
              '&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; ',
            ]
          } else {
            if (jc) {
              jF = [
                '&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; ',
              ]
            } else {
              if (ji) {
                jF = [
                  '&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; ',
                ]
              } else {
                if (jf) {
                  jF = [
                    '&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; ',
                  ]
                } else {
                  if (e) {
                    jF = [
                      '&copy;&nbsp;2022 Baidu - GS(2021)6026号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; ',
                    ]
                  }
                }
              }
            }
          }
        }
      }
    }
    if (jn.getZoom() <= 9) {
      jF.push('长地万方')
      jF.push(
        ' &amp; <a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>'
      )
      jF.push(
        ' &amp; <a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>'
      )
      if (jo === BMAP_SATELLITE_MAP || jo === BMAP_HYBRID_MAP) {
        jF.push(
          ' &amp; <a target="_blank" href="http://www.eso.org/public/">ESO</a>'
        )
        js = 'rgba(0,0,0,.7)'
      }
    } else {
      if (jg || jm) {
        jF.push(
          '<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>'
        )
      } else {
        if (i || jl) {
          jF.push(
            '<a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>'
          )
        } else {
          if (jc) {
            jF.push(
              '<a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>'
            )
            jF.push(
              ' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>'
            )
          } else {
            if (ji) {
              jF.push(
                '<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>'
              )
              jF.push(
                ' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>'
              )
            } else {
              if (jf) {
                jF.push(
                  '<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>'
                )
                jF.push(
                  ' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>'
                )
              } else {
                if (jB || ja || jx) {
                  jF.push(
                    '<a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>'
                  )
                  jF.push(
                    ' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>'
                  )
                } else {
                  if (e) {
                    jF.push(
                      '<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>'
                    )
                    jF.push(
                      ' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>'
                    )
                  } else {
                    jF.push('长地万方')
                    if (jk) {
                      jF.push(
                        ' &amp; <a target="_blank" href="http://www.palmcity.cn/palmcity/">PalmCity</a>'
                      )
                    }
                    if (jG) {
                      jF.push(
                        ' &amp; <a target="_blank" href="http://www.mapking.com/HongKong/eng/home/MapKing_Webmap.html">MapKing</a>'
                      )
                    }
                    if (jy) {
                      jF.push(
                        ' &amp; <a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>'
                      )
                      jF.push(
                        ' &amp; <a target="_blank" href="http://www.localking.com.tw/about/localking.aspx">樂客LocalKing</a>'
                      )
                    }
                    if (jo === BMAP_SATELLITE_MAP || jo === BMAP_HYBRID_MAP) {
                      js = 'rgba(0,0,0,.7)'
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
    jF.unshift(
      '<span style="background: ' +
        js +
        ';padding: 0px 1px;line-height: 16px;display: inline;height: 16px;">'
    )
    jF.push('</span>')
    jF = jF.join('')
    jn.cpyCtrl.addCopyright({ id: 1, content: jF })
  }
  window.BMAP_STATUS_SUCCESS = 0
  window.BMAP_STATUS_CITY_LIST = 1
  window.BMAP_STATUS_UNKNOWN_LOCATION = 2
  window.BMAP_STATUS_UNKNOWN_ROUTE = 3
  window.BMAP_STATUS_INVALID_KEY = 4
  window.BMAP_STATUS_INVALID_REQUEST = 5
  window.BMAP_STATUS_PERMISSION_DENIED = 6
  window.BMAP_STATUS_SERVICE_UNAVAILABLE = 7
  window.BMAP_STATUS_TIMEOUT = 8
  window.BMAP_ROUTE_TYPE_WALKING = 2
  window.BMAP_ROUTE_TYPE_DRIVING = 3
  window.BMAP_ROUTE_TYPE_RIDING = 6
  window.BMAP_ROUTE_STATUS_NORMAL = 0
  window.BMAP_ROUTE_STATUS_EMPTY = 1
  window.BMAP_ROUTE_STATUS_ADDRESS = 2
  var cQ = 'cur'
  var U = 'cen'
  var D = 's'
  var c7 = 'con'
  var cZ = 'bd'
  var cu = 'nb'
  var gf = 'bt'
  var aE = 'nav'
  var hj = 'walk'
  var fe = 'gc'
  var dt = 'rgc'
  var F = 'dec'
  var hw = 'iploc'
  var f1 = 'bse'
  var fA = 'nse'
  var cN = 'bl'
  var dS = 'bsl'
  var fc = 'bda'
  var dP = 'sa'
  var aZ = 'nba'
  var ho = 'drag'
  var h4 = 'ext'
  var iC = 'exts'
  var iF = 'hip'
  var gK = 'ride'
  var iR = 'drct'
  var eR = 2
  var a5 = 4
  var fl = 7
  var hp = 11
  var bS = 12
  var en = 14
  var cr = 15
  var dG = 18
  var au = 20
  var aY = 21
  var C = 19
  var a = 23
  var hI = 26
  var av = 28
  var fB = 31
  var eA = 35
  var hx = 44
  var a3 = 45
  var aq = 46
  var iA = 47
  var fF = -1
  var a1 = 0
  var bn = 1
  var h8 = 2
  var dj = 3
  window.BMAP_POI_TYPE_NORMAL = 0
  var cg = 1
  var hr = 2
  BMapGL.I = es.I
  var bx = {}
  bx.removeHtml = function (e) {
    e = e.replace(/<\/?[^>]*>/g, '')
    e = e.replace(/[ | ]* /g, ' ')
    return e
  }
  bx.parseGeoExtReg1 = function (e) {
    return e.replace(
      /([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0|[1-9]\d*),([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0|[1-9]\d*)(,)/g,
      '$1,$2;'
    )
  }
  bx.parseGeoExtReg2 = function (i, e) {
    var T = new RegExp(
      '(((-?\\d+)(\\.\\d+)?),((-?\\d+)(\\.\\d+)?);)(((-?\\d+)(\\.\\d+)?),((-?\\d+)(\\.\\d+)?);){' +
        e +
        '}',
      'ig'
    )
    return i.replace(T, '$1')
  }
  var dd = 0
  var cP = 1
  var N = 2
  bx.unique = function (T) {
    var ja = false
    var i9 = []
    var jb = {}
    for (var i8 = 0, e = T.length; i8 < e; i8++) {
      if (!jb[T[i8]]) {
        jb[T[i8]] = true
        i9.push(T[i8])
      }
    }
    return i9
  }
  bx.getBestLevel = function (T, i) {
    if (i) {
      var e = Math.min(i.width / 1100, i.height / 660)
      T = Math.round(T + Math.log(e) / Math.log(2))
    }
    if (T < 1) {
      T = 1
    }
    if (T > 21) {
      T = 21
    }
    return T
  }
  bx.parseGeo = function (jb, je) {
    if (typeof jb != 'string' || !jb) {
      return
    }
    var jg = jb.split('|')
    var e
    var i9
    var T
    if (jg.length == 1) {
      e = bN(jb)
    } else {
      e = bN(jg[2])
      i9 = bN(jg[0])
      T = bN(jg[1])
      if (!je) {
        return e
      }
    }
    var jc = { type: e.geoType }
    if (je) {
      switch (jc.type) {
        case N:
          var jd = new cd(e.geo[0][0], e.geo[0][1])
          var jf = ia.convertMC2LL(jd)
          jc.point = jf
          jc.points = [jf]
          break
        case cP:
          jc.points = []
          var jh = e.geo[0]
          for (var ja = 0, i8 = jh.length - 1; ja < i8; ja += 2) {
            var ji = new cd(jh[ja], jh[ja + 1])
            ji = ia.convertMC2LL(ji)
            jc.points.push(ji)
          }
          i9 = new cd(i9.geo[0][0], i9.geo[0][1])
          T = new cd(T.geo[0][0], T.geo[0][1])
          i9 = ia.convertMC2LL(i9)
          T = ia.convertMC2LL(T)
          jc.bounds = new ha(i9, T)
          break
        default:
          break
      }
    }
    return jc
  }
  bx.parseGeoExt = function (jr, ji) {
    if (!ji) {
      ji = 0
    } else {
      if (ji < 0.25) {
        ji = 0
      } else {
        if (ji > 0.25 && ji < 1) {
          ji = 1
        } else {
          if (ji > 32) {
            ji = 32
          }
        }
      }
    }
    var jd = jr.split('|')
    if (jd.length == 1) {
      var i8 = bN(jd[0])
      return { type: i8.type, bound: '', points: i8.geo.join(',') }
    } else {
      if (jd.length > 1) {
        var jj = jr.split(';.=')
        var jf = []
        var i9 = []
        var jk = 0
        var jo = jj.length
        for (var jl = 0; jl < jo; jl++) {
          var jq = jj[jl]
          if (jo > 1) {
            if (jl == 0) {
              jq = jq + ';'
            }
            if (jl > 0 && jl < jo - 1) {
              jq = '.=' + jq + ';'
            }
            if (jl == jo - 1) {
              jq = '.=' + jq
            }
          }
          var ja = jq.split('|')
          var jn = bN(ja[0])
          var jm = bN(ja[1])
          jf.push(jn.geo.join(','))
          jf.push(jm.geo.join(','))
          var i8 = bN(ja[2])
          jk = i8.type
          var jp = i8.geo.join(',')
          jp = bx.parseGeoExtReg1(jp)
          if (ji > 0) {
            jp = bx.parseGeoExtReg2(jp, ji)
          }
          i9.push(jp)
        }
        if (jo <= 1) {
          i9 = i9.join(';')
        }
        if (jo == 2) {
          var T = i9[0] + ';' + i9[1]
          var jb = T.split(';')
          var e = []
          for (var jl = 0; jl < jb.length; jl++) {
            var je = jb[jl].split(',')[0]
            var jc = jb[jl].split(',')[1]
            var jg = new cd(je, jc)
            var jh = ia.convertMC2LL(jg)
            e.push(jh)
          }
          i9 = e
        }
        return { type: jk, bound: jf.join(';'), points: i9 }
      }
    }
  }
  bx.getPoiPoint = function (e) {
    var T = []
    var i = null
    if (e.toString() == 'Point') {
      i = e
    } else {
      if (typeof e == 'string') {
        T = es.trim(e).split(',')
        if (T.length < 2) {
          return
        }
        T[0] = parseFloat(es.trim(T[0]))
        T[1] = parseFloat(es.trim(T[1]))
      } else {
        T = e.slice(0)
        if (T.length < 2) {
          return
        }
      }
      i = new BMap.Point(T[0], T[1])
    }
    return i
  }
  bx.parseGeoStr = function (T) {
    var i = T.split(',')
    var e = new cd(i[0], i[1])
    return ia.convertMC2LL(e)
  }
  bx.level = { country: 4, province: 11, city: 12, area: 13 }
  var gq = ['=', '.', '-', '*']
  var cK = 1 << 23
  function bN(je) {
    var jd = g6(je.charAt(0))
    var T = je.substr(1)
    var jg = 0
    var e = T.length
    var jh = []
    var jb = []
    var jc = []
    while (jg < e) {
      if (T.charAt(jg) == gq[0]) {
        if (e - jg < 13) {
          return 0
        }
        jc = dF(T.substr(jg, 13), jh)
        if (jc < 0) {
          return 0
        }
        jg += 13
      } else {
        if (T.charAt(jg) == ';') {
          jb.push(jh.slice(0))
          jh.length = 0
          ++jg
        } else {
          if (e - jg < 8) {
            return 0
          }
          jc = bY(T.substr(jg, 8), jh)
          if (jc < 0) {
            return 0
          }
          jg += 8
        }
      }
    }
    for (var ja = 0, i8 = jb.length; ja < i8; ja++) {
      for (var i9 = 0, jf = jb[ja].length; i9 < jf; i9++) {
        jb[ja][i9] /= 100
      }
    }
    return { geoType: jd, geo: jb }
  }
  function g6(i) {
    var e = -1
    if (i == gq[1]) {
      e = N
    } else {
      if (i == gq[2]) {
        e = cP
      } else {
        if (i == gq[3]) {
          e = dd
        }
      }
    }
    return e
  }
  function dF(i9, T) {
    var e = 0
    var jb = 0
    var ja = 0
    for (var i8 = 0; i8 < 6; i8++) {
      ja = c6(i9.substr(1 + i8, 1))
      if (ja < 0) {
        return -1 - i8
      }
      e += ja << (6 * i8)
      ja = c6(i9.substr(7 + i8, 1))
      if (ja < 0) {
        return -7 - i8
      }
      jb += ja << (6 * i8)
    }
    T.push(e)
    T.push(jb)
    return 0
  }
  function bY(ja, i8) {
    var T = i8.length
    if (T < 2) {
      return -1
    }
    var e = 0
    var jc = 0
    var jb = 0
    for (var i9 = 0; i9 < 4; i9++) {
      jb = c6(ja.substr(i9, 1))
      if (jb < 0) {
        return -1 - i9
      }
      e += jb << (6 * i9)
      jb = c6(ja.substr(4 + i9, 1))
      if (jb < 0) {
        return -5 - i9
      }
      jc += jb << (6 * i9)
    }
    if (e > cK) {
      e = cK - e
    }
    if (jc > cK) {
      jc = cK - jc
    }
    i8.push(i8[T - 2] + e)
    i8.push(i8[T - 1] + jc)
    return 0
  }
  function c6(i) {
    var e = i.charCodeAt(0)
    if (i >= 'A' && i <= 'Z') {
      return e - 'A'.charCodeAt(0)
    } else {
      if (i >= 'a' && i <= 'z') {
        return 26 + e - 'a'.charCodeAt(0)
      } else {
        if (i >= '0' && i <= '9') {
          return 52 + e - '0'.charCodeAt(0)
        } else {
          if (i == '+') {
            return 62
          } else {
            if (i == '/') {
              return 63
            }
          }
        }
      }
    }
    return -1
  }
  bx.pathToPoints = function (ja) {
    var i8 = []
    if (typeof ja !== 'string') {
      return i8
    } else {
      var i9 = ja.split(';')
      for (var T = 0; T < i9.length; T++) {
        var e = i9[T].split(',')
        i8.push(new cd(e[0], e[1]))
      }
    }
    return i8
  }
  window.BMAP_POI_TYPE_NORMAL = 0
  window.BMAP_POI_TYPE_BUSSTOP = 1
  window.BMAP_POI_TYPE_BUSLINE = 2
  window.BMAP_POI_TYPE_SUBSTOP = 3
  window.BMAP_POI_TYPE_SUBLINE = 4
  var L = 0
  var gP = 1
  var e3 = {}
  window.APIPack = e3
  function az(i, e) {
    cJ.call(this)
    this._loc = {}
    this.setLocation(i)
    e = e || {}
    e.renderOptions = e.renderOptions || {}
    this._opts = {
      renderOptions: {
        panel: e.renderOptions.panel || null,
        map: e.renderOptions.map || null,
        autoViewport: e.renderOptions.autoViewport || true,
        selectFirstResult: e.renderOptions.selectFirstResult,
        highlightMode: e.renderOptions.highlightMode,
        enableDragging: e.renderOptions.enableDragging || false,
      },
      onSearchComplete: e.onSearchComplete || function () {},
      onMarkersSet: e.onMarkersSet || function () {},
      onInfoHtmlSet: e.onInfoHtmlSet || function () {},
      onResultsHtmlSet: e.onResultsHtmlSet || function () {},
      onGetBusListComplete: e.onGetBusListComplete || function () {},
      onGetBusLineComplete: e.onGetBusLineComplete || function () {},
      onBusListHtmlSet: e.onBusListHtmlSet || function () {},
      onBusLineHtmlSet: e.onBusLineHtmlSet || function () {},
      onPolylinesSet: e.onPolylinesSet || function () {},
      reqFrom: e.reqFrom || '',
    }
    if (
      typeof e != 'undefined' &&
      typeof e.renderOptions != 'undefined' &&
      typeof e.renderOptions['autoViewport'] != 'undefined'
    ) {
      this._opts.renderOptions.autoViewport = e.renderOptions['autoViewport']
    } else {
      this._opts.renderOptions.autoViewport = true
    }
    this._opts.renderOptions.panel = es.G(this._opts.renderOptions.panel)
  }
  az.inherits(cJ, 'BaseSearch')
  es.extend(az.prototype, {
    getResults: function () {
      if (!this._isMultiKey) {
        return this._results
      } else {
        return this._arrResults
      }
    },
    enableAutoViewport: function () {
      this._opts.renderOptions.autoViewport = true
    },
    disableAutoViewport: function () {
      this._opts.renderOptions.autoViewport = false
    },
    setLocation: function (e) {
      if (!e) {
        return
      }
      this._loc.src = e
    },
    setSearchCompleteCallback: function (e) {
      this._opts.onSearchComplete = e || function () {}
    },
    setMarkersSetCallback: function (e) {
      this._opts.onMarkersSet = e || function () {}
    },
    setPolylinesSetCallback: function (e) {
      this._opts.onPolylinesSet = e || function () {}
    },
    setInfoHtmlSetCallback: function (e) {
      this._opts.onInfoHtmlSet = e || function () {}
    },
    setResultsHtmlSetCallback: function (e) {
      this._opts.onResultsHtmlSet = e || function () {}
    },
    getStatus: function () {
      return this._status
    },
  })
  var cf = function (T, i) {
    az.call(this, T, i)
    i = i || {}
    i.renderOptions = i.renderOptions || {}
    this.setPageCapacity(i.pageCapacity)
    if (
      typeof i.renderOptions['selectFirstResult'] != 'undefined' &&
      !i.renderOptions['selectFirstResult']
    ) {
      this.disableFirstResultSelection()
    } else {
      this.enableFirstResultSelection()
    }
    this._overlays = []
    this._arrPois = []
    this._curIndex = -1
    this._queryList = []
    var e = this
    gi.load(
      'localSearch',
      function () {
        e._check()
      },
      true
    )
  }
  cf.inherits(az, 'LocalSearch')
  cf.DEFAULT_PAGE_CAPACITY = 10
  cf.MIN_PAGE_CAPACITY = 1
  cf.MAX_PAGE_CAPACITY = 100
  cf.DEFAULT_RADIUS = 2000
  cf.MAX_RADIUS = 100000
  es.extend(cf.prototype, {
    search: function (e, i) {
      this._queryList.push({ method: 'search', arguments: [e, i] })
    },
    searchInBounds: function (e, T, i) {
      this._queryList.push({ method: 'searchInBounds', arguments: [e, T, i] })
    },
    searchNearby: function (T, i, e, i8) {
      this._queryList.push({ method: 'searchNearby', arguments: [T, i, e, i8] })
    },
    clearResults: function () {
      delete this._json
      delete this._status
      delete this._results
      delete this._ud
      this._curIndex = -1
      this._setStatus()
      if (this._opts.renderOptions.panel) {
        this._opts.renderOptions.panel.innerHTML = ''
      }
    },
    gotoPage: function () {},
    enableFirstResultSelection: function () {
      this._opts.renderOptions.selectFirstResult = true
    },
    disableFirstResultSelection: function () {
      this._opts.renderOptions.selectFirstResult = false
    },
    setPageCapacity: function (e) {
      if (typeof e == 'number' && !isNaN(e)) {
        this._opts.pageCapacity =
          e < 1
            ? cf.DEFAULT_PAGE_CAPACITY
            : e > cf.MAX_PAGE_CAPACITY
            ? cf.DEFAULT_PAGE_CAPACITY
            : e
      } else {
        this._opts.pageCapacity = cf.DEFAULT_PAGE_CAPACITY
      }
    },
    getPageCapacity: function () {
      return this._opts.pageCapacity
    },
    toString: function () {
      return 'LocalSearch'
    },
  })
  function a6(i) {
    this._opts = {}
    es.extend(this._opts, i)
    this._queryList = []
    var e = this
    gi.load('otherSearch', function () {
      e._asyncSearch()
    })
  }
  a6.inherits(cJ, 'Geocoder')
  es.extend(a6.prototype, {
    getPoint: function (e, T, i) {
      this._queryList.push({ method: 'getPoint', arguments: [e, T, i] })
    },
    getLocation: function (e, T, i) {
      this._queryList.push({ method: 'getLocation', arguments: [e, T, i] })
    },
    toString: function () {
      return 'Geocoder'
    },
  })
  function cz(e) {
    e = e || {}
    this.config = {
      timeout: e.timeout || 1000 * 10,
      maximumAge: e.maximumAge || 0,
      enableHighAccuracy: e.enableHighAccuracy || true,
      SDKLocation: e.SDKLocation || false,
    }
    this._pendingCalls = []
    var i = this
    gi.load('otherSearch', function () {
      var T = i._pendingCalls.length
      for (var i8 = 0; i8 < T; i8++) {
        var i9 = i._pendingCalls[i8]
        i[i9.method].apply(i, i9.arguments)
      }
    })
  }
  es.extend(cz.prototype, {
    getCurrentPosition: function (e, i) {
      this._pendingCalls.push({
        method: 'getCurrentPosition',
        arguments: arguments,
      })
    },
    getStatus: function () {
      return BMAP_STATUS_UNKNOWN_LOCATION
    },
    enableSDKLocation: function () {
      if (bJ()) {
        this.config.SDKLocation = true
      }
    },
    disableSDKLocation: function () {
      this.config.SDKLocation = false
    },
  })
  function eN() {
    this._queryList = []
    var e = this
    gi.load('otherSearch', function () {
      e._asyncSearch()
    })
  }
  eN.inherits(cJ, 'Boundary')
  es.extend(eN.prototype, {
    get: function (i, e) {
      this._queryList.push({ method: 'get', arguments: [i, e] })
    },
    toString: function () {
      return 'Boundary'
    },
    parsebdStr: function (i, e) {},
  })
  function eG(i) {
    i = i || {}
    i.renderOptions = i.renderOptions || {}
    this._opts = { renderOptions: { map: i.renderOptions.map || null } }
    this._queryList = []
    var e = this
    gi.load('otherSearch', function () {
      e._asyncSearch()
    })
  }
  eG.inherits(cJ, 'LocalCity')
  es.extend(eG.prototype, {
    get: function (e) {
      this._queryList.push({ method: 'get', arguments: [e] })
    },
    toString: function () {
      return 'LocalCity'
    },
  })
  function gu(e, T) {
    cJ.call(this)
    this.markersList = []
    this.destList = []
    this.pointsList = []
    this._opts = T
    this.json = e
    this.map = this._opts.renderOptions.map || null
    this.sType = this._opts.sType
    this.infoWindow = null
    this.curPointIndex = 0
    this.startName = ''
    this.endIndex = 1
    this.endName = ''
    this.resCity = [0, 0, 0, 0, 0, 0, 0]
    this.locPois = []
    this.curPageIndex = [1, 1, 1, 1, 1, 1, 1]
    this.totalPage = [1, 1, 1, 1, 1, 1, 1]
    this.resCount = [0, 0, 0, 0, 0, 0, 0]
    this.resType = [0, 0, 0, 0, 0, 0, 0]
    this.qInfo = [
      { n: '', c: 0, u: 0, x: 0, y: 0, t: -1 },
      { n: '', c: 0, u: 0, x: 0, y: 0, t: -1 },
      { n: '', c: 0, u: 0, x: 0, y: 0, t: -1 },
      { n: '', c: 0, u: 0, x: 0, y: 0, t: -1 },
      { n: '', c: 0, u: 0, x: 0, y: 0, t: -1 },
      { n: '', c: 0, u: 0, x: 0, y: 0, t: -1 },
      { n: '', c: 0, u: 0, x: 0, y: 0, t: -1 },
    ]
    this.curSelectedIndex = -1
    this.tpList = []
    this.tpListInMap = []
    var i = this
    gi.load('route', function () {})
  }
  gu.inherits(cJ, 'RouteAddr')
  function d2(T, i) {
    az.call(this, T, i)
    this.QUERY_TYPE_BUSLIST = cN
    this.RETURN_TYPE_BUSLIST = cr
    this.QUERY_TYPE_BUSLINE = dS
    this.RETURN_TYPE_BUSLINE = dG
    this._queryList = []
    var e = this
    gi.load('buslineSearch', function () {
      e._asyncSearch()
    })
  }
  var e2 = w.staticHost + '/wolfman/static/common/images/'
  d2._iconOpen = w.apiIMG + '/iw_plus.gif'
  d2._iconClose = w.apiIMG + '/iw_minus.gif'
  d2._stopUrl = e2 + 'new/bus-stop-1x_ddd4723.png'
  d2.inherits(az, 'BusLineSearch')
  es.extend(d2.prototype, {
    getBusList: function (e) {
      this._queryList.push({ method: 'getBusList', arguments: [e] })
    },
    getBusLine: function (e) {
      this._queryList.push({ method: 'getBusLine', arguments: [e] })
    },
    setGetBusListCompleteCallback: function (e) {
      this._opts.onGetBusListComplete = e || function () {}
    },
    setGetBusLineCompleteCallback: function (e) {
      this._opts.onGetBusLineComplete = e || function () {}
    },
    setBusListHtmlSetCallback: function (e) {
      this._opts.onBusListHtmlSet = e || function () {}
    },
    setBusLineHtmlSetCallback: function (e) {
      this._opts.onBusLineHtmlSet = e || function () {}
    },
    setPolylinesSetCallback: function (e) {
      this._opts.onPolylinesSet = e || function () {}
    },
  })
  function h5(i) {
    az.call(this, i)
    i = i || {}
    this._options = {
      input: i.input || null,
      baseDom: i.baseDom || null,
      types: i.types || [],
      onSearchComplete: i.onSearchComplete || function () {},
    }
    this._loc.src = i.location || '全国'
    this._word = ''
    this._show = false
    this._suggestion = null
    this._inputValue = ''
    this._initialize()
    var e = this
    gi.load(
      'autocomplete',
      function () {
        e._asyncSearch()
      },
      true
    )
  }
  h5.inherits(az, 'Autocomplete')
  es.extend(h5.prototype, {
    _initialize: function () {},
    show: function () {
      this._show = true
    },
    hide: function () {
      this._show = false
    },
    setTypes: function (e) {
      this._options.types = e
    },
    setLocation: function (e) {
      this._loc.src = e
    },
    search: function (e) {
      this._word = e
    },
    setInputValue: function (e) {
      this._inputValue = e
    },
    setSearchCompleteCallback: function (e) {
      this._options.onSearchComplete = e
    },
  })
  var iI = function (i, e) {
    az.call(this, i, e)
  }
  es.inherit(iI, az, 'BaseRoute')
  es.extend(iI.prototype, { clearResults: function () {} })
  window.BMAP_TRANSIT_POLICY_RECOMMEND = 0
  window.BMAP_TRANSIT_POLICY_LEAST_TIME = 4
  window.BMAP_TRANSIT_POLICY_LEAST_TRANSFER = 1
  window.BMAP_TRANSIT_POLICY_LEAST_WALKING = 2
  window.BMAP_TRANSIT_POLICY_AVOID_SUBWAYS = 3
  window.BMAP_TRANSIT_POLICY_FIRST_SUBWAYS = 5
  window.BMAP_LINE_TYPE_BUS = 0
  window.BMAP_LINE_TYPE_SUBWAY = 1
  window.BMAP_LINE_TYPE_FERRY = 2
  window.BMAP_LINE_TYPE_TRAIN = 3
  window.BMAP_LINE_TYPE_AIRPLANE = 4
  window.BMAP_LINE_TYPE_COACH = 5
  var hs = 3
  var dE = 4
  var ab = 1
  var hq = 2
  var aM = 5
  var ct = 6
  window.BMAP_TRANSIT_TYPE_IN_CITY = 0
  window.BMAP_TRANSIT_TYPE_CROSS_CITY = 1
  window.BMAP_TRANSIT_PLAN_TYPE_ROUTE = 0
  window.BMAP_TRANSIT_PLAN_TYPE_LINE = 1
  window.BMAP_TRANSIT_TYPE_POLICY_TRAIN = 0
  window.BMAP_TRANSIT_TYPE_POLICY_AIRPLANE = 1
  window.BMAP_TRANSIT_TYPE_POLICY_COACH = 2
  window.BMAP_INTERCITY_POLICY_LEAST_TIME = 0
  window.BMAP_INTERCITY_POLICY_EARLY_START = 1
  window.BMAP_INTERCITY_POLICY_CHEAP_PRICE = 2
  function eh(T, i) {
    iI.call(this, T, i)
    i = i || {}
    this.setPolicy(i.policy)
    this.setIntercityPolicy(i.intercityPolicy)
    this.setTransitTypePolicy(i.transitTypePolicy)
    this.setPageCapacity(i.pageCapacity)
    this.QUERY_TYPE = gf
    this.RETURN_TYPE = en
    this.ROUTE_TYPE = gP
    this._overlays = []
    this._curIndex = -1
    this._opts._enableTraffic = i.enableTraffic || false
    this._queryList = []
    var e = this
    gi.load(
      'route',
      function () {
        e._asyncSearch()
      },
      true
    )
  }
  eh.MAX_PAGE_CAPACITY = 100
  eh.LINE_TYPE_MAPPING = [0, 1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 1, 1, 1]
  eh.LINE_TYPE_MAPPING_CROSS_CITY = [0, 3, 4, 0, 0, 0, 5]
  es.inherit(eh, iI, 'TransitRoute')
  es.extend(eh.prototype, {
    setPolicy: function (e) {
      if (
        e >= BMAP_TRANSIT_POLICY_RECOMMEND &&
        e <= BMAP_TRANSIT_POLICY_FIRST_SUBWAYS
      ) {
        this._opts.policy = e
      } else {
        this._opts.policy = BMAP_TRANSIT_POLICY_RECOMMEND
      }
    },
    setIntercityPolicy: function (e) {
      if (
        e >= BMAP_INTERCITY_POLICY_LEAST_TIME &&
        e <= BMAP_INTERCITY_POLICY_CHEAP_PRICE
      ) {
        this._opts.intercityPolicy = e
      } else {
        this._opts.intercityPolicy = BMAP_INTERCITY_POLICY_LEAST_TIME
      }
    },
    setTransitTypePolicy: function (e) {
      if (
        e >= BMAP_TRANSIT_TYPE_POLICY_TRAIN &&
        e <= BMAP_TRANSIT_TYPE_POLICY_COACH
      ) {
        this._opts.transitTypePolicy = e
      } else {
        this._opts.transitTypePolicy = BMAP_TRANSIT_TYPE_POLICY_TRAIN
      }
    },
    _internalSearch: function (i, e) {
      this._queryList.push({ method: '_internalSearch', arguments: [i, e] })
    },
    search: function (i, e) {
      this._queryList.push({ method: 'search', arguments: [i, e] })
    },
    setPageCapacity: function (e) {
      if (typeof e === 'string') {
        e = parseInt(e, 10)
        if (isNaN(e)) {
          this._opts.pageCapacity = eh.MAX_PAGE_CAPACITY
          return
        }
      }
      if (typeof e !== 'number') {
        this._opts.pageCapacity = eh.MAX_PAGE_CAPACITY
        return
      }
      if (e >= 1 && e <= eh.MAX_PAGE_CAPACITY) {
        this._opts.pageCapacity = Math.round(e)
      } else {
        this._opts.pageCapacity = eh.MAX_PAGE_CAPACITY
      }
    },
    toString: function () {
      return 'TransitRoute'
    },
    _shortTitle: function (e) {
      return e.replace(/\(.*\)/, '')
    },
  })
  window.BMAP_HIGHLIGHT_STEP = 1
  window.BMAP_HIGHLIGHT_ROUTE = 2
  var ci = function (e, i8) {
    iI.call(this, e, i8)
    this._overlays = []
    this._curIndex = -1
    this._queryList = []
    var T = this
    var i = this._opts.renderOptions
    if (
      i.highlightMode !== BMAP_HIGHLIGHT_STEP &&
      i.highlightMode !== BMAP_HIGHLIGHT_ROUTE
    ) {
      i.highlightMode = BMAP_HIGHLIGHT_STEP
    }
    this._enableDragging = this._opts.renderOptions.enableDragging
      ? true
      : false
    gi.load(
      'route',
      function () {
        T._asyncSearch()
      },
      true
    )
    if (this.init_d) {
      this.init_d()
    }
  }
  ci.ROAD_TYPE = [
    '',
    '环岛',
    '无属性道路',
    '主路',
    '高速连接路',
    '交叉点内路段',
    '连接道路',
    '停车场内部道路',
    '服务区内部道路',
    '桥',
    '步行街',
    '辅路',
    '匝道',
    '全封闭道路',
    '未定义交通区域',
    'POI连接路',
    '隧道',
    '步行道',
    '公交专用道',
    '提前右转道',
  ]
  es.inherit(ci, iI, 'DWRoute')
  es.extend(ci.prototype, {
    search: function (T, e, i) {
      this._queryList.push({ method: 'search', arguments: [T, e, i] })
    },
  })
  window.BMAP_DRIVING_POLICY_DEFAULT = 0
  window.BMAP_DRIVING_POLICY_AVOID_HIGHWAYS = 3
  window.BMAP_DRIVING_POLICY_FIRST_HIGHWAYS = 4
  window.BMAP_DRIVING_POLICY_AVOID_CONGESTION = 5
  window.BMAP_TRAFFICE_STATUS_NONE = 0
  window.BMAP_TRAFFICE_STATUS_NORMAL = 1
  window.BMAP_TRAFFICE_STATUS_SLOW = 2
  window.BMAP_TRAFFICE_STATUS_JAM = 3
  function b7(e, i) {
    ci.call(this, e, i)
    i = i || {}
    this._opts._enableTraffic = i.enableTraffic || false
    this.setPolicy(i.policy)
    this.QUERY_TYPE = aE
    this.RETURN_TYPE = au
    this.ROUTE_TYPE = BMAP_ROUTE_TYPE_DRIVING
  }
  es.inherit(b7, ci, 'DrivingRoute')
  b7.prototype.setPolicy = function (e) {
    if (
      e >= BMAP_DRIVING_POLICY_DEFAULT &&
      e <= BMAP_DRIVING_POLICY_AVOID_CONGESTION
    ) {
      this._opts.policy = e
    } else {
      this._opts.policy = BMAP_DRIVING_POLICY_DEFAULT
    }
  }
  function eS(e, i) {
    ci.call(this, e, i)
    this.QUERY_TYPE = hj
    this.RETURN_TYPE = fB
    this.ROUTE_TYPE = BMAP_ROUTE_TYPE_WALKING
    this._enableDragging = false
  }
  es.inherit(eS, ci, 'WalkingRoute')
  function cG(e, i) {
    ci.call(this, e, i)
    this.QUERY_TYPE = gK
    this.ROUTE_TYPE = BMAP_ROUTE_TYPE_RIDING
    this._enableDragging = false
  }
  es.inherit(cG, ci, 'RidingRoute')
  window.BMAP_MODE_DRIVING = 'driving'
  window.BMAP_MODE_TRANSIT = 'transit'
  window.BMAP_MODE_WALKING = 'walking'
  window.BMAP_MODE_NAVIGATION = 'navigation'
  var aS = {
    web: '//api.map.baidu.com/direction?',
    android: 'bdapp://map/direction?',
    ios: 'baidumap://map/direction?',
  }
  function hN(e) {
    this.opts = e || {}
  }
  es.extend(hN.prototype, {
    routeCall: function (i8, e, T) {
      var i = this
      gi.load('route', function () {
        i._asyncSearch(i8, e, T)
      })
    },
  })
  function dD() {
    return Pano.getStreetViewCoverageLayer(bo)
  }
  function ej() {
    Pano.PanoramaService.call(this)
  }
  es.inherit(ej, Pano.PanoramaService, 'PanoramaService')
  es.extend(ej.prototype, {
    getPanoramaById: function (T, i) {
      var e = this
      this.getPanoById(T, function (i8) {
        i && i(e._makeData(i8))
      })
    },
    getPanoramaByLocation: function (e, T) {
      e = ia.convertLL2MC(e)
      var i = this
      this.getPanoByLocation(e, 50, function (i8) {
        T && T(i._makeData(i8))
      })
    },
    _makeData: function (T) {
      if (!T) {
        return null
      }
      var i = {}
      var e = T.content[0]
      i.description = e.Rname || e.Info || ''
      i.id = e.ID
      i.pointX = e.X / 100
      i.pointY = e.Y / 100
      i.position = ia.convertMC2LL(new cd(i.pointX, i.pointY))
      return i
    },
  })
  function eJ() {
    if (window.PANORAMA_URL) {
      return Pano.getPanoControl(bo, {
        imgPath: w.imgPath,
        tileBaseUrl: w.panoTilePath,
      })
    }
    return Pano.getPanoControl(bo)
  }
  function J(T, e) {
    if (!e) {
      return
    }
    this.content = T
    if (e.position && !Array.isArray(e.position)) {
      e.position = ia.convertLL2MC(e.position)
      this.position = e.position
      this.hideDistance = !!e.hideDistance
    } else {
      this.hideDistance = true
    }
    var i = this._createDom()
    Pano.PanoOverlay.call(this, e.position, { dom: i, altitude: e.altitude })
  }
  es.inherit(J, Pano.PanoOverlay, 'PanoramaLabel')
  es.extend(J.prototype, {
    init: function (e) {
      var i = this
      this._pano = e
      this.updatedDistance()
      Pano.PanoOverlay.prototype.init.call(this, e)
      this._pano.on('dataload', function (T) {
        i.updatedDistance()
      })
    },
    _createDom: function () {
      var i8 = this.content
      var jb = document.createElement('div')
      var i = jb.style
      i.position = 'absolute'
      i.backgroundColor = 'rgba(29, 29, 29, 0.8)'
      i.padding = '7px 0'
      i.height = '19px'
      i.font = '16px arial'
      i.color = 'white'
      i.whiteSpace = 'nowrap'
      i.borderRadius = '4px'
      var e = document.createElement('div')
      e.style['float'] = 'left'
      e.style['lineHeight'] = '19px'
      jb.appendChild(e)
      var T = document.createElement('span')
      T.style.margin = '0 14px'
      T.innerText = i8
      e.appendChild(T)
      if (!this.hideDistance) {
        var ja = document.createElement('span')
        ja.style.color = 'color:rgba(255,255,255,0.3)'
        ja.innerText = '|'
        e.appendChild(ja)
        var i9 = document.createElement('span')
        i9.style.margin = '0 8px'
        i9.style.color = '#60c7fa'
        i9.style.fontSize = '12px'
        i9.innerText = '0米'
        e.appendChild(i9)
        this._distanceDom = i9
      }
      this._dom = jb
      this._titleDom = T
      return jb
    },
    updatedDistance: function () {
      if (this.hideDistance) {
        return
      }
      var T = 0
      if (this._pano) {
        var i = this._pano.position
        var e = this.position
        if (i && !i.equals(e)) {
          T = ia.getDistanceByMC(i, e)
        }
      }
      if (T > 100) {
        T = T / 1000
        T = T < 100 ? T.toFixed(2) : T.toFixed(0)
        T += '公里'
      } else {
        T = T < 100 ? T.toFixed(2) : T.toFixed(0)
        T += '米'
      }
      this._distanceDom.innerText = T
    },
  })
  function c(i) {
    if (typeof i === 'string' && /^(?!#)(\w)*/.test(i)) {
      i = '#' + i
    }
    var i8 = {}
    if (window.PANORAMA_URL) {
      i8.imgPath = w.imgPath
      i8.tileBaseUrls = [w.panoTilePath]
    }
    var e = Pano.init(i, i8)
    var T = e.setPosition
    e.setPosition = function (ja) {
      var jb = ia.convertLL2MC(ja)
      T.call(e, jb)
    }
    var i9 = e.addEventListener
    e.addEventListener = function (ja, jb) {
      if (ja === 'position_changed') {
        i9.call(e, ja, function (jc) {
          var jd = ia.convertMC2LL(jc)
          jb(jd)
        })
      } else {
        i9.call(e, ja, jb)
      }
    }
    return e
  }
  bo.Map = gV
  bo.MapType = dO
  bo.Point = cd
  bo.Pixel = eL
  bo.Size = h3
  bo.Bounds = ha
  bo.PrivateRegionDataModel = cp
  bo.TileLayer = gI
  bo.Copyright = h
  bo.Projection = bo.Project = ia
  bo.XYZProjection = bo.XYZProject = da
  bo.Convertor = fg
  bo.RenderTypeUtils = cH
  bo.Overlay = aH
  bo.Label = g3
  bo.Marker = r
  bo.Icon = ir
  bo.Polyline = bc
  bo.BezierCurve = cl
  bo.PolylineMultipart = dQ
  bo.Polygon = hM
  bo.MapMask = iW
  bo.Prism = bi
  bo.Marker3D = dH
  bo.GroundOverlay = fm
  bo.InfoWindow = dz
  bo.SimpleInfoWindow = hd
  bo.Circle = aK
  bo.Control = f0
  bo.NavigationControl = iE
  bo.NavigationControl3D = eu
  bo.CopyrightControl = ft
  bo.ScaleControl = i7
  bo.CityListControl = bj
  bo.MapTypeControl = u
  bo.ZoomControl = id
  bo.LocationControl = fJ
  bo.LogoControl = br
  bo.DistanceTool = bZ
  bo.ContextMenu = gz
  bo.MenuItem = g8
  bo.OperationMask = ae
  bo.Animation = e0
  bo.ViewAnimation = n
  bo.Transitions = fT
  bo.Event = e7
  bo.trafficLayer = iB
  bo.TrafficLayer = ii
  bo.XYZLayer = iX
  bo.PixelLayer = c2
  bo.BaiduLayer = O
  bo.Geolocation = cz
  bo.Geocoder = a6
  bo.Boundary = eN
  bo.DistrictLayer = dw
  bo.LocalCity = eG
  bo.LocalSearch = cf
  bo.Autocomplete = h5
  bo.BusLineSearch = d2
  bo.WalkingRoute = eS
  bo.RidingRoute = cG
  bo.DrivingRoute = b7
  bo.TransitRoute = eh
  bo.RouteSearch = hN
  bo.PanoramaCoverageLayer = dD
  bo.PanoramaControl = eJ
  bo.PanoramaService = ej
  bo.PanoramaLabel = J
  bo.Panorama = c
  function gr(e, i) {
    for (var T in i) {
      e[T] = i[T]
    }
  }
  bo.fetchDebug && bo.fetchDebug.init()
  bo.verify()
  bo.apiLoad()
  bo.frequency()
  bo.getSeckeyCid()
  window._layer = 1
  es.extend(dw.prototype, {
    _asyncSearch: function () {
      for (var T = 0, e = this._queryList.length; T < e; T++) {
        var i8 = this._queryList[T]
        this[i8.method].apply(this, i8.arguments)
      }
      delete this._queryList
    },
    addDistrict: function () {
      if (this._opts.districts) {
        var e = this._opts.districts
        if (typeof e === 'string') {
          this.getDistrictData(e)
        } else {
          if (Object.prototype.toString.call(e) === '[object Array]') {
            var i = this.parseArrayParams(e)
            this.getDistrictData(i)
          }
        }
      }
    },
    parseArrayParams: function (e) {
      var i9 = ''
      for (var i8 = 0; i8 < e.length; i8++) {
        if (e[i8] instanceof Array) {
          i9 += '('
          for (var T = 0; T < e.length; T++) {
            i9 += e[T]
          }
          i9 += ')'
        } else {
          i9 += '(' + e[i8] + ')'
        }
      }
      return i9
    },
    getDistrictData: function (e) {
      var i = this
      iT.request(
        function (i8) {
          var T = i._parseGeoData(i8)
          i._drawToMap(i, T)
        },
        { qt: iC, adnames: e, level: i._opts.kind }
      )
    },
    _drawToMap: function (jh, jd) {
      var jg = jd.boundaries.length
      if (jg === 0) {
        alert('未能获取当前输入行政区域')
        return
      }
      var ji = this._config.fillColor
      var ja = this._config.fillOpacity
      var T = this._config.strokeColor
      var e = this._config.strokeOpacity
      var je = this._config.strokeWeight
      if (typeof ji === 'string') {
        var i8 = ji
        var jj = []
        for (var jc = 0; jc < jg; jc++) {
          var jf = new BMapGL.Polygon(jd.boundaries[jc], {
            strokeWeight: je,
            strokeColor: T,
            strokeOpacity: e,
            fillColor: i8,
            fillOpacity: ja,
          })
          jf.style = {
            strokeWeight: je,
            strokecolor: T,
            strokeOpacity: e,
            fillColor: i8,
            fillOpacity: ja,
          }
          this.disOverlays.push(jf)
          this.addEventListenerIn()
          jh._map.addOverlay(jf)
          jj = jj.concat(jf.getPath())
        }
        if (this._config.viewport) {
          jh._map.setViewport(jj)
        }
      } else {
        if (Object.prototype.toString.call(ji) === '[object Array]') {
          var jj = []
          var jb = ji.length
          if (jb < jg) {
            for (var jc = 0, i9 = 0; jc < jg - jb; jc++) {
              if (i9 < jb - 1) {
                ji.push(ji[i9++])
              } else {
                ji.push(ji[0])
              }
            }
          }
          for (var jc = 0; jc < jg; jc++) {
            var i8 = ji[jc]
            var jf = new BMapGL.Polygon(jd.boundaries[jc], {
              strokeWeight: je,
              strokeColor: T,
              strokeOpacity: e,
              fillColor: i8,
              fillOpacity: ja,
            })
            jf.style = {
              strokeWeight: je,
              strokecolor: T,
              strokeOpacity: e,
              fillColor: i8,
              fillOpacity: ja,
            }
            this.disOverlays.push(jf)
            this.addEventListenerIn()
            jh._map.addOverlay(jf)
            jj = jj.concat(jf.getPath())
          }
          if (this._config.viewport) {
            jh._map.setViewport(jj)
          }
        }
      }
    },
    _parseGeoData: function (jh) {
      var jk = {}
      jk.boundaries = []
      if (jh && jh.content && jh.content['geo']) {
        for (var jp = 0; jp < jh.content['geo'].length; jp++) {
          var i8 = bx.parseGeo(jh.content['geo'][jp], false)
          if (i8.geo && i8.geo.length && i8.geo.length > 0) {
            var jn = i8.geo.length
            for (io = 0; io < jn; io++) {
              var T = i8.geo[io]
              if (T && T.length && T.length > 0) {
                var jf = T.length - 1
                var jm = []
                var je = false
                var jl = 0
                var jj = 0
                for (var jo = 0; jo < jf; jo += 2) {
                  var jc = T[jo]
                  var ja = T[jo + 1]
                  var ji = new cd(jc, ja)
                  ji = ia.convertMC2LL(ji)
                  if (jo < jf - 3) {
                    var i = T[jo + 2]
                    var e = T[jo + 3]
                    var jg = new cd(i, e)
                    jg = ia.convertMC2LL(jg)
                  }
                  jm.push(ji.lng + ', ' + ji.lat)
                }
                if (je === true) {
                  if (jl > jj) {
                    var jq = jl
                    jl = jj
                    jj = jq
                  }
                  var jd = jm
                  var jb = jm.splice(jl + 1)
                  var i9 = jb.splice(jj - jl)
                  jd = jd.concat(i9)
                  jk.boundaries.push(jd.join(';'))
                  jk.boundaries.push(jb.join(';'))
                  je = false
                  continue
                }
                if (jm.length !== 0) {
                  jk.boundaries.push(jm.join(';'))
                }
              }
            }
          }
        }
      }
      return jk
    },
    deleteDistrict: function (i8) {
      var T = i8.disOverlays
      for (var e = 0; e < T.length; e++) {
        this._map.removeOverlay(T[e])
      }
    },
    addEventListener: function (e, i) {
      this.eventAndCallback[e] = i
    },
    addEventListenerIn: function () {
      var i8 = this
      var ja = Object.keys(i8.eventAndCallback)
      if (ja.length > 0) {
        for (var T = 0; T < ja.length; T++) {
          var i9 = i8.eventAndCallback[ja[T]]
          for (var e = 0; e < i8.disOverlays.length; e++) {
            i8.disOverlays[e].addEventListener(ja[T], i9)
          }
        }
      }
    },
    searchBoundary: function (i, i9) {
      i = i || {}
      var e = i.name || ''
      var T = i.kind || 0
      var i8 = this
      iT.request(
        function (jb) {
          var ja = i8._parseGeoData(jb)
          i9 && i9(ja)
        },
        { qt: iC, adnames: e, level: T }
      )
    },
  })
  window._layer = 2
})(BMapGL, 'BMapGL')