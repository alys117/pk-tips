<input type="file" id="excelFileInput" accept=".xlsx" />
<div id="output"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script>
  document.getElementById('excelFileInput').addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      const data = new Uint8Array(e.target.result);
      processExcel(data);
    };
    reader.readAsArrayBuffer(file);
  });

  function processExcel(data) {
    // 使用 JSZip 解压 Excel 文件
    JSZip.loadAsync(data).then(function (zip) {
      // 获取图片文件
      const imageFiles = [];
      zip.forEach((relativePath, file) => {
        if (relativePath.startsWith('xl/media/')) {
          imageFiles.push(file);
        }
      });

      // 解析 Excel 数据
      const workbook = XLSX.read(data, { type: 'array' });
      const sheet = workbook.Sheets[workbook.SheetNames[0]];

      // 遍历单元格，查找包含图片的单元格
      const output = document.getElementById('output');
      output.innerHTML = '';

      for (let cellAddress in sheet) {
        console.log(cellAddress, sheet[cellAddress]);
        // if (sheet[cellAddress].t === 'e' && sheet[cellAddress].v.startsWith('rId')) {
        //   // 假设图片的关联信息在单元格中
        //   const imageIndex = parseInt(sheet[cellAddress].v.replace('rId', '')) - 1;
        //   if (imageFiles[imageIndex]) {
        //     imageFiles[imageIndex].async('blob').then(function (blob) {
        //       const imgUrl = URL.createObjectURL(blob);
        //       const img = document.createElement('img');
        //       img.src = imgUrl;
        //       img.style.width = '100px';
        //       output.appendChild(img);
        //     });
        //   }
        // }
      }
    });
  }
</script>